

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Runtime - Task Configuration &mdash; Cylc 8.0b2 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/diff_selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/grid_table.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/hieroglyph_theme_addons.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/tutorial.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/addons.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/cylc-favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/js/diff_selector.js"></script>
        <script src="../../_static/js/minicylc.js"></script>
        <script src="../../_static/js/spoiler.js"></script>
        <script src="../../_static/js/addons.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Parameterized Tasks" href="parameterized-tasks.html" />
    <link rel="prev" title="Scheduling - Dependency Graphs" href="scheduling.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/cylc-logo-white.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                8.0b2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../7-to-8/index.html">Cylc 8 Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../workflows.html">Workflows For Cycling Systems</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Writing Workflows</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="configuration.html">Workflow Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="scheduling.html">Scheduling - Dependency Graphs</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Runtime - Task Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#namespace-names">Namespace Names</a></li>
<li class="toctree-l4"><a class="reference internal" href="#root-runtime-defaults">Root - Runtime Defaults</a></li>
<li class="toctree-l4"><a class="reference internal" href="#defining-multiple-namespaces-at-once">Defining Multiple Namespaces At Once</a></li>
<li class="toctree-l4"><a class="reference internal" href="#runtime-inheritance-single">Runtime Inheritance - Single</a></li>
<li class="toctree-l4"><a class="reference internal" href="#runtime-inheritance-multiple">Runtime Inheritance - Multiple</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-runtime-inheritance-works">How Runtime Inheritance Works</a></li>
<li class="toctree-l4"><a class="reference internal" href="#task-execution-environment">Task Execution Environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-tasks-get-access-to-the-run-directory">How Tasks Get Access To The Run Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#remote-task-hosting">Remote Task Hosting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#implicit-tasks">Implicit Tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#automatic-task-retry-on-failure">Automatic Task Retry On Failure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#event-handling">Event Handling</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="parameterized-tasks.html">Parameterized Tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="jinja2.html">Jinja2</a></li>
<li class="toctree-l3"><a class="reference internal" href="empy.html">EmPy</a></li>
<li class="toctree-l3"><a class="reference internal" href="external-triggers.html">External Triggers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../installing-workflows.html">Installing Workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../running-workflows/index.html">Running Workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workflow-storage-etc.html">Workflow Storage, Discovery, Revision Control, and Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../task-implementation/index.html">Task Implementation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/index.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../workflow-design-guide/index.html">Workflow Design Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Cylc</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">User Guide</a> &raquo;</li>
        
          <li><a href="index.html">Writing Workflows</a> &raquo;</li>
        
      <li>Runtime - Task Configuration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/user-guide/writing-workflows/runtime.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="runtime-task-configuration">
<span id="user-guide-runtime"></span><h1>Runtime - Task Configuration<a class="headerlink" href="#runtime-task-configuration" title="Permalink to this headline">¶</a></h1>
<div class="tip tutorial-ref admonition">
<p class="admonition-title">Related Tutorial</p>
<p><a class="reference internal" href="../../tutorial/runtime/index.html#tutorial-runtime"><span class="std std-ref">Runtime Tutorial</span></a></p>
</div>
<p>The <a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime]" title="flow.cylc[runtime]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[runtime]</span></code></a> section of a workflow configuration configures what
to execute (and where and how to execute it) when each task is ready to
run, in a <em>multiple inheritance hierarchy</em> of <em>namespaces</em> culminating in
individual tasks. This allows all common configuration detail to be
factored out and defined in one place.</p>
<p>Any namespace can configure any or all of the items defined in
<a class="reference internal" href="../../reference/config/workflow.html#flow.cylc" title="flow.cylc"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">flow.cylc</span></code></a>.</p>
<p>Namespaces that do not explicitly inherit from others automatically
inherit from the <code class="docutils literal notranslate"><span class="pre">root</span></code> namespace (below).</p>
<p>Nested namespaces define <em>task families</em> that can be used in the
graph as convenient shorthand for triggering all member tasks at once,
or for triggering other tasks off all members at once -
see <a class="reference internal" href="scheduling.html#familytriggers"><span class="std std-ref">Family Triggers</span></a>.</p>
<div class="section" id="namespace-names">
<span id="id1"></span><h2>Namespace Names<a class="headerlink" href="#namespace-names" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="cylc.flow.unicode_rules.TaskNameValidator">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">cylc.flow.unicode_rules.</span></span><span class="sig-name descname"><span class="pre">TaskNameValidator</span></span><a class="headerlink" href="#cylc.flow.unicode_rules.TaskNameValidator" title="Permalink to this definition">¶</a></dt>
<dd><p>The rules for valid task and family names:</p>
<ul class="simple">
<li><p>must start with: alphanumeric</p></li>
<li><p>can only contain: alphanumeric, <code class="docutils literal notranslate"><span class="pre">-</span></code>, <code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">%</span></code>, <code class="docutils literal notranslate"><span class="pre">&#64;</span></code></p></li>
</ul>
</dd></dl>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p><em>Task names need not be hardwired into task implementations</em>
because task and workflow identity can be extracted portably from the task
execution environment supplied by the <a class="reference internal" href="../../glossary.html#term-scheduler"><span class="xref std std-term">scheduler</span></a>
(<a class="reference internal" href="#taskexecutionenvironment"><span class="std std-ref">Task Execution Environment</span></a>) - then to rename a task you can
just change its name in the workflow configuration.</p>
</div>
</div>
<div class="section" id="root-runtime-defaults">
<h2>Root - Runtime Defaults<a class="headerlink" href="#root-runtime-defaults" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">root</span></code> namespace, at the base of the inheritance hierarchy,
provides default configuration for all tasks in the workflow.
Most root items are unset by default, but some have default values
sufficient to allow test workflows to be defined by dependency graph alone.
The <em>script</em> item, for example, defaults to code that
prints a message then sleeps for between 1 and 15 seconds and
exits. Default values are documented with each item in
<a class="reference internal" href="../../reference/config/workflow.html#flow.cylc" title="flow.cylc"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">flow.cylc</span></code></a>. You can override the defaults or
provide your own defaults by explicitly configuring the root namespace.</p>
</div>
<div class="section" id="defining-multiple-namespaces-at-once">
<span id="multitaskdef"></span><h2>Defining Multiple Namespaces At Once<a class="headerlink" href="#defining-multiple-namespaces-at-once" title="Permalink to this headline">¶</a></h2>
<p>If a namespace section heading is a comma-separated list of names
then the subsequent configuration applies to each list member.
Particular tasks can be singled out at run time using the
<code class="docutils literal notranslate"><span class="pre">$CYLC_TASK_NAME</span></code> variable.</p>
<p>As an example, consider a workflow containing an ensemble of closely
related tasks that each invokes the same script but with a unique
argument that identifies the calling task name:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[ENSEMBLE]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;run-model.sh $CYLC_TASK_NAME&quot;</span>
    <span class="nt">[[m1, m2, m3]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> ENSEMBLE</span>
</pre></div>
</div>
<p>For large ensembles template processing can be used to
automatically generate the member names and associated dependencies
(see <a class="reference internal" href="jinja2.html#user-guide-jinja2"><span class="std std-ref">Jinja2</span></a> and <a class="reference internal" href="empy.html#user-guide-empy"><span class="std std-ref">EmPy</span></a>).</p>
</div>
<div class="section" id="runtime-inheritance-single">
<h2>Runtime Inheritance - Single<a class="headerlink" href="#runtime-inheritance-single" title="Permalink to this headline">¶</a></h2>
<p>The following listing of the <em>inherit.single.one</em> example workflow
illustrates basic runtime inheritance with single parents.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># FLOW.CYLC</span>
<span class="c1">#</span>
<span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;User Guide [runtime] example.&quot;</span>

<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20110101T06</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20110102T00</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">T00 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            foo =&gt; OBS</span>
<span class="s2">            OBS:succeed-all =&gt; bar</span>
<span class="s2">        &quot;&quot;&quot;</span>

<span class="c1"># TODO: platformise</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span> <span class="c1"># base namespace for all tasks (defines workflow-wide defaults)</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> at</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">COLOR </span><span class="o">=</span><span class="s"> red</span>
    <span class="nt">[[OBS]]</span>  <span class="c1"># family (inherited by land, ship); implicitly inherits root</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> run-${CYLC_TASK_NAME}.sh</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">RUNNING_DIR </span><span class="o">=</span><span class="s"> $HOME/running/$CYLC_TASK_NAME</span>
    <span class="nt">[[land]]</span> <span class="c1"># a task (a leaf on the inheritance tree) in the OBS family</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> OBS</span>
        <span class="nt">[[[meta]]]</span>
            <span class="nv">description </span><span class="o">=</span><span class="s"> land obs processing</span>
    <span class="nt">[[ship]]</span> <span class="c1"># a task (a leaf on the inheritance tree) in the OBS family</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> OBS</span>
        <span class="nt">[[[meta]]]</span>
            <span class="nv">description </span><span class="o">=</span><span class="s"> ship obs processing</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> loadleveler</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">RUNNING_DIR </span><span class="o">=</span><span class="s"> $HOME/running/ship</span>  <span class="c1"># override OBS environment</span>
            <span class="nv">OUTPUT_DIR </span><span class="o">=</span><span class="s"> $HOME/output/ship</span>    <span class="c1"># add to OBS environment</span>
    <span class="nt">[[foo, bar]]</span>
        <span class="c1"># (just inherit from root)</span>
</pre></div>
</div>
</div>
<div class="section" id="runtime-inheritance-multiple">
<h2>Runtime Inheritance - Multiple<a class="headerlink" href="#runtime-inheritance-multiple" title="Permalink to this headline">¶</a></h2>
<p>If a namespace inherits from multiple parents the linear order of
precedence (which namespace overrides which) is determined by the
so-called <em>C3 algorithm</em> used to find the linear <em>method
resolution order</em> for class hierarchies in Python and several other
object oriented programming languages. The result of this should be
fairly obvious for typical use of multiple inheritance in Cylc workflows,
but for detailed documentation of how the algorithm works refer to the
<a class="reference external" href="https://www.python.org/download/releases/2.3/mro/">official Python documentation</a>.</p>
<p>The <em>inherit.multi.one</em> example workflow, listed here, makes use of
multiple inheritance:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;multiple inheritance example&quot;</span>

    <span class="nv">description </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        To see how multiple inheritance works:</span>

<span class="s2">        $ cylc list -tb[m] WORKFLOW</span> <span class="c1"># list namespaces</span><span class="s2"></span>
<span class="s2">        $ cylc graph -n WORKFLOW</span> <span class="c1"># graph namespaces</span><span class="s2"></span>
<span class="s2">        $ cylc graph WORKFLOW</span> <span class="c1"># dependencies, collapse on first-parent namespaces</span><span class="s2"></span>

<span class="s2">        $ cylc config --item [runtime]ops_s1 WORKFLOW</span>
<span class="s2">        $ cylc config --item [runtime]var_p2 foo</span>
<span class="s2">    &quot;&quot;&quot;</span>

<span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;OPS:finish-all =&gt; VAR&quot;</span>

<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
    <span class="nt">[[OPS]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> echo &quot;RUN: run-ops.sh&quot;</span>
    <span class="nt">[[VAR]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> echo &quot;RUN: run-var.sh&quot;</span>
    <span class="nt">[[SERIAL]]</span>
        <span class="nt">[[[directives]]]</span>
            <span class="nv">job_type </span><span class="o">=</span><span class="s"> serial</span>
    <span class="nt">[[PARALLEL]]</span>
        <span class="nt">[[[directives]]]</span>
            <span class="nv">job_type </span><span class="o">=</span><span class="s"> parallel</span>
    <span class="nt">[[ops_s1, ops_s2]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> OPS, SERIAL</span>

    <span class="nt">[[ops_p1, ops_p2]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> OPS, PARALLEL</span>

    <span class="nt">[[var_s1, var_s2]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> VAR, SERIAL</span>

    <span class="nt">[[var_p1, var_p2]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> VAR, PARALLEL</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">config</span></code> provides an easy way to check the result of
inheritance in a workflow. You can extract specific items, e.g.:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cylc config --item <span class="s1">&#39;[runtime][var_p2]script&#39;</span> inherit.multi.one
<span class="go">echo &quot;RUN: run-var.sh&quot;</span>
</pre></div>
</div>
<div class="section" id="workflow-visualization-and-multiple-inheritance">
<h3>Workflow Visualization And Multiple Inheritance<a class="headerlink" href="#workflow-visualization-and-multiple-inheritance" title="Permalink to this headline">¶</a></h3>
<p>The first parent a namespace inherits from doubles as the collapsible family
group in workflow UI views and visualization. If this is not what you want, you
can demote the first parent for visualization purposes, without affecting the
order of inheritance of runtime properties:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[BAR]]</span>
        <span class="c1"># ...</span>
    <span class="nt">[[foo]]</span>
        <span class="c1"># inherit properties from BAR, but stay under root for visualization:</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> None, BAR</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="how-runtime-inheritance-works">
<h2>How Runtime Inheritance Works<a class="headerlink" href="#how-runtime-inheritance-works" title="Permalink to this headline">¶</a></h2>
<p>The linear precedence order of ancestors is computed for each namespace
using the C3 algorithm. Then any runtime items that are explicitly
configured in the workflow configuration are “inherited” up the linearized
hierarchy for each task, starting at the root namespace: if a particular
item is defined at multiple levels in the hierarchy, the level nearest
the final task namespace takes precedence. Finally, root namespace
defaults are applied for every item that has not been configured in the
inheritance process (this is more efficient than carrying the full dense
namespace structure through from root from the beginning).</p>
</div>
<div class="section" id="task-execution-environment">
<span id="taskexecutionenvironment"></span><h2>Task Execution Environment<a class="headerlink" href="#task-execution-environment" title="Permalink to this headline">¶</a></h2>
<p>The task execution environment contains workflow and task identity variables
provided by the <a class="reference internal" href="../../glossary.html#term-scheduler"><span class="xref std std-term">scheduler</span></a>, and user-defined environment variables.
The environment is explicitly exported (by the task job script) prior to
executing the task <code class="docutils literal notranslate"><span class="pre">script</span></code> (see <a class="reference internal" href="../task-implementation/job-submission.html#taskjobsubmission"><span class="std std-ref">Task Job Submission and Management</span></a>).</p>
<p>Workflow and task identity are exported first, so that user-defined
variables can refer to them. Order of definition is preserved throughout
so that variable assignment expressions can safely refer to previously
defined variables.</p>
<p>Additionally, access to Cylc itself is configured prior to the user-defined
environment, so that variable assignment expressions can make use of
Cylc utility commands:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">REFERENCE_TIME </span><span class="o">=</span><span class="s"> $( cylc util cycletime --offset-hours=6 )</span>
</pre></div>
</div>
<div class="section" id="user-environment-variables">
<h3>User Environment Variables<a class="headerlink" href="#user-environment-variables" title="Permalink to this headline">¶</a></h3>
<p>A task’s user-defined environment results from its inherited
<a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime][&lt;namespace&gt;][environment]" title="flow.cylc[runtime][&lt;namespace&gt;][environment]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[runtime][&lt;namespace&gt;][environment]</span></code></a> section.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">COLOR </span><span class="o">=</span><span class="s"> red</span>
            <span class="nv">SHAPE </span><span class="o">=</span><span class="s"> circle</span>
    <span class="nt">[[foo]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">COLOR </span><span class="o">=</span><span class="s"> blue</span>  <span class="c1"># root override</span>
            <span class="nv">TEXTURE </span><span class="o">=</span><span class="s"> rough</span> <span class="c1"># new variable</span>
</pre></div>
</div>
<p>This results in a task <em>foo</em> with <code class="docutils literal notranslate"><span class="pre">SHAPE=circle</span></code>, <code class="docutils literal notranslate"><span class="pre">COLOR=blue</span></code>,
and <code class="docutils literal notranslate"><span class="pre">TEXTURE=rough</span></code> in its environment.</p>
</div>
<div class="section" id="overriding-environment-variables">
<h3>Overriding Environment Variables<a class="headerlink" href="#overriding-environment-variables" title="Permalink to this headline">¶</a></h3>
<p>When you override inherited namespace items the original parent
item definition is <em>replaced</em> by the new definition. This applies to
all items including those in the environment sub-sections which,
strictly speaking, are not “environment variables” until they are
written, post inheritance processing, to the task job script that
executes the associated task. Consequently, if you override an
environment variable you cannot also access the original parent value:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[FOO]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">COLOR </span><span class="o">=</span><span class="s"> red</span>
    <span class="nt">[[bar]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> FOO</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">tmp </span><span class="o">=</span><span class="s"> $COLOR</span>        <span class="c1"># !! ERROR: $COLOR is undefined here</span>
            <span class="nv">COLOR </span><span class="o">=</span><span class="s"> dark-$tmp</span>   <span class="c1"># !! as this overrides COLOR in FOO.</span>
</pre></div>
</div>
<p>The compressed variant of this, <code class="docutils literal notranslate"><span class="pre">COLOR</span> <span class="pre">=</span> <span class="pre">dark-$COLOR</span></code>, is
also in error for the same reason. To achieve the desired result you
must use a different name for the parent variable:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[FOO]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">FOO_COLOR </span><span class="o">=</span><span class="s"> red</span>
    <span class="nt">[[bar]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> FOO</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">COLOR </span><span class="o">=</span><span class="s"> dark-$FOO_COLOR</span>  <span class="c1"># OK</span>
</pre></div>
</div>
</div>
<div class="section" id="task-job-script-variables">
<span id="id2"></span><h3>Task Job Script Variables<a class="headerlink" href="#task-job-script-variables" title="Permalink to this headline">¶</a></h3>
<p>These are variables that can be referenced (but should not be modified) in a
task job script.</p>
<p>The task job script may export the following environment variables:</p>
<div class="highlight-sub notranslate"><div class="highlight"><pre><span></span>CYLC_DEBUG                         <span class="c"># Debug mode, true or not defined</span>
CYLC_VERSION                       <span class="c"># Version of cylc installation used</span>

CYLC_CYCLING_MODE                  <span class="c"># Cycling mode, e.g. gregorian</span>
ISODATETIMECALENDAR                <span class="c"># Calendar mode for the `isodatetime` command,</span>
                                   <span class="c"># defined with the value of CYLC_CYCLING_MODE</span>
                                   <span class="c"># when in any date-time cycling mode</span>
CYLC_WORKFLOW_FINAL_CYCLE_POINT    <span class="c"># Final cycle point</span>
CYLC_WORKFLOW_INITIAL_CYCLE_POINT  <span class="c"># Initial cycle point</span>
CYLC_WORKFLOW_NAME                 <span class="c"># Workflow name</span>
CYLC_UTC                           <span class="c"># UTC mode, True or False</span>
CYLC_VERBOSE                       <span class="c"># Verbose mode, True or False</span>
TZ                                 <span class="c"># Set to &quot;UTC&quot; in UTC mode or not defined</span>

CYLC_WORKFLOW_RUN_DIR              <span class="c"># Location of the run directory in</span>
                                   <span class="c"># job host, e.g. ~/cylc-run/foo</span>
CYLC_WORKFLOW_HOST                 <span class="c"># Host running the workflow process</span>
CYLC_WORKFLOW_OWNER                <span class="c"># User ID running the workflow process</span>

CYLC_WORKFLOW_SHARE_DIR            <span class="c"># Workflow (or task!) shared directory (see below)</span>
CYLC_WORKFLOW_UUID                 <span class="c"># Workflow UUID string</span>
CYLC_WORKFLOW_WORK_DIR             <span class="c"># Workflow work directory (see below)</span>

CYLC_TASK_JOB                      <span class="c"># Task job identifier expressed as</span>
                                   <span class="c"># CYCLE-POINT/TASK-NAME/SUBMIT-NUM</span>
                                   <span class="c"># e.g. 20110511T1800Z/t1/01</span>
CYLC_TASK_CYCLE_POINT              <span class="c"># Cycle point, e.g. 20110511T1800Z</span>
ISODATETIMEREF                     <span class="c"># Reference time for the `isodatetime` command,</span>
                                   <span class="c"># defined with the value of CYLC_TASK_CYCLE_POINT</span>
                                   <span class="c"># when in any date-time cycling mode</span>
CYLC_TASK_NAME                     <span class="c"># Job&#39;s task name, e.g. t1</span>
CYLC_TASK_SUBMIT_NUMBER            <span class="c"># Job&#39;s submit number, e.g. 1,</span>
                                   <span class="c"># increments with every submit</span>
CYLC_TASK_TRY_NUMBER               <span class="c"># Number of execution tries, e.g. 1</span>
                                   <span class="c"># increments with automatic retry-on-fail</span>
CYLC_TASK_ID                       <span class="c"># Task instance identifier expressed as</span>
                                   <span class="c"># TASK-NAME.CYCLE-POINT</span>
                                   <span class="c"># e.g. t1.20110511T1800Z</span>
CYLC_TASK_LOG_DIR                  <span class="c"># Location of the job log directory</span>
                                   <span class="c"># e.g. ~/cylc-run/foo/log/job/20110511T1800Z/t1/01/</span>
CYLC_TASK_LOG_ROOT                 <span class="c"># The task job file path</span>
                                   <span class="c"># e.g. ~/cylc-run/foo/log/job/20110511T1800Z/t1/01/job</span>
CYLC_TASK_WORK_DIR                 <span class="c"># Location of task work directory (see below)</span>
                                   <span class="c"># e.g. ~/cylc-run/foo/work/20110511T1800Z/t1</span>
CYLC_TASK_NAMESPACE_HIERARCHY      <span class="c"># Linearised family namespace of the task,</span>
                                   <span class="c"># e.g. root postproc t1</span>
CYLC_TASK_DEPENDENCIES             <span class="c"># List of met dependencies that triggered the task</span>
                                   <span class="c"># e.g. foo.1 bar.1</span>

CYLC_TASK_COMMS_METHOD             <span class="c"># Set to &quot;ssh&quot; if communication method is &quot;ssh&quot;</span>
CYLC_TASK_SSH_LOGIN_SHELL          <span class="c"># With &quot;ssh&quot; communication, if set to &quot;True&quot;,</span>
                                   <span class="c"># use login shell on workflow host</span>
</pre></div>
</div>
<p>There are also some global shell variables that may be defined in the task job
script (but not exported to the environment). These include:</p>
<div class="highlight-sub notranslate"><div class="highlight"><pre><span></span>CYLC_FAIL_SIGNALS               <span class="c"># List of signals trapped by the error trap</span>
CYLC_VACATION_SIGNALS           <span class="c"># List of signals trapped by the vacation trap</span>
CYLC_WORKFLOW_WORK_DIR_ROOT     <span class="c"># Root directory above the workflow work directory</span>
                                <span class="c"># in the job host</span>
CYLC_TASK_MESSAGE_STARTED_PID   <span class="c"># PID of &quot;cylc message&quot; job started&quot; command</span>
CYLC_TASK_WORK_DIR_BASE         <span class="c"># Alternate task work directory,</span>
                                <span class="c"># relative to the workflow work directory</span>
</pre></div>
</div>
</div>
<div class="section" id="workflow-share-directories">
<h3>Workflow Share Directories<a class="headerlink" href="#workflow-share-directories" title="Permalink to this headline">¶</a></h3>
<p>A workflow <a class="reference internal" href="../../glossary.html#term-share-directory"><span class="xref std std-term">share directory</span></a> is created automatically under the workflow run
directory as a share space for tasks. The location is available to tasks as
<code class="docutils literal notranslate"><span class="pre">$CYLC_WORKFLOW_SHARE_DIR</span></code>. In a cycling workflow, output files are
typically held in cycle point sub-directories of the workflow share directory.</p>
<p>The top level share and work directory (below) location can be changed
(e.g. to a large data area) by global config settings in
<a class="reference internal" href="../../reference/config/global.html#global.cylc[install][symlink dirs]" title="global.cylc[install][symlink dirs]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">global.cylc[install][symlink</span> <span class="pre">dirs]</span></code></a>.</p>
</div>
<div class="section" id="task-work-directories">
<h3>Task Work Directories<a class="headerlink" href="#task-work-directories" title="Permalink to this headline">¶</a></h3>
<p>Task job scripts are executed from within
<a class="reference internal" href="../../glossary.html#term-work-directory"><span class="xref std std-term">work directories</span></a> created automatically under the workflow
run directory. A task can get its own work directory from
<code class="docutils literal notranslate"><span class="pre">$CYLC_TASK_WORK_DIR</span></code> (or simply <code class="docutils literal notranslate"><span class="pre">$PWD</span></code> if it does not <code class="docutils literal notranslate"><span class="pre">cd</span></code> elsewhere at
runtime). By default the location contains task name and cycle point, to
provide a unique workspace for every instance of every task.</p>
<p>The top level work and share directory (above) location can be changed
(e.g. to a large data area) by global config settings in
<a class="reference internal" href="../../reference/config/global.html#global.cylc[install][symlink dirs]" title="global.cylc[install][symlink dirs]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">global.cylc[install][symlink</span> <span class="pre">dirs]</span></code></a>.</p>
</div>
<div class="section" id="environment-variable-evaluation">
<h3>Environment Variable Evaluation<a class="headerlink" href="#environment-variable-evaluation" title="Permalink to this headline">¶</a></h3>
<p>Variables in the task execution environment are not evaluated in the
shell in which the workflow is running prior to submitting the task. They
are written in unevaluated form to the job script that is submitted by
Cylc to run the task (<a class="reference internal" href="../task-implementation/job-scripts.html#jobscripts"><span class="std std-ref">Task Job Scripts</span></a>) and are therefore
evaluated when the task begins executing under the task owner account
on the task host. Thus <code class="docutils literal notranslate"><span class="pre">$HOME</span></code>, for instance, evaluates at
run time to the home directory of task owner on the task host.</p>
</div>
</div>
<div class="section" id="how-tasks-get-access-to-the-run-directory">
<h2>How Tasks Get Access To The Run Directory<a class="headerlink" href="#how-tasks-get-access-to-the-run-directory" title="Permalink to this headline">¶</a></h2>
<p>The workflow bin directory is automatically added
<code class="docutils literal notranslate"><span class="pre">$PATH</span></code>. If a remote workflow configuration directory is not
specified, the local (workflow host) path will be assumed with the local
home directory, if present, swapped for literal <code class="docutils literal notranslate"><span class="pre">$HOME</span></code> for
evaluation on the task host.</p>
</div>
<div class="section" id="remote-task-hosting">
<span id="runningtasksonaremotehost"></span><h2>Remote Task Hosting<a class="headerlink" href="#remote-task-hosting" title="Permalink to this headline">¶</a></h2>
<p>If a task declares a different platform to the one running the workflow,
Cylc will use non-interactive ssh to execute the task using the
<a class="reference internal" href="../../glossary.html#term-job-runner"><span class="xref std std-term">job runner</span></a> and one of the hosts from the <a class="reference internal" href="../../glossary.html#term-platform"><span class="xref std std-term">platform</span></a> definition
(platforms are defined in <code class="docutils literal notranslate"><span class="pre">global.cylc[platforms]</span></code>).</p>
<p>For example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nv">platform </span><span class="o">=</span><span class="s"> orca</span>
</pre></div>
</div>
<p>For this to work:</p>
<ul class="simple">
<li><p>Non-interactive ssh is required from the <a class="reference internal" href="../../glossary.html#term-scheduler"><span class="xref std std-term">scheduler</span></a> host
to the remote platform’s hosts.</p></li>
<li><p>Cylc must be installed on the hosts of the destination platform.</p>
<ul>
<li><p>If polling task communication is used, there is no other
requirement.</p></li>
<li><p>If SSH task communication is configured, non-interactive ssh is
required from the task platform to the workflow platform.</p></li>
<li><p>If TCP (default) task communication is configured, the task platform
should have access to the port on the workflow host.</p></li>
</ul>
</li>
<li><p>The workflow configuration directory, or some fraction of its
content, can be installed on the task platform, if needed.</p></li>
</ul>
<p>Platform, like all namespace settings, can be declared globally in
the root namespace, or per family, or for individual tasks.</p>
<div class="section" id="dynamic-platform-selection">
<h3>Dynamic Platform Selection<a class="headerlink" href="#dynamic-platform-selection" title="Permalink to this headline">¶</a></h3>
<p>Instead of hardwiring platform names into the workflow configuration you can
specify a shell command that prints a platform name, or an environment
variable that holds a platform name, as the value of the
<a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime][&lt;namespace&gt;]platform" title="flow.cylc[runtime][&lt;namespace&gt;]platform"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">host</span> <span class="pre">config</span> <span class="pre">item</span></code></a>.</p>
</div>
<div class="section" id="remote-task-log-directories">
<h3>Remote Task Log Directories<a class="headerlink" href="#remote-task-log-directories" title="Permalink to this headline">¶</a></h3>
<p>Task stdout and stderr streams are written to <a class="reference internal" href="../../glossary.html#term-job-log"><span class="xref std std-term">log files</span></a> in a
workflow-specific sub-directory of the workflow <a class="reference internal" href="../../glossary.html#term-run-directory"><span class="xref std std-term">run directory</span></a>, as
explained in <a class="reference internal" href="../task-implementation/job-submission.html#whitherstdoutandstderr"><span class="std std-ref">Task stdout And stderr Logs</span></a>. For remote tasks
the same directory is used, but <em>on the task host</em>.
Remote task log directories, like local ones, are created on the fly, if
necessary, during job submission.</p>
</div>
</div>
<div class="section" id="implicit-tasks">
<span id="implicittasks"></span><h2>Implicit Tasks<a class="headerlink" href="#implicit-tasks" title="Permalink to this headline">¶</a></h2>
<p>An <a class="reference internal" href="../../glossary.html#term-implicit-task"><span class="xref std std-term">implicit task</span></a> appears in the workflow graph but has no
explicit runtime configuration section. Such tasks automatically
inherit the configuration from the root namespace.
This is very useful because it allows functional workflows to
be mocked up quickly for test and demonstration purposes by simply
defining the graph. It is somewhat dangerous, however, because there
is no way to distinguish an intentional implicit task from one
caused by typographic error. Misspelling a task name in the graph
results in a new implicit task replacing the intended task in the
affected trigger expression, and misspelling a task name in a runtime
section heading results in the intended task becoming an implicit task
itself (by divorcing it from its intended runtime config section).</p>
<p>You can allow implicit tasks during development of a workflow using
<a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[scheduler]allow implicit tasks" title="flow.cylc[scheduler]allow implicit tasks"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">flow.cylc[scheduler]allow</span> <span class="pre">implicit</span> <span class="pre">tasks</span></code></a>. But, to avoid
the problems mentioned above, any task used in a production/operational
workflow should not be implicit, i.e. it should have an explicit entry in under
the runtime section of <code class="docutils literal notranslate"><span class="pre">flow.cylc</span></code>, even if the section is empty. This
results in exactly the same task behaviour, via inheritance from root,
but adds a layer of protection against mistakes. Thus, it is recommended to
turn off <a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[scheduler]allow implicit tasks" title="flow.cylc[scheduler]allow implicit tasks"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">flow.cylc[scheduler]allow</span> <span class="pre">implicit</span> <span class="pre">tasks</span></code></a> when the
<a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime]" title="flow.cylc[runtime]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">flow.cylc[runtime]</span></code></a> section has been written.</p>
</div>
<div class="section" id="automatic-task-retry-on-failure">
<span id="taskretries"></span><h2>Automatic Task Retry On Failure<a class="headerlink" href="#automatic-task-retry-on-failure" title="Permalink to this headline">¶</a></h2>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>cylc:conf:<cite>[runtime][&lt;namespace&gt;]execution retry delays</cite>.</p>
</div>
<p>Tasks can be configured with a list of “retry delay” intervals, as
<a class="reference internal" href="../../glossary.html#term-ISO8601-duration"><span class="xref std std-term">ISO8601 durations</span></a>. If the task job fails it will go
into the <em>retrying</em> state and resubmit after the next configured delay
interval. An example is shown in the workflow listed below under
<a class="reference internal" href="#eventhandling"><span class="std std-ref">Event Handling</span></a>.</p>
<p>If a task with configured retries is <em>killed</em> (by <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">kill</span></code>
it goes to the <em>held</em> state so that the operator can decide
whether to release it and continue the retry sequence or to abort the retry
sequence by manually resetting it to the <em>failed</em> state.</p>
</div>
<div class="section" id="event-handling">
<span id="eventhandling"></span><h2>Event Handling<a class="headerlink" href="#event-handling" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Task events (e.g. task succeeded/failed) are configured by
<a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime][&lt;namespace&gt;][events]" title="flow.cylc[runtime][&lt;namespace&gt;][events]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">task</span> <span class="pre">events</span></code></a>.</p></li>
<li><p>Workflow events (e.g. workflow started/stopped) are configured by
<a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[scheduler][events]" title="flow.cylc[scheduler][events]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">workflow</span> <span class="pre">events</span></code></a></p></li>
</ul>
<p>Cylc can call nominated event handlers - to do whatever you like - when certain
workflow or task events occur. This facilitates centralized alerting and automated
handling of critical events. Event handlers can be used to send a message, call
a pager, or whatever; they can even intervene in the operation of their own
workflow using cylc commands.</p>
<p>To send an email, use the built-in setting <a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime][&lt;namespace&gt;][events]mail events" title="flow.cylc[runtime][&lt;namespace&gt;][events]mail events"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[events]mail</span> <span class="pre">events</span></code></a>
to specify a list of events for which notifications should be sent. (The
name of a registered task output can also be used as an event name in
this case.) E.g. to send an email on (submission) failed and retry:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nv">script </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            test ${CYLC_TASK_TRY_NUMBER} -eq 3</span>
<span class="s2">            cylc message -- &quot;${CYLC_WORKFLOW_NAME}&quot; &quot;${CYLC_TASK_JOB}&quot; &#39;oopsy daisy&#39;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="nv">execution retry delays </span><span class="o">=</span><span class="s"> PT0S, PT30S</span>
        <span class="nt">[[[events]]]</span>
            <span class="nv">mail events </span><span class="o">=</span><span class="s"> submission failed, submission retry, failed, retry, oops</span>
        <span class="nt">[[[outputs]]]</span>
            <span class="nv">oops </span><span class="o">=</span><span class="s"> oopsy daisy</span>
</pre></div>
</div>
<p>By default, the emails will be sent to the current user with:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">to:</span></code> set as <code class="docutils literal notranslate"><span class="pre">$USER</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">from:</span></code> set as <code class="docutils literal notranslate"><span class="pre">notifications&#64;$(hostname)</span></code></p></li>
<li><p>SMTP server at <code class="docutils literal notranslate"><span class="pre">localhost:25</span></code></p></li>
</ul>
<p>These can be configured using the settings:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime][&lt;namespace&gt;][mail]to" title="flow.cylc[runtime][&lt;namespace&gt;][mail]to"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[mail]to</span></code></a> (list of email addresses)</p></li>
<li><p><a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime][&lt;namespace&gt;][mail]from" title="flow.cylc[runtime][&lt;namespace&gt;][mail]from"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[mail]from</span></code></a></p></li>
</ul>
<p>By default, a cylc workflow will send you no more than one task event email every
5 minutes - this is to prevent your inbox from being flooded by emails should a
large group of tasks all fail at similar time. This is configured by
<a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[scheduler][mail]task event batch interval" title="flow.cylc[scheduler][mail]task event batch interval"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[scheduler][mail]task</span> <span class="pre">event</span> <span class="pre">batch</span> <span class="pre">interval</span></code></a>.</p>
<p>Event handlers can be located in the workflow <code class="docutils literal notranslate"><span class="pre">bin/</span></code> directory;
otherwise it is up to you to ensure their location is in <code class="docutils literal notranslate"><span class="pre">$PATH</span></code> (in
the shell in which the <a class="reference internal" href="../../glossary.html#term-scheduler"><span class="xref std std-term">scheduler</span></a> runs). They should require little
resource and return quickly - see <a class="reference internal" href="../running-workflows/running-workflows.html#managing-external-command-execution"><span class="std std-ref">Managing External Command Execution</span></a>.</p>
<p>Task event handlers can be specified using the
<code class="docutils literal notranslate"><span class="pre">[events]&lt;event&gt;</span> <span class="pre">handler</span></code> settings, where
<code class="docutils literal notranslate"><span class="pre">&lt;event&gt;</span></code> is one of:</p>
<p>The value of each setting should be a list of command lines or command line
templates (see below).</p>
<p>Alternatively you can use <a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime][&lt;namespace&gt;][events]handlers" title="flow.cylc[runtime][&lt;namespace&gt;][events]handlers"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[events]handlers</span></code></a> and
<a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime][&lt;namespace&gt;][events]handler events" title="flow.cylc[runtime][&lt;namespace&gt;][events]handler events"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[events]handler</span> <span class="pre">events</span></code></a>, where the former is a list of command
lines or command line templates (see below) and the latter is a list of events
for which these commands should be invoked. (The name of a registered task
output can also be used as an event name in this case.)</p>
<p>Event handler arguments can be constructed from various templates
representing workflow name; task ID, name, cycle point, message, and submit
number name; and any <a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[meta]" title="flow.cylc[meta]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">workflow</span></code></a> or
<a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime][&lt;namespace&gt;][meta]" title="flow.cylc[runtime][&lt;namespace&gt;][meta]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">task</span></code></a> item.
See <a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[scheduler][events]" title="flow.cylc[scheduler][events]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">workflow</span> <span class="pre">events</span></code></a> and
<a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime][&lt;namespace&gt;][events]" title="flow.cylc[runtime][&lt;namespace&gt;][events]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">task</span> <span class="pre">events</span></code></a> for options.</p>
<p>If no template arguments are supplied the following default command line
will be used:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;task-event-handler&gt; %(event)s %(workflow)s %(id)s %(message)s
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Substitution patterns should not be quoted in the template strings.
This is done automatically where required.</p>
</div>
<p>For an explanation of the substitution syntax, see
<a class="reference external" href="https://docs.python.org/2/library/stdtypes.html#string-formatting">String Formatting Operations</a>
in the Python documentation.</p>
<p>The retry event occurs if a task fails and has any remaining retries
configured (see <a class="reference internal" href="#taskretries"><span class="std std-ref">Automatic Task Retry On Failure</span></a>).
The event handler will be called as soon as the task fails, not after
the retry delay period when it is resubmitted.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Event handlers are called by the <a class="reference internal" href="../../glossary.html#term-scheduler"><span class="xref std std-term">scheduler</span></a>, not by
task jobs. If you wish to pass additional information to them use
<code class="docutils literal notranslate"><span class="pre">[scheduler]</span> <span class="pre">-&gt;</span> <span class="pre">[[environment]]</span></code>, not task runtime environment.</p>
</div>
<p>The following two <a class="reference internal" href="../../reference/config/workflow.html#flow.cylc" title="flow.cylc"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">flow.cylc</span></code></a> snippets are examples on how to specify
event handlers using the alternate methods:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> test ${CYLC_TASK_TRY_NUMBER} -eq 2</span>
        <span class="nv">execution retry delays </span><span class="o">=</span><span class="s"> PT0S, PT30S</span>
        <span class="nt">[[[events]]]</span>
            <span class="nv">retry handler </span><span class="o">=</span><span class="s"> &quot;echo &#39;!!!!!EVENT!!!!!&#39; &quot;</span>
            <span class="nv">failed handler </span><span class="o">=</span><span class="s"> &quot;echo &#39;!!!!!EVENT!!!!!&#39; &quot;</span>
</pre></div>
</div>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nv">script </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            test ${CYLC_TASK_TRY_NUMBER} -eq 2</span>
<span class="s2">            cylc message -- &quot;${CYLC_WORKFLOW_NAME}&quot; &quot;${CYLC_TASK_JOB}&quot; &#39;oopsy daisy&#39;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="nv">execution retry delays </span><span class="o">=</span><span class="s"> PT0S, PT30S</span>
        <span class="nt">[[[events]]]</span>
            <span class="nv">handlers </span><span class="o">=</span><span class="s"> &quot;echo &#39;!!!!!EVENT!!!!!&#39; &quot;</span>
            <span class="c1"># Note: task output name can be used as an event in this method</span>
            <span class="nv">handler events </span><span class="o">=</span><span class="s"> retry, failed, oops</span>
        <span class="nt">[[[outputs]]]</span>
            <span class="nv">oops </span><span class="o">=</span><span class="s"> oopsy daisy</span>
</pre></div>
</div>
<p>The handler command here - specified with no arguments - is called with the
default arguments, like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s1">&#39;!!!!!EVENT!!!!!&#39;</span> %<span class="o">(</span>event<span class="o">)</span>s %<span class="o">(</span>workflow<span class="o">)</span>s %<span class="o">(</span>id<span class="o">)</span>s %<span class="o">(</span>message<span class="o">)</span>s
</pre></div>
</div>
<div class="section" id="late-events">
<span id="id3"></span><h3>Late Events<a class="headerlink" href="#late-events" title="Permalink to this headline">¶</a></h3>
<p>You may want to be notified when certain tasks are running late in a real time
production system - i.e. when they have not triggered by <em>the usual time</em>.
Tasks of primary interest are not normally clock-triggered however, so their
trigger times are mostly a function of how the workflow runs in its environment,
and even external factors such as contention with other workflows <a class="footnote-reference brackets" href="#id5" id="id4">1</a> .</p>
<p>But if your system is reasonably stable from one cycle to the next such that a
given task has consistently triggered by some interval beyond its cycle point,
you can configure Cylc to emit a <em>late event</em> if it has not triggered by
that time. For example, if a task <code class="docutils literal notranslate"><span class="pre">forecast</span></code> normally triggers by 30
minutes after its cycle point, configure late notification for it like this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
   <span class="nt">[[forecast]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> run-model.sh</span>
        <span class="nt">[[[events]]]</span>
            <span class="nv">late offset </span><span class="o">=</span><span class="s"> PT30M</span>
            <span class="nv">late handler </span><span class="o">=</span><span class="s"> my-handler %(message)s</span>
</pre></div>
</div>
<p><em>Late offset intervals are not computed automatically so be careful
to update them after any change that affects triggering times.</em></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Cylc can only check for lateness in tasks that it is currently aware
of. If a workflow gets delayed over many cycles the next tasks coming up
can be identified as late immediately, and subsequent tasks can be
identified as late as the workflow progresses to subsequent cycle points,
until it catches up to the clock.</p>
</div>
<dl class="footnote brackets">
<dt class="label" id="id5"><span class="brackets"><a class="fn-backref" href="#id4">1</a></span></dt>
<dd><p>Late notification of clock-triggered tasks is not very useful in
any case because they typically do not depend on other tasks, and as
such they can often trigger on time even if the workflow is delayed to
the point that downstream tasks are late due to their dependence on
previous-cycle tasks that are delayed.</p>
</dd>
</dl>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="parameterized-tasks.html" class="btn btn-neutral float-right" title="Parameterized Tasks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="scheduling.html" class="btn btn-neutral float-left" title="Scheduling - Dependency Graphs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2008-2021 NIWA &amp; British Crown (Met Office) &amp; Contributors.
      <span class="lastupdated">
        Last updated on Aug 05, 2021.
      </span>

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  <!--
  element which gets populated with the list of available versions and
  formats for the documentation by versions.js
-->
<div
  class="rst-versions"
  data-toggle="rst-versions"
  id='versions-and-formats'
></div>



<script type="text/javascript">
    const CUR_FORMAT = "html";
    const CUR_VERSION = "8.0b2";
    // name of page (in URL), for singlepage builds this will be `index`
    const PAGE_NAME = "user-guide/writing-workflows/runtime";
    // URL path to the base docs dir i.e. ROOT_DIR/version/format
    const ROOT_DIR = "../../../..";
</script>

<script
  type="text/javascript"
  src="../../../../versions.js"
></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>