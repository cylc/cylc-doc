

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Writing Suites &mdash; Cylc nightly.2020-08-11 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/cylc.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/cylc-favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/js/minicylc.js"></script>
        <script src="../_static/js/spoiler.js"></script>
        <script src="../_static/js/cylc.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Running Suites" href="running-suites.html" />
    <link rel="prev" title="Workflows For Cycling Systems" href="workflows.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/cylc-logo-white.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                nightly.2020-08-11
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table Of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction: How Cylc Works</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="workflows.html">Workflows For Cycling Systems</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Writing Suites</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#suite-configuration-directories">Suite Configuration Directories</a></li>
<li class="toctree-l3"><a class="reference internal" href="#suite-rc-file-overview">Suite.rc File Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#syntax">Syntax</a></li>
<li class="toctree-l4"><a class="reference internal" href="#include-files">Include-Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#syntax-highlighting-for-suite-configuration">Syntax Highlighting For Suite Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gross-file-structure">Gross File Structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#validation">Validation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#scheduling-dependency-graphs">Scheduling - Dependency Graphs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#graph-string-syntax">Graph String Syntax</a></li>
<li class="toctree-l4"><a class="reference internal" href="#interpreting-graph-strings">Interpreting Graph Strings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#graph-types">Graph Types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#graph-section-headings">Graph Section Headings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#task-triggering">Task Triggering</a></li>
<li class="toctree-l4"><a class="reference internal" href="#model-restart-dependencies">Model Restart Dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-the-graph-determines-task-instantiation">How The Graph Determines Task Instantiation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#runtime-task-configuration">Runtime - Task Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#namespace-names">Namespace Names</a></li>
<li class="toctree-l4"><a class="reference internal" href="#root-runtime-defaults">Root - Runtime Defaults</a></li>
<li class="toctree-l4"><a class="reference internal" href="#defining-multiple-namespaces-at-once">Defining Multiple Namespaces At Once</a></li>
<li class="toctree-l4"><a class="reference internal" href="#runtime-inheritance-single">Runtime Inheritance - Single</a></li>
<li class="toctree-l4"><a class="reference internal" href="#runtime-inheritance-multiple">Runtime Inheritance - Multiple</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-runtime-inheritance-works">How Runtime Inheritance Works</a></li>
<li class="toctree-l4"><a class="reference internal" href="#task-execution-environment">Task Execution Environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-tasks-get-access-to-the-suite-directory">How Tasks Get Access To The Suite Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#remote-task-hosting">Remote Task Hosting</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#visualization">Visualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parameterized-tasks">Parameterized Tasks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#parameter-expansion">Parameter Expansion</a></li>
<li class="toctree-l4"><a class="reference internal" href="#passing-parameter-values-to-tasks">Passing Parameter Values To Tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#selecting-specific-parameter-values">Selecting Specific Parameter Values</a></li>
<li class="toctree-l4"><a class="reference internal" href="#selecting-partial-parameter-ranges">Selecting Partial Parameter Ranges</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parameter-offsets-in-the-graph">Parameter Offsets In The Graph</a></li>
<li class="toctree-l4"><a class="reference internal" href="#task-families-and-parameterization">Task Families And Parameterization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parameterized-cycling">Parameterized Cycling</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#jinja2">Jinja2</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#accessing-environment-variables-with-jinja2">Accessing Environment Variables With Jinja2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#custom-jinja2-filters-tests-and-globals">Custom Jinja2 Filters, Tests and Globals</a></li>
<li class="toctree-l4"><a class="reference internal" href="#associative-arrays-in-jinja2">Associative Arrays In Jinja2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#jinja2-default-values-and-template-inputs">Jinja2 Default Values And Template Inputs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#jinja2-variable-scope">Jinja2 Variable Scope</a></li>
<li class="toctree-l4"><a class="reference internal" href="#raising-exceptions">Raising Exceptions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#importing-additional-python-modules">Importing additional Python modules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#logging">Logging</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#empy">EmPy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#omitting-tasks-at-runtime">Omitting Tasks At Runtime</a></li>
<li class="toctree-l3"><a class="reference internal" href="#naked-dummy-tasks-and-strict-validation">Naked Dummy Tasks And Strict Validation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="running-suites.html">Running Suites</a></li>
<li class="toctree-l2"><a class="reference internal" href="suite-name-reg.html">Suite Name Registration</a></li>
<li class="toctree-l2"><a class="reference internal" href="suite-storage-etc.html">Suite Storage, Discovery, Revision Control, and Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="task-implementation.html">Task Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="task-job-submission.html">Task Job Submission and Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="remote-job-management.html">Remote Job Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="external-triggers.html">External Triggers</a></li>
<li class="toctree-l2"><a class="reference internal" href="known-issues.html">Known Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugins/index.html">Plugins</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../suite-design-guide/index.html">Suite Design Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Cylc</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">User Guide</a> &raquo;</li>
        
      <li>Writing Suites</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/user-guide/writing-suites.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="writing-suites">
<span id="suitedefinition"></span><h1>Writing Suites<a class="headerlink" href="#writing-suites" title="Permalink to this headline">¶</a></h1>
<p>Cylc suites are defined in structured, validated, <em>suite.rc</em> files
that concisely specify the properties of, and the relationships
between, the various tasks managed by the suite. This section of the
User Guide deals with the format and content of the suite.rc file,
including task definition. Task implementation - what’s required of the
real commands, scripts, or programs that do the processing that the
tasks represent - is covered in <a class="reference internal" href="task-implementation.html#taskimplementation"><span class="std std-ref">Task Implementation</span></a>; and
task job submission - how tasks are submitted to run - is
in <a class="reference internal" href="task-job-submission.html#taskjobsubmission"><span class="std std-ref">Task Job Submission and Management</span></a>.</p>
<div class="section" id="suite-configuration-directories">
<span id="suitedefinitiondirectories"></span><h2>Suite Configuration Directories<a class="headerlink" href="#suite-configuration-directories" title="Permalink to this headline">¶</a></h2>
<p>A cylc <em>suite configuration directory</em> contains:</p>
<ul class="simple">
<li><p><strong>A suite.rc file</strong>: this is the suite configuration.</p>
<ul>
<li><p>And any include-files used in it (see below; may be
kept in sub-directories).</p></li>
</ul>
</li>
<li><p><strong>A</strong> <code class="docutils literal notranslate"><span class="pre">bin/</span></code> <strong>sub-directory</strong> (optional)</p>
<ul>
<li><p>For scripts and executables that implement, or are
used by, suite tasks.</p></li>
<li><p>Automatically added to <code class="docutils literal notranslate"><span class="pre">$PATH</span></code> in task
execution environments.</p></li>
<li><p>Alternatively, tasks can call external
commands, scripts, or programs; or they can be scripted
entirely within the suite.rc file.</p></li>
</ul>
</li>
<li><p><strong>A</strong> <code class="docutils literal notranslate"><span class="pre">lib/python/</span></code> <strong>sub-directory</strong> (optional)</p>
<ul>
<li><p>Python libraries for use by suite tasks.</p></li>
<li><p>Automatically added to <cite>$PYTHONPATH`</cite> in task execution environments.</p></li>
<li><p>Custom job submission modules
(see <a class="reference internal" href="task-job-submission.html#customjobsubmissionmethods"><span class="std std-ref">Custom Job Submission Methods</span></a>)</p></li>
<li><p>Python libraries for use by Jinja2 in custom filters,
tests and globals (see <a class="reference internal" href="#customjinja2filters"><span class="std std-ref">Custom Jinja2 Filters, Tests and Globals</span></a>).</p></li>
</ul>
</li>
<li><p><strong>Any other sub-directories and files</strong> - documentation,
control files, etc. (optional)</p>
<ul>
<li><p>Holding everything in one place makes proper suite
revision control possible.</p></li>
<li><p>Portable access to files here, for running tasks, is
provided through <code class="docutils literal notranslate"><span class="pre">$CYLC_SUITE_DEF_PATH</span></code>
(see <a class="reference internal" href="#taskexecutionenvironment"><span class="std std-ref">Task Execution Environment</span></a>).</p></li>
<li><p>Ignored by cylc, but the entire suite configuration
directory tree is copied when you copy a
suite using cylc commands.</p></li>
</ul>
</li>
</ul>
<p>A typical example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/path/to/my/suite   <span class="c1"># suite configuration directory</span>
    suite.rc           <span class="c1"># THE SUITE CONFIGURATION FILE</span>
    bin/               <span class="c1"># scripts and executables used by tasks</span>
        foo.sh
        bar.sh
        ...
    <span class="c1"># (OPTIONAL) any other suite-related files, for example:</span>
    inc/               <span class="c1"># suite.rc include-files</span>
        nwp-tasks.rc
        globals.rc
        ...
    doc/               <span class="c1"># documentation</span>
    control/           <span class="c1"># control files</span>
    ancil/             <span class="c1"># ancillary files</span>
    ...
</pre></div>
</div>
</div>
<div class="section" id="suite-rc-file-overview">
<span id="suitercfile"></span><h2>Suite.rc File Overview<a class="headerlink" href="#suite-rc-file-overview" title="Permalink to this headline">¶</a></h2>
<p>Suite.rc files are an extended-INI format with section nesting.</p>
<p>Embedded template processor expressions may also be used in the file, to
programatically generate the final suite configuration seen by
cylc. Currently the <a class="reference external" href="http://jinja.pocoo.org/">Jinja2</a> and <a class="reference external" href="http://www.alcyone.com/software/empy/">EmPy</a> template processors are
supported; see <a class="reference internal" href="#jinja"><span class="std std-ref">Jinja2</span></a> and <a class="reference internal" href="#empylabel"><span class="std std-ref">EmPy</span></a> for examples. In the future
cylc may provide a plug-in interface to allow use of other template
engines too.</p>
<div class="section" id="syntax">
<span id="id1"></span><h3>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h3>
<p>The following defines legal suite.rc syntax:</p>
<ul class="simple">
<li><p><strong>Items</strong> are of the form <code class="docutils literal notranslate"><span class="pre">item</span> <span class="pre">=</span> <span class="pre">value</span></code>.</p></li>
<li><p><strong>[Section]</strong> headings are enclosed in square brackets.</p></li>
<li><p><strong>Sub-section [[nesting]]</strong> is defined by repeated square brackets.</p>
<ul>
<li><p>Sections are <strong>closed</strong> by the next section heading.</p></li>
</ul>
</li>
<li><p><strong>Comments</strong> (line and trailing) follow a hash character: <code class="docutils literal notranslate"><span class="pre">#</span></code></p></li>
<li><p><strong>List values</strong> are comma-separated.</p></li>
<li><p><strong>Single-line string values</strong> can be single-, double-, or un-quoted.</p></li>
<li><p><strong>Multi-line string values</strong> are triple-quoted (using
single or double quote characters).</p></li>
<li><p><strong>Boolean values</strong> are capitalized: True, False.</p></li>
<li><p><strong>Leading and trailing whitespace</strong> is ignored.</p></li>
<li><p><strong>Indentation</strong> is optional but should be used for clarity.</p></li>
<li><p><strong>Continuation lines</strong> follow a trailing backslash: <code class="docutils literal notranslate"><span class="pre">\</span></code></p></li>
<li><p><strong>Duplicate sections</strong> add their items to those previously
defined under the same section.</p></li>
<li><p><strong>Duplicate items</strong> override, <em>except for dependency
``graph`` strings, which are additive</em>.</p></li>
<li><p><strong>Include-files</strong> <code class="docutils literal notranslate"><span class="pre">%include</span> <span class="pre">inc/foo.rc</span></code> can be
used as a verbatim inlining mechanism.</p></li>
</ul>
<p>Suites that embed templating code (see <a class="reference internal" href="#jinja"><span class="std std-ref">Jinja2</span></a> and <a class="reference internal" href="#empylabel"><span class="std std-ref">EmPy</span></a>) must
process to raw suite.rc syntax.</p>
</div>
<div class="section" id="include-files">
<h3>Include-Files<a class="headerlink" href="#include-files" title="Permalink to this headline">¶</a></h3>
<p>Cylc has native support for suite.rc include-files, which may help to
organize large suites. Inclusion boundaries are completely arbitrary -
you can think of include-files as chunks of the suite.rc file simply
cut-and-pasted into another file. Include-files may be included
multiple times in the same file, and even nested. Include-file paths
can be specified portably relative to the suite configuration directory,
e.g.:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># include the file $CYLC_SUITE_DEF_PATH/inc/foo.rc:</span>
<span class="o">%include</span> <span class="s">inc/foo.rc</span>
</pre></div>
</div>
<div class="section" id="editing-temporarily-inlined-suites">
<h4>Editing Temporarily Inlined Suites<a class="headerlink" href="#editing-temporarily-inlined-suites" title="Permalink to this headline">¶</a></h4>
<p>Cylc’s native file inclusion mechanism supports optional inlined
editing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc edit --inline SUITE
</pre></div>
</div>
<p>The suite will be split back into its constituent include-files when you
exit the edit session. While editing, the inlined file becomes the
official suite configuration so that changes take effect whenever you save
the file. See <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">prep</span> <span class="pre">edit</span> <span class="pre">--help</span></code> for more information.</p>
</div>
<div class="section" id="include-files-via-jinja2">
<h4>Include-Files via Jinja2<a class="headerlink" href="#include-files-via-jinja2" title="Permalink to this headline">¶</a></h4>
<p>Jinja2 (<a class="reference internal" href="#jinja"><span class="std std-ref">Jinja2</span></a>) also has template inclusion functionality.</p>
</div>
</div>
<div class="section" id="syntax-highlighting-for-suite-configuration">
<span id="syntaxhighlighting"></span><h3>Syntax Highlighting For Suite Configuration<a class="headerlink" href="#syntax-highlighting-for-suite-configuration" title="Permalink to this headline">¶</a></h3>
<p>Cylc comes with syntax files for a number of text editors: vim, emacs,
gedit (and other gtksourceview programs), and kate.</p>
<p>These can be extracted from the cylc-flow library with the <code class="docutils literal notranslate"><span class="pre">cylc</span>
<span class="pre">get-pkg-resources</span></code> command. Refer to comments at the top of each file for
usage instructions.</p>
</div>
<div class="section" id="gross-file-structure">
<h3>Gross File Structure<a class="headerlink" href="#gross-file-structure" title="Permalink to this headline">¶</a></h3>
<p>Cylc suite.rc files consist of a suite title and description followed by
configuration items grouped under several top level section headings:</p>
<ul class="simple">
<li><p><strong>[cylc]</strong> - <em>non task-specific suite configuration</em></p></li>
<li><p><strong>[scheduling]</strong> - <em>determines when tasks are ready to run</em></p>
<ul>
<li><p>tasks with special behaviour, e.g. clock-trigger tasks</p></li>
<li><p>the dependency graph, which defines the relationships
between tasks</p></li>
</ul>
</li>
<li><p><strong>[runtime]</strong> - <em>determines how, where, and what to
execute when tasks are ready</em></p>
<ul>
<li><p>script, environment, job submission, remote hosting, etc.</p></li>
<li><p>suite-wide defaults in the <em>root</em> namespace</p></li>
<li><p>a nested family hierarchy with common properties
inherited by related tasks</p></li>
</ul>
</li>
<li><p><strong>[visualization]</strong> - suite graph styling</p></li>
</ul>
</div>
<div class="section" id="validation">
<span id="id2"></span><h3>Validation<a class="headerlink" href="#validation" title="Permalink to this headline">¶</a></h3>
<p>Cylc suite.rc files are automatically validated against a specification
that defines all legal entries, values, options, and defaults. This
detects formatting errors, typographic errors, illegal items and illegal
values prior to run time. Some values are complex strings that require
further parsing by cylc to determine their correctness (this is also
done during validation). All legal entries are documented in
<a class="reference internal" href="../reference/config/suite.html#suite.rc" title="suite.rc"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">suite.rc</span></code></a>.</p>
<p>The validator reports the line numbers of detected errors. Here’s an
example showing a section heading with a missing right bracket:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc validate my.suite
    <span class="o">[[</span>special tasks<span class="o">]</span>
<span class="s1">&#39;Section bracket mismatch, line 19&#39;</span>
</pre></div>
</div>
<p>If the suite.rc file uses include-files <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">view</span></code> will
show an inlined copy of the suite with correct line numbers
(you can also edit suites in a temporarily inlined state with
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">edit</span> <span class="pre">--inline</span></code>).</p>
<p>Validation does not check the validity of chosen batch systems.</p>
</div>
</div>
<div class="section" id="scheduling-dependency-graphs">
<span id="configuringscheduling"></span><h2>Scheduling - Dependency Graphs<a class="headerlink" href="#scheduling-dependency-graphs" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../reference/config/suite.html#suite.rc[scheduling]" title="suite.rc[scheduling]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">suite.rc[scheduling]</span></code></a> section defines the
relationships between tasks in a suite - the information that allows
cylc to determine when tasks are ready to run. The most important
component of this is the suite dependency graph. Cylc graph notation
makes clear textual graph representations that are very concise because
sections of the graph that repeat at different hours of the day, say,
only have to be defined once. Here’s an example with dependencies that
vary depending on the particular cycle point:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20200401</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20200405</span>
    <span class="nt">[[graph]]</span>
        <span class="c1"># validity (hours)</span>
        <span class="nv">T00,T06,T12,T18 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            A =&gt; B &amp; C</span>   <span class="c1"># B and C trigger off A</span><span class="s2"></span>
<span class="s2">            A[-PT6H] =&gt; A</span>  <span class="c1"># Model A restart trigger</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="c1"># hours</span>
        <span class="nv">T06,T18 </span><span class="o">=</span><span class="s"> &quot;C =&gt; X&quot;</span>
</pre></div>
</div>
<p>Here is the complete suite.rc listing with the corresponding suite graph;
this is a complete, valid, runnable suite (it will use default task runtime
properties such as <code class="docutils literal notranslate"><span class="pre">script</span></code>):</p>
<div class="twocol docutils container">
<div class="caption docutils container">
<p><em>Example Suite</em></p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;Dependency Example 1&quot;</span>
<span class="nt">[cylc]</span>
    <span class="nv">UTC mode </span><span class="o">=</span><span class="s"> True</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20200401</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20200405</span>
    <span class="nt">[[graph]]</span>
        <span class="c1"># validity (hours)</span>
        <span class="nv">T00,T06,T12,T18 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            A =&gt; B &amp; C</span>     <span class="c1"># B and C trigger off A</span><span class="s2"></span>
<span class="s2">            A[-PT6H] =&gt; A</span>  <span class="c1"># Model A restart trigger</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="c1"># hours</span>
        <span class="nv">T06,T18 </span><span class="o">=</span><span class="s"> &quot;C =&gt; X&quot;</span>
<span class="nt">[visualization]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20200401</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20200401T06</span>
    <span class="nt">[[node attributes]]</span>
        <span class="nv">X </span><span class="o">=</span><span class="s"> &quot;color=red&quot;</span>
</pre></div>
</div>
</div>
<div class="image docutils container">
<div class="figure align-center" id="fig-dep-eg-1">
<img alt="../_images/dep-eg-1.png" src="../_images/dep-eg-1.png" />
</div>
</div>
</div>
<div class="section" id="graph-string-syntax">
<h3>Graph String Syntax<a class="headerlink" href="#graph-string-syntax" title="Permalink to this headline">¶</a></h3>
<p>Multiline graph strings may contain:</p>
<ul class="simple">
<li><p><strong>blank lines</strong></p></li>
<li><p><strong>arbitrary white space</strong></p></li>
<li><p><strong>internal comments</strong>: following the <code class="docutils literal notranslate"><span class="pre">#</span></code> character</p></li>
<li><p><strong>conditional task trigger expressions</strong> - see below.</p></li>
</ul>
</div>
<div class="section" id="interpreting-graph-strings">
<h3>Interpreting Graph Strings<a class="headerlink" href="#interpreting-graph-strings" title="Permalink to this headline">¶</a></h3>
<p>Suite dependency graphs can be broken down into pairs in which the left
side (which may be a single task or family, or several that are
conditionally related) defines a trigger for the task or family on the
right. For instance the “word graph” <em>C triggers off B which
triggers off A</em> can be deconstructed into pairs <em>C triggers off B</em>
and <em>B triggers off A</em>. In this section we use only the default
trigger type, which is to trigger off the upstream task succeeding;
see <a class="reference internal" href="#triggertypes"><span class="std std-ref">Task Triggering</span></a> for other available triggers.</p>
<p>In the case of cycling tasks, the triggers defined by a graph string are
valid for cycle points matching the list of hours specified for the
graph section. For example this graph:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">T00,T12 </span><span class="o">=</span><span class="s"> &quot;A =&gt; B&quot;</span>
</pre></div>
</div>
<p>implies that B triggers off A for cycle points in which the hour matches <code class="docutils literal notranslate"><span class="pre">00</span></code>
or <code class="docutils literal notranslate"><span class="pre">12</span></code>.</p>
<p>To define inter-cycle dependencies, attach an offset indicator to the
left side of a pair:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">T00,T12 </span><span class="o">=</span><span class="s"> &quot;A[-PT12H] =&gt; B&quot;</span>
</pre></div>
</div>
<p>This means B[time] triggers off A[time-PT12H] (12 hours before) for cycle
points with hours matching <code class="docutils literal notranslate"><span class="pre">00</span></code> or <code class="docutils literal notranslate"><span class="pre">12</span></code>. <code class="docutils literal notranslate"><span class="pre">time</span></code> is implicit because
this keeps graphs clean and concise, given that the
majority of tasks will typically
depend only on others with the same cycle point. Cycle point offsets can only
appear on the left of a pair, because a pairs define triggers for the right
task at cycle point <code class="docutils literal notranslate"><span class="pre">time</span></code>. However, <code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">=&gt;</span> <span class="pre">B[-PT6H]</span></code>, which is
illegal, can be reformulated as a <em>future trigger</em>
<code class="docutils literal notranslate"><span class="pre">A[+PT6H]</span> <span class="pre">=&gt;</span> <span class="pre">B</span></code> (see <a class="reference internal" href="#intercyclepointtriggers"><span class="std std-ref">Inter-Cycle Triggers</span></a>). It is also
possible to combine multiple offsets within a cycle point offset e.g.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">T00,T12 </span><span class="o">=</span><span class="s"> &quot;A[-P1D-PT12H] =&gt; B&quot;</span>
</pre></div>
</div>
<p>This means that B[Time] triggers off A[time-P1D-PT12H] (1 day and 12 hours
before).</p>
<p>Triggers can be chained together. This graph:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">T00, T12 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;A =&gt; B</span>  <span class="c1"># B triggers off A</span><span class="s2"></span>
<span class="s2">              B =&gt; C</span>  <span class="c1"># C triggers off B&quot;&quot;&quot;</span><span class="s2"></span>
</pre></div>
</div>
<p>is equivalent to this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">T00, T12 </span><span class="o">=</span><span class="s"> &quot;A =&gt; B =&gt; C&quot;</span>
</pre></div>
</div>
<p><em>Each trigger in the graph must be unique</em> but <em>the same task
can appear in multiple pairs or chains</em>. Separately defined triggers
for the same task have an AND relationship. So this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">T00, T12 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;A =&gt; X</span>  <span class="c1"># X triggers off A</span><span class="s2"></span>
<span class="s2">              B =&gt; X</span>  <span class="c1"># X also triggers off B&quot;&quot;&quot;</span><span class="s2"></span>
</pre></div>
</div>
<p>is equivalent to this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">T00, T12 </span><span class="o">=</span><span class="s"> &quot;A &amp; B =&gt; X&quot;</span>  <span class="c1"># X triggers off A AND B</span>
</pre></div>
</div>
<p>In summary, the branching tree structure of a dependency graph can
be partitioned into lines (in the suite.rc graph string) of pairs
or chains, in any way you like, with liberal use of internal white space
and comments to make the graph structure as clear as possible.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># B triggers if A succeeds, then C and D trigger if B succeeds:</span>
    <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;A =&gt; B =&gt; C &amp; D&quot;</span>
<span class="c1"># which is equivalent to this:</span>
    <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;A =&gt; B =&gt; C</span>
<span class="s2">            B =&gt; D&quot;&quot;&quot;</span>
<span class="c1"># and to this:</span>
    <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;A =&gt; B =&gt; D</span>
<span class="s2">            B =&gt; C&quot;&quot;&quot;</span>
<span class="c1"># and to this:</span>
    <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;A =&gt; B</span>
<span class="s2">            B =&gt; C</span>
<span class="s2">            B =&gt; D&quot;&quot;&quot;</span>
<span class="c1"># and it can even be written like this:</span>
    <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;A =&gt; B</span> <span class="c1"># blank line follows:</span><span class="s2"></span>

<span class="s2">            B =&gt; C</span> <span class="c1"># comment ...</span><span class="s2"></span>
<span class="s2">            B =&gt; D&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="section" id="splitting-up-long-graph-lines">
<h4>Splitting Up Long Graph Lines<a class="headerlink" href="#splitting-up-long-graph-lines" title="Permalink to this headline">¶</a></h4>
<p>It is not necessary to use the general line continuation marker
<code class="docutils literal notranslate"><span class="pre">\</span></code> to split long graph lines. Just break at dependency arrows,
or split long chains into smaller ones. This graph:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;A =&gt; B =&gt; C&quot;</span>
</pre></div>
</div>
<p>is equivalent to this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;A =&gt; B =&gt;</span>
<span class="s2">        C&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>and also to this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;A =&gt; B</span>
<span class="s2">        B =&gt; C&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="graph-types">
<span id="graphtypes"></span><h3>Graph Types<a class="headerlink" href="#graph-types" title="Permalink to this headline">¶</a></h3>
<p>A suite configuration can contain multiple graph strings that are combined
to generate the final graph.</p>
<div class="section" id="one-off-non-cycling">
<h4>One-off (Non-Cycling)<a class="headerlink" href="#one-off-non-cycling" title="Permalink to this headline">¶</a></h4>
<p>The following is a small suite of one-off non-cycling
tasks; these all share a single cycle point (<code class="docutils literal notranslate"><span class="pre">1</span></code>) and don’t spawn
successors (once they’re all finished the suite just exits). The integer
<code class="docutils literal notranslate"><span class="pre">1</span></code> attached to each graph node is just an arbitrary label here.</p>
<div class="twocol docutils container">
<div class="caption docutils container">
<p><em>One-off (Non-Cycling) Tasks</em></p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> some one-off tasks</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;foo =&gt; bar &amp; baz =&gt; qux&quot;</span>
</pre></div>
</div>
</div>
<div class="image docutils container">
<div class="figure align-center" id="fig-test1">
<img alt="../_images/test1.png" src="../_images/test1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="cycling-graphs">
<h4>Cycling Graphs<a class="headerlink" href="#cycling-graphs" title="Permalink to this headline">¶</a></h4>
<p>For cycling tasks the graph section heading defines a sequence of cycle points
for which the subsequent graph section is valid, as demonstrated here for a
small suite of cycling tasks:</p>
<div class="twocol docutils container">
<div class="caption docutils container">
<p><em>Cycling Tasks</em></p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> some cycling tasks</span>
<span class="c1"># (no dependence between cycle points)</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">T00,T12 </span><span class="o">=</span><span class="s"> &quot;foo =&gt; bar &amp; baz =&gt; qux&quot;</span>
</pre></div>
</div>
</div>
<div class="image docutils container">
<div class="figure align-center" id="fig-test2">
<img alt="../_images/test2.png" src="../_images/test2.png" />
</div>
</div>
</div>
</div>
</div>
<div class="section" id="graph-section-headings">
<h3>Graph Section Headings<a class="headerlink" href="#graph-section-headings" title="Permalink to this headline">¶</a></h3>
<p>Graph section headings define recurrence expressions, the graph within a graph
section heading defines a workflow at each point of the recurrence. For
example in the following scenario:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">T06 </span><span class="o">=</span><span class="s"> foo =&gt; bar</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">T06</span></code> means “Run every day starting at 06:00 after the
initial cycle point”. Cylc allows you to start (or end) at any particular
time, repeat at whatever frequency you like, and even optionally limit the
number of repetitions.</p>
<p>Graph section heading can also be used with integer cycling see
<a class="reference internal" href="#integercycling"><span class="std std-ref">Integer Cycling</span></a>.</p>
<div class="section" id="syntax-rules">
<h4>Syntax Rules<a class="headerlink" href="#syntax-rules" title="Permalink to this headline">¶</a></h4>
<p>Date-time cycling information is made up of a starting <em>date-time</em>, an
<em>interval</em>, and an optional <em>limit</em>.</p>
<p>The time is assumed to be in the local time zone unless you set
<code class="docutils literal notranslate"><span class="pre">[cylc]cycle</span> <span class="pre">point</span> <span class="pre">time</span> <span class="pre">zone</span></code> or <code class="docutils literal notranslate"><span class="pre">[cylc]UTC</span> <span class="pre">mode</span></code>. The
calendar is assumed to be the proleptic Gregorian calendar unless you set
<code class="docutils literal notranslate"><span class="pre">[scheduling]cycling</span> <span class="pre">mode</span></code>.</p>
<p>The syntax for representations is based on the ISO 8601 date-time standard.
This includes the representation of <em>date-time</em>, <em>interval</em>. What we
define for cylc’s cycling syntax is our own optionally-heavily-condensed form
of ISO 8601 recurrence syntax. The most common full form is:
<code class="docutils literal notranslate"><span class="pre">R[limit?]/[date-time]/[interval]</span></code>. However, we allow omitting
information that can be guessed from the context (rules below). This means
that it can be written as:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>R[limit?]/[date-time]
R[limit?]//[interval]
[date-time]/[interval]
R[limit?] # Special limit of 1 case
[date-time]
[interval]
</pre></div>
</div>
<p>with example graph headings for each form being:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="err">R5/T00</span>           <span class="c1"># Run 5 times at 00:00 every day</span>
<span class="err">R//PT1H</span>          <span class="c1"># Run every hour (Note the R// is redundant)</span>
<span class="err">20000101T00Z/P1D</span> <span class="c1"># Run every day starting at 00:00 1st Jan 2000</span>
<span class="err">R1</span>               <span class="c1"># Run once at the initial cycle point</span>
<span class="err">R1/20000101T00Z</span>  <span class="c1"># Run once at 00:00 1st Jan 2000</span>
<span class="err">P1Y</span>              <span class="c1"># Run every year</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">T00</span></code> is an example of <code class="docutils literal notranslate"><span class="pre">[date-time]</span></code>, with an
inferred 1 day period and no limit.</p>
</div>
<p>Where some or all <em>date-time</em> information is omitted, it is inferred to
be relative to the initial date-time cycle point. For example, <code class="docutils literal notranslate"><span class="pre">T00</span></code>
by itself would mean the next occurrence of midnight that follows, or is, the
initial cycle point. Entering <code class="docutils literal notranslate"><span class="pre">+PT6H</span></code> would mean 6 hours after the
initial cycle point. Entering <code class="docutils literal notranslate"><span class="pre">-P1D</span></code> would mean 1 day before the
initial cycle point. Entering no information for the <em>date-time</em> implies
the initial cycle point date-time itself.</p>
<p>Where the <em>interval</em> is omitted and some (but not all) <em>date-time</em>
information is omitted, it is inferred to be a single unit above
the largest given specific <em>date-time</em> unit. For example, the largest
given specific unit in <code class="docutils literal notranslate"><span class="pre">T00</span></code> is hours, so the inferred interval is
1 day (daily), <code class="docutils literal notranslate"><span class="pre">P1D</span></code>.</p>
<p>Where the <em>limit</em> is omitted, unlimited cycling is assumed. This will be
bounded by the final cycle point’s date-time if given.</p>
<p>Another supported form of ISO 8601 recurrence is:
<code class="docutils literal notranslate"><span class="pre">R[limit?]/[interval]/[date-time]</span></code>. This form uses the
<em>date-time</em> as the end of the cycling sequence rather than the start.
For example, <code class="docutils literal notranslate"><span class="pre">R3/P5D/20140430T06</span></code> means:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>20140420T06
20140425T06
20140430T06
</pre></div>
</div>
<p>This kind of form can be used for specifying special behaviour near the end of
the suite, at the final cycle point’s date-time. We can also represent this in
cylc with a collapsed form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>R[limit?]/[interval]
R[limit?]//[date-time]
[interval]/[date-time]
</pre></div>
</div>
<p>So, for example, you can write:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="err">R1//+P0D</span>  <span class="c1"># Run once at the final cycle point</span>
<span class="err">R5/P1D</span>    <span class="c1"># Run 5 times, every 1 day, ending at the final</span>
          <span class="c1"># cycle point</span>
<span class="err">P2W/T00</span>   <span class="c1"># Run every 2 weeks ending at 00:00 following</span>
          <span class="c1"># the final cycle point</span>
<span class="err">R//T00</span>    <span class="c1"># Run every 1 day ending at 00:00 following the</span>
          <span class="c1"># final cycle point</span>
</pre></div>
</div>
</div>
<div class="section" id="referencing-the-initial-and-final-cycle-points">
<span id="id3"></span><h4>Referencing The Initial And Final Cycle Points<a class="headerlink" href="#referencing-the-initial-and-final-cycle-points" title="Permalink to this headline">¶</a></h4>
<p>For convenience the caret and dollar symbols may be used as shorthand for the
initial and final cycle points. Using this shorthand you can write:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="err">R1/^+PT12H</span>  <span class="c1"># Repeat once 12 hours after the initial cycle point</span>
            <span class="c1"># R[limit]/[date-time]</span>
            <span class="c1"># Equivalent to R1/+PT12H</span>
<span class="err">R1/$</span>        <span class="c1"># Repeat once at the final cycle point</span>
            <span class="c1"># R[limit]/[date-time]</span>
            <span class="c1"># Equivalent to R1//+P0D</span>
<span class="err">$-P2D/PT3H</span>  <span class="c1"># Repeat 3 hourly starting two days before the</span>
            <span class="c1"># [date-time]/[interval]</span>
            <span class="c1"># final cycle point</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There can be multiple ways to write the same headings, for instance
the following all run once at the final cycle point:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="err">R1/P0Y</span>       <span class="c1"># R[limit]/[interval]</span>
<span class="err">R1/P0Y/$</span>     <span class="c1"># R[limit]/[interval]/[date-time]</span>
<span class="err">R1/$</span>         <span class="c1"># R[limit]/[date-time]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="excluding-dates">
<span id="id4"></span><h4>Excluding Dates<a class="headerlink" href="#excluding-dates" title="Permalink to this headline">¶</a></h4>
<p>Date-times can be excluded from a recurrence by an exclamation mark for
example <code class="docutils literal notranslate"><span class="pre">PT1D!20000101</span></code> means run daily except on the
first of January 2000.</p>
<p>This syntax can be used to exclude one or multiple date-times from a
recurrence. Multiple date-times are excluded using the syntax
<code class="docutils literal notranslate"><span class="pre">PT1D!(20000101,20000102,...)</span></code>. All date-times listed within
the parentheses after the exclamation mark will be excluded.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">^</span></code> and <code class="docutils literal notranslate"><span class="pre">$</span></code> symbols (shorthand for the initial
and final cycle points) are both date-times so <code class="docutils literal notranslate"><span class="pre">T12!$-PT1D</span></code>
is valid.</p>
</div>
<p>If using a run limit in combination with an exclusion, the heading might not
run the number of times specified in the limit. For example in the following
suite <code class="docutils literal notranslate"><span class="pre">foo</span></code> will only run once as its second run has been excluded.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20000101T00Z</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20000105T00Z</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R2/P1D!20000102 </span><span class="o">=</span><span class="s"> foo</span>
</pre></div>
</div>
</div>
<div class="section" id="advanced-exclusion-syntax">
<h4>Advanced exclusion syntax<a class="headerlink" href="#advanced-exclusion-syntax" title="Permalink to this headline">¶</a></h4>
<p>In addition to excluding isolated date-time points or lists of date-time points
from recurrences, exclusions themselves may be date-time recurrence sequences.
Any partial date-time or sequence given after the exclamation mark will be
excluded from the main sequence.</p>
<p>For example, partial date-times can be excluded using the syntax:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="err">PT1H</span> <span class="err">!</span> <span class="err">T12</span>                   <span class="c1"># Run hourly but not at 12:00 from the initial</span>
                             <span class="c1"># cycle point.</span>
<span class="err">T-00</span> <span class="err">!</span> <span class="err">(T00,</span> <span class="err">T06,</span> <span class="err">T12,</span> <span class="err">T18)</span>  <span class="c1"># Run hourly but not at 00:00, 06:00,</span>
                             <span class="c1"># 12:00, 18:00.</span>
<span class="err">PT5M</span> <span class="err">!</span> <span class="err">T-15</span>                  <span class="c1"># Run 5-minutely but not at 15 minutes past the</span>
                             <span class="c1"># hour from the initial cycle point.</span>
<span class="err">T00</span> <span class="err">!</span> <span class="err">W-1T00</span>                 <span class="c1"># Run daily at 00:00 except on Mondays.</span>
</pre></div>
</div>
<p>It is also valid to use sequences for exclusions. For example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="err">PT1H</span> <span class="err">!</span> <span class="err">PT6H</span>         <span class="c1"># Run hourly from the initial cycle point but</span>
                    <span class="c1"># not 6-hourly from the initial cycle point.</span>
<span class="err">T-00</span> <span class="err">!</span> <span class="err">PT6H</span>         <span class="c1"># Run hourly on the hour but not 6-hourly on the hour.</span>
<span class="c1"># Same as T-00 ! T-00/PT6H (T-00 context is implied)</span>
<span class="c1"># Same as T-00 ! (T00, T06, T12, T18)</span>
<span class="c1"># Same as PT1H ! (T00, T06, T12, T18) Initial cycle point dependent</span>

<span class="err">T12</span> <span class="err">!</span> <span class="err">T12/P15D</span>      <span class="c1"># Run daily at 12:00 except every 15th day.</span>

<span class="err">R/^/P1H</span> <span class="err">!</span> <span class="err">R5/20000101T00/P1D</span>    <span class="c1"># Any valid recurrence may be used to</span>
                                <span class="c1"># determine exclusions. This example</span>
                                <span class="c1"># translates to: Repeat every hour from</span>
                                <span class="c1"># the initial cycle point, but exclude</span>
                                <span class="c1"># 00:00 for 5 days from the 1st January</span>
                                <span class="c1"># 2000.</span>
</pre></div>
</div>
<p>You can combine exclusion sequences and single point exclusions within a
comma separated list enclosed in parentheses:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="err">T-00</span> <span class="err">!</span> <span class="err">(20000101T07,</span> <span class="err">PT2H)</span>  <span class="c1"># Run hourly on the hour but not at 07:00</span>
                            <span class="c1"># on the 1st Jan, 2000 and not 2-hourly</span>
                            <span class="c1"># on the hour.</span>
</pre></div>
</div>
</div>
<div class="section" id="how-multiple-graph-strings-combine">
<span id="howmultiplegraphstringscombine"></span><h4>How Multiple Graph Strings Combine<a class="headerlink" href="#how-multiple-graph-strings-combine" title="Permalink to this headline">¶</a></h4>
<p>For a cycling graph with multiple validity sections for different
hours of the day, the different sections <em>add</em> to generate the
complete graph. Different graph sections can overlap (i.e. the same
hours may appear in multiple section headings) and the same tasks may
appear in multiple sections, but individual dependencies should be
unique across the entire graph. For example, the following graph defines
a duplicate prerequisite for task C:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">T00,T06,T12,T18 </span><span class="o">=</span><span class="s"> &quot;A =&gt; B =&gt; C&quot;</span>
        <span class="nv">T06,T18 </span><span class="o">=</span><span class="s"> &quot;B =&gt; C =&gt; X&quot;</span>
        <span class="c1"># duplicate prerequisite: B =&gt; C already defined at T06, T18</span>
</pre></div>
</div>
<p>This does not affect scheduling, but for the sake of clarity and brevity
the graph should be written like this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">T00,T06,T12,T18 </span><span class="o">=</span><span class="s"> &quot;A =&gt; B =&gt; C&quot;</span>
        <span class="c1"># X triggers off C only at 6 and 18 hours</span>
        <span class="nv">T06,T18 </span><span class="o">=</span><span class="s"> &quot;C =&gt; X&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="advanced-examples">
<span id="advancedcycling"></span><h4>Advanced Examples<a class="headerlink" href="#advanced-examples" title="Permalink to this headline">¶</a></h4>
<p>The following examples show the various ways of writing graph headings in cylc.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="err">R1</span>         <span class="c1"># Run once at the initial cycle point</span>
<span class="err">P1D</span>        <span class="c1"># Run every day starting at the initial cycle point</span>
<span class="err">PT5M</span>       <span class="c1"># Run every 5 minutes starting at the initial cycle point</span>
<span class="err">T00/P2W</span>    <span class="c1"># Run every 2 weeks starting at 00:00 after the</span>
           <span class="c1"># initial cycle point</span>
<span class="err">+P5D/P1M</span>   <span class="c1"># Run every month, starting 5 days after the initial cycle point</span>
<span class="err">R1/T06</span>     <span class="c1"># Run once at 06:00 after the initial cycle point</span>
<span class="err">R1/P0Y</span>     <span class="c1"># Run once at the final cycle point</span>
<span class="err">R1/$</span>       <span class="c1"># Run once at the final cycle point (alternative form)</span>
<span class="err">R1/$-P3D</span>   <span class="c1"># Run once three days before the final cycle point</span>
<span class="err">R3/T0830</span>   <span class="c1"># Run 3 times, every day at 08:30 after the initial cycle point</span>
<span class="err">R3/01T00</span>   <span class="c1"># Run 3 times, every month at 00:00 on the first</span>
           <span class="c1"># of the month after the initial cycle point</span>
<span class="err">R5/W-1/P1M</span> <span class="c1"># Run 5 times, every month starting on Monday</span>
           <span class="c1"># following the initial cycle point</span>
<span class="err">T00!^</span>      <span class="c1"># Run at the first occurrence of T00 that isn&#39;t the</span>
           <span class="c1"># initial cycle point</span>
<span class="err">PT1D!20000101</span>  <span class="c1"># Run every day days excluding 1st Jan 2000</span>
<span class="err">20140201T06/P1D</span>    <span class="c1"># Run every day starting at 20140201T06</span>
<span class="err">R1/min(T00,T06,T12,T18)</span>  <span class="c1"># Run once at the first instance</span>
                         <span class="c1"># of either T00, T06, T12 or T18</span>
                         <span class="c1"># starting at the initial cycle point</span>
</pre></div>
</div>
</div>
<div class="section" id="advanced-starting-up">
<span id="advancedstartingup"></span><h4>Advanced Starting Up<a class="headerlink" href="#advanced-starting-up" title="Permalink to this headline">¶</a></h4>
<p>Dependencies that are only valid at the initial cycle point can be written
using the <code class="docutils literal notranslate"><span class="pre">R1</span></code> notation. For example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nv">UTC mode </span><span class="o">=</span><span class="s"> True</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20130808T00</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20130812T00</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;prep =&gt; foo&quot;</span>
        <span class="nv">T00 </span><span class="o">=</span><span class="s"> &quot;foo[-P1D] =&gt; foo =&gt; bar&quot;</span>
</pre></div>
</div>
<p>In the example above, <code class="docutils literal notranslate"><span class="pre">R1</span></code> implies <code class="docutils literal notranslate"><span class="pre">R1/20130808T00</span></code>, so
<code class="docutils literal notranslate"><span class="pre">prep</span></code> only runs once at that cycle point (the initial cycle point).
At that cycle point, <code class="docutils literal notranslate"><span class="pre">foo</span></code> will have a dependence on
<code class="docutils literal notranslate"><span class="pre">prep</span></code> - but not at subsequent cycle points.</p>
<p>However, it is possible to have a suite that has multiple effective initial
cycles - for example, one starting at <code class="docutils literal notranslate"><span class="pre">T00</span></code> and another starting
at <code class="docutils literal notranslate"><span class="pre">T12</span></code>. What if they need to share an initial task?</p>
<p>Let’s suppose that we add the following section to the suite example above:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nv">UTC mode </span><span class="o">=</span><span class="s"> True</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20130808T00</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20130812T00</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;prep =&gt; foo&quot;</span>
        <span class="nv">T00 </span><span class="o">=</span><span class="s"> &quot;foo[-P1D] =&gt; foo =&gt; bar&quot;</span>
        <span class="nv">T12 </span><span class="o">=</span><span class="s"> &quot;baz[-P1D] =&gt; baz =&gt; qux&quot;</span>
</pre></div>
</div>
<p>We’ll also say that there should be a starting dependence between
<code class="docutils literal notranslate"><span class="pre">prep</span></code> and our new task <code class="docutils literal notranslate"><span class="pre">baz</span></code> - but we still want to have
a single <code class="docutils literal notranslate"><span class="pre">prep</span></code> task, at a single cycle.</p>
<p>We can write this using a special case of the <code class="docutils literal notranslate"><span class="pre">task[-interval]</span></code> syntax -
if the interval is null, this implies the task at the initial cycle point.</p>
<p>For example, we can write our suite like so, to produce the graph as shown:</p>
<div class="twocol docutils container">
<div class="caption docutils container">
<p><em>Staggered Start Suite</em></p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nv">UTC mode </span><span class="o">=</span><span class="s"> True</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20130808T00</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20130812T00</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;prep&quot;</span>
        <span class="c1"># ^ implies the initial cycle point:</span>
        <span class="nv">R1/T00 </span><span class="o">=</span><span class="s"> &quot;prep[^] =&gt; foo&quot;</span>
        <span class="c1"># ^ is initial cycle point, as above:</span>
        <span class="nv">R1/T12 </span><span class="o">=</span><span class="s"> &quot;prep[^] =&gt; baz&quot;</span>
        <span class="nv">T00 </span><span class="o">=</span><span class="s"> &quot;foo[-P1D] =&gt; foo =&gt; bar&quot;</span>
        <span class="nv">T12 </span><span class="o">=</span><span class="s"> &quot;baz[-P1D] =&gt; baz =&gt; qux&quot;</span>
<span class="nt">[visualization]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20130808T00</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20130810T00</span>
    <span class="nt">[[node attributes]]</span>
        <span class="nv">foo </span><span class="o">=</span><span class="s"> &quot;color=red&quot;</span>
        <span class="nv">bar </span><span class="o">=</span><span class="s"> &quot;color=orange&quot;</span>
        <span class="nv">baz </span><span class="o">=</span><span class="s"> &quot;color=green&quot;</span>
        <span class="nv">qux </span><span class="o">=</span><span class="s"> &quot;color=blue&quot;</span>
</pre></div>
</div>
</div>
<div class="image docutils container">
<div class="figure align-center" id="fig-test4">
<img alt="../_images/test4.png" src="../_images/test4.png" />
</div>
</div>
</div>
<p>This neatly expresses what we want - a task running at the initial cycle point
that has one-off dependencies with other task sets at different cycles.</p>
<p>Cylc also caters for a different kind of requirement.</p>
<p>Usually, we want to specify additional tasks and dependencies at the initial
cycle point. What if we want our first cycle point to be entirely special,
with some tasks missing compared to subsequent cycle points?</p>
<p>In the suite below, <code class="docutils literal notranslate"><span class="pre">bar</span></code> will not be run at the initial
cycle point, but will still run at subsequent cycle points, where
<code class="docutils literal notranslate"><span class="pre">+PT6H/PT6H</span></code> means start at <code class="docutils literal notranslate"><span class="pre">+PT6H</span></code> (6 hours after
the initial cycle point) and then repeat every <code class="docutils literal notranslate"><span class="pre">PT6H</span></code> (6 hours):</p>
<div class="twocol docutils container">
<div class="caption docutils container">
<p><em>Restricted First Cycle Point Suite</em></p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nv">UTC mode </span><span class="o">=</span><span class="s"> True</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20130808T00</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20130808T18</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;setup_foo =&gt; foo&quot;</span>
        <span class="nv">+PT6H/PT6H </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            foo[-PT6H] =&gt; foo</span>
<span class="s2">            foo =&gt; bar</span>
<span class="s2">        &quot;&quot;&quot;</span>
<span class="nt">[visualization]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20130808T00</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20130808T18</span>
    <span class="nt">[[node attributes]]</span>
        <span class="nv">foo </span><span class="o">=</span><span class="s"> &quot;color=red&quot;</span>
        <span class="nv">bar </span><span class="o">=</span><span class="s"> &quot;color=orange&quot;</span>
</pre></div>
</div>
</div>
<div class="image docutils container">
<div class="figure align-center" id="fig-test5">
<img alt="../_images/test5.png" src="../_images/test5.png" />
</div>
</div>
</div>
<p>Some suites may have staggered start-up sequences where different tasks need
running once but only at specific cycle points, potentially due to differing
data sources at different cycle points with different possible initial cycle
points. To allow this cylc provides a <code class="docutils literal notranslate"><span class="pre">min(</span> <span class="pre">)</span></code> function that can be
used as follows:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nv">UTC mode </span><span class="o">=</span><span class="s"> True</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20100101T03</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1/min(T00,T12) </span><span class="o">=</span><span class="s"> &quot;prep1 =&gt; foo&quot;</span>
        <span class="nv">R1/min(T06,T18) </span><span class="o">=</span><span class="s"> &quot;prep2 =&gt; foo&quot;</span>
        <span class="nv">T00,T06,T12,T18 </span><span class="o">=</span><span class="s"> &quot;foo =&gt; bar&quot;</span>
</pre></div>
</div>
<p>In this example the initial cycle point is <code class="docutils literal notranslate"><span class="pre">20100101T03</span></code>, so the
<code class="docutils literal notranslate"><span class="pre">prep1</span></code> task will run once at <code class="docutils literal notranslate"><span class="pre">20100101T12</span></code> and the
<code class="docutils literal notranslate"><span class="pre">prep2</span></code> task will run once at <code class="docutils literal notranslate"><span class="pre">20100101T06</span></code> as these are
the first cycle points after the initial cycle point in the respective
<code class="docutils literal notranslate"><span class="pre">min(</span> <span class="pre">)</span></code> entries.</p>
</div>
<div class="section" id="integer-cycling">
<span id="integercycling"></span><h4>Integer Cycling<a class="headerlink" href="#integer-cycling" title="Permalink to this headline">¶</a></h4>
<p>In addition to non-repeating and date-time cycling workflows, cylc can do
integer cycling for repeating workflows that are not date-time based.</p>
<p>To construct an integer cycling suite, set
<a class="reference internal" href="../reference/config/suite.html#suite.rc[scheduling]cycling mode" title="suite.rc[scheduling]cycling mode"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[scheduling]cycling</span> <span class="pre">mode</span> <span class="pre">=</span> <span class="pre">integer</span></code></a>, and specify integer values
for the initial and (optional) final cycle points. The notation for intervals,
offsets, and recurrences (sequences) is similar to the date-time cycling
notation, except for the simple integer values.</p>
<p>The full integer recurrence expressions supported are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Rn/start-point/interval</span> <span class="pre">#</span> <span class="pre">e.g.</span> <span class="pre">R3/1/P2</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Rn/interval/end-point</span> <span class="pre">#</span> <span class="pre">e.g.</span> <span class="pre">R3/P2/9</span></code></p></li>
</ul>
<p>But, as for date-time cycling, sequence start and end points can be omitted
where suite initial and final cycle points can be assumed. Some examples:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="err">R1</span>        <span class="c1"># Run once at the initial cycle point</span>
          <span class="c1"># (short for R1/initial-point/?)</span>
<span class="err">P1</span>        <span class="c1"># Repeat with step 1 from the initial cycle point</span>
          <span class="c1"># (short for R/initial-point/P1)</span>
<span class="err">P5</span>        <span class="c1"># Repeat with step 5 from the initial cycle point</span>
          <span class="c1"># (short for R/initial-point/P5)</span>
<span class="err">R2//P2</span>    <span class="c1"># Run twice with step 3 from the initial cycle point</span>
          <span class="c1"># (short for R2/initial-point/P2)</span>
<span class="err">R/+P1/P2</span>  <span class="c1"># Repeat with step 2, from 1 after the initial cycle point</span>
<span class="err">R2/P2</span>     <span class="c1"># Run twice with step 2, to the final cycle point</span>
          <span class="c1"># (short for R2/P2/final-point)</span>
<span class="err">R1/P0</span>     <span class="c1"># Run once at the final cycle point</span>
          <span class="c1"># (short for R1/P0/final-point)</span>
</pre></div>
</div>
<div class="section" id="advanced-integer-cycling-syntax">
<h5>Advanced Integer Cycling Syntax<a class="headerlink" href="#advanced-integer-cycling-syntax" title="Permalink to this headline">¶</a></h5>
<p>The same syntax used to reference the initial and final cycle points
(introduced in <a class="reference internal" href="#referencing-the-initial-and-final-cycle-points"><span class="std std-ref">Referencing The Initial And Final Cycle Points</span></a>) for
use with date-time cycling can also be used for integer cycling. For
example you can write:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="err">R1/^</span>     <span class="c1"># Run once at the initial cycle point</span>
<span class="err">R1/$</span>     <span class="c1"># Run once at the final cycle point</span>
<span class="err">R3/^/P2</span>  <span class="c1"># Run three times with step two starting at the</span>
                 <span class="c1"># initial cycle point</span>
</pre></div>
</div>
<p>Likewise the syntax introduced in <a class="reference internal" href="#excluding-dates"><span class="std std-ref">Excluding Dates</span></a> for excluding
a particular point from a recurrence also works for integer cycling. For
example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="err">R/P4!8</span>       <span class="c1"># Run with step 4, to the final cycle point but not at point 8</span>
<span class="err">R3/3/P2!5</span>    <span class="c1"># Run with step 2 from point 3 but not at point 5</span>
<span class="err">R/+P1/P6!14</span>  <span class="c1"># Run with step 6 from 1 step after the</span>
             <span class="c1"># initial cycle point but not at point 14</span>
</pre></div>
</div>
<p>Multiple integer exclusions are also valid in the same way as the syntax
in <a class="reference internal" href="#excluding-dates"><span class="std std-ref">Excluding Dates</span></a>. Integer exclusions may be a list of single
integer points, an integer sequence, or a combination of both:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="err">R/P1!(2,3,7)</span>  <span class="c1"># Run with step 1 to the final cycle point,</span>
              <span class="c1"># but not at points 2, 3, or 7.</span>
<span class="err">P1</span> <span class="err">!</span> <span class="err">P2</span>       <span class="c1"># Run with step 1 from the initial to final</span>
              <span class="c1"># cycle point, skipping every other step from</span>
              <span class="c1"># the initial cycle point.</span>
<span class="err">P1</span> <span class="err">!</span> <span class="err">+P1/P2</span>   <span class="c1"># Run with step 1 from the initial cycle point,</span>
              <span class="c1"># excluding every other step beginning one step</span>
              <span class="c1"># after the initial cycle point.</span>
<span class="err">P1</span> <span class="err">!(P2,6,8)</span>  <span class="c1"># Run with step 1 from the initial cycle point,</span>
              <span class="c1"># excluding every other step, and also excluding</span>
              <span class="c1"># steps 6 and 8.</span>
</pre></div>
</div>
</div>
<div class="section" id="an-integer-cycling-example">
<h5>An Integer Cycling Example<a class="headerlink" href="#an-integer-cycling-example" title="Permalink to this headline">¶</a></h5>
<span class="target" id="fig-integer-pipeline"></span><p>The following suite definition, as <a class="reference internal" href="#fig-integer-pipeline"><span class="std std-ref">graphed above</span></a>,
implements a classical linear pipeline using integer cycling. The workflow
ensures that one instance each of A, B, and C runs concurrently and the
pipeline is kept full: when A.1 has finished processing the first dataset, A.2
can start on the second one at the same time as B.1 begins processing the
output of A.1, and so on. The artificial cross-cycle dependence ensures that
only one instance of A can run at a time; and similarly B and C. If available
compute resource supports more than three concurrent jobs, remove the
cross-cycle dependence and Cylc will run many cycles at once. Task runtime
configuration is omitted, but it would likely involve retrieving datasets by
cycle point and processing them in cycle point-specific shared workspaces under
the self-contained suite run directory.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">cycling mode </span><span class="o">=</span><span class="s"> integer</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 1</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R/^/P1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                A =&gt; B =&gt; C</span>
<span class="s2">                A[-P1] =&gt; A</span>
<span class="s2">                B[-P1] =&gt; B</span>
<span class="s2">                C[-P1] =&gt; C</span>
<span class="s2">                     &quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[A]]</span>
        <span class="c1"># ...</span>
    <span class="nt">[[B]]</span>
        <span class="c1"># ...</span>
    <span class="nt">[[C]]</span>
        <span class="c1"># ...</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="task-triggering">
<span id="triggertypes"></span><h3>Task Triggering<a class="headerlink" href="#task-triggering" title="Permalink to this headline">¶</a></h3>
<p>A task is said to “trigger” when it submits its job to run, as soon as all of
its dependencies (also known as its separate “triggers”) are met. Tasks can
be made to trigger off of the state of other tasks (indicated by a
<code class="docutils literal notranslate"><span class="pre">:state</span></code> qualifier on the upstream task (or family)
name in the graph) and, and off the clock, and arbitrary external events.</p>
<p>External triggering is relatively more complicated, and is documented
separately in <a class="reference internal" href="external-triggers.html#section-external-triggers"><span class="std std-ref">External Triggers</span></a>.</p>
<div class="section" id="success-triggers">
<h4>Success Triggers<a class="headerlink" href="#success-triggers" title="Permalink to this headline">¶</a></h4>
<p>The default, with no trigger type specified, is to trigger off the
upstream task succeeding:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># B triggers if A SUCCEEDS:</span>
    <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;A =&gt; B&quot;</span>
</pre></div>
</div>
<p>For consistency and completeness, however, the success trigger can be
explicit:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># B triggers if A SUCCEEDS:</span>
    <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;A =&gt; B&quot;</span>
<span class="c1"># or:</span>
    <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;A:succeed =&gt; B&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="failure-triggers">
<h4>Failure Triggers<a class="headerlink" href="#failure-triggers" title="Permalink to this headline">¶</a></h4>
<p>To trigger off the upstream task reporting failure:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># B triggers if A FAILS:</span>
    <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;A:fail =&gt; B&quot;</span>
</pre></div>
</div>
<p><em>Suicide triggers</em> can be used to remove task <code class="docutils literal notranslate"><span class="pre">B</span></code> here if
<code class="docutils literal notranslate"><span class="pre">A</span></code> does not fail, see <a class="reference internal" href="#suicidetriggers"><span class="std std-ref">Suicide Triggers</span></a>.</p>
</div>
<div class="section" id="start-triggers">
<h4>Start Triggers<a class="headerlink" href="#start-triggers" title="Permalink to this headline">¶</a></h4>
<p>To trigger off the upstream task starting to execute:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># B triggers if A STARTS EXECUTING:</span>
    <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;A:start =&gt; B&quot;</span>
</pre></div>
</div>
<p>This can be used to trigger tasks that monitor other tasks once they
(the target tasks) start executing. Consider a long-running forecast model,
for instance, that generates a sequence of output files as it runs. A
postprocessing task could be launched with a start trigger on the model
(<code class="docutils literal notranslate"><span class="pre">model:start</span> <span class="pre">=&gt;</span> <span class="pre">post</span></code>) to process the model output as it
becomes available. Note, however, that there are several alternative
ways of handling this scenario: both tasks could be triggered at the
same time (<code class="docutils literal notranslate"><span class="pre">foo</span> <span class="pre">=&gt;</span> <span class="pre">model</span> <span class="pre">&amp;</span> <span class="pre">post</span></code>), but depending on
external queue delays this could result in the monitoring task starting
to execute first; or a different postprocessing task could be
triggered off a message output for each data file
(<code class="docutils literal notranslate"><span class="pre">model:out1</span> <span class="pre">=&gt;</span> <span class="pre">post1</span></code> etc.; see <a class="reference internal" href="#messagetriggers"><span class="std std-ref">Message Triggers</span></a>), but this
may not be practical if the
number of output files is large or if it is difficult to add cylc
messaging calls to the model.</p>
</div>
<div class="section" id="finish-triggers">
<h4>Finish Triggers<a class="headerlink" href="#finish-triggers" title="Permalink to this headline">¶</a></h4>
<p>To trigger off the upstream task succeeding or failing, i.e. finishing
one way or the other:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># B triggers if A either SUCCEEDS or FAILS:</span>
    <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;A | A:fail =&gt; B&quot;</span>
<span class="c1"># or</span>
    <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;A:finish =&gt; B&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="message-triggers">
<span id="messagetriggers"></span><h4>Message Triggers<a class="headerlink" href="#message-triggers" title="Permalink to this headline">¶</a></h4>
<p>Tasks can also trigger off custom output messages. These must be registered in
the <a class="reference internal" href="../reference/config/suite.html#suite.rc[runtime]" title="suite.rc[runtime]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[runtime]</span></code></a> section of the emitting task, and reported using
the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">message</span></code> command in task scripting. The graph trigger notation
refers to the item name of the registered output message.
And example message triggering suite:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;test suite for cylc-6 message triggers&quot;</span>

<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20140801T00</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20141201T00</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">P2M </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;foo:out1 =&gt; bar</span>
<span class="s2">                 foo[-P2M]:out2 =&gt; baz&quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nv">script </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">sleep 5</span>
<span class="s2">cylc message -- &quot;${CYLC_SUITE_NAME}&quot; &quot;${CYLC_TASK_JOB}&quot; &quot;file 1 done&quot;</span>
<span class="s2">sleep 10</span>
<span class="s2">cylc message -- &quot;${CYLC_SUITE_NAME}&quot; &quot;${CYLC_TASK_JOB}&quot; &quot;file 2 done&quot;</span>
<span class="s2">sleep 10&quot;&quot;&quot;</span>
        <span class="nt">[[[outputs]]]</span>
            <span class="nv">out1 </span><span class="o">=</span><span class="s"> &quot;file 1 done&quot;</span>
            <span class="nv">out2 </span><span class="o">=</span><span class="s"> &quot;file 2 done&quot;</span>
    <span class="nt">[[bar, baz]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> sleep 10</span>
</pre></div>
</div>
</div>
<div class="section" id="job-submission-triggers">
<h4>Job Submission Triggers<a class="headerlink" href="#job-submission-triggers" title="Permalink to this headline">¶</a></h4>
<p>It is also possible to trigger off a task submitting, or failing to submit:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># B triggers if A submits successfully:</span>
    <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;A:submit =&gt; B&quot;</span>
<span class="c1"># D triggers if C fails to submit successfully:</span>
    <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;C:submit-fail =&gt; D&quot;</span>
</pre></div>
</div>
<p>A possible use case for submit-fail triggers: if a task goes into the
submit-failed state, possibly after several job submission retries,
another task that inherits the same runtime but sets a different job
submission method and/or host could be triggered to, in effect, run the
same job on a different platform.</p>
</div>
<div class="section" id="conditional-triggers">
<h4>Conditional Triggers<a class="headerlink" href="#conditional-triggers" title="Permalink to this headline">¶</a></h4>
<p>AND operators (<code class="docutils literal notranslate"><span class="pre">&amp;</span></code>) can appear on both sides of an arrow. They
provide a concise alternative to defining multiple triggers separately:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1/ this:</span>
    <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;A &amp; B =&gt; C&quot;</span>
<span class="c1"># is equivalent to:</span>
    <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;A =&gt; C</span>
<span class="s2">               B =&gt; C&quot;&quot;&quot;</span>
<span class="c1"># 2/ this:</span>
    <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;A =&gt; B &amp; C&quot;</span>
<span class="c1"># is equivalent to:</span>
    <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;A =&gt; B</span>
<span class="s2">               A =&gt; C&quot;&quot;&quot;</span>
<span class="c1"># 3/ and this:</span>
    <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;A &amp; B =&gt; C &amp; D&quot;</span>
<span class="c1"># is equivalent to this:</span>
    <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;A =&gt; C</span>
<span class="s2">               B =&gt; C</span>
<span class="s2">               A =&gt; D</span>
<span class="s2">               B =&gt; D&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>OR operators (<code class="docutils literal notranslate"><span class="pre">|</span></code>) which result in true conditional triggers,
can only appear on the left <a class="footnote-reference brackets" href="#id9" id="id5">1</a> :</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># C triggers when either A or B finishes:</span>
    <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;A | B =&gt; C&quot;</span>
</pre></div>
</div>
<p>Forecasting suites typically have simple conditional
triggering requirements, but any valid conditional expression can be
used, as shown in the graph below, where conditional triggers are plotted
with open arrow heads:</p>
<div class="twocol docutils container">
<div class="caption docutils container">
<p><em>Conditional triggers</em></p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span>        <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="c1"># D triggers if A or (B and C) succeed</span><span class="s2"></span>
<span class="s2">A | B &amp; C =&gt; D</span>
<span class="c1"># just to align the two graph sections</span><span class="s2"></span>
<span class="s2">D =&gt; W</span>
<span class="c1"># Z triggers if (W or X) and Y succeed</span><span class="s2"></span>
<span class="s2">(W|X) &amp; Y =&gt; Z</span>
<span class="s2">                &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="image docutils container">
<div class="figure align-center" id="fig-conditional">
<img alt="../_images/conditional-triggers.png" src="../_images/conditional-triggers.png" />
</div>
</div>
</div>
</div>
<div class="section" id="suicide-triggers">
<span id="suicidetriggers"></span><h4>Suicide Triggers<a class="headerlink" href="#suicide-triggers" title="Permalink to this headline">¶</a></h4>
<p>Suicide triggers take tasks out of the suite. This can be used for automated
failure recovery. The following <a class="reference internal" href="../reference/config/suite.html#suite.rc" title="suite.rc"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">suite.rc</span></code></a> listing and
accompanying graph
show how to define a chain of failure recovery tasks that trigger if they’re
needed but otherwise remove themselves from the
suite (you can run the <em>AutoRecover.async</em> example suite to see how
this works). The dashed graph edges ending in solid dots indicate
suicide triggers, and the open arrowheads indicate conditional triggers
as usual. Suicide triggers are ignored by default in the graph view, unless
you toggle them on with <em>View</em> <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> <em>Options</em> <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code>
<em>Ignore Suicide Triggers</em>.</p>
<div class="twocol docutils container">
<div class="caption docutils container">
<p><em>Automated failure recovery via suicide triggers</em></p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> automated failure recovery</span>
    <span class="nv">description </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Model task failure triggers diagnosis</span>
<span class="s2">and recovery tasks, which take themselves</span>
<span class="s2">out of the suite if model succeeds. Model</span>
<span class="s2">post processing triggers off model OR</span>
<span class="s2">recovery tasks.</span>
<span class="s2">              &quot;&quot;&quot;</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">pre =&gt; model</span>
<span class="s2">model:fail =&gt; diagnose =&gt; recover</span>
<span class="s2">model =&gt; !diagnose &amp; !recover</span>
<span class="s2">model | recover =&gt; post</span>
<span class="s2">                &quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[model]]</span>
        <span class="c1"># UNCOMMENT TO TEST FAILURE:</span>
        <span class="c1"># script = /bin/false</span>
</pre></div>
</div>
</div>
<div class="image docutils container">
<div class="figure align-center" id="fig-suicide">
<img alt="../_images/suicide.png" src="../_images/suicide.png" />
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Multiple suicide triggers combine in the same way as other
triggers, so this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">foo </span><span class="o">=</span><span class="s">&gt; !baz</span>
<span class="nv">bar </span><span class="o">=</span><span class="s">&gt; !baz</span>
</pre></div>
</div>
<p>is equivalent to this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">foo &amp; bar </span><span class="o">=</span><span class="s">&gt; !baz</span>
</pre></div>
</div>
<p>i.e. both <code class="docutils literal notranslate"><span class="pre">foo</span></code> and <code class="docutils literal notranslate"><span class="pre">bar</span></code> must succeed for
<code class="docutils literal notranslate"><span class="pre">baz</span></code> to be taken out of the suite. If you really want a task
to be taken out if any one of several events occurs then be careful to
write it that way:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">foo | bar </span><span class="o">=</span><span class="s">&gt; !baz</span>
</pre></div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>A word of warning on the meaning of “bare suicide triggers”. Consider
the following suite:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;foo =&gt; !bar&quot;</span>
</pre></div>
</div>
<p>Task <code class="docutils literal notranslate"><span class="pre">bar</span></code> has a suicide trigger but no normal prerequisites
(a suicide trigger is not a task triggering prerequisite, it is a task
removal prerequisite) so this is entirely equivalent to:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            foo &amp; bar</span>
<span class="s2">           foo =&gt; !bar</span>
<span class="s2">                &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>In other words both tasks will trigger immediately, at the same time,
and then <code class="docutils literal notranslate"><span class="pre">bar</span></code> will be removed if <code class="docutils literal notranslate"><span class="pre">foo</span></code> succeeds.</p>
</div>
<p>If an active task proxy (currently in the submitted or running states)
is removed from the suite by a suicide trigger, a warning will be logged.</p>
</div>
<div class="section" id="family-triggers">
<span id="familytriggers"></span><h4>Family Triggers<a class="headerlink" href="#family-triggers" title="Permalink to this headline">¶</a></h4>
<p>Families defined by the namespace inheritance hierarchy
(<a class="reference internal" href="#niorp"><span class="std std-ref">Runtime - Task Configuration</span></a>) can be used in the graph trigger whole groups of
tasks at the same time (e.g. forecast model ensembles and groups of
tasks for processing different observation types at the same time) and
for triggering downstream tasks off families as a whole. Higher level
families, i.e. families of families, can also be used, and are reduced
to the lowest level member tasks.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Tasks can also trigger off individual family members if necessary.</p>
</div>
<p>To trigger an entire task family at once:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;foo =&gt; FAM&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[FAM]]</span>    <span class="c1"># a family (because others inherit from it)</span>
    <span class="nt">[[m1,m2]]</span>  <span class="c1"># family members (inherit from namespace FAM)</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> FAM</span>
</pre></div>
</div>
<p>This is equivalent to:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;foo =&gt; m1 &amp; m2&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[FAM]]</span>
    <span class="nt">[[m1,m2]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> FAM</span>
</pre></div>
</div>
<p>To trigger other tasks off families we have to specify whether
to triggering off <em>all members</em> starting, succeeding, failing,
or finishing, or off <em>any</em> members (doing the same). Legal family
triggers are thus:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
      <span class="c1"># all-member triggers:</span><span class="s2"></span>
<span class="s2">    FAM:start-all =&gt; one</span>
<span class="s2">    FAM:succeed-all =&gt; one</span>
<span class="s2">    FAM:fail-all =&gt; one</span>
<span class="s2">    FAM:finish-all =&gt; one</span>
      <span class="c1"># any-member triggers:</span><span class="s2"></span>
<span class="s2">    FAM:start-any =&gt; one</span>
<span class="s2">    FAM:succeed-any =&gt; one</span>
<span class="s2">    FAM:fail-any =&gt; one</span>
<span class="s2">    FAM:finish-any =&gt; one</span>
<span class="s2">                &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Here’s how to trigger downstream processing after if one or more family
members succeed, but only after all members have finished (succeeded or
failed):</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    FAM:finish-all &amp; FAM:succeed-any =&gt; foo</span>
<span class="s2">                &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="efficient-inter-family-triggering">
<span id="efficientinterfamilytriggering"></span><h4>Efficient Inter-Family Triggering<a class="headerlink" href="#efficient-inter-family-triggering" title="Permalink to this headline">¶</a></h4>
<p>While cylc allows writing dependencies between two families it is important to
consider the number of dependencies this will generate. In the following
example, each member of <code class="docutils literal notranslate"><span class="pre">FAM2</span></code> has dependencies pointing at all the
members of <code class="docutils literal notranslate"><span class="pre">FAM1</span></code>.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    FAM1:succeed-any =&gt; FAM2</span>
<span class="s2">                &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Expanding this out, you generate <code class="docutils literal notranslate"><span class="pre">N</span> <span class="pre">*</span> <span class="pre">M</span></code> dependencies, where
<code class="docutils literal notranslate"><span class="pre">N</span></code> is the number of members of <code class="docutils literal notranslate"><span class="pre">FAM1</span></code> and <code class="docutils literal notranslate"><span class="pre">M</span></code> is
the number of members of <code class="docutils literal notranslate"><span class="pre">FAM2</span></code>. This can result in high memory use
as the number of members of these families grows, potentially rendering the
suite impractical for running on some systems.</p>
<p>You can greatly reduce the number of dependencies generated in these situations
by putting dummy tasks in the graphing to represent the state of the family you
want to trigger off. For example, if <code class="docutils literal notranslate"><span class="pre">FAM2</span></code> should trigger off any
member of <code class="docutils literal notranslate"><span class="pre">FAM1</span></code> succeeding you can create a dummy task
<code class="docutils literal notranslate"><span class="pre">FAM1_succeed_any_marker</span></code> and place a dependency on it as follows:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    FAM1:succeed-any =&gt; FAM1_succeed_any_marker =&gt; FAM2</span>
<span class="s2">                &quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
<span class="c1"># ...</span>
    <span class="nt">[[FAM1_succeed_any_marker]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> true</span>
<span class="c1"># ...</span>
</pre></div>
</div>
<p>This graph generates only <code class="docutils literal notranslate"><span class="pre">N</span> <span class="pre">+</span> <span class="pre">M</span></code> dependencies, which takes
significantly less memory and CPU to store and evaluate.</p>
</div>
<div class="section" id="inter-cycle-triggers">
<span id="intercyclepointtriggers"></span><h4>Inter-Cycle Triggers<a class="headerlink" href="#inter-cycle-triggers" title="Permalink to this headline">¶</a></h4>
<p>Typically most tasks in a suite will trigger off others in the same
cycle point, but some may depend on others with other cycle points.
This notably applies to warm-cycled forecast models, which depend on
their own previous instances (see below); but other kinds of inter-cycle
dependence are possible too <a class="footnote-reference brackets" href="#id10" id="id6">2</a> . Here’s how to express this
kind of relationship in cylc:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[[graph]]</span>
    <span class="c1"># B triggers off A in the previous cycle point</span>
    <span class="nv">PT6H </span><span class="o">=</span><span class="s"> &quot;A[-PT6H] =&gt; B&quot;</span>
</pre></div>
</div>
<p>inter-cycle and trigger type (or message trigger) notation can be
combined:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># B triggers if A in the previous cycle point fails:</span>
<span class="nv">PT6H </span><span class="o">=</span><span class="s"> &quot;A[-PT6H]:fail =&gt; B&quot;</span>
</pre></div>
</div>
<p>At suite start-up inter-cycle triggers refer to a previous cycle point
that does not exist. This does not cause the dependent task to wait
indefinitely, however, because cylc ignores triggers that reach back
beyond the initial cycle point. That said, the presence of an
inter-cycle trigger does normally imply that something special has to
happen at start-up. If a model depends on its own previous instance for
restart files, for instance, then an initial set of restart files has to be
generated somehow or the first model task will presumably fail with
missing input files. There are several ways to handle this in cylc
using different kinds of one-off (non-cycling) tasks that run at suite
start-up.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">R1</span></code> tasks (recommended):</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;prep&quot;</span>
        <span class="nv">R1/T00,R1/T12 </span><span class="o">=</span><span class="s"> &quot;prep[^] =&gt; foo&quot;</span>
        <span class="nv">T00,T12 </span><span class="o">=</span><span class="s"> &quot;foo[-PT12H] =&gt; foo =&gt; bar&quot;</span>
</pre></div>
</div>
</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">R1</span></code>, or <code class="docutils literal notranslate"><span class="pre">R1/date-time</span></code> tasks are the recommended way to
specify unusual start up conditions. They allow you to specify a clean
distinction between the dependencies of initial cycles and the dependencies
of the subsequent cycles.</p>
<p>Initial tasks can be used for real model cold-start processes, whereby a
warm-cycled model at any given cycle point can in principle have its inputs
satisfied by a previous instance of itself, <em>or</em> by an initial task with
(nominally) the same cycle point.</p>
<p>In effect, the <code class="docutils literal notranslate"><span class="pre">R1</span></code> task masquerades as the previous-cycle-point trigger
of its associated cycling task. At suite start-up initial tasks will
trigger the first cycling tasks, and thereafter the inter-cycle trigger
will take effect.</p>
<p>If a task has a dependency on another task in a different cycle point, the
dependency can be written using the <code class="docutils literal notranslate"><span class="pre">[offset]</span></code> syntax such as
<code class="docutils literal notranslate"><span class="pre">[-PT12H]</span></code> in <code class="docutils literal notranslate"><span class="pre">foo[-PT12H]</span> <span class="pre">=&gt;</span> <span class="pre">foo</span></code>. This means that
<code class="docutils literal notranslate"><span class="pre">foo</span></code> at the current cycle point depends on a previous instance of
<code class="docutils literal notranslate"><span class="pre">foo</span></code> at 12 hours before the current cycle point. Unlike recurrences
(e.g. <code class="docutils literal notranslate"><span class="pre">T00,T12</span></code>), dependencies assume that relative times are relative to the
current cycle point, not the initial cycle point.</p>
<p>However, it can be useful to have specific dependencies on tasks at or near
the initial cycle point. You can switch the context of the offset to be
the initial cycle point by using the caret symbol: <code class="docutils literal notranslate"><span class="pre">^</span></code>.</p>
<p>For example, you can write <code class="docutils literal notranslate"><span class="pre">foo[^]</span></code> to mean foo at the initial
cycle point, and <code class="docutils literal notranslate"><span class="pre">foo[^+PT6H]</span></code> to mean foo 6 hours after the initial
cycle point. Usually, this kind of dependency will only apply in a limited
number of cycle points near the start of the suite, so you may want to write
it in <code class="docutils literal notranslate"><span class="pre">R1</span></code>-based graphs. Here’s the example inter-cycle
<code class="docutils literal notranslate"><span class="pre">R1</span></code> suite from above again.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;prep&quot;</span>
        <span class="nv">R1/T00,R1/T12 </span><span class="o">=</span><span class="s"> &quot;prep[^] =&gt; foo&quot;</span>
        <span class="nv">T00,T12 </span><span class="o">=</span><span class="s"> &quot;foo[-PT12H] =&gt; foo =&gt; bar&quot;</span>
</pre></div>
</div>
<p>You can see there is a dependence on the initial <code class="docutils literal notranslate"><span class="pre">R1</span></code> task
<code class="docutils literal notranslate"><span class="pre">prep</span></code> for <code class="docutils literal notranslate"><span class="pre">foo</span></code> at the first <code class="docutils literal notranslate"><span class="pre">T00</span></code> cycle point,
and at the first <code class="docutils literal notranslate"><span class="pre">T12</span></code> cycle point. Thereafter, <code class="docutils literal notranslate"><span class="pre">foo</span></code> just
depends on its previous (12 hours ago) instance.</p>
<p>Finally, it is also possible to have a dependency on a task at a specific cycle
point.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1/20200202 </span><span class="o">=</span><span class="s"> &quot;baz[20200101] =&gt; qux&quot;</span>
</pre></div>
</div>
<p>However, in a long running suite, a repeating cycle should avoid having a
dependency on a task with a specific cycle point (including the initial cycle
point) - as it can currently cause performance issue. In the following example,
all instances of <code class="docutils literal notranslate"><span class="pre">qux</span></code> will depend on <code class="docutils literal notranslate"><span class="pre">baz.20200101</span></code>, which
will never be removed from the task pool:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2010</span>
    <span class="nt">[[graph]]</span>
        <span class="c1"># Can cause performance issue!</span>
        <span class="nv">P1D </span><span class="o">=</span><span class="s"> &quot;baz[20200101] =&gt; qux&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="special-sequential-tasks">
<span id="sequentialtasks"></span><h4>Special Sequential Tasks<a class="headerlink" href="#special-sequential-tasks" title="Permalink to this headline">¶</a></h4>
<p>Tasks that depend on their own previous-cycle instance can be declared as
<em>sequential</em>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[special tasks]]</span>
        <span class="c1"># foo depends on its previous instance:</span>
        <span class="nv">sequential </span><span class="o">=</span><span class="s"> foo</span>  <span class="c1"># deprecated - see below!</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">T00,T12 </span><span class="o">=</span><span class="s"> &quot;foo =&gt; bar&quot;</span>
</pre></div>
</div>
<p><em>The sequential declaration is deprecated</em> however, in favor of explicit
inter-cycle triggers which clearly expose the same scheduling behaviour in the
graph:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="c1"># foo depends on its previous instance:</span>
        <span class="nv">T00,T12 </span><span class="o">=</span><span class="s"> &quot;foo[-PT12H] =&gt; foo =&gt; bar&quot;</span>
</pre></div>
</div>
<p>The sequential declaration is arguably convenient in one unusual situation
though: if a task has a non-uniform cycling sequence then multiple explicit
triggers,</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">T00,T03,T11 </span><span class="o">=</span><span class="s"> &quot;foo =&gt; bar&quot;</span>
        <span class="nv">T00 </span><span class="o">=</span><span class="s"> &quot;foo[-PT13H] =&gt; foo&quot;</span>
        <span class="nv">T03 </span><span class="o">=</span><span class="s"> &quot;foo[-PT3H] =&gt; foo&quot;</span>
        <span class="nv">T11 </span><span class="o">=</span><span class="s"> &quot;foo[-PT8H] =&gt; foo&quot;</span>
</pre></div>
</div>
<p>can be replaced by a single sequential declaration,</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[special tasks]]</span>
        <span class="nv">sequential </span><span class="o">=</span><span class="s"> foo</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">T00,T03,T11 </span><span class="o">=</span><span class="s"> &quot;foo =&gt; bar&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="future-triggers">
<h4>Future Triggers<a class="headerlink" href="#future-triggers" title="Permalink to this headline">¶</a></h4>
<p>Cylc also supports inter-cycle triggering off tasks “in the future” (with
respect to cycle point - which has no bearing on wall-clock job submission time
unless the task has a clock trigger):</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[[graph]]</span>
    <span class="nv">T00,T06,T12,T18 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
        <span class="c1"># A runs in this cycle:</span><span class="s2"></span>
<span class="s2">        A</span>
        <span class="c1"># B in this cycle triggers off A in the next cycle.</span><span class="s2"></span>
<span class="s2">        A[PT6H] =&gt; B</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Future triggers present a problem at suite shutdown rather than at start-up.
Here, <code class="docutils literal notranslate"><span class="pre">B</span></code> at the final cycle point wants to trigger off an instance
of <code class="docutils literal notranslate"><span class="pre">A</span></code> that will never exist because it is beyond the suite stop
point. Consequently Cylc prevents tasks from spawning successors that depend on
other tasks beyond the final point.</p>
</div>
<div class="section" id="clock-triggers">
<span id="clocktriggertasks"></span><h4>Clock Triggers<a class="headerlink" href="#clock-triggers" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please read External Triggers (<a class="reference internal" href="external-triggers.html#section-external-triggers"><span class="std std-ref">External Triggers</span></a>) before
using the older clock triggers described in this section.</p>
</div>
<p>By default, date-time cycle points are not connected to the real time “wall
clock”. They are just labels that are passed to task jobs (e.g. to
initialize an atmospheric model run with a particular date-time value). In real
time cycling systems, however, some tasks - typically those near the top of the
graph in each cycle - need to trigger at or near the time when their cycle point
is equal to the real clock date-time.</p>
<p>So <em>clock triggers</em> allow tasks to trigger at (or after, depending on other
triggers) a wall clock time expressed as an offset from cycle point:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[special tasks]]</span>
        <span class="nv">clock-trigger </span><span class="o">=</span><span class="s"> foo(PT2H)</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">T00 </span><span class="o">=</span><span class="s"> foo</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">foo[2015-08-23T00]</span></code> would trigger (other dependencies allowing)
when the wall clock time reaches <code class="docutils literal notranslate"><span class="pre">2015-08-23T02</span></code>. Clock-trigger
offsets are normally positive, to trigger some time <em>after</em> the wall-clock
time is equal to task cycle point.</p>
<p>Clock-triggers have no effect on scheduling if a suite is running sufficiently
far behind the clock (e.g. after a delay, or because it is processing archived
historical data) that the trigger times, which are relative to task cycle
point, have already passed.</p>
</div>
<div class="section" id="clock-expire-triggers">
<span id="clockexpiretasks"></span><h4>Clock-Expire Triggers<a class="headerlink" href="#clock-expire-triggers" title="Permalink to this headline">¶</a></h4>
<p>Tasks can be configured to <em>expire</em> - i.e. to skip job submission and
enter the <em>expired</em> state - if they are too far behind the wall clock when
they become ready to run, and other tasks can trigger off this. As a possible
use case, consider a cycling task that copies the latest of a set of files to
overwrite the previous set: if the task is delayed by more than one cycle there
may be no point in running it because the freshly copied files will just be
overwritten immediately by the next task instance as the suite catches back up
to real time operation. Clock-expire tasks are configured with
<a class="reference internal" href="../reference/config/suite.html#suite.rc[scheduling][special tasks]clock-expire" title="suite.rc[scheduling][special tasks]clock-expire"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[scheduling][special</span> <span class="pre">tasks]clock-expire</span></code></a> using a syntax like
<a class="reference internal" href="../reference/config/suite.html#suite.rc[scheduling][special tasks]clock-trigger" title="suite.rc[scheduling][special tasks]clock-trigger"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">clock-trigger</span></code></a>
with a date-time offset relative to cycle point.
The offset should be positive to make the task expire if the wall-clock time
has gone beyond the cycle point. Triggering off an expired task typically
requires suicide triggers to remove the workflow that runs if the task has not
expired. Here a task called <code class="docutils literal notranslate"><span class="pre">copy</span></code> expires, and its downstream
workflow is skipped, if it is more than one day behind the wall-clock:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
   <span class="nv">cycle point format </span><span class="o">=</span><span class="s"> %Y-%m-%dT%H</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2015-08-15T00</span>
    <span class="nt">[[special tasks]]</span>
        <span class="nv">clock-expire </span><span class="o">=</span><span class="s"> copy(-P1D)</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">P1D </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            model[-P1D] =&gt; model =&gt; copy =&gt; proc</span>
<span class="s2">            copy:expired =&gt; !proc</span>
<span class="s2">        &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="external-triggers">
<span id="suiteconfigexternaltriggers"></span><h4>External Triggers<a class="headerlink" href="#external-triggers" title="Permalink to this headline">¶</a></h4>
<p>This is a substantial topic, documented in <a class="reference internal" href="external-triggers.html#section-external-triggers"><span class="std std-ref">External Triggers</span></a>.</p>
</div>
</div>
<div class="section" id="model-restart-dependencies">
<span id="modelrestartdependencies"></span><h3>Model Restart Dependencies<a class="headerlink" href="#model-restart-dependencies" title="Permalink to this headline">¶</a></h3>
<p>Warm-cycled forecast models generate <em>restart files</em>, e.g. model
background fields, to initialize the next forecast. This kind of
dependence requires an inter-cycle trigger:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">T00,T06,T12,T18 </span><span class="o">=</span><span class="s"> &quot;A[-PT6H] =&gt; A&quot;</span>
</pre></div>
</div>
<p>If your model is configured to write out additional restart files
to allow one or more cycle points to be skipped in an emergency <em>do not
represent these potential dependencies in the suite graph</em> as they
should not be used under normal circumstances. For example, the
following graph would result in task <code class="docutils literal notranslate"><span class="pre">A</span></code> erroneously
triggering off <code class="docutils literal notranslate"><span class="pre">A[T-24]</span></code> as a matter of course, instead of
off <code class="docutils literal notranslate"><span class="pre">A[T-6]</span></code>, because <code class="docutils literal notranslate"><span class="pre">A[T-24]</span></code> will always
be finished first:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="c1"># DO NOT DO THIS (SEE ACCOMPANYING TEXT):</span>
        <span class="nv">T00,T06,T12,T18 </span><span class="o">=</span><span class="s"> &quot;A[-PT24H] | A[-PT18H] | A[-PT12H] | A[-PT6H] =&gt; A&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="how-the-graph-determines-task-instantiation">
<h3>How The Graph Determines Task Instantiation<a class="headerlink" href="#how-the-graph-determines-task-instantiation" title="Permalink to this headline">¶</a></h3>
<p>A graph trigger pair like <code class="docutils literal notranslate"><span class="pre">foo</span> <span class="pre">=&gt;</span> <span class="pre">bar</span></code> determines the existence and
prerequisites (dependencies) of the downstream task <code class="docutils literal notranslate"><span class="pre">bar</span></code>, for
the cycle points defined by the associated graph section heading. In general it
does not say anything about the dependencies or existence of the upstream task
<code class="docutils literal notranslate"><span class="pre">foo</span></code>. However <em>if the trigger has no cycle point offset</em> Cylc
will infer that <code class="docutils literal notranslate"><span class="pre">bar</span></code> must exist at the same cycle points as
<code class="docutils literal notranslate"><span class="pre">foo</span></code>. This is a convenience to allow this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;foo =&gt; bar&quot;</span>
</pre></div>
</div>
<p>to be written as shorthand for this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;foo</span>
<span class="s2">        foo =&gt; bar&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>(where <code class="docutils literal notranslate"><span class="pre">foo</span></code> by itself means <code class="docutils literal notranslate"><span class="pre">&lt;nothing&gt;</span> <span class="pre">=&gt;</span> <span class="pre">foo</span></code>, i.e. the
task exists at these cycle points but has no prerequisites - although other
prerequisites may be defined for it in other parts of the graph).</p>
<p><em>Cylc does not infer the existence of the upstream task in offset
triggers</em> like <code class="docutils literal notranslate"><span class="pre">foo[-P1D]</span> <span class="pre">=&gt;</span> <span class="pre">bar</span></code> because a typo in the offset
interval should generate an error rather than silently creating
tasks on an erroneous cycling sequence.</p>
<p>As a result you need to be careful not to define inter-cycle dependencies that
cannot be satisfied at run time. Suite validation catches this kind of error if
the existence of the cycle offset task is not defined anywhere at all:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2020</span>
    <span class="nt">[[graph]]</span>
        <span class="c1"># ERROR</span>
        <span class="nv">P1Y </span><span class="o">=</span><span class="s"> &quot;foo[-P1Y] =&gt; bar&quot;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc validate SUITE
<span class="s1">&#39;ERROR: No cycling sequences defined for foo&#39;</span>
</pre></div>
</div>
<p>To fix this, use another line in the graph to tell Cylc to define
<code class="docutils literal notranslate"><span class="pre">foo</span></code> at each cycle point:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2020</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">P1Y </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            foo</span>
<span class="s2">            foo[-P1Y] =&gt; bar</span>
<span class="s2">        &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>But validation does not catch this kind of error if the offset task
is defined only on a different cycling sequence:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2020</span>
    <span class="nt">[[graph]]</span>
        <span class="c1"># ERROR</span>
        <span class="nv">P2Y </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            foo</span>
<span class="s2">            foo[-P1Y] =&gt; bar</span>
<span class="s2">        &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>This suite will validate OK, but it will stall at runtime with <code class="docutils literal notranslate"><span class="pre">bar</span></code>
waiting on <code class="docutils literal notranslate"><span class="pre">foo[-P1Y]</span></code> at the intermediate years where it does not
exist. The offset <code class="docutils literal notranslate"><span class="pre">[-P1Y]</span></code> is presumably an error (it should be
<code class="docutils literal notranslate"><span class="pre">[-P2Y]</span></code>), or else another graph line is needed to generate
<code class="docutils literal notranslate"><span class="pre">foo</span></code> instances on the yearly sequence:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2020</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">P1Y </span><span class="o">=</span><span class="s"> &quot;foo&quot;</span>
        <span class="nv">P2Y </span><span class="o">=</span><span class="s"> &quot;foo[-P1Y] =&gt; bar&quot;</span>
</pre></div>
</div>
<p>Similarly the following suite will validate OK, but it will stall at
runtime with <code class="docutils literal notranslate"><span class="pre">bar</span></code> waiting on <code class="docutils literal notranslate"><span class="pre">foo[-P1Y]</span></code> in
every cycle point, when only a single instance of it exists, at the initial
cycle point:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2020</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> foo</span>
        <span class="c1"># ERROR</span>
        <span class="nv">P1Y </span><span class="o">=</span><span class="s"> foo[-P1Y] =&gt; bar</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">graph</span></code> will display un-satisfiable inter-cycle
dependencies as “ghost nodes”, as illustrated in this
screenshot of cylc graph displaying the above example with the
un-satisfiable task (foo) displayed as a “ghost node”.</p>
<div class="figure align-center" id="id13">
<span id="ghost-node-screenshot"></span><img alt="../_images/ghost-node-example.png" src="../_images/ghost-node-example.png" />
<p class="caption"><span class="caption-text">Screenshot of <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">graph</span></code> showing one task as a “ghost node”.</span><a class="headerlink" href="#id13" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>
</div>
<div class="section" id="runtime-task-configuration">
<span id="niorp"></span><h2>Runtime - Task Configuration<a class="headerlink" href="#runtime-task-configuration" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../reference/config/suite.html#suite.rc[runtime]" title="suite.rc[runtime]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[runtime]</span></code></a> section of a suite configuration configures what
to execute (and where and how to execute it) when each task is ready to
run, in a <em>multiple inheritance hierarchy</em> of <em>namespaces</em> culminating in
individual tasks. This allows all common configuration detail to be
factored out and defined in one place.</p>
<p>Any namespace can configure any or all of the items defined in
<a class="reference internal" href="../reference/config/suite.html#suite.rc" title="suite.rc"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">suite.rc</span></code></a>.</p>
<p>Namespaces that do not explicitly inherit from others automatically
inherit from the <code class="docutils literal notranslate"><span class="pre">root</span></code> namespace (below).</p>
<p>Nested namespaces define <em>task families</em> that can be used in the
graph as convenient shorthand for triggering all member tasks at once,
or for triggering other tasks off all members at once -
see <a class="reference internal" href="#familytriggers"><span class="std std-ref">Family Triggers</span></a>.</p>
<div class="section" id="namespace-names">
<h3>Namespace Names<a class="headerlink" href="#namespace-names" title="Permalink to this headline">¶</a></h3>
<p>Namespace names may contain letters, digits, underscores, and hyphens.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><em>Task names need not be hardwired into task implementations</em>
because task and suite identity can be extracted portably from the task
execution environment supplied by the suite server program
(<a class="reference internal" href="#taskexecutionenvironment"><span class="std std-ref">Task Execution Environment</span></a>) - then to rename a task you can
just change its name in the suite configuration.</p>
</div>
</div>
<div class="section" id="root-runtime-defaults">
<h3>Root - Runtime Defaults<a class="headerlink" href="#root-runtime-defaults" title="Permalink to this headline">¶</a></h3>
<p>The root namespace, at the base of the inheritance hierarchy,
provides default configuration for all tasks in the suite.
Most root items are unset by default, but some have default values
sufficient to allow test suites to be defined by dependency graph alone.
The <em>script</em> item, for example, defaults to code that
prints a message then sleeps for between 1 and 15 seconds and
exits. Default values are documented with each item in
<a class="reference internal" href="../reference/config/suite.html#suite.rc" title="suite.rc"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">suite.rc</span></code></a>. You can override the defaults or
provide your own defaults by explicitly configuring the root namespace.</p>
</div>
<div class="section" id="defining-multiple-namespaces-at-once">
<span id="multitaskdef"></span><h3>Defining Multiple Namespaces At Once<a class="headerlink" href="#defining-multiple-namespaces-at-once" title="Permalink to this headline">¶</a></h3>
<p>If a namespace section heading is a comma-separated list of names
then the subsequent configuration applies to each list member.
Particular tasks can be singled out at run time using the
<code class="docutils literal notranslate"><span class="pre">$CYLC_TASK_NAME</span></code> variable.</p>
<p>As an example, consider a suite containing an ensemble of closely
related tasks that each invokes the same script but with a unique
argument that identifies the calling task name:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[ENSEMBLE]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;run-model.sh $CYLC_TASK_NAME&quot;</span>
    <span class="nt">[[m1, m2, m3]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> ENSEMBLE</span>
</pre></div>
</div>
<p>For large ensembles template processing can be used to
automatically generate the member names and associated dependencies
(see <a class="reference internal" href="#jinja"><span class="std std-ref">Jinja2</span></a> and <a class="reference internal" href="#empylabel"><span class="std std-ref">EmPy</span></a>).</p>
</div>
<div class="section" id="runtime-inheritance-single">
<h3>Runtime Inheritance - Single<a class="headerlink" href="#runtime-inheritance-single" title="Permalink to this headline">¶</a></h3>
<p>The following listing of the <em>inherit.single.one</em> example suite
illustrates basic runtime inheritance with single parents.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># SUITE.RC</span>
<span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;User Guide [runtime] example.&quot;</span>
<span class="nt">[cylc]</span>
    <span class="nv">required run mode </span><span class="o">=</span><span class="s"> simulation</span> <span class="c1"># (no task implementations)</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20110101T06</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20110102T00</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">T00 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;foo =&gt; OBS</span>
<span class="s2">                 OBS:succeed-all =&gt; bar&quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span> <span class="c1"># base namespace for all tasks (defines suite-wide defaults)</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> at</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">COLOR </span><span class="o">=</span><span class="s"> red</span>
    <span class="nt">[[OBS]]</span>  <span class="c1"># family (inherited by land, ship); implicitly inherits root</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> run-${CYLC_TASK_NAME}.sh</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">RUNNING_DIR </span><span class="o">=</span><span class="s"> $HOME/running/$CYLC_TASK_NAME</span>
    <span class="nt">[[land]]</span> <span class="c1"># a task (a leaf on the inheritance tree) in the OBS family</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> OBS</span>
        <span class="nt">[[[meta]]]</span>
            <span class="nv">description </span><span class="o">=</span><span class="s"> land obs processing</span>
    <span class="nt">[[ship]]</span> <span class="c1"># a task (a leaf on the inheritance tree) in the OBS family</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> OBS</span>
        <span class="nt">[[[meta]]]</span>
            <span class="nv">description </span><span class="o">=</span><span class="s"> ship obs processing</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> loadleveler</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">RUNNING_DIR </span><span class="o">=</span><span class="s"> $HOME/running/ship</span>  <span class="c1"># override OBS environment</span>
            <span class="nv">OUTPUT_DIR </span><span class="o">=</span><span class="s"> $HOME/output/ship</span>    <span class="c1"># add to OBS environment</span>
    <span class="nt">[[foo]]</span>
        <span class="c1"># (just inherits from root)</span>

    <span class="c1"># The task [[bar]] is implicitly defined by its presence in the</span>
    <span class="c1"># graph; it is also a dummy task that just inherits from root.</span>
</pre></div>
</div>
</div>
<div class="section" id="runtime-inheritance-multiple">
<h3>Runtime Inheritance - Multiple<a class="headerlink" href="#runtime-inheritance-multiple" title="Permalink to this headline">¶</a></h3>
<p>If a namespace inherits from multiple parents the linear order of
precedence (which namespace overrides which) is determined by the
so-called <em>C3 algorithm</em> used to find the linear <em>method
resolution order</em> for class hierarchies in Python and several other
object oriented programming languages. The result of this should be
fairly obvious for typical use of multiple inheritance in cylc suites,
but for detailed documentation of how the algorithm works refer to the
<a class="reference external" href="https://www.python.org/download/releases/2.3/mro/">official Python documentation</a>.</p>
<p>The <em>inherit.multi.one</em> example suite, listed here, makes use of
multiple inheritance:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;multiple inheritance example&quot;</span>

    <span class="nv">description </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;To see how multiple inheritance works:</span>

<span class="s2"> % cylc list -tb[m] SUITE</span> <span class="c1"># list namespaces</span><span class="s2"></span>
<span class="s2"> % cylc graph -n SUITE</span> <span class="c1"># graph namespaces</span><span class="s2"></span>
<span class="s2"> % cylc graph SUITE</span> <span class="c1"># dependencies, collapse on first-parent namespaces</span><span class="s2"></span>

<span class="s2">  % cylc get-config --sparse --item [runtime]ops_s1 SUITE</span>
<span class="s2">  % cylc get-config --sparse --item [runtime]var_p2 foo&quot;&quot;&quot;</span>

<span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;OPS:finish-all =&gt; VAR&quot;</span>

<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
    <span class="nt">[[OPS]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> echo &quot;RUN: run-ops.sh&quot;</span>
    <span class="nt">[[VAR]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> echo &quot;RUN: run-var.sh&quot;</span>
    <span class="nt">[[SERIAL]]</span>
        <span class="nt">[[[directives]]]</span>
            <span class="nv">job_type </span><span class="o">=</span><span class="s"> serial</span>
    <span class="nt">[[PARALLEL]]</span>
        <span class="nt">[[[directives]]]</span>
            <span class="nv">job_type </span><span class="o">=</span><span class="s"> parallel</span>
    <span class="nt">[[ops_s1, ops_s2]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> OPS, SERIAL</span>

    <span class="nt">[[ops_p1, ops_p2]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> OPS, PARALLEL</span>
        
    <span class="nt">[[var_s1, var_s2]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> VAR, SERIAL</span>

    <span class="nt">[[var_p1, var_p2]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> VAR, PARALLEL</span>

<span class="nt">[visualization]</span>
    <span class="c1"># NOTE ON VISUALIZATION AND MULTIPLE INHERITANCE: overlapping</span>
    <span class="c1"># family groups can have overlapping attributes, so long as </span>
    <span class="c1"># non-conflicting attributes are used to style each group. Below,</span>
    <span class="c1"># for example, OPS tasks are filled green and SERIAL tasks are</span>
    <span class="c1"># outlined blue, so that ops_s1 and ops_s2 are green with a blue</span>
    <span class="c1"># outline. But if the SERIAL tasks are explicitly styled as &quot;not</span>
    <span class="c1"># filled&quot; (by setting &quot;style=&quot;) this will override the fill setting</span>
    <span class="c1"># in the (previously defined and therefore lower precedence) OPS</span>
    <span class="c1"># group, making ops_s1 and ops_s2 unfilled with a blue outline.</span>
    <span class="c1"># Alternatively you can just create a manual node group for ops_s1</span>
    <span class="c1"># and ops_s2 and style them separately.</span>
    <span class="nt">[[node groups]]</span>
        <span class="c1">#(see comment above:)</span>
        <span class="c1">#serial_ops = ops_s1, ops_s2</span>
    <span class="nt">[[node attributes]]</span>
        <span class="nv">OPS </span><span class="o">=</span><span class="s"> &quot;style=filled&quot;, &quot;fillcolor=green&quot;</span>
        <span class="nv">SERIAL </span><span class="o">=</span><span class="s"> &quot;color=blue&quot;</span> <span class="c1">#(see comment above:), &quot;style=&quot;</span>
        <span class="c1">#(see comment above:)</span>
        <span class="c1">#serial_ops = &quot;color=blue&quot;, &quot;style=filled&quot;, &quot;fillcolor=green&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">get-suite-config</span></code> provides an easy way to check the result of
inheritance in a suite. You can extract specific items, e.g.:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc get-suite-config --item <span class="s1">&#39;[runtime][var_p2]script&#39;</span> <span class="se">\</span>
    inherit.multi.one
<span class="nb">echo</span> <span class="sb">``</span>RUN: run-var.sh<span class="s1">&#39;&#39;</span>
</pre></div>
</div>
<p>or use the <code class="docutils literal notranslate"><span class="pre">--sparse</span></code> option to print entire namespaces
without obscuring the result with the dense runtime structure obtained
from the root namespace:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc get-suite-config --sparse --item <span class="s1">&#39;[runtime]ops_s1&#39;</span> inherit.multi.one
<span class="nv">script</span> <span class="o">=</span> <span class="nb">echo</span> <span class="sb">``</span>RUN: run-ops.sh<span class="s1">&#39;&#39;</span>
<span class="nv">inherit</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;OPS&#39;</span>, <span class="s1">&#39;SERIAL&#39;</span><span class="o">]</span>
<span class="o">[</span>directives<span class="o">]</span>
   <span class="nv">job_type</span> <span class="o">=</span> serial
</pre></div>
</div>
<div class="section" id="suite-visualization-and-multiple-inheritance">
<h4>Suite Visualization And Multiple Inheritance<a class="headerlink" href="#suite-visualization-and-multiple-inheritance" title="Permalink to this headline">¶</a></h4>
<p>The first parent inherited by a namespace is also used as the
collapsible family group when visualizing the suite. If this is not what
you want, you can demote the first parent for visualization purposes,
without affecting the order of inheritance of runtime properties:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[BAR]]</span>
        <span class="c1"># ...</span>
    <span class="nt">[[foo]]</span>
        <span class="c1"># inherit properties from BAR, but stay under root for visualization:</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> None, BAR</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="how-runtime-inheritance-works">
<h3>How Runtime Inheritance Works<a class="headerlink" href="#how-runtime-inheritance-works" title="Permalink to this headline">¶</a></h3>
<p>The linear precedence order of ancestors is computed for each namespace
using the C3 algorithm. Then any runtime items that are explicitly
configured in the suite configuration are “inherited” up the linearized
hierarchy for each task, starting at the root namespace: if a particular
item is defined at multiple levels in the hierarchy, the level nearest
the final task namespace takes precedence. Finally, root namespace
defaults are applied for every item that has not been configured in the
inheritance process (this is more efficient than carrying the full dense
namespace structure through from root from the beginning).</p>
</div>
<div class="section" id="task-execution-environment">
<span id="taskexecutionenvironment"></span><h3>Task Execution Environment<a class="headerlink" href="#task-execution-environment" title="Permalink to this headline">¶</a></h3>
<p>The task execution environment contains suite and task identity variables
provided by the suite server program, and user-defined environment variables.
The environment is explicitly exported (by the task job script) prior to
executing the task <code class="docutils literal notranslate"><span class="pre">script</span></code> (see <a class="reference internal" href="task-job-submission.html#taskjobsubmission"><span class="std std-ref">Task Job Submission and Management</span></a>).</p>
<p>Suite and task identity are exported first, so that user-defined
variables can refer to them. Order of definition is preserved throughout
so that variable assignment expressions can safely refer to previously
defined variables.</p>
<p>Additionally, access to cylc itself is configured prior to the user-defined
environment, so that variable assignment expressions can make use of
cylc utility commands:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">REFERENCE_TIME </span><span class="o">=</span><span class="s"> $( cylc util cycletime --offset-hours=6 )</span>
</pre></div>
</div>
<div class="section" id="user-environment-variables">
<h4>User Environment Variables<a class="headerlink" href="#user-environment-variables" title="Permalink to this headline">¶</a></h4>
<p>A task’s user-defined environment results from its inherited
<code class="docutils literal notranslate"><span class="pre">[[[environment]]]</span></code> sections:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">COLOR </span><span class="o">=</span><span class="s"> red</span>
            <span class="nv">SHAPE </span><span class="o">=</span><span class="s"> circle</span>
    <span class="nt">[[foo]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">COLOR </span><span class="o">=</span><span class="s"> blue</span>  <span class="c1"># root override</span>
            <span class="nv">TEXTURE </span><span class="o">=</span><span class="s"> rough</span> <span class="c1"># new variable</span>
</pre></div>
</div>
<p>This results in a task <em>foo</em> with <code class="docutils literal notranslate"><span class="pre">SHAPE=circle</span></code>, <code class="docutils literal notranslate"><span class="pre">COLOR=blue</span></code>,
and <code class="docutils literal notranslate"><span class="pre">TEXTURE=rough</span></code> in its environment.</p>
</div>
<div class="section" id="overriding-environment-variables">
<h4>Overriding Environment Variables<a class="headerlink" href="#overriding-environment-variables" title="Permalink to this headline">¶</a></h4>
<p>When you override inherited namespace items the original parent
item definition is <em>replaced</em> by the new definition. This applies to
all items including those in the environment sub-sections which,
strictly speaking, are not “environment variables” until they are
written, post inheritance processing, to the task job script that
executes the associated task. Consequently, if you override an
environment variable you cannot also access the original parent value:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[FOO]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">COLOR </span><span class="o">=</span><span class="s"> red</span>
    <span class="nt">[[bar]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> FOO</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">tmp </span><span class="o">=</span><span class="s"> $COLOR</span>        <span class="c1"># !! ERROR: $COLOR is undefined here</span>
            <span class="nv">COLOR </span><span class="o">=</span><span class="s"> dark-$tmp</span>   <span class="c1"># !! as this overrides COLOR in FOO.</span>
</pre></div>
</div>
<p>The compressed variant of this, <code class="docutils literal notranslate"><span class="pre">COLOR</span> <span class="pre">=</span> <span class="pre">dark-$COLOR</span></code>, is
also in error for the same reason. To achieve the desired result you
must use a different name for the parent variable:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[FOO]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">FOO_COLOR </span><span class="o">=</span><span class="s"> red</span>
    <span class="nt">[[bar]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> FOO</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">COLOR </span><span class="o">=</span><span class="s"> dark-$FOO_COLOR</span>  <span class="c1"># OK</span>
</pre></div>
</div>
</div>
<div class="section" id="task-job-script-variables">
<span id="id7"></span><h4>Task Job Script Variables<a class="headerlink" href="#task-job-script-variables" title="Permalink to this headline">¶</a></h4>
<p>These are variables that can be referenced (but should not be modified) in a
task job script.</p>
<p>The task job script may export the following environment variables:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>CYLC_DEBUG                      <span class="c1"># Debug mode, true or not defined</span>
CYLC_VERSION                    <span class="c1"># Version of cylc installation used</span>

CYLC_CYCLING_MODE               <span class="c1"># Cycling mode, e.g. gregorian</span>
ISODATETIMECALENDAR             <span class="c1"># Calendar mode for the `isodatetime` command,</span>
                                <span class="c1"># defined with the value of CYLC_CYCLING_MODE</span>
                                <span class="c1"># when in any date-time cycling mode</span>
CYLC_SUITE_FINAL_CYCLE_POINT    <span class="c1"># Final cycle point</span>
CYLC_SUITE_INITIAL_CYCLE_POINT  <span class="c1"># Initial cycle point</span>
CYLC_SUITE_NAME                 <span class="c1"># Suite name</span>
CYLC_UTC                        <span class="c1"># UTC mode, True or False</span>
CYLC_VERBOSE                    <span class="c1"># Verbose mode, True or False</span>
TZ                              <span class="c1"># Set to &quot;UTC&quot; in UTC mode or not defined</span>

CYLC_SUITE_RUN_DIR              <span class="c1"># Location of the suite run directory in</span>
                                <span class="c1"># job host, e.g. ~/cylc-run/foo</span>
CYLC_SUITE_DEF_PATH             <span class="c1"># Location of the suite configuration directory in</span>
                                <span class="c1"># job host, e.g. ~/cylc-run/foo</span>
CYLC_SUITE_HOST                 <span class="c1"># Host running the suite process</span>
CYLC_SUITE_OWNER                <span class="c1"># User ID running the suite process</span>
CYLC_SUITE_DEF_PATH_ON_SUITE_HOST
                                <span class="c1"># Location of the suite configuration directory in</span>
                                <span class="c1"># suite host, e.g. ~/cylc-run/foo</span>
CYLC_SUITE_SHARE_DIR            <span class="c1"># Suite (or task!) shared directory (see below)</span>
CYLC_SUITE_UUID                 <span class="c1"># Suite UUID string</span>
CYLC_SUITE_WORK_DIR             <span class="c1"># Suite work directory (see below)</span>

CYLC_TASK_JOB                   <span class="c1"># Task job identifier expressed as</span>
                                <span class="c1"># CYCLE-POINT/TASK-NAME/SUBMIT-NUM</span>
                                <span class="c1"># e.g. 20110511T1800Z/t1/01</span>
CYLC_TASK_CYCLE_POINT           <span class="c1"># Cycle point, e.g. 20110511T1800Z</span>
ISODATETIMEREF                  <span class="c1"># Reference time for the `isodatetime` command,</span>
                                <span class="c1"># defined with the value of CYLC_TASK_CYCLE_POINT</span>
                                <span class="c1"># when in any date-time cycling mode</span>
CYLC_TASK_NAME                  <span class="c1"># Job&#39;s task name, e.g. t1</span>
CYLC_TASK_SUBMIT_NUMBER         <span class="c1"># Job&#39;s submit number, e.g. 1,</span>
                                <span class="c1"># increments with every submit</span>
CYLC_TASK_TRY_NUMBER            <span class="c1"># Number of execution tries, e.g. 1</span>
                                <span class="c1"># increments with automatic retry-on-fail</span>
CYLC_TASK_ID                    <span class="c1"># Task instance identifier expressed as</span>
                                <span class="c1"># TASK-NAME.CYCLE-POINT</span>
                                <span class="c1"># e.g. t1.20110511T1800Z</span>
CYLC_TASK_LOG_DIR               <span class="c1"># Location of the job log directory</span>
                                <span class="c1"># e.g. ~/cylc-run/foo/log/job/20110511T1800Z/t1/01/</span>
CYLC_TASK_LOG_ROOT              <span class="c1"># The task job file path</span>
                                <span class="c1"># e.g. ~/cylc-run/foo/log/job/20110511T1800Z/t1/01/job</span>
CYLC_TASK_WORK_DIR              <span class="c1"># Location of task work directory (see below)</span>
                                <span class="c1"># e.g. ~/cylc-run/foo/work/20110511T1800Z/t1</span>
CYLC_TASK_NAMESPACE_HIERARCHY   <span class="c1"># Linearised family namespace of the task,</span>
                                <span class="c1"># e.g. root postproc t1</span>
CYLC_TASK_DEPENDENCIES          <span class="c1"># List of met dependencies that triggered the task</span>
                                <span class="c1"># e.g. foo.1 bar.1</span>

CYLC_TASK_COMMS_METHOD          <span class="c1"># Set to &quot;ssh&quot; if communication method is &quot;ssh&quot;</span>
CYLC_TASK_SSH_LOGIN_SHELL       <span class="c1"># With &quot;ssh&quot; communication, if set to &quot;True&quot;,</span>
                                <span class="c1"># use login shell on suite host</span>
</pre></div>
</div>
<p>There are also some global shell variables that may be defined in the task job
script (but not exported to the environment). These include:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>CYLC_FAIL_SIGNALS               <span class="c1"># List of signals trapped by the error trap</span>
CYLC_VACATION_SIGNALS           <span class="c1"># List of signals trapped by the vacation trap</span>
CYLC_SUITE_WORK_DIR_ROOT        <span class="c1"># Root directory above the suite work directory</span>
                                <span class="c1"># in the job host</span>
CYLC_TASK_MESSAGE_STARTED_PID   <span class="c1"># PID of &quot;cylc message&quot; job started&quot; command</span>
CYLC_TASK_WORK_DIR_BASE         <span class="c1"># Alternate task work directory,</span>
                                <span class="c1"># relative to the suite work directory</span>
</pre></div>
</div>
</div>
<div class="section" id="suite-share-directories">
<h4>Suite Share Directories<a class="headerlink" href="#suite-share-directories" title="Permalink to this headline">¶</a></h4>
<p>A <em>suite share directory</em> is created automatically under the suite run
directory as a share space for tasks. The location is available to tasks as
<code class="docutils literal notranslate"><span class="pre">$CYLC_SUITE_SHARE_DIR</span></code>. In a cycling suite, output files are
typically held in cycle point sub-directories of the suite share directory.</p>
<p>The top level share and work directory (below) location can be changed
(e.g. to a large data area) by a global config setting
<a class="reference internal" href="../reference/config/global.html#flow.rc[hosts][&lt;hostname glob&gt;]work directory" title="flow.rc[hosts][&lt;hostname glob&gt;]work directory"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">flow.rc[hosts][&lt;hostname</span> <span class="pre">glob&gt;]work</span> <span class="pre">directory</span></code></a>.</p>
</div>
<div class="section" id="task-work-directories">
<h4>Task Work Directories<a class="headerlink" href="#task-work-directories" title="Permalink to this headline">¶</a></h4>
<p>Task job scripts are executed from within <em>work directories</em> created
automatically under the suite run directory. A task can get its own work
directory from <code class="docutils literal notranslate"><span class="pre">$CYLC_TASK_WORK_DIR</span></code> (or simply <code class="docutils literal notranslate"><span class="pre">$PWD</span></code> if
it does not <code class="docutils literal notranslate"><span class="pre">cd</span></code> elsewhere at runtime). By default the location
contains task name and cycle point, to provide a unique workspace for every
instance of every task. This can be overridden in the suite configuration,
however, to get several tasks to share the same
<a class="reference internal" href="../reference/config/global.html#flow.rc[hosts][&lt;hostname glob&gt;]work directory" title="flow.rc[hosts][&lt;hostname glob&gt;]work directory"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">work</span> <span class="pre">directory</span></code></a>.</p>
<p>The top level work and share directory (above) location can be changed
(e.g. to a large data area) by a global config setting
<a class="reference internal" href="../reference/config/global.html#flow.rc[hosts][&lt;hostname glob&gt;]work directory" title="flow.rc[hosts][&lt;hostname glob&gt;]work directory"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">flow.rc[hosts][&lt;hostname</span> <span class="pre">glob&gt;]work</span> <span class="pre">directory</span></code></a>.</p>
</div>
<div class="section" id="environment-variable-evaluation">
<h4>Environment Variable Evaluation<a class="headerlink" href="#environment-variable-evaluation" title="Permalink to this headline">¶</a></h4>
<p>Variables in the task execution environment are not evaluated in the
shell in which the suite is running prior to submitting the task. They
are written in unevaluated form to the job script that is submitted by
cylc to run the task (<a class="reference internal" href="task-implementation.html#jobscripts"><span class="std std-ref">Task Job Scripts</span></a>) and are therefore
evaluated when the task begins executing under the task owner account
on the task host. Thus <code class="docutils literal notranslate"><span class="pre">$HOME</span></code>, for instance, evaluates at
run time to the home directory of task owner on the task host.</p>
</div>
</div>
<div class="section" id="how-tasks-get-access-to-the-suite-directory">
<h3>How Tasks Get Access To The Suite Directory<a class="headerlink" href="#how-tasks-get-access-to-the-suite-directory" title="Permalink to this headline">¶</a></h3>
<p>Tasks can use <code class="docutils literal notranslate"><span class="pre">$CYLC_SUITE_DEF_PATH</span></code> to access suite files on
the task host, and the suite bin directory is automatically added
<code class="docutils literal notranslate"><span class="pre">$PATH</span></code>. If a remote suite configuration directory is not
specified the local (suite host) path will be assumed with the local
home directory, if present, swapped for literal <code class="docutils literal notranslate"><span class="pre">$HOME</span></code> for
evaluation on the task host.</p>
</div>
<div class="section" id="remote-task-hosting">
<span id="runningtasksonaremotehost"></span><h3>Remote Task Hosting<a class="headerlink" href="#remote-task-hosting" title="Permalink to this headline">¶</a></h3>
<p>If a task declares an owner other than the suite owner and/or
a host other than the suite host, cylc will use non-interactive ssh to
execute the task on the <code class="docutils literal notranslate"><span class="pre">owner&#64;host</span></code> account by the configured
batch system:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nt">[[[remote]]]</span>
            <span class="nv">host </span><span class="o">=</span><span class="s"> orca.niwa.co.nz</span>
            <span class="nv">owner </span><span class="o">=</span><span class="s"> bob</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> pbs</span>
</pre></div>
</div>
<p>For this to work:</p>
<ul class="simple">
<li><p>non-interactive ssh is required from the suite host to the remote
task accounts.</p></li>
<li><p>cylc must be installed on task hosts.</p>
<ul>
<li><p>Optional software dependencies such as graphviz and
Jinja2 are not needed on task hosts.</p></li>
<li><p>If polling task communication is used, there is no other
requirement.</p></li>
<li><p>If SSH task communication is configured, non-interactive ssh is
required from the task host to the suite host.</p></li>
<li><p>If (default) task communication is configured, the task host
should have access to the port on the suite host.</p></li>
</ul>
</li>
<li><p>the suite configuration directory, or some fraction of its
content, can be installed on the task host, if needed.</p></li>
</ul>
<p>Tasks running on the suite host under another user account are treated as
remote tasks.</p>
<p>Remote hosting, like all namespace settings, can be declared globally in
the root namespace, or per family, or for individual tasks.</p>
<div class="section" id="dynamic-host-selection">
<h4>Dynamic Host Selection<a class="headerlink" href="#dynamic-host-selection" title="Permalink to this headline">¶</a></h4>
<p>Instead of hardwiring host names into the suite configuration you can
specify a shell command that prints a hostname, or an environment
variable that holds a hostname, as the value of the
<a class="reference internal" href="../reference/config/suite.html#suite.rc[runtime][&lt;namespace&gt;][remote]host" title="suite.rc[runtime][&lt;namespace&gt;][remote]host"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">host</span> <span class="pre">config</span> <span class="pre">item</span></code></a>.</p>
</div>
<div class="section" id="remote-task-log-directories">
<h4>Remote Task Log Directories<a class="headerlink" href="#remote-task-log-directories" title="Permalink to this headline">¶</a></h4>
<p>Task stdout and stderr streams are written to log files in a
suite-specific sub-directory of the <em>suite run directory</em>, as
explained in <a class="reference internal" href="task-job-submission.html#whitherstdoutandstderr"><span class="std std-ref">Task stdout And stderr Logs</span></a>. For remote tasks
the same directory is used, but <em>on the task host</em>.
Remote task log directories, like local ones, are created on the fly, if
necessary, during job submission.</p>
</div>
</div>
</div>
<div class="section" id="visualization">
<span id="viso"></span><h2>Visualization<a class="headerlink" href="#visualization" title="Permalink to this headline">¶</a></h2>
<p>The visualization section of a suite configuration is used to configure
the representation of a suite in Cylc visualisation tools.</p>
<p>See <a class="reference internal" href="../reference/config/suite.html#suite.rc" title="suite.rc"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">suite.rc</span></code></a> for details.</p>
</div>
<div class="section" id="parameterized-tasks">
<span id="parameterized-tasks-label"></span><h2>Parameterized Tasks<a class="headerlink" href="#parameterized-tasks" title="Permalink to this headline">¶</a></h2>
<p>Cylc can automatically generate tasks and dependencies by expanding
parameterized task names over lists of parameter values. Uses for this
include:</p>
<ul class="simple">
<li><p>generating an ensemble of similar model runs</p></li>
<li><p>generating chains of tasks to process similar datasets</p></li>
<li><p>replicating an entire workflow, or part thereof, over several runs</p></li>
<li><p>splitting a long model run into smaller steps or <code class="docutils literal notranslate"><span class="pre">chunks</span></code>
(parameterized cycling)</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This can be done with Jinja2 loops too (<a class="reference internal" href="#jinja"><span class="std std-ref">Jinja2</span></a>)
but parameterization is much cleaner (nested loops can seriously reduce
the clarity of a suite configuration).*</p>
</div>
<div class="section" id="parameter-expansion">
<h3>Parameter Expansion<a class="headerlink" href="#parameter-expansion" title="Permalink to this headline">¶</a></h3>
<p>Parameter values can be lists of strings, or lists of integers and
integer ranges (with inclusive bounds). Numeric values in a list of strings are
considered strings. It is not possible to mix strings with integer ranges.</p>
<p>For example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="c1"># parameters: &quot;ship&quot;, &quot;buoy&quot;, &quot;plane&quot;</span>
        <span class="c1"># default task suffixes: _ship, _buoy, _plane</span>
        <span class="nv">obs </span><span class="o">=</span><span class="s"> ship, buoy, plane</span>

        <span class="c1"># parameters: 1, 2, 3, 4, 5</span>
        <span class="c1"># default task suffixes: _run1, _run2, _run3, _run4, _run5</span>
        <span class="nv">run </span><span class="o">=</span><span class="s"> 1..5</span>

        <span class="c1"># parameters: 1, 3, 5, 7, 9</span>
        <span class="c1"># default task suffixes: _idx1, _idx3, _idx5, _idx7, _idx9</span>
        <span class="nv">idx </span><span class="o">=</span><span class="s"> 1..9..2</span>

        <span class="c1"># parameters: -11, -1, 9</span>
        <span class="c1"># default task suffixes: _idx-11, _idx-01, _idx+09</span>
        <span class="nv">idx </span><span class="o">=</span><span class="s"> -11..9..10</span>

        <span class="c1"># parameters: 1, 3, 5, 10, 11, 12, 13</span>
        <span class="c1"># default task suffixes: _i01, _i03, _i05, _i10, _i11, _i12, _i13</span>
        <span class="nv">i </span><span class="o">=</span><span class="s"> 1..5..2, 10, 11..13</span>

        <span class="c1"># parameters: &quot;0&quot;, &quot;1&quot;, &quot;e&quot;, &quot;pi&quot;, &quot;i&quot;</span>
        <span class="c1"># default task suffixes: _0, _1, _e, _pi, _i</span>
        <span class="nv">item </span><span class="o">=</span><span class="s"> 0, 1, e, pi, i</span>

        <span class="c1"># ERROR: mix strings with int range</span>
        <span class="nv">p </span><span class="o">=</span><span class="s"> one, two, 3..5</span>
</pre></div>
</div>
<p>Then angle brackets denote use of these parameters throughout the suite
configuration. For the values above, this parameterized name:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>model&lt;run&gt;  # for run = 1..5
</pre></div>
</div>
<p>expands to these concrete task names:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>model_run1, model_run2, model_run3, model_run4, model_run5
</pre></div>
</div>
<p>and this parameterized name:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>proc&lt;obs&gt;  # for obs = ship, buoy, plane
</pre></div>
</div>
<p>expands to these concrete task names:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>proc_ship, proc_buoy, proc_plane
</pre></div>
</div>
<p>By default, to avoid any ambiguity, the parameter name appears in the expanded
task names for integer values, but not for string values. For example,
<code class="docutils literal notranslate"><span class="pre">model_run1</span></code> for <code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">=</span> <span class="pre">1</span></code>, but <code class="docutils literal notranslate"><span class="pre">proc_ship</span></code> for
<code class="docutils literal notranslate"><span class="pre">obs</span> <span class="pre">=</span> <span class="pre">ship</span></code>. However, the default expansion templates can be
overridden if need be:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">obs </span><span class="o">=</span><span class="s"> ship, buoy, plane</span>
        <span class="nv">run </span><span class="o">=</span><span class="s"> 1..5</span>
    <span class="nt">[[parameter templates]]</span>
        <span class="nv">run </span><span class="o">=</span><span class="s"> -R%(run)s</span>  <span class="c1"># Make foo&lt;run&gt; expand to foo-R1 etc.</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="../reference/config/suite.html#suite.rc[cylc][parameter templates]" title="suite.rc[cylc][parameter templates]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[cylc][parameter</span> <span class="pre">templates]</span></code></a> for more on the string
template syntax.</p>
<p>Any number of parameters can be used at once. This parameterization:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>model&lt;run,obs&gt;  # for run = 1..2 and obs = ship, buoy, plane
</pre></div>
</div>
<p>expands to these tasks names:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>model_run1_ship, model_run1_buoy, model_run1_plane,
model_run2_ship, model_run2_buoy, model_run2_plane
</pre></div>
</div>
<p>Here’s a simple but complete example suite:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">run </span><span class="o">=</span><span class="s"> 1..2</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;prep =&gt; model&lt;run&gt;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[model</span>&lt;<span class="nb">run</span>&gt;<span class="nt">]]</span>
        <span class="c1"># ...</span>
</pre></div>
</div>
<p>The result, post parameter expansion, is this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;prep =&gt; model_run1 &amp; model_run2&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[model_run1]]</span>
        <span class="c1"># ...</span>
    <span class="nt">[[model_run2]]</span>
        <span class="c1"># ...</span>
</pre></div>
</div>
<p>Here’s a more complex graph using two parameters (<a class="reference internal" href="../reference/config/suite.html#suite.rc[runtime]" title="suite.rc[runtime]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[runtime]</span></code></a>
omitted):</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">run </span><span class="o">=</span><span class="s"> 1..2</span>
        <span class="nv">mem </span><span class="o">=</span><span class="s"> cat, dog</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;prep =&gt; init&lt;run&gt; =&gt; model&lt;run,mem&gt; =&gt;</span>
<span class="s2">                      post&lt;run,mem&gt; =&gt; wrap&lt;run&gt; =&gt; done&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>The result as visualized by <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">graph</span></code> is:</p>
<div class="figure align-center" id="id14">
<span id="fig-params-1"></span><img alt="../_images/params1.png" src="../_images/params1.png" />
<p class="caption"><span class="caption-text">Parameter expansion example.</span><a class="headerlink" href="#id14" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="zero-padded-integer-values">
<h4>Zero-Padded Integer Values<a class="headerlink" href="#zero-padded-integer-values" title="Permalink to this headline">¶</a></h4>
<p>Integer parameter values are given a default template for generating task
suffixes that are zero-padded according to the longest size of their values.
For example, the default template for <code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">=</span> <span class="pre">9..10</span></code> would be
<code class="docutils literal notranslate"><span class="pre">_p%(p)02d</span></code>, so that <code class="docutils literal notranslate"><span class="pre">foo&lt;p&gt;</span></code> would become <code class="docutils literal notranslate"><span class="pre">foo_p09,</span> <span class="pre">foo_p10</span></code>.
If negative values are present in the parameter list, the
default template will include the sign.
For example, the default template for <code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">=</span> <span class="pre">-1..1</span></code> would be
<code class="docutils literal notranslate"><span class="pre">_p%(p)+02d</span></code>, so that <code class="docutils literal notranslate"><span class="pre">foo&lt;p&gt;</span></code> would become
<code class="docutils literal notranslate"><span class="pre">foo_p-1,</span> <span class="pre">foo_p+0,</span> <span class="pre">foo_p+1</span></code>.</p>
<p>To get thicker padding and/or alternate suffixes, use a template. E.g.:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">i </span><span class="o">=</span><span class="s"> 1..9</span>
        <span class="nv">p </span><span class="o">=</span><span class="s"> 3..14</span>
    <span class="nt">[[parameter templates]]</span>
        <span class="nv">i </span><span class="o">=</span><span class="s"> _i%(i)02d</span>  <span class="c1"># suffixes = _i01, _i02, ..., _i09</span>
        <span class="c1"># A double-percent gives a literal percent character</span>
        <span class="nv">p </span><span class="o">=</span><span class="s"> %%p%(p)03d</span>  <span class="c1"># suffixes = %p003, %p004, ..., %p013, %p014</span>
</pre></div>
</div>
</div>
<div class="section" id="parameters-as-full-task-names">
<h4>Parameters as Full Task Names<a class="headerlink" href="#parameters-as-full-task-names" title="Permalink to this headline">¶</a></h4>
<p>Parameter values can be used as full task names, but the default template
should be overridden to remove the initial underscore. For example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">i </span><span class="o">=</span><span class="s"> 1..4</span>
        <span class="nv">obs </span><span class="o">=</span><span class="s"> ship, buoy, plane</span>
    <span class="nt">[[parameter templates]]</span>
        <span class="nv">i </span><span class="o">=</span><span class="s"> i%(i)d</span>  <span class="c1"># task name must begin with an alphabet</span>
        <span class="nv">obs </span><span class="o">=</span><span class="s"> %(obs)s</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">foo =&gt; &lt;i&gt;</span>  <span class="c1"># foo =&gt; i1 &amp; i2 &amp; i3 &amp; i4</span><span class="s2"></span>
<span class="s2">&lt;obs&gt; =&gt; bar</span>  <span class="c1"># ship &amp; buoy &amp; plane =&gt; bar</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="passing-parameter-values-to-tasks">
<h3>Passing Parameter Values To Tasks<a class="headerlink" href="#passing-parameter-values-to-tasks" title="Permalink to this headline">¶</a></h3>
<p>Parameter values are passed as environment variables to tasks generated by
parameter expansion. For example, if we have:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">obs </span><span class="o">=</span><span class="s"> ship, buoy, plane</span>
        <span class="nv">run </span><span class="o">=</span><span class="s"> 1..5</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> model&lt;run,obs&gt;</span>
</pre></div>
</div>
<p>Then task <code class="docutils literal notranslate"><span class="pre">model_run2_ship</span></code> would get the following standard
environment variables:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># In a job script of an instance of the &quot;model_run2_ship&quot; task:</span>
<span class="nb">export</span> <span class="nv">CYLC_TASK_PARAM_run</span><span class="o">=</span><span class="s2">&quot;2&quot;</span>
<span class="nb">export</span> <span class="nv">CYLC_TASK_PARAM_obs</span><span class="o">=</span><span class="s2">&quot;ship&quot;</span>
</pre></div>
</div>
<p>These variables allow tasks to determine which member of a parameterized
group they are, and so to vary their behaviour accordingly.</p>
<p>You can also define custom variables and string templates for parameter value
substitution. For example, if we add this to the above configuration:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[model</span>&lt;<span class="nb">run,obs</span>&gt;<span class="nt">]]</span>
        <span class="nt">[[[parameter environment templates]]]</span>
            <span class="nv">MYNAME </span><span class="o">=</span><span class="s"> %(obs)sy-mc%(obs)sface</span>
            <span class="nv">MYFILE </span><span class="o">=</span><span class="s"> /path/to/run%(run)03d/%(obs)s</span>
</pre></div>
</div>
<p>Then task <code class="docutils literal notranslate"><span class="pre">model_run2_ship</span></code> would get the following custom
environment variables:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># In a job script of an instance of the &quot;model_run2_ship&quot; task:</span>
<span class="nb">export</span> <span class="nv">MYNAME</span><span class="o">=</span>shipy-mcshipface
<span class="nb">export</span> <span class="nv">MYFILE</span><span class="o">=</span>/path/to/run002/ship
</pre></div>
</div>
</div>
<div class="section" id="selecting-specific-parameter-values">
<h3>Selecting Specific Parameter Values<a class="headerlink" href="#selecting-specific-parameter-values" title="Permalink to this headline">¶</a></h3>
<p>Specific parameter values can be singled out in the graph and under
<a class="reference internal" href="../reference/config/suite.html#suite.rc[runtime]" title="suite.rc[runtime]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[runtime]</span></code></a> with the notation <code class="docutils literal notranslate"><span class="pre">&lt;p=5&gt;</span></code> (for example).
Here’s how to make a special task trigger off just the first of a
set of model runs:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">run </span><span class="o">=</span><span class="s"> 1..5</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot; model&lt;run&gt; =&gt; post_proc&lt;run&gt;</span>  <span class="c1"># general case</span><span class="s2"></span>
<span class="s2">                 model&lt;run=1&gt; =&gt; check_first_run &quot;&quot;&quot;</span>  <span class="c1"># special case</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[model</span>&lt;<span class="nb">run</span>&gt;<span class="nt">]]</span>
        <span class="c1"># config for all &quot;model&quot; runs...</span>
    <span class="nt">[[model</span>&lt;<span class="nb">run=1</span>&gt;<span class="nt">]]</span>
        <span class="c1"># special config (if any) for the first model run...</span>
    <span class="c1">#...</span>
</pre></div>
</div>
</div>
<div class="section" id="selecting-partial-parameter-ranges">
<h3>Selecting Partial Parameter Ranges<a class="headerlink" href="#selecting-partial-parameter-ranges" title="Permalink to this headline">¶</a></h3>
<p>The parameter notation does not currently support partial range selection such
as <code class="docutils literal notranslate"><span class="pre">foo&lt;p=5..10&gt;</span></code>, but you can achieve the same result by defining a
second parameter that covers the partial range and giving it the same expansion
template as the full-range parameter. For example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">run </span><span class="o">=</span><span class="s"> 1..10</span>  <span class="c1"># 1, 2, ..., 10</span>
        <span class="nv">runx </span><span class="o">=</span><span class="s"> 1..3</span>  <span class="c1"># 1, 2, 3</span>
    <span class="nt">[[parameter templates]]</span>
        <span class="nv">run </span><span class="o">=</span><span class="s"> _R%(run)02d</span>   <span class="c1"># _R01, _R02, ..., _R10</span>
        <span class="nv">runx </span><span class="o">=</span><span class="s"> _R%(runx)02d</span>  <span class="c1"># _R01, _R02, _R03</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;model&lt;run&gt; =&gt; post&lt;run&gt;</span>
<span class="s2">                model&lt;runx&gt; =&gt; checkx&lt;runx&gt;&quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[model</span>&lt;<span class="nb">run</span>&gt;<span class="nt">]]</span>
        <span class="c1"># ...</span>
    <span class="c1">#...</span>
</pre></div>
</div>
</div>
<div class="section" id="parameter-offsets-in-the-graph">
<h3>Parameter Offsets In The Graph<a class="headerlink" href="#parameter-offsets-in-the-graph" title="Permalink to this headline">¶</a></h3>
<p>A negative offset notation <code class="docutils literal notranslate"><span class="pre">&lt;NAME-1&gt;</span></code> is interpreted as the previous
value in the ordered list of parameter values, while a positive offset is
interpreted as the next value. For example, to split a model run into multiple
steps with each step depending on the previous one, either of these graphs:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;model&lt;run-1&gt; =&gt; model&lt;run&gt;&quot;</span>  <span class="c1"># for run = 1, 2, 3</span>
<span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;model&lt;run&gt; =&gt; model&lt;run+1&gt;&quot;</span>  <span class="c1"># for run = 1, 2, 3</span>
</pre></div>
</div>
<p>expands to:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;model_run1 =&gt; model_run2</span>
<span class="s2">        model_run2 =&gt; model_run3&quot;&quot;&quot;</span>

<span class="c1"># or equivalently:</span>

<span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;model_run1 =&gt; model_run2 =&gt; model_run3&quot;</span>
</pre></div>
</div>
<p>And this graph:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;proc&lt;size-1&gt; =&gt; proc&lt;size&gt;&quot;</span>  <span class="c1"># for size = small, big, huge</span>
</pre></div>
</div>
<p>expands to:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;proc_small =&gt; proc_big</span>
<span class="s2">        proc_big =&gt; proc_huge&quot;&quot;&quot;</span>

<span class="c1"># or equivalently:</span>

<span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;proc_small =&gt; proc_big =&gt; proc_huge&quot;</span>
</pre></div>
</div>
<p>However, a quirk in the current system means that you should avoid mixing
conditional logic in these statements. For example, the following will do the
unexpected:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">R1 </span><span class="o">=</span><span class="s"> foo&lt;m-1&gt; &amp; baz =&gt; foo&lt;m&gt;</span>  <span class="c1"># for m = cat, dog</span>
</pre></div>
</div>
<p>currently expands to:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">R1 </span><span class="o">=</span><span class="s"> foo_cat &amp; baz =&gt; foo_dog</span>

<span class="c1"># when users may expect it to be:</span>
<span class="c1">#    R1 = foo_cat =&gt; foo_dog</span>
<span class="c1">#    R1 = baz =&gt; foo_cat &amp; foo_dog</span>
</pre></div>
</div>
<p>For the time being, writing out the logic explicitly will give you the correct
graph.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;foo&lt;m-1&gt; =&gt; foo&lt;m&gt;</span>  <span class="c1"># for m = cat, dog</span><span class="s2"></span>
<span class="s2">        baz =&gt; foo&lt;m&gt;&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="task-families-and-parameterization">
<h3>Task Families And Parameterization<a class="headerlink" href="#task-families-and-parameterization" title="Permalink to this headline">¶</a></h3>
<p>Task family members can be generated by parameter expansion:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[FAM]]</span>
    <span class="nt">[[member</span>&lt;<span class="nb">r</span>&gt;<span class="nt">]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> FAM</span>
<span class="c1"># Result: family FAM contains member_r1, member_r2, etc.</span>
</pre></div>
</div>
<p>Family names can be parameterized too, just like task names:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[RUN</span>&lt;<span class="nb">r</span>&gt;<span class="nt">]]</span>
    <span class="nt">[[model</span>&lt;<span class="nb">r</span>&gt;<span class="nt">]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> RUN&lt;r&gt;</span>
    <span class="nt">[[post_proc</span>&lt;<span class="nb">r</span>&gt;<span class="nt">]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> RUN&lt;r&gt;</span>
<span class="c1"># Result: family RUN_r1 contains model_r1 and post_proc_r1,</span>
<span class="c1">#         family RUN_r2 contains model_r2 and post_proc_r1, etc.</span>
</pre></div>
</div>
<p>As described in <a class="reference internal" href="#familytriggers"><span class="std std-ref">Family Triggers</span></a> family names can be used to
trigger all members at once:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;foo =&gt; FAMILY&quot;</span>
</pre></div>
</div>
<p>or to trigger off all members:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;FAMILY:succeed-all =&gt; bar&quot;</span>
</pre></div>
</div>
<p>or to trigger off any members:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;FAMILY:succeed-any =&gt; bar&quot;</span>
</pre></div>
</div>
<p>If the members of <code class="docutils literal notranslate"><span class="pre">FAMILY</span></code> were generated with parameters, you can
also trigger them all at once with parameter notation:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;foo =&gt; member&lt;m&gt;&quot;</span>
</pre></div>
</div>
<p>Similarly, to trigger off all members:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;member&lt;m&gt; =&gt; bar&quot;</span>
<span class="c1"># (member&lt;m&gt;:fail etc., for other trigger types)</span>
</pre></div>
</div>
<p>Family names are still needed in the graph, however, to succinctly express
“succeed-any” triggering semantics, and all-to-all or any-to-all triggering:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;FAM1:succeed-any =&gt; FAM2&quot;</span>
</pre></div>
</div>
<p>(Direct all-to-all and any-to-all family triggering is not recommended for
efficiency reasons though - see <a class="reference internal" href="#efficientinterfamilytriggering"><span class="std std-ref">Efficient Inter-Family Triggering</span></a>).</p>
<p>For family <em>member-to-member</em> triggering use parameterized members.
For example, if family <code class="docutils literal notranslate"><span class="pre">OBS_GET</span></code> has members <code class="docutils literal notranslate"><span class="pre">get&lt;obs&gt;</span></code> and
family <code class="docutils literal notranslate"><span class="pre">OBS_PROC</span></code> has members <code class="docutils literal notranslate"><span class="pre">proc&lt;obs&gt;</span></code> then this graph:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;get&lt;obs&gt; =&gt; proc&lt;obs&gt;&quot;</span>  <span class="c1"># for obs = ship, buoy, plane</span>
</pre></div>
</div>
<p>expands to:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>get_ship =&gt; proc_ship
get_buoy =&gt; proc_buoy
get_plane =&gt; proc_plane
</pre></div>
</div>
</div>
<div class="section" id="parameterized-cycling">
<span id="id8"></span><h3>Parameterized Cycling<a class="headerlink" href="#parameterized-cycling" title="Permalink to this headline">¶</a></h3>
<p>Two ways of constructing cycling systems are described and contrasted in
<a class="reference internal" href="workflows.html#workflows-for-cycling-systems"><span class="std std-ref">Workflows For Cycling Systems</span></a>.  For most purposes use of
a proper <em>cycling workflow</em> is recommended, wherein cylc incrementally
generates the date-time sequence and extends the workflow, potentially
indefinitely, at run time. For smaller systems of finite duration, however,
parameter expansion can be used to generate a sequence of pre-defined tasks
as a proxy for cycling.</p>
<p>Here’s a cycling workflow of two-monthly model runs for one year,
with previous-instance model dependence (e.g. for model restart files):</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2020-01</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 2020-12</span>
    <span class="nt">[[graph]]</span>
        <span class="c1"># Run once, at the initial point.</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;prep =&gt; model&quot;</span>
        <span class="c1"># Run at 2-month intervals between the initial and final points.</span>
        <span class="nv">P2M </span><span class="o">=</span><span class="s"> &quot;model[-P2M] =&gt; model =&gt; post_proc &amp; archive&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[model]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;run-model $CYLC_TASK_CYCLE_POINT&quot;</span>
</pre></div>
</div>
<p>And here’s how to do the same thing with parameterized tasks:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">chunk </span><span class="o">=</span><span class="s"> 1..6</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;prep =&gt; model&lt;chunk=1&gt;</span>
<span class="s2">                model&lt;chunk-1&gt; =&gt; model&lt;chunk&gt; =&gt;</span>
<span class="s2">                post_proc&lt;chunk&gt; &amp; archive&lt;chunk&gt;&quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[model</span>&lt;<span class="nb">chunk</span>&gt;<span class="nt">]]</span>
        <span class="nv">script </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="c1"># Compute start date from chunk index and interval, then run the model.</span><span class="s2"></span>
<span class="s2">INITIAL_POINT=2020-01</span>
<span class="s2">INTERVAL_MONTHS=2</span>
<span class="s2">OFFSET_MONTHS=(( (CYLC_TASK_PARAM_chunk - 1)*INTERVAL_MONTHS ))</span>
<span class="s2">OFFSET=P${OFFSET_MONTHS}M</span>  <span class="c1"># e.g. P4M for chunk=3</span><span class="s2"></span>
<span class="s2">run-model $(cylc cyclepoint --offset=$OFFSET $INITIAL_POINT)&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>The two workflows are shown together below. They both achieve the same
result, and both can include special tasks at the start, end, or
anywhere in between. But as noted earlier the parameterized version has
several disadvantages: it must be finite in extent and not too large; the
date-time arithmetic has to be done by the user; and the full extent of the
workflow will be visible at all times as the suite runs.</p>
<div class="figure align-center">
<img alt="../_images/eg2-static.png" src="../_images/eg2-static.png" />
</div>
<div class="figure align-center" id="id15">
<span id="fig-eg2"></span><img alt="../_images/eg2-dynamic.png" src="../_images/eg2-dynamic.png" />
<p class="caption"><span class="caption-text">Parameterized (top) and cycling (bottom) versions of the same
workflow. The first three cycle points are shown in the
cycling case. The parameterized case does not have “cycle points”.</span><a class="headerlink" href="#id15" title="Permalink to this image">¶</a></p>
</div>
<p>Here’s a yearly-cycling suite with four parameterized chunks in each cycle
point:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">chunk </span><span class="o">=</span><span class="s"> 1..4</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2020-01</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">P1Y </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            model&lt;chunk-1&gt; =&gt; model&lt;chunk&gt;</span>
<span class="s2">            model&lt;chunk=4&gt;[-P1Y] =&gt; model&lt;chunk=1&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The inter-cycle trigger connects the first chunk in each cycle point
to the last chunk in the previous cycle point. Of course it would be simpler
to just use 3-monthly cycling:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2020-01</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">P3M </span><span class="o">=</span><span class="s"> &quot;model[-P3M] =&gt; model&quot;</span>
</pre></div>
</div>
</div>
<p>Here’s a possible valid use-case for mixed cycling: consider a portable
date-time cycling workflow of model jobs that can each take too long to run on
some supported platforms. This could be handled without changing the cycling
structure of the suite by splitting the run (at each cycle point) into a
variable number of shorter steps, using more steps on less powerful hosts.</p>
<div class="section" id="cycle-point-and-parameter-offsets-at-start-up">
<h4>Cycle Point And Parameter Offsets At Start-Up<a class="headerlink" href="#cycle-point-and-parameter-offsets-at-start-up" title="Permalink to this headline">¶</a></h4>
<p>In cycling workflows cylc ignores anything earlier than the suite initial
cycle point. So this graph:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">P1D </span><span class="o">=</span><span class="s"> &quot;model[-P1D] =&gt; model&quot;</span>
</pre></div>
</div>
<p>simplifies at the initial cycle point to this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">P1D </span><span class="o">=</span><span class="s"> &quot;model&quot;</span>
</pre></div>
</div>
<p>Similarly, parameter offsets are ignored if they extend beyond the start
of the parameter value list. So this graph:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;model&lt;chunk-1&gt; =&gt; model&lt;chunk&gt;&quot;</span>
</pre></div>
</div>
<p>simplifies for <code class="docutils literal notranslate"><span class="pre">chunk=1</span></code> to this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">R1 </span><span class="o">=</span><span class="s"> &quot;model_chunk1&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The initial cut-off applies to every parameter list, but only
to cycle point sequences that start at the suite initial cycle point.
Therefore it may be somewhat easier to use parameterized cycling if you
need multiple date-time sequences <em>with different start points</em> in the
same suite. We plan to allow this sequence-start simplification for any
date-time sequence in the future, not just at the suite initial point,
but it needs to be optional because delayed-start cycling tasks
sometimes need to trigger off earlier cycling tasks.</p>
</div>
</div>
</div>
</div>
<div class="section" id="jinja2">
<span id="jinja"></span><h2>Jinja2<a class="headerlink" href="#jinja2" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section needs to be revised - the Parameterized Task feature
introduced in cylc-6.11.0 (see <a class="reference internal" href="#parameterized-tasks-label"><span class="std std-ref">Parameterized Tasks</span></a>) provides
a cleaner way to auto-generate tasks without coding messy Jinja2 loops.</p>
</div>
<p>Cylc has built in support for the Jinja2 template processor in suite
configurations. Jinja2 variables, mathematical expressions, loop control
structures, conditional logic, etc., are automatically processed to
generate the final suite configuration seen by cylc.</p>
<p>The need for Jinja2 processing must be declared with a hash-bang
comment as the first line of the suite.rc file:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="ch">#!jinja2</span>
<span class="c1"># ...</span>
</pre></div>
</div>
<p>Potential uses for this include automatic generation of repeated groups
of similar tasks and dependencies, and inclusion or exclusion of entire
suite sections according to the value of a single flag. Consider a
large complicated operational suite and several related parallel test
suites with slightly different task content and structure (the parallel
suites, for instance, might take certain large input files from the
operation or the archive rather than downloading them again) - these can
now be maintained as a single master suite configuration that reconfigures
itself according to the value of a flag variable indicating the intended use.</p>
<p>Template processing is the first thing done on parsing a suite
configuration so Jinja2 expressions can appear anywhere in the file (inside
strings and namespace headings, for example).</p>
<p>Jinja2 is <a class="reference external" href="http://jinja.pocoo.org/docs">well documented</a>, so here
we just provide an example suite that uses it. The meaning of the
embedded Jinja2 code should be reasonably self-evident to anyone familiar
with standard programming techniques.</p>
<div class="figure align-center" id="id16">
<span id="fig-jinja2-ensemble"></span><img alt="../_images/jinja2-ensemble-graph.png" src="../_images/jinja2-ensemble-graph.png" />
<p class="caption"><span class="caption-text">The Jinja2 ensemble example suite graph.</span><a class="headerlink" href="#id16" title="Permalink to this image">¶</a></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">jinja2.ensemble</span></code> example <a class="reference internal" href="#fig-jinja2-ensemble"><span class="std std-ref">graphed above</span></a>
shows an ensemble of similar tasks generated using Jinja2:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="ch">#!jinja2</span>
<span class="cp">{% set N_MEMBERS = 5 %}</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="c c-Multi">{# generate ensemble dependencies #}</span><span class="s2"></span>
<span class="s2">            </span><span class="cp">{% for I in range( 0, N_MEMBERS ) %}</span><span class="s2"></span>
<span class="s2">               foo =&gt; mem_</span><span class="cp">{{ I }}</span><span class="s2"> =&gt; post_</span><span class="cp">{{ I }}</span><span class="s2"> =&gt; bar</span>
<span class="s2">            </span><span class="cp">{% endfor %}</span><span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Here is the generated suite configuration, after Jinja2 processing:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="ch">#!jinja2</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">          foo =&gt; mem_0 =&gt; post_0 =&gt; bar</span>
<span class="s2">          foo =&gt; mem_1 =&gt; post_1 =&gt; bar</span>
<span class="s2">          foo =&gt; mem_2 =&gt; post_2 =&gt; bar</span>
<span class="s2">          foo =&gt; mem_3 =&gt; post_3 =&gt; bar</span>
<span class="s2">          foo =&gt; mem_4 =&gt; post_4 =&gt; bar</span>
<span class="s2">                &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>And finally, the <code class="docutils literal notranslate"><span class="pre">jinja2.cities</span></code> example uses variables,
includes or excludes special cleanup tasks according to the value of a
logical flag, and it automatically generates all dependencies and family
relationships for a group of tasks that is repeated for each city in the
suite. To add a new city and associated tasks and dependencies simply
add the city name to list at the top of the file. Here is the suite graphed,
with the New York City task family expanded:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="ch">#!Jinja2</span>
<span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;Jinja2 city suite example.&quot;</span>
    <span class="nv">description </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Illustrates use of variables and math expressions, and programmatic</span>
<span class="s2">generation of groups of related dependencies and runtime properties.&quot;&quot;&quot;</span>

<span class="cp">{% set HOST = &quot;SuperComputer&quot; %}</span>
<span class="cp">{% set CITIES = &#39;NewYork&#39;, &#39;Philadelphia&#39;, &#39;Newark&#39;, &#39;Houston&#39;, &#39;SantaFe&#39;, &#39;Chicago&#39; %}</span>
<span class="cp">{% set CITYJOBS = &#39;one&#39;, &#39;two&#39;, &#39;three&#39;, &#39;four&#39; %}</span>
<span class="cp">{% set LIMIT_MINS = 20 %}</span>

<span class="cp">{% set CLEANUP = True %}</span>

<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2011-08-08T12</span>
    <span class="nt">[[graph]]</span>
<span class="cp">{% if CLEANUP %}</span>
        <span class="nv">T23 </span><span class="o">=</span><span class="s"> &quot;clean&quot;</span>
<span class="cp">{% endif %}</span>
        <span class="nv">T00,T12 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    setup =&gt; get_lbc &amp; get_ic</span> <span class="c1"># foo</span><span class="s2"></span>
<span class="cp">{% for CITY in CITIES %}</span><span class="s2"> </span><span class="c c-Multi">{# comment #}</span><span class="s2"></span>
<span class="s2">                    get_lbc =&gt; </span><span class="cp">{{ CITY }}</span><span class="s2">_one</span>
<span class="s2">                    get_ic =&gt; </span><span class="cp">{{ CITY }}</span><span class="s2">_two</span>
<span class="s2">                    </span><span class="cp">{{ CITY }}</span><span class="s2">_one &amp; </span><span class="cp">{{ CITY }}</span><span class="s2">_two =&gt; </span><span class="cp">{{ CITY }}</span><span class="s2">_three &amp; </span><span class="cp">{{ CITY }}</span><span class="s2">_four</span>
<span class="cp">{% if CLEANUP %}</span><span class="s2"></span>
<span class="s2">                    </span><span class="cp">{{ CITY }}</span><span class="s2">_three &amp; </span><span class="cp">{{ CITY }}</span><span class="s2">_four =&gt; cleanup</span>
<span class="cp">{% endif %}</span><span class="s2"></span>
<span class="cp">{% endfor %}</span><span class="s2"></span>
<span class="s2">                    &quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[on_</span><span class="cp">{{ HOST }}</span><span class="nt"> ]]</span>
        <span class="nt">[[[remote]]]</span>
            <span class="nv">host </span><span class="o">=</span><span class="s"> </span><span class="cp">{{ HOST }}</span>
            <span class="c1"># (remote cylc directory is set in site/user config for this host)</span>
        <span class="nt">[[[directives]]]</span>
            <span class="nv">wall_clock_limit </span><span class="o">=</span><span class="s"> &quot;00:</span><span class="cp">{{ LIMIT_MINS|int() + 2 }}</span><span class="s">:00,00:</span><span class="cp">{{ LIMIT_MINS }}</span><span class="s">:00&quot;</span>

<span class="cp">{% for CITY in CITIES %}</span>
    <span class="nt">[[ </span><span class="cp">{{ CITY }}</span><span class="nt"> ]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> on_</span><span class="cp">{{ HOST }}</span>
<span class="cp">{% for JOB in CITYJOBS %}</span>
    <span class="nt">[[ </span><span class="cp">{{ CITY }}</span><span class="nt">_</span><span class="cp">{{ JOB }}</span><span class="nt"> ]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> </span><span class="cp">{{ CITY }}</span>
<span class="cp">{% endfor %}</span>
<span class="cp">{% endfor %}</span>

<span class="nt">[visualization]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2011-08-08T12</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 2011-08-08T23</span>
    <span class="nt">[[node groups]]</span>
        <span class="nv">cleaning </span><span class="o">=</span><span class="s"> clean, cleanup</span>
    <span class="nt">[[node attributes]]</span>
        <span class="nv">cleaning </span><span class="o">=</span><span class="s"> &#39;style=filled&#39;, &#39;fillcolor=yellow&#39;</span>
        <span class="nv">NewYork </span><span class="o">=</span><span class="s"> &#39;style=filled&#39;, &#39;fillcolor=lightblue&#39;        </span>
</pre></div>
</div>
<div class="figure align-center" id="id17">
<span id="fig-jinja2-cities"></span><img alt="../_images/jinja2-suite-graph.png" src="../_images/jinja2-suite-graph.png" />
<p class="caption"><span class="caption-text">The Jinja2 cities example suite graph, with the
New York City task family expanded.</span><a class="headerlink" href="#id17" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="accessing-environment-variables-with-jinja2">
<h3>Accessing Environment Variables With Jinja2<a class="headerlink" href="#accessing-environment-variables-with-jinja2" title="Permalink to this headline">¶</a></h3>
<p>This functionality is not provided by Jinja2 by default, but cylc
automatically imports the user environment to template’s global namespace
(see <a class="reference internal" href="#customjinja2filters"><span class="std std-ref">Custom Jinja2 Filters, Tests and Globals</span></a>) in a dictionary structure called
<em>environ</em>. A usage example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="ch">#!Jinja2</span>
<span class="c1">#...</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">SUITE_OWNER_HOME_DIR_ON_SUITE_HOST </span><span class="o">=</span><span class="s"> </span><span class="cp">{{environ[&#39;HOME&#39;]}}</span>
</pre></div>
</div>
<p>In addition, the following variables are exported to this environment
prior to configuration parsing to provide suite context:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>CYLC_DEBUG                      <span class="c1"># Debug mode, true or not defined</span>
CYLC_VERBOSE                    <span class="c1"># Verbose mode, True or False</span>
CYLC_VERSION                    <span class="c1"># Version of cylc installation used</span>

CYLC_SUITE_NAME                 <span class="c1"># Suite name</span>

CYLC_SUITE_DEF_PATH             <span class="c1"># Location of the suite configuration</span>
                                <span class="c1"># source path on suite host,</span>
                                <span class="c1"># e.g. ~/cylc-run/foo</span>
CYLC_SUITE_LOG_DIR              <span class="c1"># Suite log directory.</span>
CYLC_SUITE_RUN_DIR              <span class="c1"># Location of the suite run directory in</span>
                                <span class="c1"># suite host, e.g. ~/cylc-run/foo</span>
CYLC_SUITE_SHARE_DIR            <span class="c1"># Suite (or task post parsing!)</span>
                                <span class="c1"># shared directory.</span>
CYLC_SUITE_WORK_DIR             <span class="c1"># Suite work directory.</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The example above emphasizes that <em>the environment - including the suite
context variables - is read on the suite host when the suite configuration
is parsed</em>, not at task run time on job hosts.</p>
</div>
</div>
<div class="section" id="custom-jinja2-filters-tests-and-globals">
<span id="customjinja2filters"></span><h3>Custom Jinja2 Filters, Tests and Globals<a class="headerlink" href="#custom-jinja2-filters-tests-and-globals" title="Permalink to this headline">¶</a></h3>
<p>Jinja2 has three different namespaces used to separate “globals”,
“filters” and “tests”. Globals are template-wide accessible variables
and functions. Cylc extends this namespace with “environ” dictionary and
“raise” and “assert” functions for raising exceptions
(see <a class="reference internal" href="#jinja2raisingexceptions"><span class="std std-ref">Raising Exceptions</span></a>).</p>
<p>Filters can be used to modify variable values and are applied using pipe
notation. For example, the built-in <code class="docutils literal notranslate"><span class="pre">trim</span></code> filter strips leading
and trailing white space from a string:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="cp">{% set MyString = &quot;   dog   &quot; %}</span>
<span class="cp">{{ MyString | trim() }}</span>  <span class="c1"># &quot;dog&quot;</span>
</pre></div>
</div>
<p>Additionally, variable values can be tested using “is” keyword followed by
the name of the test, e.g. <code class="docutils literal notranslate"><span class="pre">VARIABLE</span> <span class="pre">is</span> <span class="pre">defined</span></code>.
See official Jinja2 documentation for available built-in globals, filters
and tests.</p>
<p>Cylc also supports custom Jinja2 globals, filters and tests. A custom global,
filter or test is a single Python function in a source file with the same name
as the function (plus “.py” extension) and stored in one of the following
locations:</p>
<p>In the argument list of filter or test function, the first argument is
the variable value to be “filtered” or “tested”, respectively, and
subsequent arguments can be whatever else is needed. Currently there are three
custom filters:</p>
<div class="section" id="pad">
<h4>pad<a class="headerlink" href="#pad" title="Permalink to this headline">¶</a></h4>
<p>The “pad” filter is for padding string values to some
constant length with a fill character - useful for generating task names
and related values in ensemble suites:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="cp">{% for i in range(0,100) %}</span>  <span class="c1"># 0, 1, ..., 99</span>
    <span class="cp">{% set j = i | pad(2,&#39;0&#39;) %}</span>
    <span class="nt">[[A_</span><span class="cp">{{j}}</span><span class="nt">]]</span>         <span class="c1"># [[A_00]], [[A_01]], ..., [[A_99]]</span>
<span class="cp">{% endfor %}</span>
</pre></div>
</div>
</div>
<div class="section" id="strftime">
<h4>strftime<a class="headerlink" href="#strftime" title="Permalink to this headline">¶</a></h4>
<p>The “strftime” filter can be used to format ISO8601 date-time strings using
an strftime string.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="cp">{% set START_CYCLE = &#39;10661004T08+01&#39; %}</span>
<span class="cp">{{ START_CYCLE | strftime(&#39;%H&#39;) }}</span>  <span class="c1"># 00</span>
</pre></div>
</div>
<p>Examples:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">{{START_CYCLE</span> <span class="pre">|</span> <span class="pre">strftime('%Y')}}</span></code> - 1066</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{{START_CYCLE</span> <span class="pre">|</span> <span class="pre">strftime('%m')}}</span></code> - 10</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{{START_CYCLE</span> <span class="pre">|</span> <span class="pre">strftime('%d')}}</span></code> - 14</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{{START_CYCLE</span> <span class="pre">|</span> <span class="pre">strftime('%H:%M:%S</span> <span class="pre">%z')}}</span></code> - 08:00:00 +01</p></li>
</ul>
<p>It is also possible to parse non-standard date-time strings by passing a
strptime string as the second argument.</p>
<p>Examples:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">{{'12,30,2000'</span> <span class="pre">|</span> <span class="pre">strftime('%m',</span> <span class="pre">'%m,%d,%Y')}}</span></code> - 12</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{{'1066/10/14</span> <span class="pre">08:00:00'</span> <span class="pre">|</span> <span class="pre">strftime('%Y%m%dT%H',</span> <span class="pre">'%Y/%m/%d</span> <span class="pre">%H:%M:%S')}}</span></code> - 10661014T08</p></li>
</ul>
</div>
<div class="section" id="duration-as">
<h4>duration_as<a class="headerlink" href="#duration-as" title="Permalink to this headline">¶</a></h4>
<p>The “duration_as” filter can be used to format ISO8601 duration
strings as a floating-point number of several different units.  Units
for the conversion can be specified in a case-insensitive short or long
form:</p>
<ul class="simple">
<li><p>Seconds - “s” or “seconds”</p></li>
<li><p>Minutes - “m” or “minutes”</p></li>
<li><p>Hours - “h” or “hours”</p></li>
<li><p>Days - “d” or “days”</p></li>
<li><p>Weeks - “w” or “weeks”</p></li>
</ul>
<p>Within the suite, this becomes:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="cp">{% set CYCLE_INTERVAL = &#39;PT1D&#39; %}</span>
<span class="cp">{{ CYCLE_INTERVAL | duration_as(&#39;h&#39;) }}</span>  <span class="c1"># 24.0</span>
<span class="cp">{% set CYCLE_SUBINTERVAL = &#39;PT30M&#39; %}</span>
<span class="cp">{{ CYCLE_SUBINTERVAL | duration_as(&#39;hours&#39;) }}</span>  <span class="c1"># 0.5</span>
<span class="cp">{% set CYCLE_INTERVAL = &#39;PT1D&#39; %}</span>
<span class="cp">{{ CYCLE_INTERVAL | duration_as(&#39;s&#39;) }}</span>  <span class="c1"># 86400.0</span>
<span class="cp">{% set CYCLE_SUBINTERVAL = &#39;PT30M&#39; %}</span>
<span class="cp">{{ CYCLE_SUBINTERVAL | duration_as(&#39;seconds&#39;) }}</span>  <span class="c1"># 1800.0</span>
</pre></div>
</div>
<p>While the filtered value is a floating-point number, it is often required to
supply an integer to suite entities (e.g. environment variables) that require
it.  This is accomplished by chaining filters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">{{CYCLE_INTERVAL</span> <span class="pre">|</span> <span class="pre">duration_as('h')</span> <span class="pre">|</span> <span class="pre">int}}</span></code> - 24</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{{CYCLE_SUBINTERVAL</span> <span class="pre">|</span> <span class="pre">duration_as('h')</span> <span class="pre">|</span> <span class="pre">int}}</span></code> - 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{{CYCLE_INTERVAL</span> <span class="pre">|</span> <span class="pre">duration_as('s')</span> <span class="pre">|</span> <span class="pre">int}}</span></code> - 86400</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{{CYCLE_SUBINTERVAL</span> <span class="pre">|</span> <span class="pre">duration_as('s')</span> <span class="pre">|</span> <span class="pre">int}}</span></code> - 1800</p></li>
</ul>
</div>
</div>
<div class="section" id="associative-arrays-in-jinja2">
<h3>Associative Arrays In Jinja2<a class="headerlink" href="#associative-arrays-in-jinja2" title="Permalink to this headline">¶</a></h3>
<p>Associative arrays (<em>dicts</em> in Python) can be very useful.
Here’s an example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="ch">#!Jinja2</span>
<span class="cp">{% set obs_types = [&#39;airs&#39;, &#39;iasi&#39;] %}</span>
<span class="cp">{% set resource = { &#39;airs&#39;:&#39;ncpus=9&#39;, &#39;iasi&#39;:&#39;ncpus=20&#39; } %}</span>

<span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> OBS</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[OBS]]</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> pbs</span>
    <span class="cp">{% for i in obs_types %}</span>
    <span class="nt">[[ </span><span class="cp">{{i}}</span><span class="nt"> ]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> OBS</span>
        <span class="nt">[[[directives]]]</span>
             <span class="nv">-I </span><span class="o">=</span><span class="s"> </span><span class="cp">{{ resource[i] }}</span>
     <span class="cp">{% endfor %}</span>
</pre></div>
</div>
<p>Here’s the result:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc get-suite-config -i <span class="o">[</span>runtime<span class="o">][</span>airs<span class="o">]</span>directives SUITE
-I <span class="o">=</span> <span class="nv">ncpus</span><span class="o">=</span><span class="m">9</span>
</pre></div>
</div>
</div>
<div class="section" id="jinja2-default-values-and-template-inputs">
<h3>Jinja2 Default Values And Template Inputs<a class="headerlink" href="#jinja2-default-values-and-template-inputs" title="Permalink to this headline">¶</a></h3>
<p>The values of Jinja2 variables can be passed in from the cylc command
line rather than hardwired in the suite configuration.
Here’s an example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="ch">#!Jinja2</span>
<span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;Jinja2 example: use of defaults and external input&quot;</span>

    <span class="nv">description </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">The template variable N_MEMBERS can be set on the command line with</span>
<span class="s2">--set or --set-file=FILE; but if not a default values is supplied.&quot;&quot;&quot;</span> 

<span class="cp">{% set N_MEMBERS = N_MEMBERS | default( 3 ) | int %}</span>

<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20100808T00</span>
    <span class="nv">final cycle point   </span><span class="o">=</span><span class="s"> 20100816T00</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">T00 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;foo =&gt; ENS</span>
<span class="s2">                 ENS:succeed-all =&gt; bar&quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[ENS]]</span>
<span class="cp">{% for I in range( 0, N_MEMBERS ) %}</span>
    <span class="nt">[[ mem_</span><span class="cp">{{ I }}</span><span class="nt"> ]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> ENS</span>
<span class="cp">{% endfor %}</span>
</pre></div>
</div>
<p>Here’s the result:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc list SUITE
Jinja2 Template Error
<span class="s1">&#39;FIRST_TASK&#39;</span> is undefined
cylc-list SUITE  failed:  <span class="m">1</span>

$ cylc list --set <span class="nv">FIRST_TASK</span><span class="o">=</span>bob SUITE
bob
baz
mem_2
mem_1
mem_0

$ cylc list --set <span class="nv">FIRST_TASK</span><span class="o">=</span>bob --set <span class="nv">LAST_TASK</span><span class="o">=</span>alice SUITE
bob
alice
mem_2
mem_1
mem_0

$ cylc list --set <span class="nv">FIRST_TASK</span><span class="o">=</span>bob --set <span class="nv">N_MEMBERS</span><span class="o">=</span><span class="m">10</span> SUITE
mem_9
mem_8
mem_7
mem_6
mem_5
mem_4
mem_3
mem_2
mem_1
mem_0
baz
bob
</pre></div>
</div>
<p>Note also that <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">view</span> <span class="pre">--set</span> <span class="pre">FIRST_TASK=bob</span> <span class="pre">--jinja2</span> <span class="pre">SUITE</span></code>
will show the suite with the Jinja2 variables as set.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Suites started with template variables set on the command
line will <em>restart</em> with the same settings. However, you can set
them again on the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">restart</span></code> command line if they need to
be overridden.</p>
</div>
</div>
<div class="section" id="jinja2-variable-scope">
<h3>Jinja2 Variable Scope<a class="headerlink" href="#jinja2-variable-scope" title="Permalink to this headline">¶</a></h3>
<p>Jinja2 variable scoping rules may be surprising. Variables set inside a
<em>for loop</em> block, for instance, are not accessible outside of the block,
so the following will print <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">FOO</span> <span class="pre">is</span> <span class="pre">0</span></code>, not <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">FOO</span> <span class="pre">is</span> <span class="pre">9</span></code>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="cp">{% set FOO = false %}</span>
<span class="cp">{% for item in items %}</span>
    <span class="cp">{% if item.check_something() %}</span>
        <span class="cp">{% set FOO = true %}</span>
    <span class="cp">{% endif %}</span>
<span class="cp">{% endfor %}</span>
<span class="c1"># FOO is {{FOO}}</span>
</pre></div>
</div>
<p>Jinja2 documentation suggests using alternative constructs like the loop else
block or the special <code class="docutils literal notranslate"><span class="pre">loop</span></code> variable. More complex use cases can be
handled using <code class="docutils literal notranslate"><span class="pre">namespace</span></code> objects which allow propagating of changes
across scopes:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="cp">{% set ns = namespace(foo=false) %}</span>
<span class="cp">{% for item in items %}</span>
    <span class="cp">{% if item.check_something() %}</span>
        <span class="cp">{% set ns.foo = true %}</span>
    <span class="cp">{% endif %}</span>
<span class="cp">{% endfor %}</span>
<span class="c1"># FOO is {{ns.foo}}</span>
</pre></div>
</div>
<p>For detail, see
<a class="reference external" href="http://jinja.pocoo.org/docs/2.10/templates/#assignments">Jinja2 Template Designer Documentation &gt;
Assignments</a></p>
</div>
<div class="section" id="raising-exceptions">
<span id="jinja2raisingexceptions"></span><h3>Raising Exceptions<a class="headerlink" href="#raising-exceptions" title="Permalink to this headline">¶</a></h3>
<p>Cylc provides two functions for raising exceptions using Jinja2. These
exceptions are raised when the suite.rc file is loaded and will prevent a suite
from running.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These functions must be contained within <code class="docutils literal notranslate"><span class="pre">{{</span></code> Jinja2
blocks as opposed to <code class="docutils literal notranslate"><span class="pre">{%</span></code> blocks.</p>
</div>
<div class="section" id="raise">
<h4>Raise<a class="headerlink" href="#raise" title="Permalink to this headline">¶</a></h4>
<p>The “raise” function will result in an error containing the provided text.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="cp">{% if not VARIABLE is defined %}</span>
    <span class="cp">{{ raise(&#39;VARIABLE must be defined for this suite.&#39;) }}</span>
<span class="cp">{% endif %}</span>
</pre></div>
</div>
</div>
<div class="section" id="assert">
<h4>Assert<a class="headerlink" href="#assert" title="Permalink to this headline">¶</a></h4>
<p>The “assert” function will raise an exception containing the text provided in
the second argument providing that the first argument evaluates as False. The
following example is equivalent to the “raise” example above.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="cp">{{ assert(VARIABLE is defined, &#39;VARIABLE must be defined for this suite.&#39;) }}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="importing-additional-python-modules">
<h3>Importing additional Python modules<a class="headerlink" href="#importing-additional-python-modules" title="Permalink to this headline">¶</a></h3>
<p>Jinja2 allows to gather variable and macro definitions in a separate template
that can be imported into (and thus shared among) other templates.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="cp">{% import &quot;suite-utils.rc&quot; as utils %}</span>
<span class="cp">{% from &quot;suite-utils.rc&quot; import VARIABLE as ALIAS %}</span>
<span class="cp">{{ utils.VARIABLE is equalto(ALIAS)) }}</span>
</pre></div>
</div>
<p>Cylc extends this functionality to allow import of arbitrary Python modules.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="cp">{% from &quot;itertools&quot; import product %}</span>
<span class="nt">[runtime]</span>
<span class="cp">{% for group, member in product([&#39;a&#39;, &#39;b&#39;], [0, 1, 2]) %}</span>
    <span class="nt">[[</span><span class="cp">{{group}}</span><span class="nt">_</span><span class="cp">{{member}}</span><span class="nt">]]</span>
<span class="cp">{% endfor %}</span>
</pre></div>
</div>
<p>For better clarity and disambiguation Python modules can be prefixed with
<code class="docutils literal notranslate"><span class="pre">__python__</span></code>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="cp">{% from &quot;__python__.itertools&quot; import product %}</span>
</pre></div>
</div>
</div>
<div class="section" id="logging">
<h3>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h3>
<p>It is possible to output messages to the Cylc log from within Jinja2, these
messages will appear on the console when running or validating a suite.
This can be useful for development or debugging.</p>
<p>Example <code class="docutils literal notranslate"><span class="pre">suite.rc</span></code>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="ch">#!Jinja2</span>
<span class="cp">{% from &quot;cylc.flow&quot; import LOG %}</span>
<span class="cp">{% do LOG.debug(&quot;Hello World!&quot;) %}</span>
</pre></div>
</div>
<p>Example output:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cylc validate . --debug
<span class="go">DEBUG - Loading site/user config files</span>
<span class="go">DEBUG - Reading file &lt;file&gt;</span>
<span class="go">DEBUG - Processing with Jinja2</span>
<span class="go">DEBUG - Hello World!</span>
<span class="go">...</span>
<span class="go">Valid for cylc-&lt;version&gt;</span>
</pre></div>
</div>
<p>Log messages will appear whenever the suite configuration is loaded so it is
advisable to use the <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> logging level which is suppressed unless the
<code class="docutils literal notranslate"><span class="pre">--debug</span></code> option is provided.</p>
</div>
</div>
<div class="section" id="empy">
<span id="empylabel"></span><h2>EmPy<a class="headerlink" href="#empy" title="Permalink to this headline">¶</a></h2>
<p>In addition to Jinja2, Cylc supports EmPy template processor in suite
configurations. Similarly to Jinja2, EmPy provides variables, mathematical
expressions, loop control structures, conditional logic, etc., that are
expanded to generate the final suite configuration seen by Cylc. See the
<a class="reference external" href="http://www.alcyone.com/software/empy">EmPy documentation</a> for more
details on its templating features and how to use them.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>EmPy is not bundled with Cylc and must be installed separately. It
should be available to Python through standard <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">em</span></code>. Please also
note that there is another Python package called “em” that provides
a conflicting module of the same name. You can run
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">check-software</span></code> command to check your installation.</p>
</div>
<p>The need for EmPy processing must be declared with a hash-bang comment as
the first line of the suite.rc file:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="ch">#!empy</span>
<span class="c1"># ...</span>
</pre></div>
</div>
<p>An example suite <code class="docutils literal notranslate"><span class="pre">empy.cities</span></code> demonstrating its use is shown below.
It is a translation of <code class="docutils literal notranslate"><span class="pre">jinja2.cities</span></code> example from
<a class="reference internal" href="#jinja"><span class="std std-ref">Jinja2</span></a> and can be directly compared against it.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1">#!EmPy</span>
<span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;EmPy city suite example.&quot;</span>
    <span class="nv">description </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Illustrates use of variables and math expressions, and programmatic</span>
<span class="s2">generation of groups of related dependencies and runtime properties.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="cp">@{</span>
<span class="cp">HOST = &quot;SuperComputer&quot;</span>
<span class="cp">CITIES = &#39;NewYork&#39;, &#39;Philadelphia&#39;, &#39;Newark&#39;, &#39;Houston&#39;, &#39;SantaFe&#39;, &#39;Chicago&#39;</span>
<span class="cp">CITYJOBS = &#39;one&#39;, &#39;two&#39;, &#39;three&#39;, &#39;four&#39;</span>
<span class="cp">LIMIT_MINS = 20</span>
<span class="cp">CLEANUP = True</span>
<span class="cp">}</span>

<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2011-08-08T12</span>
    <span class="nt">[[graph]]</span>
<span class="cp">@[ if CLEANUP ]</span>
        <span class="nv">T23 </span><span class="o">=</span><span class="s"> &quot;clean&quot;</span>
<span class="cp">@[ end if ]</span>
        <span class="nv">T00,T12 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                setup =&gt; get_lbc &amp; get_ic</span> <span class="c1"># foo</span><span class="s2"></span>
<span class="cp">@[ for CITY in CITIES ]</span><span class="c c-Multi">@# comment</span><span class="s2"></span>
<span class="s2">                get_lbc =&gt; </span><span class="cp">@(CITY)</span><span class="s2">_one</span>
<span class="s2">                get_ic =&gt; </span><span class="cp">@(CITY)</span><span class="s2">_two</span>
<span class="s2">                </span><span class="cp">@(CITY)</span><span class="s2">_one &amp; </span><span class="cp">@(CITY)</span><span class="s2">_two =&gt; </span><span class="cp">@(CITY)</span><span class="s2">_three &amp; </span><span class="cp">@(CITY)</span><span class="s2">_four</span>
<span class="s2">    </span><span class="cp">@[ if CLEANUP ]</span><span class="s2"></span>
<span class="s2">                </span><span class="cp">@(CITY)</span><span class="s2">_three &amp; </span><span class="cp">@(CITY)</span><span class="s2">_four =&gt; cleanup</span>
<span class="s2">    </span><span class="cp">@[ end if ]</span><span class="s2"></span>
<span class="cp">@[ end for ]</span><span class="s2"></span>
<span class="s2">            &quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[on_</span><span class="cp">@HOST</span><span class="nt"> ]]</span>
        <span class="nt">[[[remote]]]</span>
            <span class="nv">host </span><span class="o">=</span><span class="s"> </span><span class="cp">@HOST</span>
            <span class="c1"># (remote cylc directory is set in site/user config for this host)</span>
        <span class="nt">[[[directives]]]</span>
            <span class="nv">wall_clock_limit </span><span class="o">=</span><span class="s"> &quot;00:</span><span class="cp">@(LIMIT_MINS + 2)</span><span class="s">:00,00:</span><span class="cp">@(LIMIT_MINS)</span><span class="s">:00&quot;</span>

<span class="cp">@[ for CITY in CITIES ]</span>
    <span class="nt">[[ </span><span class="cp">@(CITY)</span><span class="nt"> ]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> on_</span><span class="cp">@(HOST)</span>
    <span class="cp">@[ for JOB in CITYJOBS ]</span>
    <span class="nt">[[ </span><span class="cp">@(CITY)</span><span class="nt">_</span><span class="cp">@(JOB)</span><span class="nt"> ]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> </span><span class="cp">@CITY</span>
    <span class="cp">@[ end for ]</span>
<span class="cp">@[ end for ]</span>

<span class="cp">@empy.include(&quot;./suite-visualization.rc&quot;)</span>
</pre></div>
</div>
<p>For basic usage the difference between Jinja2 and EmPy amounts to a different
markup syntax with little else to distinguish them. EmPy might be preferable,
however, in cases where more complicated processing logic have to be
implemented.</p>
<p>EmPy is a system for embedding Python expressions and statements in template
text. It makes the full power of Python language and its ecosystem easily
accessible from within the template. This might be desirable for several
reasons:</p>
<ul class="simple">
<li><p>no need to learn different language and its idiosyncrasies just for
writing template logic</p></li>
<li><p>availability of lambda functions, list and dictionary comprehensions
can make template code smaller and more readable compared to Jinja2</p></li>
<li><p>natural and straightforward integration with Python package ecosystem</p></li>
<li><p>no two-language barrier between writing template logic and processing
extensions makes it easier to refactor and maintain the template code
as its complexity grows - inline pieces of Python code can be
gathered into subroutines and eventually into separate modules and
packages in a seamless manner.</p></li>
</ul>
</div>
<div class="section" id="omitting-tasks-at-runtime">
<h2>Omitting Tasks At Runtime<a class="headerlink" href="#omitting-tasks-at-runtime" title="Permalink to this headline">¶</a></h2>
<p>It is sometimes convenient to omit certain tasks from the suite at
runtime without actually deleting their definitions from the suite.</p>
<p>Defining <code class="docutils literal notranslate"><span class="pre">[runtime]</span></code> properties for tasks that do not appear in the suite
graph results in verbose-mode validation warnings that the tasks are
disabled. They cannot be used because the suite graph is what defines
their dependencies and valid cycle points. Nevertheless, it is legal to
leave these orphaned runtime sections in the suite configuration because it
allows you to temporarily remove tasks from the suite by simply
commenting them out of the graph.</p>
<p>To omit a task from the suite at runtime but still leave it fully
defined and available for use (by insertion) use one or both of
<a class="reference internal" href="../reference/config/suite.html#suite.rc[scheduling][special tasks]include at start-up" title="suite.rc[scheduling][special tasks]include at start-up"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[scheduling][special</span> <span class="pre">tasks]include</span> <span class="pre">at</span> <span class="pre">start-up</span></code></a> or
<a class="reference internal" href="../reference/config/suite.html#suite.rc[scheduling][special tasks]exclude at start-up" title="suite.rc[scheduling][special tasks]exclude at start-up"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[scheduling][special</span> <span class="pre">tasks]exclude</span> <span class="pre">at</span> <span class="pre">start-up</span></code></a>.
Then the graph still defines the
validity of the tasks and their dependencies, but they are not actually
loaded into the suite at start-up. Other tasks that depend on the
omitted ones, if any, will have to wait on their insertion at a later
time or otherwise be triggered manually.</p>
<p>Finally, with Jinja2 (<a class="reference internal" href="#jinja"><span class="std std-ref">Jinja2</span></a>) you can radically alter
suite structure by including or excluding tasks from th
<a class="reference internal" href="../reference/config/suite.html#suite.rc[scheduling]" title="suite.rc[scheduling]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[scheduling]</span></code></a> and <a class="reference internal" href="../reference/config/suite.html#suite.rc[runtime]" title="suite.rc[runtime]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[runtime]</span></code></a> sections according to the
value of a single logical flag defined at the top of the suite.</p>
</div>
<div class="section" id="naked-dummy-tasks-and-strict-validation">
<h2>Naked Dummy Tasks And Strict Validation<a class="headerlink" href="#naked-dummy-tasks-and-strict-validation" title="Permalink to this headline">¶</a></h2>
<p>A <em>naked dummy task</em> appears in the suite graph but has no
explicit runtime configuration section. Such tasks automatically
inherit the default “dummy task” configuration from the root
namespace. This is very useful because it allows functional suites to
be mocked up quickly for test and demonstration purposes by simply
defining the graph. It is somewhat dangerous, however, because there
is no way to distinguish an intentional naked dummy task from one
generated by typographic error: misspelling a task name in the graph
results in a new naked dummy task replacing the intended task in the
affected trigger expression; and misspelling a task name in a runtime
section heading results in the intended task becoming a dummy task
itself (by divorcing it from its intended runtime config section).</p>
<p>To avoid this problem any dummy task used in a real suite should not be
naked - i.e. it should have an explicit entry in under the runtime
section of the suite configuration, even if the section is empty. This
results in exactly the same dummy task behaviour, via implicit
inheritance from root, but it allows use of
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">validate</span> <span class="pre">--strict</span></code>
to catch errors in task names by failing the suite if any naked dummy
tasks are detected.</p>
<dl class="footnote brackets">
<dt class="label" id="id9"><span class="brackets"><a class="fn-backref" href="#id5">1</a></span></dt>
<dd><p>An OR operator on the right doesn’t make much sense: if “B or C”
triggers off A, what exactly should cylc do when A finishes?</p>
</dd>
<dt class="label" id="id10"><span class="brackets"><a class="fn-backref" href="#id6">2</a></span></dt>
<dd><p>In NWP forecast analysis suites parts of the observation
processing and data assimilation subsystem will typically also
depend on model background fields generated by the previous forecast.</p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="running-suites.html" class="btn btn-neutral float-right" title="Running Suites" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="workflows.html" class="btn btn-neutral float-left" title="Workflows For Cycling Systems" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2008-2020 NIWA &amp; British Crown (Met Office) &amp; Contributors
      <span class="lastupdated">
        Last updated on Aug 11, 2020.
      </span>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  <!--
  element which gets populated with the list of available versions and
  formats for the documentation by versions.js
-->
<div
  class="rst-versions"
  data-toggle="rst-versions"
  id='versions-and-formats'
></div>



<script type="text/javascript">
    const CUR_FORMAT = "html";
    const CUR_VERSION = "nightly.2020-08-11";
    // name of page (in URL), for singlepage builds this will be `index`
    const PAGE_NAME = "user-guide/writing-suites";
    // URL path to the base docs dir i.e. ROOT_DIR/version/format
    const ROOT_DIR = "../../..";
</script>

<script
  type="text/javascript"
  src="../../../versions.js"
></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>