

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Efficiency And Maintainability &mdash; Cylc nightly.2020-08-11 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/cylc.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/cylc-favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/js/minicylc.js"></script>
        <script src="../_static/js/spoiler.js"></script>
        <script src="../_static/js/cylc.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Portable Suites" href="portable-suites.html" />
    <link rel="prev" title="Basic Principles" href="general-principles.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/cylc-logo-white.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                nightly.2020-08-11
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table Of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction: How Cylc Works</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/index.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Suite Design Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="style-guide.html">Style Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="general-principles.html">Basic Principles</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Efficiency And Maintainability</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-task-family-hierarchy">The Task Family Hierarchy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#sharing-by-inheritance">Sharing By Inheritance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#family-triggering">Family Triggering</a></li>
<li class="toctree-l4"><a class="reference internal" href="#family-to-family-triggering">Family-to-Family Triggering</a></li>
<li class="toctree-l4"><a class="reference internal" href="#task-families-and-visualization">Task Families And Visualization</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#generating-tasks-automatically">Generating Tasks Automatically</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#jinja2-loops">Jinja2 Loops</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parameterized-tasks">Parameterized Tasks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#optional-app-config-files">Optional App Config Files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="portable-suites.html">Portable Suites</a></li>
<li class="toctree-l2"><a class="reference internal" href="roadmap.html">Roadmap</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Cylc</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Suite Design Guide</a> &raquo;</li>
        
      <li>Efficiency And Maintainability</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/suite-design-guide/efficiency.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="efficiency-and-maintainability">
<span id="id1"></span><h1>Efficiency And Maintainability<a class="headerlink" href="#efficiency-and-maintainability" title="Permalink to this headline">¶</a></h1>
<p>Efficiency (in the sense of <em>economy of suite definition</em>) and
maintainability go hand in hand. This section describes techniques for clean
and efficient construction of complex workflows that are easy to understand,
maintain, and modify.</p>
<div class="section" id="the-task-family-hierarchy">
<span id="id2"></span><h2>The Task Family Hierarchy<a class="headerlink" href="#the-task-family-hierarchy" title="Permalink to this headline">¶</a></h2>
<p>A properly designed family hierarchy fulfils three purposes in Cylc:</p>
<ul class="simple">
<li><p>efficient sharing of all configuration common to groups of related
tasks</p></li>
<li><p>efficient bulk triggering, for clear scheduling graphs</p></li>
<li><p>clean suite visualization and monitoring, because families are
collapsible</p></li>
</ul>
<div class="section" id="sharing-by-inheritance">
<span id="id3"></span><h3>Sharing By Inheritance<a class="headerlink" href="#sharing-by-inheritance" title="Permalink to this headline">¶</a></h3>
<p>Duplication is a maintenance risk because changes have to be repeated in
multiple places without mistakes. On the other hand, unnecessary sharing of
items via global variables is also bad because it is hard to be sure which
tasks are using which variables. A properly designed runtime inheritance
hierarchy can give every task exactly what it needs, and nothing that it
doesn’t need.</p>
<p>If a group of related tasks has some configuration in common, it can be
factored out into a task family inherited by all.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[OBSPROC]]</span>
        <span class="c1"># Settings common to all obs processing tasks.</span>
    <span class="nt">[[obs1]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> OBSPROC</span>
    <span class="nt">[[obs2]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> OBSPROC</span>
</pre></div>
</div>
<p>If several families have settings in common, they can in turn can inherit
from higher-level families.</p>
<p>Multiple inheritance allows efficient sharing even for overlapping categories
of tasks. For example consider that some obs processing tasks in the following
suite run parallel jobs and some serial:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[SERIAL]]</span>
        <span class="c1"># Serial job settings.</span>
    <span class="nt">[[PARALLEL]]</span>
        <span class="c1"># Parallel job settings.</span>
    <span class="nt">[[OBSPROC]]</span>
        <span class="c1"># Settings for all obs processing tasks.</span>
    <span class="nt">[[obs1, obs2, obs3]]</span>
        <span class="c1"># Serial obs processing tasks.</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> OBSPROC, SERIAL</span>
    <span class="nt">[[obs4, obs5]]</span>
        <span class="c1"># Parallel obs processing tasks.</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> OBSPROC, PARALLEL</span>
</pre></div>
</div>
<p>Note that suite parameters should really be used to define family members
efficiently - see <a class="reference internal" href="#generating-tasks"><span class="std std-ref">Generating Tasks Automatically</span></a>.</p>
<p>Cylc provides tools to help make sense of your inheritance hierarchy:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">graph</span> <span class="pre">-n/--namespaces</span></code> - plot the full multiple
inheritance graph (not the dependency graph)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">get-config</span> <span class="pre">SUITE</span></code> - print selected sections or items
after inheritance processing</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">graph</span> <span class="pre">SUITE</span></code> - plot the dependency graph, with
collapsible first-parent families
(see <a class="reference internal" href="#task-families-and-visualization"><span class="std std-ref">Task Families And Visualization</span></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">list</span> <span class="pre">-t/--tree</span> <span class="pre">SUITE</span></code> - print the first-parent
inheritance hierarchy</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">list</span> <span class="pre">-m/--mro</span> <span class="pre">SUITE</span></code> - print the inheritance
precedence order for each runtime namespace</p></li>
</ul>
</div>
<div class="section" id="family-triggering">
<h3>Family Triggering<a class="headerlink" href="#family-triggering" title="Permalink to this headline">¶</a></h3>
<p>Task families can be used to simplify the scheduling graph wherever many
tasks need to trigger at once:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> pre =&gt; MODELS</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[MODELS]]</span>
    <span class="nt">[[model1, model2, model3, ...]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> MODELS</span>
</pre></div>
</div>
<p>To trigger <em>off of</em> many tasks at once, family names need to be qualified
by <code class="docutils literal notranslate"><span class="pre">&lt;state&gt;-all</span></code> or <code class="docutils literal notranslate"><span class="pre">&lt;state&gt;-any</span></code> to indicate the desired
member-triggering semantics:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;pre =&gt; MODELS</span>
<span class="s2">                MODELS:succeed-all =&gt; post&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Note that this can be simplified further because Cylc ignores trigger
qualifiers like <code class="docutils literal notranslate"><span class="pre">:succeed-all</span></code> on the right of trigger arrows
to allow chaining of dependencies:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> pre =&gt; MODELS:succeed-all =&gt; post</span>
</pre></div>
</div>
</div>
<div class="section" id="family-to-family-triggering">
<h3>Family-to-Family Triggering<a class="headerlink" href="#family-to-family-triggering" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> BIG_FAM_1:succeed-all =&gt; BIG_FAM_2</span>
</pre></div>
</div>
<p>This means every member of <code class="docutils literal notranslate"><span class="pre">BIG_FAM_2</span></code> depends on every member
of <code class="docutils literal notranslate"><span class="pre">BIG_FAM_1</span></code> succeeding. For very large families this can create so
many dependencies that it affects the performance of Cylc at run time, as
well as cluttering graph visualizations with unnecessary edges. Instead,
interpose a dummy task that signifies completion of the first family:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> BIG_FAM_1:succeed-all =&gt; big_fam_1_done =&gt; BIG_FAM_2</span>
</pre></div>
</div>
<p>For families with <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">N</span></code> members respectively, this
reduces the number of dependencies from <code class="docutils literal notranslate"><span class="pre">M*N</span></code> to <code class="docutils literal notranslate"><span class="pre">M+N</span></code>
without affecting the scheduling.</p>
<img alt="../_images/fam-to-fam-1.png" src="../_images/fam-to-fam-1.png" />
<img alt="../_images/fam-to-fam-2.png" src="../_images/fam-to-fam-2.png" />
</div>
<div class="section" id="task-families-and-visualization">
<span id="id4"></span><h3>Task Families And Visualization<a class="headerlink" href="#task-families-and-visualization" title="Permalink to this headline">¶</a></h3>
<p><em>First parents</em> in the inheritance hierarchy double as collapsible summary
groups for visualization and monitoring. Tasks should generally be grouped into
visualization families that reflect their logical purpose in the suite rather
than technical detail such as inherited job submission or host settings. So in
the example under <a class="reference internal" href="#sharing-by-inheritance"><span class="std std-ref">Sharing By Inheritance</span></a> above all
<code class="docutils literal notranslate"><span class="pre">obs&lt;n&gt;</span></code> tasks collapse into <code class="docutils literal notranslate"><span class="pre">OBSPROC</span></code> but not into
<code class="docutils literal notranslate"><span class="pre">SERIAL</span></code> or <code class="docutils literal notranslate"><span class="pre">PARALLEL</span></code>.</p>
<p>If necessary you can introduce new namespaces just for visualization:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[MODEL]]</span>
        <span class="c1"># (No settings here - just for visualization).</span>
    <span class="nt">[[model1, model2]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> MODEL, HOSTX</span>
    <span class="nt">[[model3, model4]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> MODEL, HOSTY</span>
</pre></div>
</div>
<p>To stop a solo parent being used in visualization, demote it to secondary with
a null parent like this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[SERIAL]]</span>
    <span class="nt">[[foo]]</span>
        <span class="c1"># Inherit settings from SERIAL but don&#39;t use it in visualization.</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> None, SERIAL</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="generating-tasks-automatically">
<span id="generating-tasks"></span><h2>Generating Tasks Automatically<a class="headerlink" href="#generating-tasks-automatically" title="Permalink to this headline">¶</a></h2>
<p>Groups of tasks that are closely related such as an ensemble of model runs or
a family of obs processing tasks, or sections of workflow that are repeated
with minor variations, can be generated automatically by iterating over
some integer range (e.g. <code class="docutils literal notranslate"><span class="pre">model&lt;n&gt;</span></code> for <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">=</span> <span class="pre">1..10</span></code>) or
list of strings (e.g. <code class="docutils literal notranslate"><span class="pre">obs&lt;type&gt;</span></code> for
<code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">=</span> <span class="pre">ship,</span> <span class="pre">buoy,</span> <span class="pre">radiosonde,</span> <span class="pre">...</span></code>).</p>
<div class="section" id="jinja2-loops">
<h3>Jinja2 Loops<a class="headerlink" href="#jinja2-loops" title="Permalink to this headline">¶</a></h3>
<p>Task generation was traditionally done in Cylc with explicit Jinja2 loops,
like this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># Task generation the old way: Jinja2 loops (NO LONGER RECOMMENDED!)</span>
<span class="cp">{% set PARAMS = range(1,11) %}</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="cp">{% for P in PARAMS %}</span><span class="s2"></span>
<span class="s2">      pre =&gt; model_p</span><span class="cp">{{P}}</span><span class="s2"> =&gt; post</span>
<span class="s2">      </span><span class="cp">{% if P == 5 %}</span><span class="s2"></span>
<span class="s2">          model_p</span><span class="cp">{{P}}</span><span class="s2"> =&gt; check</span>
<span class="s2">      </span><span class="cp">{% endif %}</span><span class="s2"></span>
<span class="cp">{% endfor %}</span><span class="s2">    &quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
<span class="cp">{% for P in PARAMS %}</span>
    <span class="nt">[[model_p</span><span class="cp">{{P}}</span><span class="nt">]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> echo &quot;my parameter value is </span><span class="cp">{{P}}</span><span class="s">&quot;</span>
    <span class="cp">{% if P == 1 %}</span>
        <span class="c1"># special case...</span>
    <span class="cp">{% endif %}</span>
<span class="cp">{% endfor %}</span>
</pre></div>
</div>
<p>Unfortunately this makes a mess of the suite definition, particularly the
scheduling graph, and it gets worse with nested loops over multiple parameters.</p>
<img alt="../_images/param-1.png" src="../_images/param-1.png" />
</div>
<div class="section" id="parameterized-tasks">
<span id="sdg-parameterized-tasks"></span><h3>Parameterized Tasks<a class="headerlink" href="#parameterized-tasks" title="Permalink to this headline">¶</a></h3>
<p>Cylc-6.11 introduced built-in <em>suite parameters</em> for generating tasks
without destroying the clarity of the base suite definition. Here’s the same
example using suite parameters instead of Jinja2 loops:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># Task generation the new way: suite parameters.</span>
<span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">p </span><span class="o">=</span><span class="s"> 1..10</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;pre =&gt; model&lt;p&gt; =&gt; post</span>
<span class="s2">                model&lt;p=5&gt; =&gt; check&quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[model</span>&lt;<span class="nb">p</span>&gt;<span class="nt">]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> echo &quot;my parameter value is ${CYLC_TASK_PARAM_p}&quot;</span>
    <span class="nt">[[model</span>&lt;<span class="nb">p=7</span>&gt;<span class="nt">]]</span>
        <span class="c1"># special case ...</span>
</pre></div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">model&lt;p&gt;</span></code> expands to <code class="docutils literal notranslate"><span class="pre">model_p7</span></code> for <code class="docutils literal notranslate"><span class="pre">p=7</span></code>,
and so on, via the default expansion template for integer-valued parameters,
but custom templates can be defined if necessary. Parameters can also be
defined as lists of strings, and you can define dependencies between different
values: <code class="docutils literal notranslate"><span class="pre">chunk&lt;p-1&gt;</span> <span class="pre">=&gt;</span> <span class="pre">chunk&lt;p&gt;</span></code>.  Here’s a multi-parameter example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">run </span><span class="o">=</span><span class="s"> a, b, c</span>
        <span class="nv">m </span><span class="o">=</span><span class="s"> 1..5</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> pre =&gt; init&lt;run&gt; =&gt; sim&lt;run,m&gt; =&gt; close&lt;run&gt; =&gt; post</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[sim</span>&lt;<span class="nb">run,m</span>&gt;<span class="nt">]]</span>
</pre></div>
</div>
<img alt="../_images/param-2.png" src="../_images/param-2.png" />
<p>If family members are defined by suite parameters, then parameterized
trigger expressions are equivalent to family <code class="docutils literal notranslate"><span class="pre">:&lt;state&gt;-all</span></code> triggers.
For example, this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">n </span><span class="o">=</span><span class="s"> 1..5</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> pre =&gt; model&lt;n&gt; =&gt; post</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[MODELS]]</span>
    <span class="nt">[[model</span>&lt;<span class="nb">n</span>&gt;<span class="nt">]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> MODELS</span>
</pre></div>
</div>
<p>is equivalent to this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">n </span><span class="o">=</span><span class="s"> 1..5</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span><span class="s"> pre =&gt; MODELS:succeed-all =&gt; post</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[MODELS]]</span>
    <span class="nt">[[model</span>&lt;<span class="nb">n</span>&gt;<span class="nt">]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> MODELS</span>
</pre></div>
</div>
<p>(but future plans for family triggering may make the second case more
efficient for very large families).</p>
<p>For more information on parameterized tasks see the Cylc user guide.</p>
</div>
</div>
<div class="section" id="optional-app-config-files">
<span id="id5"></span><h2>Optional App Config Files<a class="headerlink" href="#optional-app-config-files" title="Permalink to this headline">¶</a></h2>
<p>Closely related tasks with few configuration differences between them - such as
multiple UM forecast and reconfiguration apps in the same suite - should use
the same Rose app configuration with the differences supplied by optional
configs, rather than duplicating the entire app for each task.</p>
<p>Optional app configs should be valid on top of the main app config and not
dependent on the use of other optional app configs. This ensures they will
work correctly with macros and can therefore be upgraded automatically.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Currently optional configs don’t work very well with UM STASH
configuration - see <a class="reference internal" href="roadmap.html#um-stash-in-optional-app-configs"><span class="std std-ref">UM STASH in Optional App Configs</span></a>.</p>
</div>
<p>Optional app configs can be loaded by command line switch:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rose task-run -O key1 -O key2
</pre></div>
</div>
<p>or by environment variable:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">ROSE_APP_OPT_CONF_KEYS</span> <span class="o">=</span> key1 key2
</pre></div>
</div>
<p>The environment variable is generally preferred in suites because you don’t
have to repeat and override the root-level script configuration:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> rose task-run -v</span>
    <span class="nt">[[foo]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">ROSE_APP_OPT_CONF_KEYS </span><span class="o">=</span><span class="s"> key1 key2</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="portable-suites.html" class="btn btn-neutral float-right" title="Portable Suites" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="general-principles.html" class="btn btn-neutral float-left" title="Basic Principles" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2008-2020 NIWA &amp; British Crown (Met Office) &amp; Contributors
      <span class="lastupdated">
        Last updated on Aug 11, 2020.
      </span>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  <!--
  element which gets populated with the list of available versions and
  formats for the documentation by versions.js
-->
<div
  class="rst-versions"
  data-toggle="rst-versions"
  id='versions-and-formats'
></div>



<script type="text/javascript">
    const CUR_FORMAT = "html";
    const CUR_VERSION = "nightly.2020-08-11";
    // name of page (in URL), for singlepage builds this will be `index`
    const PAGE_NAME = "suite-design-guide/efficiency";
    // URL path to the base docs dir i.e. ROOT_DIR/version/format
    const ROOT_DIR = "../../..";
</script>

<script
  type="text/javascript"
  src="../../../versions.js"
></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>