<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Task Job Polling &mdash; Cylc 8.0b3 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/diff_selector.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/grid_table.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/hieroglyph_theme_addons.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/tutorial.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/addons.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/cylc-favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/js/diff_selector.js"></script>
        <script src="../../_static/js/minicylc.js"></script>
        <script src="../../_static/js/spoiler.js"></script>
        <script src="../../_static/js/addons.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Client-Server Interaction" href="authentication-files.html" />
    <link rel="prev" title="Workflow Completion" href="workflow-completion.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html">
            <img src="../../_static/cylc-logo-white.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                8.0b3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../7-to-8/index.html">Cylc 8 Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction/index.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writing-workflows/index.html">Writing Workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installing-workflows.html">Installing Workflows</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Running Workflows</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="scheduler-start-up.html">Start, Restart, Reload</a></li>
<li class="toctree-l3"><a class="reference internal" href="task-job-states.html">Task &amp; Job States</a></li>
<li class="toctree-l3"><a class="reference internal" href="tasks-jobs-ui.html">Tasks in the UI</a></li>
<li class="toctree-l3"><a class="reference internal" href="reflow.html">Flows &amp; Reflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="retrying-tasks.html">Retrying Tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="workflow-completion.html">Workflow Completion</a></li>
<li class="toctree-l3"><a class="reference internal" href="workflow-completion.html#workflow-stall">Workflow Stall</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Task Job Polling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#routine-polling">Routine Polling</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tracking-job-status">Tracking Job Status</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tcp-task-messaging">TCP Task Messaging</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ssh-task-communication">SSH Task Communication</a></li>
<li class="toctree-l4"><a class="reference internal" href="#polling-to-track-job-status">Polling to Track Job Status</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="authentication-files.html">Client-Server Interaction</a></li>
<li class="toctree-l3"><a class="reference internal" href="authentication-files.html#authentication-files">Authentication Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="simulation-modes.html">Simulating Workflow Behaviour</a></li>
<li class="toctree-l3"><a class="reference internal" href="scheduler-log-files.html">Workflow Server Logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="external-command-execution.html">External Command Execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="handling-job-preemption.html">Handling Job Preemption</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamic-behaviour.html">Cylc Broadcast</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamic-behaviour.html#sub-workflows">Sub-Workflows</a></li>
<li class="toctree-l3"><a class="reference internal" href="workflow-databases.html">Workflow Run Databases</a></li>
<li class="toctree-l3"><a class="reference internal" href="workflow-migration.html">Auto Stop-Restart</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../task-implementation/index.html">Task Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../removing-workflows.html">Removing Workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sharing-access-to-workflows.html">Authorizing Others to Access Your Workflows</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/index.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../workflow-design-guide/index.html">Workflow Design Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Cylc</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">User Guide</a> &raquo;</li>
          <li><a href="index.html">Running Workflows</a> &raquo;</li>
      <li>Task Job Polling</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/user-guide/running-workflows/tracking-task-state.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="task-job-polling">
<span id="id1"></span><h1>Task Job Polling<a class="headerlink" href="#task-job-polling" title="Permalink to this headline"></a></h1>
<p>At any point after job submission, task jobs can be <em>polled</em> to check that
their true state matches what scheduler expects based on received job status
messages or previous polls.</p>
<p>Polling may be necessary if, for example, a task job gets killed by the
untrappable SIGKILL signal (e.g. <code class="docutils literal notranslate"><span class="pre">kill</span> <span class="pre">-9</span> <span class="pre">PID</span></code>), or after a network
outage that prevents job status messages getting back to the scheduler, or if
the <a class="reference internal" href="../../glossary.html#term-scheduler"><span class="xref std std-term">scheduler</span></a> itself was down when active task jobs finished.</p>
<p>To poll a job the <a class="reference internal" href="../../glossary.html#term-scheduler"><span class="xref std std-term">scheduler</span></a> interrogates the <a class="reference internal" href="../../glossary.html#term-job-runner"><span class="xref std std-term">job runner</span></a>, and
the <code class="docutils literal notranslate"><span class="pre">job.status</span></code> file of the task, on the job host. This information is
enough to determine correct task status even if the job finished while the
<a class="reference internal" href="../../glossary.html#term-scheduler"><span class="xref std std-term">scheduler</span></a> was down or unreachable on the network.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">poll</span> <span class="pre">--help</span></code></p></li>
</ul>
</div>
<section id="routine-polling">
<h2>Routine Polling<a class="headerlink" href="#routine-polling" title="Permalink to this headline"></a></h2>
<p>Task jobs are automatically polled at certain times: once on job submission
timeout; several times on exceeding the job execution time limit; and at
workflow restart any tasks recorded as active are polled to find out what
happened to them while the workflow was down.</p>
<p>Routine polling can also be configured as a way to track job status on platforms
that do not allow routing back to the workflow host for task messaging by TCP
or SSH. See <a class="reference internal" href="#polling-to-track-job-status"><span class="std std-ref">Polling to Track Job Status</span></a>.</p>
</section>
</section>
<section id="tracking-job-status">
<span id="taskcomms"></span><h1>Tracking Job Status<a class="headerlink" href="#tracking-job-status" title="Permalink to this headline"></a></h1>
<p>Cylc supports three ways of tracking task state on job hosts:</p>
<ul class="simple">
<li><p>task-to-scheduler messaging via TCP (using ZMQ protocol)</p></li>
<li><p>task-to-scheduler messaging via non-interactive SSH to the workflow host, then
local TCP.</p></li>
<li><p>regular polling by the <a class="reference internal" href="../../glossary.html#term-scheduler"><span class="xref std std-term">scheduler</span></a></p></li>
</ul>
<p>These can be configured per platform using
<a class="reference internal" href="../../reference/config/global.html#global.cylc[platforms][&lt;platform name&gt;]communication method" title="global.cylc[platforms][&lt;platform name&gt;]communication method"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">global.cylc[platforms][&lt;platform</span> <span class="pre">name&gt;]communication</span> <span class="pre">method</span></code></a>.</p>
<p>If your site prohibits TCP and SSH back from job hosts to workflow hosts,
before resorting to the polling method you should consider installing dedicated
Cylc servers or VMs inside the HPC trust zone (where TCP and SSH should be
allowed).</p>
<p>It is possible to run Cylc <a class="reference internal" href="../../glossary.html#term-scheduler"><span class="xref std std-term">schedulers</span></a> on HPC login nodes,
but be aware of scheduler resource requirements (which depend on workflow size
and run duration).</p>
<p>Port forwarding could potentially provide another solution, but the idea has
been rejected at this stage. Organisations often disable port forwarding for
security reasons.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Use Cylc 8 platform configuration via
<a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime][&lt;namespace&gt;]platform" title="flow.cylc[runtime][&lt;namespace&gt;]platform"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">flow.cylc[runtime][&lt;namespace&gt;]platform</span></code></a>, not the
deprecated <code class="docutils literal notranslate"><span class="pre">host</span></code> setting, to ensure the intended task communication
method is applied.</p>
</div>
<section id="tcp-task-messaging">
<h2>TCP Task Messaging<a class="headerlink" href="#tcp-task-messaging" title="Permalink to this headline"></a></h2>
<p>Task job wrappers automatically invoke <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">message</span></code> to report
progress back to the <a class="reference internal" href="../../glossary.html#term-scheduler"><span class="xref std std-term">scheduler</span></a> when they begin executing,
at normal exit (success) and abnormal exit (failure).</p>
<p>By default job status messaging goes by an authenticated TCP connection to the
<a class="reference internal" href="../../glossary.html#term-scheduler"><span class="xref std std-term">scheduler</span></a>, using the ZMQ protocol.  This is the preferred task
communications method because it is efficient and direct.</p>
<p>Schedulers automatically install workflow <a class="reference internal" href="../../glossary.html#term-contact-file"><span class="xref std std-term">contact information</span></a> and credentials on job hosts.</p>
</section>
<section id="ssh-task-communication">
<h2>SSH Task Communication<a class="headerlink" href="#ssh-task-communication" title="Permalink to this headline"></a></h2>
<p>Cylc can be configured to re-invoke task messaging commands on the workflow
host via non-interactive SSH (from job platform to workflow host).</p>
<p>User-invoked client commands also support this communication method, when
<a class="reference internal" href="../../reference/config/global.html#global.cylc[platforms][&lt;platform name&gt;]communication method" title="global.cylc[platforms][&lt;platform name&gt;]communication method"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">global.cylc[platforms][&lt;platform</span> <span class="pre">name&gt;]communication</span> <span class="pre">method</span></code></a> is
configured to <code class="docutils literal notranslate"><span class="pre">ssh</span></code>.</p>
<p>This is less efficient than direct ZMQ protocol messaging, but it may be useful at
sites where the ZMQ ports are blocked but non-interactive SSH is allowed.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Ensure SSH keys are in place for the remote task platform(s) before enabling
this feature. Failure to do so, will result in <code class="docutils literal notranslate"><span class="pre">Host</span> <span class="pre">key</span> <span class="pre">verification</span>
<span class="pre">failed</span></code> errors.</p>
</div>
</section>
<section id="polling-to-track-job-status">
<span id="id2"></span><h2>Polling to Track Job Status<a class="headerlink" href="#polling-to-track-job-status" title="Permalink to this headline"></a></h2>
<p>Schedulers can actively poll task jobs at configured intervals, via
non-interactive SSH to the job platform.</p>
<p>This is the least efficient communication method because task status updates
are delayed by up to the polling interval. However, it may be needed at sites
that do not allow TCP or non-interactive SSH from job host to workflow host.</p>
<p>Be careful to avoid spamming task hosts with polling operations. Each poll
opens (and then closes) a new SSH connection.</p>
<p>Polling intervals are configurable under <a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime]" title="flow.cylc[runtime]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[runtime]</span></code></a> because they
may depend on expected job execution time. You may want to poll a job
frequently at first, to check that it started running properly; frequently
near the expected end of its run time, to get a timely task finished update;
and infrequently between times. Configured intervals are used in sequence until
the last value, which is used repeatedly until the job is finished:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="c1"># poll every minute in the &#39;submitted&#39; state:</span>
        <span class="nv">submission polling intervals </span><span class="o">=</span><span class="s"> PT1M</span>

        <span class="c1"># poll one minute after foo starts running, then every 10</span>
        <span class="c1"># minutes for 50 minutes, then every minute until finished:</span>
        <span class="nv">execution polling intervals </span><span class="o">=</span><span class="s"> PT1M, 5*PT10M, PT1M</span>
</pre></div>
</div>
<p>A list of intervals with optional multipliers can be used for both submission
and execution polling, although a single value is probably sufficient for
submission. If these items are not configured, default values from
site and user global config will be used for
<a class="reference internal" href="../../reference/config/global.html#global.cylc[platforms][&lt;platform name&gt;]communication method" title="global.cylc[platforms][&lt;platform name&gt;]communication method"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">communication</span> <span class="pre">method=polling</span></code></a>.</p>
<p>Polling is not done by default under the other task communications methods, but
it can be configured as well if you like.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="workflow-completion.html" class="btn btn-neutral float-left" title="Workflow Completion" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="authentication-files.html" class="btn btn-neutral float-right" title="Client-Server Interaction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2008-2021 NIWA &amp; British Crown (Met Office) &amp; Contributors.
      <span class="lastupdated">Last updated on Dec 02, 2021.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <!--
  element which gets populated with the list of available versions and
  formats for the documentation by versions.js
-->
<div
  class="rst-versions"
  data-toggle="rst-versions"
  id='versions-and-formats'
></div>



<script type="text/javascript">
    const CUR_FORMAT = "html";
    const CUR_VERSION = "8.0b3";
    // name of page (in URL), for singlepage builds this will be `index`
    const PAGE_NAME = "user-guide/running-workflows/tracking-task-state";
    // URL path to the base docs dir i.e. ROOT_DIR/version/format
    const ROOT_DIR = "../../../..";
</script>

<script
  type="text/javascript"
  src="../../../../versions.js"
></script><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>