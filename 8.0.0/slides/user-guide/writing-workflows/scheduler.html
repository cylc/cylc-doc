<!DOCTYPE html>


<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Scheduler Configuration &mdash; Cylc 8.0.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/styles.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/single.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <link rel="stylesheet" href="../../_static/css/slides-custom.css" type="text/css" />
    
    
    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/single.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/diff_selector.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/grid_table.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/hieroglyph_theme_addons.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/tutorial.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/addons.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '8.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/js/diff_selector.js"></script>
    <script type="text/javascript" src="../../_static/js/minicylc.js"></script>
    <script type="text/javascript" src="../../_static/js/spoiler.js"></script>
    <script type="text/javascript" src="../../_static/js/addons.js"></script>
    <script type="text/javascript" src="../../_static/common.js"></script>
    
    <script type="text/javascript" src="../../_static/slides.js"></script>
    <script type="text/javascript" src="../../_static/sync.js"></script>
    <script type="text/javascript" src="../../_static/controller.js"></script>
    <script type="text/javascript" src="../../_static/init.js"></script>
    
    
    <link rel="shortcut icon" href="../../_static/cylc-favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="top" title="Cylc 8.0.0 documentation" href="../../index.html" />
    <link rel="up" title="Writing Workflows" href="index.html" />
    <link rel="next" title="Installing Workflows" href="../installing-workflows.html" />
    <link rel="prev" title="Suicide Triggers" href="suicide-triggers.html" /> 
  </head>
  <body>

<section
   id="slide_container"
   class='slides layout-regular'>


  
<article class="slide level-1" id="scheduler-configuration">

<h1>Scheduler Configuration<a class="headerlink" href="../../../html/user-guide/writing-workflows/scheduler.html#scheduler-configuration" title="View HTML">§</a></h1>

<p>The <a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[scheduler]" title="flow.cylc[scheduler]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">flow.cylc[scheduler]</span></code></a> section configures certain aspects of
<a class="reference internal" href="../../glossary.html#term-scheduler"><span class="xref std std-term">scheduler</span></a> behaviour at the workflow level.</p>
<p>Many of these configurations can also be defined at the site or user level in
the <a class="reference internal" href="../../reference/config/global.html#global.cylc[scheduler]" title="global.cylc[scheduler]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">global.cylc[scheduler]</span></code></a> section where it applies to all
workflows.</p>




</article>
<article class="slide level-2" id="event-handlers">

<h2>Event handlers<a class="headerlink" href="../../../html/user-guide/writing-workflows/scheduler.html#event-handlers" title="View HTML">§</a></h2>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Workflow event handlers are configured by:</p>
<ul class="last simple">
<li><a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[scheduler][events]" title="flow.cylc[scheduler][events]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">flow.cylc[scheduler][events]</span></code></a></li>
<li><a class="reference internal" href="../../reference/config/global.html#global.cylc[scheduler][events]" title="global.cylc[scheduler][events]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">global.cylc[scheduler][events]</span></code></a></li>
</ul>
</div>
<p>Workflow event handlers allow configurable actions to be performed when
workflow events occur.</p>




</article>
<article class="slide level-3" id="workflow-events">

<h3>Workflow Events<a class="headerlink" href="../../../html/user-guide/writing-workflows/scheduler.html#workflow-events" title="View HTML">§</a></h3>

<p>The list of events is:</p>
<dl class="docutils">
<dt>startup</dt><dd>The scheduler started running the workflow.</dd>
<dt>shutdown</dt><dd>The workflow finished and the scheduler will shut down.</dd>
<dt>abort</dt><dd>The scheduler shut down early with error status, due to a fatal error
condition or a configured timeout.</dd>
<dt>workflow timeout</dt><dd>The workflow run timed out.</dd>
<dt>stall</dt><dd>The workflow stalled.</dd>
<dt>stall timeout</dt><dd>The workflow timed out after stalling.</dd>
<dt>inactivity timeout</dt><dd>The workflow timed out with no activity.</dd>
</dl>
<p>You can tell the scheduler to abort (i.e., shut down immediately with error
status) on certain workflow events, with the following settings:</p>
<ul class="simple">
<li>abort on stall timeout</li>
<li>abort on inactivity timeout</li>
<li>abort on workflow timeout</li>
</ul>




</article>
<article class="slide level-3" id="mail-events">

<h3>Mail Events<a class="headerlink" href="../../../html/user-guide/writing-workflows/scheduler.html#mail-events" title="View HTML">§</a></h3>

<p>Cylc can send emails for workflow events, these are configured by
<a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[scheduler][events]mail events" title="flow.cylc[scheduler][events]mail events"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">flow.cylc[scheduler][events]mail</span> <span class="pre">events</span></code></a>.</p>
<p>For example with the following configuration, emails will be sent if a
scheduler stalls or shuts down for an unexpected reason.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduler]</span>
    <span class="nt">[[events]]</span>
        <span class="nv">mail events </span><span class="o">=</span><span class="s"> stall, abort</span>
</pre></div>
</div>
<p>Email addresses and servers are configured by
<a class="reference internal" href="../../reference/config/global.html#global.cylc[scheduler][mail]" title="global.cylc[scheduler][mail]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">global.cylc[scheduler][mail]</span></code></a>.</p>
<p>Workflow event emails can be customised using
<a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[scheduler][mail]footer" title="flow.cylc[scheduler][mail]footer"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">flow.cylc[scheduler][mail]footer</span></code></a>,
<a class="reference internal" href="#workflow-event-template-variables"><span class="std std-ref">Workflow Event Template Variables</span></a> can be used.</p>
<p>For example to integrate with the Cylc 7 web interface (Cylc Review) the mail
footer could be configured with a URL:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduler]</span>
    <span class="nt">[[events]]</span>
        <span class="nv">mail footer </span><span class="o">=</span><span class="s"> http://cylc-review/taskjobs/%(owner)s/?suite=%(workflow)s</span>
</pre></div>
</div>




</article>
<article class="slide level-3" id="custom-event-handlers">

<h3>Custom Event Handlers<a class="headerlink" href="../../../html/user-guide/writing-workflows/scheduler.html#custom-event-handlers" title="View HTML">§</a></h3>

<p>Cylc can also be configured to invoke scripts on workflow events.</p>
<p>Event handler scripts can be stored in the workflow <code class="docutils literal notranslate"><span class="pre">bin</span></code> directory, or
anywhere in <code class="docutils literal notranslate"><span class="pre">$PATH</span></code> in the <a class="reference internal" href="../../glossary.html#term-scheduler"><span class="xref std std-term">scheduler</span></a> environment.</p>
<p>They should return quickly to avoid tying up the scheduler process pool -
see <a class="reference internal" href="#managing-external-command-execution"><span class="std std-ref">External Command Execution</span></a>.</p>
<p>Contextual information can be passed to the event handler via
<a class="reference internal" href="#workflow-event-template-variables"><span class="std std-ref">Workflow Event Template Variables</span></a>.</p>
<p>For example the following configuration will write some information to a file
when a workflow is started:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">~/cylc-run/&lt;workflow-id&gt;/bin/my-handler</span></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nb">echo</span> <span class="s2">&quot;Workflow </span><span class="nv">$1</span><span class="s2"> is running on </span><span class="nv">$2</span><span class="s2">:</span><span class="nv">$3</span><span class="s2">&quot;</span> &gt; info
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">flow.cylc or global.cylc</span></div>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduler]</span>
    <span class="nt">[[events]]</span>
        <span class="nv">startup handlers </span><span class="o">=</span><span class="s"> my-handler %(workflow)s %(host) %(port)</span>
</pre></div>
</div>
</div>




</article>
<article class="slide level-3" id="workflow-event-template-variables">

<h3>Workflow Event Template Variables<a class="headerlink" href="../../../html/user-guide/writing-workflows/scheduler.html#workflow-event-template-variables" title="View HTML">§</a></h3>

<dl>
<p>The following variables are available to workflow event handlers.</p>
<p>They can be templated into event handlers with Python percent style string
formatting e.g:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>%(workflow)s is running on %(host)s
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Substitution patterns should not be quoted in the template strings.
This is done automatically where required.</p>
</div>
<p>For an explanation of the substitution syntax, see
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#printf-style-string-formatting">String Formatting Operations in the Python documentation</a>.</p>
<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">event</span></code></dt>
<dd><p>The type of workflow event that has occurred e.g. <code class="docutils literal notranslate"><span class="pre">stall</span></code>.</p>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">message</span></code></dt>
<dd><p>Additional information about the event.</p>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">workflow</span></code></dt>
<dd><p>The workflow ID</p>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">host</span></code></dt>
<dd><p>The host where the workflow is running.</p>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">port</span></code></dt>
<dd><p>The port where the workflow is running.</p>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">owner</span></code></dt>
<dd><p>The user account under which the workflow is running.</p>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">uuid</span></code></dt>
<dd><p>The unique identification string for this workflow run.</p>
<p>This string is preserved for the lifetime of the scheduler and is restored
from the database on restart.</p>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">workflow_url</span></code></dt>
<dd><p>The URL defined in <a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[meta]URL" title="flow.cylc[meta]URL"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">flow.cylc[meta]URL</span></code></a>.</p>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">suite</span></code></dt>
<dd><p>The workflow ID</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 8.0.0: </span>Use “workflow”.</p>
</div>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">suite_uuid</span></code></dt>
<dd><p>The unique identification string for this workflow run.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 8.0.0: </span>Use “uuid_str”.</p>
</div>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">suite_url</span></code></dt>
<dd><p>The URL defined in <a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[meta]URL" title="flow.cylc[meta]URL"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">flow.cylc[meta]URL</span></code></a>.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 8.0.0: </span>Use “workflow_url”.</p>
</div>
</dd></dl>

</dl>





</article>
<article class="slide level-2" id="external-command-execution">

<h2>External Command Execution<a class="headerlink" href="../../../html/user-guide/writing-workflows/scheduler.html#external-command-execution" title="View HTML">§</a></h2>

<p>Job submission commands, event handlers, and job poll and kill commands, are
executed by the <a class="reference internal" href="../../glossary.html#term-scheduler"><span class="xref std std-term">scheduler</span></a> in a subprocess pool. The pool is size can
be configured with <a class="reference internal" href="../../reference/config/global.html#global.cylc[scheduler]process pool size" title="global.cylc[scheduler]process pool size"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">global.cylc[scheduler]process</span> <span class="pre">pool</span> <span class="pre">size</span></code></a>.</p>
<p>Event handlers should be lightweight and quick-running because they tie up
a process pool member until complete, and the workflow will appear to stall if
the pool is saturated with long-running processes.</p>
<p>To protect the scheduler, processes are killed on a timeout
(<a class="reference internal" href="../../reference/config/global.html#global.cylc[scheduler]process pool timeout" title="global.cylc[scheduler]process pool timeout"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">global.cylc[scheduler]process</span> <span class="pre">pool</span> <span class="pre">timeout</span></code></a>). This will be
logged by the <a class="reference internal" href="../../glossary.html#term-scheduler"><span class="xref std std-term">scheduler</span></a>. If a job submission gets killed, the
associated task goes to the <code class="docutils literal notranslate"><span class="pre">submit-failed</span></code> state.</p>




</article>
<article class="slide level-2" id="submitting-workflows-to-a-pool-of-hosts">

<h2>Submitting Workflows To a Pool Of Hosts<a class="headerlink" href="../../../html/user-guide/writing-workflows/scheduler.html#submitting-workflows-to-a-pool-of-hosts" title="View HTML">§</a></h2>

<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Configured by:</th><td class="field-body"><a class="reference internal" href="../../reference/config/global.html#global.cylc[scheduler][run hosts]" title="global.cylc[scheduler][run hosts]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">global.cylc[scheduler][run</span> <span class="pre">hosts]</span></code></a>.</td>
</tr>
</tbody>
</table>
<p>By default <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">play</span></code> will run workflows on the machine where the command
was invoked.</p>
<p>Cylc supports configuring a pool of hosts for workflows to run on,
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">play</span></code> will automatically pick a host and submit the workflow to it.</p>




</article>
<article class="slide level-3" id="host-pool">

<h3>Host Pool<a class="headerlink" href="../../../html/user-guide/writing-workflows/scheduler.html#host-pool" title="View HTML">§</a></h3>

<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Configured by:</th><td class="field-body"><a class="reference internal" href="../../reference/config/global.html#global.cylc[scheduler][run hosts]available" title="global.cylc[scheduler][run hosts]available"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">global.cylc[scheduler][run</span> <span class="pre">hosts]available</span></code></a>.</td>
</tr>
</tbody>
</table>
<p>The hosts must:</p>
<ol class="arabic simple">
<li>Share a common <code class="docutils literal notranslate"><span class="pre">$HOME</span></code> directory and therefore a common file system
(with each other and anywhere the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">play</span></code> command is run).</li>
<li>Share a common Cylc global config (<a class="reference internal" href="../../reference/config/global.html#global.cylc" title="global.cylc"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">global.cylc</span></code></a>).</li>
<li>Be set up to allow passwordless SSH between them.</li>
</ol>
<p>Example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduler]</span>
    <span class="nt">[[run hosts]]</span>
        <span class="nv">available </span><span class="o">=</span><span class="s"> host_1, host_2, host_3</span>
</pre></div>
</div>




</article>
<article class="slide level-3" id="load-balancing">

<h3>Load Balancing<a class="headerlink" href="../../../html/user-guide/writing-workflows/scheduler.html#load-balancing" title="View HTML">§</a></h3>

<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Configured by:</th><td class="field-body"><a class="reference internal" href="../../reference/config/global.html#global.cylc[scheduler][run hosts]ranking" title="global.cylc[scheduler][run hosts]ranking"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">global.cylc[scheduler][run</span> <span class="pre">hosts]ranking</span></code></a>.</td>
</tr>
</tbody>
</table>
<p>Cylc can balance the load on the configured “run hosts” by ranking them in
order of available resource or by excluding hosts which fail to meet certain
criterion.</p>
<p>Example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduler]</span>
    <span class="nt">[[run hosts]]</span>
        <span class="nv">available </span><span class="o">=</span><span class="s"> host_1, host_2, host_3</span>
        <span class="nv">ranking </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
            <span class="c1"># filter out hosts with high server load</span><span class="s2"></span>
<span class="s2">            getloadavg()[2] &lt; 5</span>

            <span class="c1"># pick the host with the most available memory</span><span class="s2"></span>
<span class="s2">            virtual_memory().available</span>
<span class="s2">        &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>For more information see <a class="reference internal" href="../../reference/config/global.html#global.cylc[scheduler][run hosts]ranking" title="global.cylc[scheduler][run hosts]ranking"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">global.cylc[scheduler][run</span> <span class="pre">hosts]ranking</span></code></a>.</p>




</article>
<article class="slide level-3" id="workflow-migration">

<h3>Workflow Migration<a class="headerlink" href="../../../html/user-guide/writing-workflows/scheduler.html#workflow-migration" title="View HTML">§</a></h3>

<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Configured by:</th><td class="field-body"><a class="reference internal" href="../../reference/config/global.html#global.cylc[scheduler][run hosts]condemned" title="global.cylc[scheduler][run hosts]condemned"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">global.cylc[scheduler][run</span> <span class="pre">hosts]condemned</span></code></a>.</td>
</tr>
</tbody>
</table>
<p>Cylc has the ability to automatically stop workflows running on a particular
host and optionally, restart them on a different host. This can be useful if a
host needs to be taken off-line, e.g. for scheduled maintenance.</p>
<p>Example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduler]</span>
    <span class="nt">[[run hosts]]</span>
        <span class="nv">available </span><span class="o">=</span><span class="s"> host_1, host_2, host_3</span>
        <span class="c1"># tell workflows on host_1 to move to another available host</span>
        <span class="nv">condemned </span><span class="o">=</span><span class="s"> host_1</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This feature requires the <a class="reference internal" href="../../reference/config/global.html#global.cylc[scheduler][main loop][auto restart]" title="global.cylc[scheduler][main loop][auto restart]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[auto</span> <span class="pre">restart]</span></code></a>
plugin to be enabled, e.g. in the configured list of
<a class="reference internal" href="../../reference/config/global.html#global.cylc[scheduler][main loop]plugins" title="global.cylc[scheduler][main loop]plugins"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">plugins</span></code></a>.</p>
</div>
<p>For more information see: <a class="reference internal" href="../../reference/config/global.html#global.cylc[scheduler][run hosts]ranking" title="global.cylc[scheduler][run hosts]ranking"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">global.cylc[scheduler][run</span> <span class="pre">hosts]ranking</span></code></a>.</p>




</article>

</section>

<section id="slide_notes">

</section>

  </body>
</html>