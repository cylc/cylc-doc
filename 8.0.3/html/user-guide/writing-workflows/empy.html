<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EmPy &mdash; Cylc 8.0.3 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/diff_selector.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/grid_table.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/hieroglyph_theme_addons.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/tutorial.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/addons.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/cylc-favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/js/diff_selector.js"></script>
        <script src="../../_static/js/minicylc.js"></script>
        <script src="../../_static/js/spoiler.js"></script>
        <script src="../../_static/js/addons.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="External Triggers" href="external-triggers.html" />
    <link rel="prev" title="Jinja2" href="jinja2.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html">
            <img src="../../_static/cylc-logo-white.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                8.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../7-to-8/index.html">Cylc 8 Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Writing Workflows</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="configuration.html">Workflow Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="scheduling.html">Scheduling Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="runtime.html">Task Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="parameterized-tasks.html">Task Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="jinja2.html">Jinja2</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">EmPy</a></li>
<li class="toctree-l3"><a class="reference internal" href="external-triggers.html">External Triggers</a></li>
<li class="toctree-l3"><a class="reference internal" href="suicide-triggers.html">Suicide Triggers</a></li>
<li class="toctree-l3"><a class="reference internal" href="scheduler.html">Scheduler Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../installing-workflows.html">Installing Workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../running-workflows/index.html">Running Workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../task-implementation/index.html">Task Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../removing-workflows.html">Removing Workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sharing-access-to-workflows.html">Authorizing Others to Access Your Workflows</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/index.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../workflow-design-guide/index.html">Workflow Design Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Cylc</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">User Guide</a></li>
          <li class="breadcrumb-item"><a href="index.html">Writing Workflows</a></li>
      <li class="breadcrumb-item active">EmPy</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/user-guide/writing-workflows/empy.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="empy">
<span id="user-guide-empy"></span><h1>EmPy<a class="headerlink" href="#empy" title="Permalink to this heading"></a></h1>
<p>Cylc also supports the EmPy template processor in workflow configurations.
Like <a class="reference internal" href="jinja2.html#user-guide-jinja2"><span class="std std-ref">Jinja2</span></a>, EmPy provides variables, mathematical
expressions, loop control structures, conditional logic, etc., that gets
expanded to generate the final workflow configuration seen - which must must be
valid Cylc syntax. See <a class="reference external" href="https://pypi.org/project/empy/">EmPy</a> documentation
for details of its templating features and how to use them.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>EmPy is not included in the standard Cylc installation. If installing
with <code class="docutils literal notranslate"><span class="pre">pip</span></code> run <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">cylc-flow[empy]</span></code> to install it.</p>
</div>
<p>To enable EmPy place an <code class="docutils literal notranslate"><span class="pre">empy</span></code> hash-bang comment on the first line of
the <code class="docutils literal notranslate"><span class="pre">flow.cylc</span></code> file:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="ch">#!empy</span>
</pre></div>
</div>
<p>As an example, here is the “cities” workflow from the previous section,
implemented with Empy instead of Jinja2.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1">#!EmPy</span>
<span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;EmPy city workflow example.&quot;</span>
    <span class="nv">description </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Illustrates use of variables and math expressions, and programmatic</span>
<span class="s2">        generation of groups of related dependencies and runtime properties.</span>
<span class="s2">    &quot;&quot;&quot;</span>

<span class="nt">[scheduler]</span>
    <span class="nv">allow implicit tasks </span><span class="o">=</span><span class="s"> True</span>

<span class="cp">@{</span>
<span class="cp">HOST = &quot;SuperComputer&quot;</span>
<span class="cp">CITIES = &#39;NewYork&#39;, &#39;Philadelphia&#39;, &#39;Newark&#39;, &#39;Houston&#39;, &#39;SantaFe&#39;, &#39;Chicago&#39;</span>
<span class="cp">CITYJOBS = &#39;one&#39;, &#39;two&#39;, &#39;three&#39;, &#39;four&#39;</span>
<span class="cp">LIMIT_MINS = 20</span>
<span class="cp">CLEANUP = True</span>
<span class="cp">}</span>

<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2011-08-08T12</span>
    <span class="nt">[[graph]]</span>
<span class="cp">@[ if CLEANUP ]</span>
        <span class="nv">T23 </span><span class="o">=</span> <span class="kd">clean</span>
<span class="cp">@[ end if ]</span>
        <span class="nv">T00,T12 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
            <span class="kd">setup</span> <span class="o">=&gt;</span> <span class="kd">get_lbc</span> <span class="o">&amp;</span> <span class="kd">get_ic</span> <span class="c1"># foo</span>
<span class="cp">@[ for CITY in CITIES ]</span><span class="c c-Multi">@# comment</span>
            <span class="kd">get_lbc</span> <span class="o">=&gt;</span> <span class="cp">@(CITY)</span><span class="kd">_one</span>
            <span class="kd">get_ic</span> <span class="o">=&gt;</span> <span class="cp">@(CITY)</span><span class="kd">_two</span>
            <span class="cp">@(CITY)</span><span class="kd">_one</span> <span class="o">&amp;</span> <span class="cp">@(CITY)</span><span class="kd">_two</span> <span class="o">=&gt;</span> <span class="cp">@(CITY)</span><span class="kd">_three</span> <span class="o">&amp;</span> <span class="cp">@(CITY)</span><span class="kd">_four</span>
    <span class="cp">@[ if CLEANUP ]</span>
            <span class="cp">@(CITY)</span><span class="kd">_three</span> <span class="o">&amp;</span> <span class="cp">@(CITY)</span><span class="kd">_four</span> <span class="o">=&gt;</span> <span class="kd">cleanup</span>
    <span class="cp">@[ end if ]</span>
<span class="cp">@[ end for ]</span>
        <span class="s2">&quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[on_</span><span class="cp">@HOST</span><span class="nt"> ]]</span>
        <span class="nt">[[[remote]]]</span>
            <span class="nv">host </span><span class="o">=</span><span class="s"> </span><span class="cp">@HOST</span>
            <span class="c1"># (remote cylc directory is set in site/user config for this host)</span>
        <span class="nt">[[[directives]]]</span>
            <span class="nv">wall_clock_limit </span><span class="o">=</span><span class="s"> &quot;00:</span><span class="cp">@(LIMIT_MINS + 2)</span><span class="s">:00,00:</span><span class="cp">@(LIMIT_MINS)</span><span class="s">:00&quot;</span>

<span class="cp">@[ for CITY in CITIES ]</span>
    <span class="nt">[[ </span><span class="cp">@(CITY)</span><span class="nt"> ]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> on_</span><span class="cp">@(HOST)</span>
    <span class="cp">@[ for JOB in CITYJOBS ]</span>
    <span class="nt">[[ </span><span class="cp">@(CITY)</span><span class="nt">_</span><span class="cp">@(JOB)</span><span class="nt"> ]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> </span><span class="cp">@CITY</span>
    <span class="cp">@[ end for ]</span>
<span class="cp">@[ end for ]</span>
</pre></div>
</div>
<p>For basic usage, the difference between Jinja2 and EmPy amounts to little more than
a different markup syntax. EmPy might be preferable, however, in cases needing
more complicated processing logic.</p>
<p><em>EmPy is a system for embedding Python expressions and statements in template
text. It makes the full power of Python language and its ecosystem easily
accessible from within the template. This might be desirable for several
reasons:</em></p>
<ul class="simple">
<li><p>No need to learn a different language just for writing template logic</p></li>
<li><p>Availability of lambda functions, lists, and dictionary comprehensions
can make template code smaller and more readable compared to Jinja2</p></li>
<li><p>Natural and straightforward integration with the Python package ecosystem</p></li>
<li><p>No two-language barrier between writing template logic and processing
extensions makes it easier to refactor and maintain the template code
as its complexity grows. Inline Python code can be gathered into subroutines
and eventually into separate modules and packages in a seamless manner.</p></li>
</ul>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="jinja2.html" class="btn btn-neutral float-left" title="Jinja2" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="external-triggers.html" class="btn btn-neutral float-right" title="External Triggers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2008-2022 NIWA &amp; British Crown (Met Office) &amp; Contributors.
      <span class="lastupdated">Last updated on Nov 11, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <!--
  element which gets populated with the list of available versions and
  formats for the documentation by versions.js
-->
<div
  class="rst-versions"
  data-toggle="rst-versions"
  id='versions-and-formats'
></div>




<script type="text/javascript">
    const CUR_FORMAT = "html";
    const CUR_VERSION = "8.0.3";
    // name of page (in URL), for singlepage builds this will be `index`
    const PAGE_NAME = "user-guide/writing-workflows/empy";
    // URL path to the base docs dir i.e. ROOT_DIR/version/format
    const ROOT_DIR = "../../../..";
</script>

<script
  type="text/javascript"
  src="../../../../versions.js"
></script><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>