
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>The Cylc Suite Engine 7.8.8 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    
    <link rel="shortcut icon" href="_static/cylc-favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="index.html#document-index">The Cylc Suite Engine 7.8.8 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="cylc-documentation">
<h1>Cylc documentation<a class="headerlink" href="#cylc-documentation" title="Permalink to this headline">¶</a></h1>
<p><strong>The Cylc Suite Engine</strong></p>
<p>Current release: 7.8.8</p>
<p><em>Released Under the GNU GPL v3.0 Software License</em></p>
<p><em>Copyright (C) NIWA &amp; British Crown (Met Office) &amp; Contributors.</em></p>
<hr class="docutils" />
<p>Cylc (“<em>silk</em>”) is a workflow engine for cycling systems - it orchestrates
distributed suites of interdependent cycling tasks that may continue to run
indefinitely.</p>
<hr class="docutils" />
<div class="toctree-wrapper compound">
<span id="document-introduction"></span><div class="section" id="introduction-how-cylc-works">
<span id="howcylcworks"></span><h2>1. Introduction: How Cylc Works<a class="headerlink" href="#introduction-how-cylc-works" title="Permalink to this headline">¶</a></h2>
<p><strong>This section of the user guide is being rewritten for Cylc 8. For the moment
we’ve removed some outdated information, leaving just the description of how
Cylc manages cycling workflows.</strong> For a more up-to-date description see
references cited on the Cylc web site.</p>
<div class="section" id="dependence-between-tasks">
<h3>1.1. Dependence Between Tasks<a class="headerlink" href="#dependence-between-tasks" title="Permalink to this headline">¶</a></h3>
<div class="section" id="intra-cycle-dependence">
<span id="intracycledependence"></span><h4>1.1.1. Intra-cycle Dependence<a class="headerlink" href="#intra-cycle-dependence" title="Permalink to this headline">¶</a></h4>
<p>Most dependence between tasks applies within a single cycle point.
<a class="reference internal" href="#fig-dep-one"><span class="std std-numref">Fig. 1</span></a> shows the dependency diagram for a single
cycle point of a simple example suite of three scientific models (say)
(<em>a</em>, <em>b</em>, and <em>c</em>) and three post processing or product generation
tasks (<em>d</em>, <em>e</em> and <em>f</em>). A scheduler capable of handling this
must manage, within a single cycle point, multiple parallel
streams of execution that branch when one task generates output for
several downstream tasks, and merge when one task takes input from several
upstream tasks.</p>
<div class="figure align-center" id="id3">
<span id="fig-dep-one"></span><img alt="_images/dep-one-cycle.png" src="_images/dep-one-cycle.png" />
<p class="caption"><span class="caption-number">Fig. 1 </span><span class="caption-text">A single cycle point dependency graph for a simple suite.
The dependency graph for a single cycle point of a simple
example suite. Tasks <em>a</em>, <em>b</em>, and <em>c</em> represent models,
<em>d</em>, <em>e</em> and <em>f</em> are post processing or product generation
tasks, and <em>x</em> represents external data that the upstream
model depends on.</span></p>
</div>
<div class="figure align-center" id="id4">
<span id="fig-time-one"></span><img alt="_images/timeline-one.png" src="_images/timeline-one.png" />
<p class="caption"><span class="caption-number">Fig. 2 </span><span class="caption-text">A single cycle point job schedule for real time operation.
The optimal job schedule for two consecutive cycle points of our
example suite during real time operation, assuming that all tasks
trigger off upstream tasks finishing completely. The horizontal
extent of a task bar represents its execution time, and the vertical
blue lines show when the external driving data becomes available.</span></p>
</div>
<p><a class="reference internal" href="#fig-time-one"><span class="std std-numref">Fig. 2</span></a> shows the optimal job schedule for two
consecutive cycle points of the example suite in real time operation, given
execution times represented by the horizontal extent of the task bars.
There is a time gap between cycle points as the suite waits on new external
driving data. Each task in the example suite happens to trigger off
upstream tasks <em>finishing</em>, rather than off any intermediate output
or event; this is merely a simplification that makes for clearer
diagrams.</p>
<div class="figure align-center" id="id5">
<span id="fig-dep-two-linked"></span><img alt="_images/dep-two-cycles-linked.png" src="_images/dep-two-cycles-linked.png" />
<p class="caption"><span class="caption-number">Fig. 3 </span><span class="caption-text">What if the external driving data is available early? If the external
driving data is available in advance, can we start running the next cycle
point early?</span></p>
</div>
<div class="figure align-center" id="id6">
<span id="fig-overlap"></span><img alt="_images/timeline-one-c.png" src="_images/timeline-one-c.png" />
<p class="caption"><span class="caption-number">Fig. 4 </span><span class="caption-text">Attempted overlap of consecutive single-cycle-point job
schedules. A naive attempt to overlap two consecutive cycle
points using the single-cycle-point dependency graph. The red shaded
tasks will fail because of dependency violations (or will not be able to
run because of upstream dependency violations).</span></p>
</div>
<div class="figure align-center" id="id7">
<span id="fig-job-no-overlap"></span><img alt="_images/timeline-one-a.png" src="_images/timeline-one-a.png" />
<p class="caption"><span class="caption-number">Fig. 5 </span><span class="caption-text">The only safe multi-cycle-point job schedule? The best that can be done
<em>in general</em> when inter-cycle dependence is ignored.</span></p>
</div>
<p>Now the question arises, what happens if the external driving data for
upcoming cycle points is available in advance, as it would be after a
significant delay in operations, or when running a historical case
study?  While the model <em>a</em> appears to depend only on the
external data <em>x</em>, in fact it could also depend on its own previous instance
for the model <em>background state</em> used in initializing the new run (this is
almost always the case for atmospheric models used in weather forecasting).
Thus, as alluded to in <a class="reference internal" href="#fig-dep-two-linked"><span class="std std-numref">Fig. 3</span></a>, task <em>a</em> could in
principle start as soon as its predecessor has finished. <a class="reference internal" href="#fig-overlap"><span class="std std-numref">Fig. 4</span></a>
shows, however, that starting a whole new cycle point at this point is
dangerous - it results in dependency violations in half of the tasks in
the example suite. In fact the situation could be even worse than this
- imagine that task <em>b</em> in the first cycle point is delayed for some
reason <em>after</em> the second cycle point has been launched. Clearly we must
consider handling inter-cycle dependence explicitly or else agree not to
start the next cycle point early, as is illustrated in
<a class="reference internal" href="#fig-job-no-overlap"><span class="std std-numref">Fig. 5</span></a>.</p>
</div>
<div class="section" id="inter-cycle-dependence">
<span id="intercyclepointdependence"></span><h4>1.1.2. Inter-Cycle Dependence<a class="headerlink" href="#inter-cycle-dependence" title="Permalink to this headline">¶</a></h4>
<p>Wether forecast models typically depend on their own most recent previous
forecast for background state or restart files of some kind (this is
called <em>warm cycling</em>) but there can also be inter-cycle dependence
between other tasks. In an atmospheric forecast analysis suite, for
instance, the weather model may generate background states for observation
processing and data-assimilation tasks in the next cycle point as well as for
the next forecast model run. In real time operation inter-cycle
dependence can be ignored because it is automatically satisfied when one cycle
point finishes before the next begins. If it is not ignored it drastically
complicates the dependency graph by blurring the clean boundary between
cycle points. <a class="reference internal" href="#fig-dep-multi"><span class="std std-numref">Fig. 6</span></a> illustrates the problem for our
simple example suite assuming minimal inter-cycle dependence: the warm
cycled models (<em>a</em>, <em>b</em>, and <em>c</em>) each depend on their own previous instances.</p>
<p>For this reason, and because we tend to see forecasting suites in terms of
their real time characteristics, other metaschedulers have ignored
inter-cycle dependence and are thus restricted to running entire cycle
points in sequence at all times. This does not affect normal real time
operation but it can be a serious impediment when advance availability of
external driving data makes it possible, in principle, to run some tasks from
upcoming cycle points before the current cycle point is finished - as was
suggested at the end of the previous section. This can occur, for instance,
after operational delays (late arrival of external data, system maintenance,
etc.) and to an even greater extent in historical case studies and parallel
test suites started behind a real time operation. It can be a serious problem
for suites that have little downtime between forecast cycle points and
therefore take many cycle points to catch up after a delay. Without taking
account of inter-cycle dependence, the best that can be done, in
general, is to reduce the gap between cycle points to zero as shown in
<a class="reference internal" href="#fig-job-no-overlap"><span class="std std-numref">Fig. 5</span></a>. A limited crude overlap of the single
cycle point job schedule may be possible for specific task sets but the
allowable overlap may change if new tasks are added, and it is still dangerous:
it amounts to running different parts of a dependent system as if they were not
dependent and as such it cannot be guaranteed that some unforeseen delay in
one cycle point, after the next cycle point has begun, (e.g. due to resource
contention or task failures) won’t result in dependency violations.</p>
<div class="figure align-center" id="id8">
<span id="fig-dep-multi"></span><img alt="_images/dep-multi-cycle.png" src="_images/dep-multi-cycle.png" />
<p class="caption"><span class="caption-number">Fig. 6 </span><span class="caption-text">The complete multi-cycle-point dependency graph.
The complete dependency graph for the example suite, assuming
the least possible inter-cycle dependence: the models (<em>a</em>,
<em>b</em>, and <em>c</em>) depend on their own previous instances. The dashed arrows
show connections to previous and subsequent cycle points.</span></p>
</div>
<div class="figure align-center" id="id9">
<span id="fig-optimal-two"></span><img alt="_images/timeline-two-cycles-optimal.png" src="_images/timeline-two-cycles-optimal.png" />
<p class="caption"><span class="caption-number">Fig. 7 </span><span class="caption-text">The optimal two-cycle-point job schedule. The optimal two cycle job
schedule when the next cycle’s driving data is available in
advance, possible in principle when inter-cycle dependence is
handled explicitly.</span></p>
</div>
<p><a class="reference internal" href="#fig-optimal-two"><span class="std std-numref">Fig. 7</span></a> shows, in contrast to
<a class="reference internal" href="#fig-overlap"><span class="std std-numref">Fig. 4</span></a>, the optimal two cycle point job schedule
obtained by respecting all inter-cycle dependence. This assumes no delays due
to resource contention or otherwise - i.e. every task runs
as soon as it is ready to run. The scheduler running
this suite must be able to adapt dynamically to external conditions
that impact on multi-cycle-point scheduling in the presence of
inter-cycle dependence or else, again, risk bringing the system down
with dependency violations.</p>
<div class="figure align-center" id="id10">
<span id="fig-time-three"></span><img alt="_images/timeline-three.png" src="_images/timeline-three.png" />
<p class="caption"><span class="caption-number">Fig. 8 </span><span class="caption-text">Comparison of job schedules after a delay. Job
schedules for the example suite after a delay of almost one whole
cycle point, when inter-cycle dependence is
taken into account (above the time axis), and when it is not
(below the time axis). The colored lines indicate the time that
each cycle point is delayed, and normal “caught up” cycle points
are shaded gray.</span></p>
</div>
<div class="figure align-center" id="id11">
<span id="fig-time-two"></span><img alt="_images/timeline-two.png" src="_images/timeline-two.png" />
<p class="caption"><span class="caption-number">Fig. 9 </span><span class="caption-text">Optimal job schedule when all external data is
available. Job schedules for the example suite in case study
mode, or after a long delay, when the external driving data are
available many cycle points in advance. Above the time axis is the optimal
schedule obtained when the suite is constrained only by its true
dependencies, as in <a class="reference internal" href="#fig-dep-two-linked"><span class="std std-numref">Fig. 3</span></a>, and underneath
is the best that can be done, in general, when inter-cycle
dependence is ignored.</span></p>
</div>
<p>To further illustrate the potential benefits of proper inter-cycle
dependency handling, <a class="reference internal" href="#fig-time-three"><span class="std std-numref">Fig. 8</span></a> shows an operational
delay of almost one whole cycle point in a suite with little downtime between
cycle points. Above the time axis is the optimal schedule that is possible in
principle when inter-cycle dependence is taken into account, and below
it is the only safe schedule possible <em>in general</em> when it is ignored.
In the former case, even the cycle point immediately after the delay is hardly
affected, and subsequent cycle points are all on time, whilst in the latter
case it takes five full cycle points to catch up to normal real time
operation <a class="footnote-reference" href="#id2" id="id1">[1]</a>.</p>
<p>Similarly, <a class="reference internal" href="#fig-time-two"><span class="std std-numref">Fig. 9</span></a> shows example suite job schedules
for an historical case study, or when catching up after a very long
delay; i.e. when the external driving data are available many cycle
points in advance. Task <em>a</em>, which as the most upstream
model is likely to be a resource intensive atmosphere or ocean model,
has no upstream dependence on co-temporal tasks and can therefore run
continuously, regardless of how much downstream processing is yet to be
completed in its own, or any previous, cycle point (actually,
task <em>a</em> does depend on co-temporal task <em>x</em> which waits on the
external driving data, but that returns immediately when the data is
available in advance, so the result stands). The other models
can also cycle continuously or with a short gap between, and some
post processing tasks, which have no previous-instance dependence, can
run continuously or even overlap (e.g. <em>e</em> in this case). Thus,
even for this very simple example suite, tasks from three or four
different cycle points can in principle run simultaneously at any given time.</p>
<p>In fact, if our tasks are able to trigger off internal outputs of
upstream tasks (message triggers) rather than waiting on full completion,
then successive instances of the models could overlap as well
(because model restart outputs are generally completed early in the run)
for an even more efficient job schedule.</p>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Note that simply overlapping the single cycle point schedules of
<a class="reference internal" href="#fig-time-one"><span class="std std-numref">Fig. 2</span></a> from the same start point would have
resulted in dependency violation by task <em>c</em>.
of task proxies in the pool.</td></tr>
</tbody>
</table>
</div>
</div>
</div>
<span id="document-screenshots"></span><div class="section" id="cylc-screenshots">
<h2>2. Cylc Screenshots<a class="headerlink" href="#cylc-screenshots" title="Permalink to this headline">¶</a></h2>
<div class="figure align-center" id="id1">
<span id="fig-gcylc-1"></span><img alt="_images/gcylc-graph-and-dot-views.png" src="_images/gcylc-graph-and-dot-views.png" />
<p class="caption"><span class="caption-number">Fig. 10 </span><span class="caption-text">gcylc graph and dot views.</span></p>
</div>
<div class="figure align-center" id="id2">
<span id="fig-gcylc-2"></span><img alt="_images/gcylc-text-view.png" src="_images/gcylc-text-view.png" />
<p class="caption"><span class="caption-number">Fig. 11 </span><span class="caption-text">gcylc text view.</span></p>
</div>
<div class="figure align-center" id="id3">
<span id="fig-gscan"></span><img alt="_images/gscan.png" src="_images/gscan.png" />
<p class="caption"><span class="caption-number">Fig. 12 </span><span class="caption-text">gscan multi-suite state summary GUI.</span></p>
</div>
<div class="figure align-center" id="id4">
<span id="fig-ecox-1"></span><img alt="_images/ecox-1.png" src="_images/ecox-1.png" />
<p class="caption"><span class="caption-number">Fig. 13 </span><span class="caption-text">A large-ish suite graphed by cylc.</span></p>
</div>
</div>
<span id="document-installation"></span><div class="section" id="installation">
<span id="requirements"></span><h2>3. Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Cylc runs on Linux. It is tested quite thoroughly on modern RHEL and Ubuntu
distros. Some users have also managed to make it work on other Unix variants
including Apple OS X, but they are not officially tested and supported.</p>
<div class="section" id="third-party-software-packages">
<h3>3.1. Third-Party Software Packages<a class="headerlink" href="#third-party-software-packages" title="Permalink to this headline">¶</a></h3>
<p><strong>Python 2</strong> <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code> <strong>2.6</strong> is required. <strong>Python 2</strong> <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code> <strong>2.7.9</strong> is
recommended for the best security. <a class="reference external" href="https://python.org/">Python</a> 2 should
already be installed in your Linux system.</p>
<p>For Cylc’s HTTPS communications layer:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.openssl.org/">OpenSSL</a></li>
<li><a class="reference external" href="http://www.pyopenssl.org/">pyOpenSSL</a></li>
<li><a class="reference external" href="http://docs.python-requests.org/">python-requests</a></li>
<li><strong>python-urllib3</strong> - should be bundled with python-requests</li>
</ul>
<p>The following packages are highly recommended, but are technically optional as
you can construct and run suites without dependency graph visualisation or
the Cylc GUIs:</p>
<ul>
<li><p class="first"><a class="reference external" href="http://www.pygtk.org">PyGTK</a> - Python bindings for the GTK+ GUI toolkit.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>PyGTK typically comes with your system Python 2 version. It is allegedly
quite difficult to install if you need to do so for another Python
version. At time of writing, for instance, there are no functional PyGTK
conda packages available.</p>
<p>Note that <strong>we need to do ``import gtk`` in Python, not ``import pygtk``</strong>.</p>
<p class="last">In Centos 7.6, for example, the Cylc GUIs run “out of the box” with the
system-installed Python 2.7.5. Under the hood, the Python “gtk” package is
provided by the “pygtk2” yum package. (The “pygtk” Python module, which we
don’t need, is supplied by the “pygobject2” yum package).</p>
</div>
</li>
<li><p class="first"><a class="reference external" href="http://www.graphviz.org">Graphviz</a> - graph layout engine (tested 2.36.0)</p>
</li>
<li><p class="first"><a class="reference external" href="http://pygraphviz.github.io/">Pygraphviz</a> - Python Graphviz interface
(tested 1.2). To build this you may need some <em>devel</em> packages too:</p>
<ul class="simple">
<li>python-devel</li>
<li>graphviz-devel</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">graph</span></code> command for static workflow visualization requires
PyGTK, but we provide a separate <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">ref-graph</span></code> command to print
out a simple text-format “reference graph” without PyGTK.</p>
</div>
</li>
</ul>
<p>The Cylc Review service does not need any additional packages.</p>
<p>The following packages are necessary for running all the tests in Cylc:</p>
<ul class="simple">
<li><a class="reference external" href="https://mock.readthedocs.io">mock</a></li>
</ul>
<p>To generate the HTML User Guide, you will need:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.sphinx-doc.org/en/master/">Sphinx</a> of compatible version,
<code class="docutils literal notranslate"><span class="pre">&gt;=</span></code> <strong>1.5.3</strong> and <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code> <strong>1.7.9</strong>.</li>
</ul>
<p>In most modern Linux distributions all of the software above can be installed
via the system package manager. Otherwise download packages manually and follow
their native installation instructions. To check that all packages
are installed properly:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cylc check-software
Checking your software...

Individual results:
===============================================================================
Package (version requirements)                          Outcome (version found)
===============================================================================
                              *REQUIRED SOFTWARE*
Python (2.6+, &lt;3).....................FOUND &amp; min. version MET (2.7.12.final.0)

       *OPTIONAL SOFTWARE for the GUI &amp; dependency graph visualisation*
Python:pygraphviz (any)...........................................NOT FOUND (-)
graphviz (any)...................................................FOUND (2.26.0)
Python:pygtk (2.0+)...............................................NOT FOUND (-)

            *OPTIONAL SOFTWARE for the HTTPS communications layer*
Python:requests (2.4.2+)......................FOUND &amp; min. version MET (2.11.1)
Python:urllib3 (any)..............................................NOT FOUND (-)
Python:OpenSSL (any)..............................................NOT FOUND (-)

             *OPTIONAL SOFTWARE for the configuration templating*
Python:EmPy (any).................................................NOT FOUND (-)

                *OPTIONAL SOFTWARE for the HTML documentation*
Python:sphinx (1.5.3+).........................FOUND &amp; min. version MET (1.7.0)
===============================================================================

Summary:
                         ****************************
                             Core requirements: ok
                          Full-functionality: not ok
                         ****************************
</pre></div>
</div>
<p>If errors are reported then the packages concerned are either not installed or
not in your Python search path.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">check-software</span></code> has become quite trivial as we’ve removed or
bundled some former dependencies, but in future we intend to make it
print a comprehensive list of library versions etc. to include in with
bug reports.</p>
</div>
<p>To check for specific packages only, supply these as arguments to the
<code class="docutils literal notranslate"><span class="pre">check-software</span></code> command, either in the form used in the output of
the bare command, without any parent package prefix and colon, or
alternatively all in lower-case, should the given form contain capitals. For
example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc check-software graphviz Python urllib3
</pre></div>
</div>
<p>With arguments, check-software provides an exit status indicating a
collective pass (zero) or a failure of that number of packages to satisfy
the requirements (non-zero integer).</p>
</div>
<div class="section" id="software-bundled-with-cylc">
<h3>3.2. Software Bundled With Cylc<a class="headerlink" href="#software-bundled-with-cylc" title="Permalink to this headline">¶</a></h3>
<p>Cylc bundles several third party packages which do not need to be installed
separately.</p>
<ul class="simple">
<li><a class="reference external" href="http://www.cherrypy.org/">cherrypy</a> <strong>6.0.2</strong> (slightly modified): a pure
Python HTTP framework that we use as a web server for communication between
server processes (suite server programs) and client programs (running tasks,
GUIs, CLI commands).<ul>
<li>Client communication is via the Python
<a class="reference external" href="http://docs.python-requests.org/">requests</a> library if available
(recommended) or else pure Python via <strong>urllib2</strong>.</li>
</ul>
</li>
<li><a class="reference external" href="http://jinja.pocoo.org/">Jinja2</a> <strong>2.10</strong>: a full featured template
engine for Python, and its dependency
<a class="reference external" href="http://www.pocoo.org/projects/markupsafe/">MarkupSafe</a> <strong>0.23</strong>; both
BSD licensed.</li>
<li>the <a class="reference external" href="https://github.com/jrfonseca/xdot.py">xdot</a> graph viewer (modified),
LGPL licensed.</li>
</ul>
</div>
<div class="section" id="installing-cylc">
<span id="installcylc"></span><h3>3.3. Installing Cylc<a class="headerlink" href="#installing-cylc" title="Permalink to this headline">¶</a></h3>
<p>Cylc releases can be downloaded from <a class="reference external" href="https://cylc.github.io/cylc">GitHub</a>.</p>
<p>The wrapper script <code class="docutils literal notranslate"><span class="pre">usr/bin/cylc</span></code> should be installed to
the system executable search path (e.g. <code class="docutils literal notranslate"><span class="pre">/usr/local/bin/</span></code>) and
modified slightly to point to a location such as <code class="docutils literal notranslate"><span class="pre">/opt</span></code> where
successive Cylc releases will be unpacked side by side.</p>
<p>To install Cylc, unpack the release tarball in the right location, e.g.
<code class="docutils literal notranslate"><span class="pre">/opt/cylc-7.8.2</span></code>, type <code class="docutils literal notranslate"><span class="pre">make</span></code> inside the release
directory, and set site defaults - if necessary - in a site global config file
(below).</p>
<p>Make a symbolic link from <code class="docutils literal notranslate"><span class="pre">cylc</span></code> to the latest installed version:
<code class="docutils literal notranslate"><span class="pre">ln</span> <span class="pre">-s</span> <span class="pre">/opt/cylc-7.8.2</span> <span class="pre">/opt/cylc</span></code>. This will be invoked by the
central wrapper if a specific version is not requested. Otherwise, the
wrapper will attempt to invoke the Cylc version specified in
<code class="docutils literal notranslate"><span class="pre">$CYLC_VERSION</span></code>, e.g. <code class="docutils literal notranslate"><span class="pre">CYLC_VERSION=7.8.2</span></code>. This variable
is automatically set in task job scripts to ensure that jobs use the same Cylc
version as their parent suite server program.  It can also be set by users,
manually or in login scripts, to fix the Cylc version in their environment.</p>
<p>Installing subsequent releases is just a matter of unpacking the new tarballs
next to the previous releases, running <code class="docutils literal notranslate"><span class="pre">make</span></code> in them, and copying
in (possibly with modifications) the previous site global config file.</p>
<div class="section" id="local-user-installation">
<span id="localinstall"></span><h4>3.3.1. Local User Installation<a class="headerlink" href="#local-user-installation" title="Permalink to this headline">¶</a></h4>
<p>It is easy to install Cylc under your own user account if you don’t have
root or sudo access to the system: just put the central Cylc wrapper in
<code class="docutils literal notranslate"><span class="pre">$HOME/bin/</span></code> (making sure that is in your <code class="docutils literal notranslate"><span class="pre">$PATH</span></code>) and
modify it to point to a directory such as <code class="docutils literal notranslate"><span class="pre">$HOME/cylc/</span></code> where you
will unpack and install release tarballs. Local installation of third party
dependencies like Graphviz is also possible, but that depends on the particular
installation methods used and is outside of the scope of this document.</p>
</div>
<div class="section" id="create-a-site-config-file">
<h4>3.3.2. Create A Site Config File<a class="headerlink" href="#create-a-site-config-file" title="Permalink to this headline">¶</a></h4>
<p>Site and user global config files define some important parameters that affect
all suites, some of which may need to be customized for your site.
See <a class="reference internal" href="index.html#siteanduserconfiguration"><span class="std std-ref">Global (Site, User) Configuration Files</span></a> for how to generate an initial site file and
where to install it. All legal site and user global config items are defined
in <a class="reference internal" href="index.html#sitercreference"><span class="std std-ref">Global (Site, User) Config File Reference</span></a>.</p>
</div>
<div class="section" id="configure-site-environment-on-job-hosts">
<span id="id1"></span><h4>3.3.3. Configure Site Environment on Job Hosts<a class="headerlink" href="#configure-site-environment-on-job-hosts" title="Permalink to this headline">¶</a></h4>
<p>If your users submit task jobs to hosts other than the hosts they use to run
their suites, you should ensure that the job hosts have the correct environment
for running cylc. A cylc suite generates task job scripts that normally invoke
<code class="docutils literal notranslate"><span class="pre">bash</span> <span class="pre">-l</span></code>, i.e. it will invoke bash as a login shell to run the job
script. Users and sites should ensure that their bash login profiles are able
to set up the correct environment for running cylc and their task jobs.</p>
<p>Your site administrator may customise the environment for all task jobs by
adding a <code class="docutils literal notranslate"><span class="pre">&lt;cylc-dir&gt;/etc/job-init-env.sh</span></code> file and populate it with the
appropriate contents. If customisation is still required, you can add your own
<code class="docutils literal notranslate"><span class="pre">${HOME}/.cylc/job-init-env.sh</span></code> file and populate it with the
appropriate contents.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">${HOME}/.cylc/job-init-env.sh</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;cylc-dir&gt;/etc/job-init-env.sh</span></code></li>
</ul>
<p>The job will attempt to source the first of these files it finds to set up its
environment.</p>
</div>
<div class="section" id="configuring-cylc-review-under-apache">
<span id="configuringcylcreviewapache"></span><h4>3.3.4. Configuring Cylc Review Under Apache<a class="headerlink" href="#configuring-cylc-review-under-apache" title="Permalink to this headline">¶</a></h4>
<p>The Cylc Review web service displays suite job logs and other information in
web pages - see <a class="reference internal" href="index.html#viewingsuitelogscylcreview"><span class="std std-ref">Viewing Suite Logs in a Web Browser: Cylc Review</span></a> and
<a class="reference internal" href="index.html#fig-review-screenshot"><span class="std std-numref">Fig. 14</span></a>. It can run under a WSGI server (e.g.
Apache with <code class="docutils literal notranslate"><span class="pre">mod_wsgi</span></code>) as a service for all users, or as an ad hoc
service under your own user account.</p>
<p>To run Cylc Review under Apache, install <code class="docutils literal notranslate"><span class="pre">mod_wsgi</span></code> and configure it
as follows, with paths modified appropriately:</p>
<div class="highlight-apacheconf notranslate"><div class="highlight"><pre><span></span><span class="c"># Apache mod_wsgi config file, e.g.:</span>
<span class="c">#   Red Hat Linux: /etc/httpd/conf.d/cylc-wsgi.conf</span>
<span class="c">#   Ubuntu Linux: /etc/apache2/mods-available/wsgi.conf</span>
<span class="c"># E.g. for /opt/cylc-7.8.1/</span>
<span class="nb">WSGIPythonPath</span> <span class="sx">/opt/cylc-7.8.1/lib</span>
<span class="nb">WSGIScriptAlias</span> <span class="sx">/cylc-review</span> <span class="sx">/opt/cylc-7.8.1/bin/cylc-review</span>
</pre></div>
</div>
<p>(Note the <code class="docutils literal notranslate"><span class="pre">WSGIScriptAlias</span></code> determines the service URL under the
server root).</p>
<p>And allow Apache access to the Cylc library:</p>
<div class="highlight-apacheconf notranslate"><div class="highlight"><pre><span></span><span class="c"># Directory access, in main Apache config file, e.g.:</span>
<span class="c">#   Red Hat Linux: /etc/httpd/conf/httpd.conf</span>
<span class="c">#   Ubuntu Linux: /etc/apache2/apache2.conf</span>
<span class="c"># E.g. for /opt/cylc-7.8.1/</span>
<span class="nt">&lt;Directory</span> <span class="s">/opt/cylc-7.8.1/</span><span class="nt">&gt;</span>
        <span class="nb">AllowOverride</span> <span class="k">None</span>
        <span class="nb">Require</span> <span class="k">all</span> granted
<span class="nt">&lt;/Directory&gt;</span>
</pre></div>
</div>
<p>The host running the Cylc Review web service, and the service itself (or the
user that it runs as) must be able to view the <code class="docutils literal notranslate"><span class="pre">~/cylc-run</span></code> directory
of all Cylc users.</p>
<p>Use the web server log, e.g. <code class="docutils literal notranslate"><span class="pre">/var/log/httpd/</span></code> or <code class="docutils literal notranslate"><span class="pre">/var/log/apache2/</span></code>, to
debug problems.</p>
</div>
</div>
<div class="section" id="automated-tests">
<span id="rtast"></span><h3>3.4. Automated Tests<a class="headerlink" href="#automated-tests" title="Permalink to this headline">¶</a></h3>
<p>The cylc test battery is primarily intended for developers to check that
changes to the source code don’t break existing functionality.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Some test failures can be expected to result from suites timing out,
even if nothing is wrong, if you run too many tests in parallel. See
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">test-battery</span> <span class="pre">--help</span></code>.</p>
</div>
</div>
</div>
<span id="document-terminology"></span><div class="section" id="cylc-terminology">
<h2>4. Cylc Terminology<a class="headerlink" href="#cylc-terminology" title="Permalink to this headline">¶</a></h2>
<div class="section" id="jobs-and-tasks">
<h3>4.1. Jobs and Tasks<a class="headerlink" href="#jobs-and-tasks" title="Permalink to this headline">¶</a></h3>
<p>A <em>job</em> is a program or script that runs on a computer, and a <em>task</em> is
a workflow abstraction - a node in the suite dependency graph - that represents
a job.</p>
</div>
<div class="section" id="cycle-points">
<h3>4.2. Cycle Points<a class="headerlink" href="#cycle-points" title="Permalink to this headline">¶</a></h3>
<p>A <em>cycle point</em> is a particular date-time (or integer) point in a sequence
of date-time (or integer) points. Each cylc task has a private cycle point and
can advance independently to subsequent cycle points. It may sometimes be
convenient, however, to refer to the “current cycle point” of a suite (or the
previous or next one, etc.) with reference to a particular task, or in the
sense of all tasks instances that “belong to” a particular cycle point. But
keep in mind that different tasks may pass through the “current cycle point”
(etc.) at different times as the suite evolves.</p>
</div>
</div>
<span id="document-workflows"></span><div class="section" id="workflows-for-cycling-systems">
<span id="id1"></span><h2>5. Workflows For Cycling Systems<a class="headerlink" href="#workflows-for-cycling-systems" title="Permalink to this headline">¶</a></h2>
<p>A model run and associated processing may need to be cycled for the following
reasons:</p>
<ul class="simple">
<li>In real time forecasting systems, a new forecast may be initiated
at regular intervals when new real time data comes in.</li>
<li>It may be convenient (or necessary, e.g. due to batch scheduler
queue limits) to split single long model runs into many smaller chunks,
each with associated pre- and post-processing workflows.</li>
</ul>
<p>Cylc provides two ways of constructing workflows for cycling systems:
<em>cycling workflows</em> and <em>parameterized tasks</em>.</p>
<div class="section" id="cycling-workflows">
<span id="id2"></span><h3>5.1. Cycling Workflows<a class="headerlink" href="#cycling-workflows" title="Permalink to this headline">¶</a></h3>
<p>This is cylc’s classic cycling mode as described in the Introduction. Each
instance of a cycling job is represented by a new instance of <em>the same task</em>,
with a new cycle point. The suite configuration defines patterns for
extending the workflow on the fly, so it can keep running indefinitely if
necessary. For example, to cycle <code class="docutils literal notranslate"><span class="pre">model.exe</span></code> on a monthly sequence we
could define a single task <code class="docutils literal notranslate"><span class="pre">model</span></code>, an initial cycle point, and a
monthly sequence. Cylc then generates the date-time sequence and creates a new
task instance for each cycle point as it comes up. Workflow dependencies are
defined generically with respect to the “current cycle point” of the tasks
involved.</p>
<p>This is the only sensible way to run very large suites or operational suites
that need to continue cycling indefinitely. The cycling is configured with
standards-based ISO 8601 date-time <em>recurrence expressions</em>. Multiple
cycling sequences can be used at once in the same suite. See
<a class="reference internal" href="index.html#configuringscheduling"><span class="std std-ref">Scheduling - Dependency Graphs</span></a>.</p>
</div>
<div class="section" id="parameterized-tasks-as-a-proxy-for-cycling">
<span id="id3"></span><h3>5.2. Parameterized Tasks as a Proxy for Cycling<a class="headerlink" href="#parameterized-tasks-as-a-proxy-for-cycling" title="Permalink to this headline">¶</a></h3>
<p>It is also possible to run cycling jobs with a pre-defined static workflow in
which each instance of a cycling job is represented by <em>a different task</em>:
as far as the abstract workflow is concerned there is no cycling. The sequence
of tasks can be constructed efficiently, however, using cylc’s built-in suite
parameters (<a class="reference internal" href="index.html#parameterized-cycling"><span class="std std-ref">Parameterized Cycling</span></a>) or explicit Jinja2 loops
(<a class="reference internal" href="index.html#jinja"><span class="std std-ref">Jinja2</span></a>).</p>
<p>For example, to run <code class="docutils literal notranslate"><span class="pre">model.exe</span></code> 12 times on a monthly cycle we could
loop over an integer parameter <code class="docutils literal notranslate"><span class="pre">R</span> <span class="pre">=</span> <span class="pre">0,</span> <span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">...,</span> <span class="pre">11</span></code> to define tasks
<code class="docutils literal notranslate"><span class="pre">model-R0,</span> <span class="pre">model-R1,</span> <span class="pre">model-R2,</span> <span class="pre">...model-R11</span></code>, and the parameter
values could be multiplied by the interval <code class="docutils literal notranslate"><span class="pre">P1M</span></code> (one month) to get
the start point for the corresponding model run.</p>
<p>This method is only good for smaller workflows of finite duration because every
single task has to be mapped out in advance, and cylc has to be aware of all of
them throughout the entire run. Additionally Cylc’s <em>cycling workflow</em>
capabilities (above) are more powerful, more flexible, and generally easier to
use (Cylc will generate the cycle point date-times for you, for instance), so
that is the recommended way to drive most cycling systems.</p>
<p>The primary use for parameterized tasks in cylc is to generate ensembles and
other groups of related tasks at the same cycle point, not as a proxy for
cycling.</p>
</div>
<div class="section" id="mixed-cycling-workflows">
<h3>5.3. Mixed Cycling Workflows<a class="headerlink" href="#mixed-cycling-workflows" title="Permalink to this headline">¶</a></h3>
<p>For completeness we note that parameterized cycling can be used within a
cycling workflow. For example, in a daily cycling workflow long (daily)
model runs could be split into four shorter runs by parameterized cycling.
A simpler six-hourly cycling workflow should be considered first, however.</p>
</div>
</div>
<span id="document-global-site-user-conf"></span><div class="section" id="global-site-user-configuration-files">
<span id="siteanduserconfiguration"></span><h2>6. Global (Site, User) Configuration Files<a class="headerlink" href="#global-site-user-configuration-files" title="Permalink to this headline">¶</a></h2>
<p>Cylc site and user global configuration files contain settings that affect all
suites. Some of these, such as the range of network ports used by cylc,
should be set at site level. Legal items, values, and system defaults are
documented in (<a class="reference internal" href="index.html#sitercreference"><span class="std std-ref">Global (Site, User) Config File Reference</span></a>).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># cylc site global config file</span>
&lt;cylc-dir&gt;/etc/global.rc
</pre></div>
</div>
<p>Others, such as the preferred text editor for suite configurations,
can be overridden by users,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># cylc user global config file</span>
~/.cylc/<span class="k">$(</span>cylc --version<span class="k">)</span>/global.rc  <span class="c1"># e.g. ~/.cylc/7.8.2/global.rc</span>
</pre></div>
</div>
<p>The file <code class="docutils literal notranslate"><span class="pre">&lt;cylc-dir&gt;/etc/global.rc.eg</span></code> contains instructions on how
to generate and install site and user global config files:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#------------------------------------------------------------------------------
# How to create a site or user global.rc config file.
#------------------------------------------------------------------------------
# The &quot;cylc get-global-config&quot; command prints - in valid global.rc format -
# system global defaults, overridden by site global settings (if any),
# overridden by user global settings (if any).
#
# Therefore, to generate a new global config file, do this:
#   % cylc get-global-config &gt; global.rc
# edit it as needed and install it in the right location (below).
#
# For legal config items, see the User Guide&#39;s global.rc reference appendix.
#
# FILE LOCATIONS:
#----------------------
# SITE: delete or comment out items that you do not need to change (otherwise
# you may unwittingly override future changes to system defaults).
#
# The SITE FILE LOCATION is [cylc-dir]/etc/global.rc, where [cylc-dir] is your
# install location, e.g. /opt/cylc/cylc-7.8.2.
#
# FORWARD COMPATIBILITY: The site global.rc file must be kept in the source
# installation (i.e. it is version specific) because older versions of Cylc
# will not understand newer global config items. WHEN YOU INSTALL A NEW VERSION
# OF CYLC, COPY OVER YOUR OLD SITE GLOBAL CONFIG FILE AND ADD TO IT IF NEEDED.
#
#----------------------
# USER: delete or comment out items that you do not need to change (otherwise
# you may unwittingly override future changes to site or system defaults).
#
# The USER FILE LOCATIONS are:
#   1) ~/.cylc/&lt;CYLC-VERSION&gt;/global.rc  # e.g. ~/.cylc/7.8.2/global.rc
#   2) ~/.cylc/global.rc
# If the first lcoation is not found, the second will be checked.
# 
# The version-specific location is preferred - see FORWARD COMPATIBILITY above.
# WHEN YOU FIRST USE A NEW VERSION OF CYLC, COPY OVER YOUR OLD USER GLOBAL
# CONFIG FILE AND TO IT IF NEEDED. However, if you only set a items that don&#39;t
# change from one version to the next, you may be OK with the second location.
#------------------------------------------------------------------------------
</pre></div>
</div>
</div>
<span id="document-tutorial"></span><div class="section" id="tutorial">
<span id="id1"></span><h2>7. Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h2>
<p>This section provides a hands-on tutorial introduction to basic cylc
functionality.</p>
<div class="section" id="user-config-file">
<h3>7.1. User Config File<a class="headerlink" href="#user-config-file" title="Permalink to this headline">¶</a></h3>
<p>Some settings affecting cylc’s behaviour can be defined in site and user
<em>global config files</em>. For example, to choose the text editor invoked by
cylc on suite configurations:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># $HOME/.cylc/$(cylc --version)/global.rc</span>
<span class="nt">[editors]</span>
    <span class="nv">terminal </span><span class="o">=</span><span class="s"> vim</span>
    <span class="nv">gui </span><span class="o">=</span><span class="s"> gvim -f</span>
</pre></div>
</div>
<ul class="simple">
<li>For more on site and user global config files
see <a class="reference internal" href="index.html#siteanduserconfiguration"><span class="std std-ref">Global (Site, User) Configuration Files</span></a> and <a class="reference internal" href="index.html#sitercreference"><span class="std std-ref">Global (Site, User) Config File Reference</span></a>.</li>
</ul>
<div class="section" id="configure-environment-on-job-hosts">
<span id="id2"></span><h4>7.1.1. Configure Environment on Job Hosts<a class="headerlink" href="#configure-environment-on-job-hosts" title="Permalink to this headline">¶</a></h4>
<p>See <a class="reference internal" href="index.html#configure-site-environment-on-job-hosts"><span class="std std-ref">Configure Site Environment on Job Hosts</span></a> for information.</p>
</div>
</div>
<div class="section" id="user-interfaces">
<span id="cui"></span><h3>7.2. User Interfaces<a class="headerlink" href="#user-interfaces" title="Permalink to this headline">¶</a></h3>
<p>You should have access to the cylc command line (CLI) and graphical (GUI) user
interfaces once cylc has been installed as described in
Section <a class="reference internal" href="index.html#installcylc"><span class="std std-ref">Installing Cylc</span></a>.</p>
<div class="section" id="command-line-interface-cli">
<h4>7.2.1. Command Line Interface (CLI)<a class="headerlink" href="#command-line-interface-cli" title="Permalink to this headline">¶</a></h4>
<p>The command line interface is unified under a single top level
<code class="docutils literal notranslate"><span class="pre">cylc</span></code> command that provides access to many sub-commands
and their help documentation.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc <span class="nb">help</span>       <span class="c1"># Top level command help.</span>
$ cylc run --help <span class="c1"># Example command-specific help.</span>
</pre></div>
</div>
<p>Command help transcripts are printed in <a class="reference internal" href="index.html#commandreference"><span class="std std-ref">Command Reference</span></a> and are
available from the GUI Help menu.</p>
<p>Cylc is <em>scriptable</em> - the error status returned by commands can be
relied on.</p>
</div>
<div class="section" id="graphical-user-interface-gui">
<h4>7.2.2. Graphical User Interface (GUI)<a class="headerlink" href="#graphical-user-interface-gui" title="Permalink to this headline">¶</a></h4>
<p>The cylc GUI covers the same functionality as the CLI, but it has more
sophisticated suite monitoring capability. It can start and stop suites, or
connect to suites that are already running; in either case, shutting down the
GUI does not affect the suite itself.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ gcylc <span class="p">&amp;</span> <span class="c1"># or:</span>
$ cylc gui <span class="p">&amp;</span> <span class="c1"># Single suite control GUI.</span>
$ cylc gscan <span class="p">&amp;</span> <span class="c1"># Multi-suite monitor GUI.</span>
</pre></div>
</div>
<p>Clicking on a suite in gscan, shown in <a class="reference internal" href="index.html#fig-gscan"><span class="std std-numref">Fig. 12</span></a>, opens a
gcylc instance for it.</p>
</div>
</div>
<div class="section" id="suite-configuration">
<h3>7.3. Suite Configuration<a class="headerlink" href="#suite-configuration" title="Permalink to this headline">¶</a></h3>
<p>Cylc suites are defined by extended-INI format <code class="docutils literal notranslate"><span class="pre">suite.rc</span></code>
files (the main file format extension is section nesting). These reside
in <em>suite configuration directories</em> that may also contain a
<code class="docutils literal notranslate"><span class="pre">bin</span></code> directory and any other suite-related files.</p>
<ul class="simple">
<li>For more on the suite configuration file format, see <a class="reference internal" href="index.html#suitedefinition"><span class="std std-ref">Suite Configuration</span></a>
and <a class="reference internal" href="index.html#suitercreference"><span class="std std-ref">Suite.rc Reference</span></a>.</li>
</ul>
</div>
<div class="section" id="suite-registration">
<h3>7.4. Suite Registration<a class="headerlink" href="#suite-registration" title="Permalink to this headline">¶</a></h3>
<p>Suite registration creates a run directory (under <code class="docutils literal notranslate"><span class="pre">~/cylc-run/</span></code> by
default) and populates it with authentication files and a symbolic link to a
suite configuration directory. Cylc commands that parse suites can take
the file path or the suite name as input. Commands that interact with running
suites have to target the suite by name.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Target a suite by file path:</span>
$ cylc validate /path/to/my/suite/suite.rc
$ cylc graph /path/to/my/suite/suite.rc

<span class="c1"># Register a suite:</span>
$ cylc register my.suite /path/to/my/suite/

<span class="c1"># Target a suite by name:</span>
$ cylc graph my.suite
$ cylc validate my.suite
$ cylc run my.suite
$ cylc stop my.suite
<span class="c1"># etc.</span>
</pre></div>
</div>
</div>
<div class="section" id="suite-passphrases">
<span id="tutpassphrases"></span><h3>7.5. Suite Passphrases<a class="headerlink" href="#suite-passphrases" title="Permalink to this headline">¶</a></h3>
<p>Registration (above) also generates a suite-specific passphrase file under
<code class="docutils literal notranslate"><span class="pre">.service/</span></code> in the suite run directory. It is loaded by the suite
server program at start-up and used to authenticate connections from client
programs.</p>
<p>Possession of a suite’s passphrase file gives full control over it.
Without it, the information available to a client is determined by the suite’s
public access privilege level.</p>
<p>For more on connection authentication, suite passphrases, and public access,
see <a class="reference internal" href="index.html#connectionauthentication"><span class="std std-ref">Client-Server Interaction</span></a>.</p>
</div>
<div class="section" id="import-the-example-suites">
<span id="importtheexamplesuites"></span><h3>7.6. Import The Example Suites<a class="headerlink" href="#import-the-example-suites" title="Permalink to this headline">¶</a></h3>
<p>Run the following command to copy cylc’s example suites and register them for
your own use:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc import-examples /tmp
</pre></div>
</div>
</div>
<div class="section" id="rename-the-imported-tutorial-suites">
<h3>7.7. Rename The Imported Tutorial Suites<a class="headerlink" href="#rename-the-imported-tutorial-suites" title="Permalink to this headline">¶</a></h3>
<p>Suites can be renamed by simply renaming (i.e. moving) their run directories.
Make the tutorial suite names shorter, and print their locations with
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">print</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mv ~/cylc-run/examples/<span class="k">$(</span>cylc --version<span class="k">)</span>/tutorial ~/cylc-run/tut
$ cylc print -ya tut
tut/oneoff/jinja2  <span class="p">|</span> /tmp/cylc-examples/7.0.0/tutorial/oneoff/jinja2
tut/cycling/two    <span class="p">|</span> /tmp/cylc-examples/7.0.0/tutorial/cycling/two
tut/cycling/three  <span class="p">|</span> /tmp/cylc-examples/7.0.0/tutorial/cycling/three
<span class="c1"># ...</span>
</pre></div>
</div>
<p>See <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">print</span> <span class="pre">--help</span></code> for other display options.</p>
</div>
<div class="section" id="suite-validation">
<h3>7.8. Suite Validation<a class="headerlink" href="#suite-validation" title="Permalink to this headline">¶</a></h3>
<p>Suite configurations can be validated to detect syntax (and other) errors:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># pass:</span>
$ cylc validate tut/oneoff/basic
Valid <span class="k">for</span> cylc-6.0.0
$ <span class="nb">echo</span> <span class="nv">$?</span>
<span class="m">0</span>
<span class="c1"># fail:</span>
$ cylc validate my/bad/suite
Illegal item: <span class="o">[</span>scheduling<span class="o">]</span>special tusks
$ <span class="nb">echo</span> <span class="nv">$?</span>
<span class="m">1</span>
</pre></div>
</div>
</div>
<div class="section" id="hello-world-in-cylc">
<h3>7.9. Hello World in Cylc<a class="headerlink" href="#hello-world-in-cylc" title="Permalink to this headline">¶</a></h3>
<p><strong>suite</strong>: <code class="docutils literal notranslate"><span class="pre">tut/oneoff/basic</span></code></p>
<p>Here’s the traditional <em>Hello World</em> program rendered as a cylc
suite:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;The cylc Hello World! suite&quot;</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">hello</span><span class="c">&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[hello]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;sleep 10; echo Hello World!&quot;</span>
</pre></div>
</div>
<p>Cylc suites feature a clean separation of scheduling configuration,
which determines <em>when</em> tasks are ready to run; and runtime
configuration, which determines <em>what</em> to run (and <em>where</em> and
<em>how</em> to run it) when a task is ready. In this example the
<code class="docutils literal notranslate"><span class="pre">[scheduling]</span></code> section defines a single task called
<code class="docutils literal notranslate"><span class="pre">hello</span></code> that triggers immediately when the suite starts
up. When the task finishes the suite shuts down. That this is a
<em>dependency graph</em> will be more obvious when more tasks are added.
Under the <code class="docutils literal notranslate"><span class="pre">[runtime]</span></code> section the
<code class="docutils literal notranslate"><span class="pre">script</span></code> item defines a simple inlined
implementation for <code class="docutils literal notranslate"><span class="pre">hello</span></code>: it sleeps for ten seconds,
then prints <code class="docutils literal notranslate"><span class="pre">Hello</span> <span class="pre">World!</span></code>, and exits. This ends up in a <em>job script</em>
generated by cylc to encapsulate the task (below) and,
thanks to some defaults designed to allow quick
prototyping of new suites, it is submitted to run as a background job on
the suite host. In fact cylc even provides a default task implementation
that makes the entire <code class="docutils literal notranslate"><span class="pre">[runtime]</span></code> section technically optional:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;The minimal complete runnable cylc suite&quot;</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span><span class="c">&quot;</span>
<span class="c1"># (actually, &#39;title&#39; is optional too ... and so is this comment)</span>
</pre></div>
</div>
<p>(the resulting <em>dummy task</em> just prints out some identifying
information and exits).</p>
</div>
<div class="section" id="editing-suites">
<h3>7.10. Editing Suites<a class="headerlink" href="#editing-suites" title="Permalink to this headline">¶</a></h3>
<p>The text editor invoked by Cylc on suite configurations is determined
by cylc site and user global config files, as shown above in <a class="reference internal" href="#cui"><span class="std std-ref">User Interfaces</span></a>.
Check that you have renamed the tutorial examples suites as described
just above and open the <em>Hello World</em> suite in your text editor:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc edit tut/oneoff/basic <span class="c1"># in-terminal</span>
$ cylc edit -g tut/oneoff/basic <span class="p">&amp;</span> <span class="c1"># or GUI</span>
</pre></div>
</div>
<p>Alternatively, start gcylc on the suite:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ gcylc tut/oneoff/basic <span class="p">&amp;</span>
</pre></div>
</div>
<p>and choose <em>Suite</em> <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> <em>Edit</em> from the menu.</p>
<p>The editor will be invoked from within the suite configuration directory
for easy access to other suite files (in this case there are none). There are
syntax highlighting control files for several text editors under
<code class="docutils literal notranslate"><span class="pre">&lt;cylc-dir&gt;/etc/syntax/</span></code>; see in-file comments for installation
instructions.</p>
</div>
<div class="section" id="running-suites">
<span id="runningsuitescli"></span><h3>7.11. Running Suites<a class="headerlink" href="#running-suites" title="Permalink to this headline">¶</a></h3>
<div class="section" id="cli">
<h4>7.11.1. CLI<a class="headerlink" href="#cli" title="Permalink to this headline">¶</a></h4>
<p>Run <code class="docutils literal notranslate"><span class="pre">tut/oneoff/basic</span></code> using the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">run</span></code> command.
As a suite runs detailed timestamped information is written to a <em>suite log</em>
and progress can be followed with cylc’s suite monitoring tools (below).
By default a suite server program daemonizes after printing a short message so
that you can exit the terminal or even log out without killing the suite:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc run tut/oneoff/basic
            ._.
            <span class="p">|</span> <span class="p">|</span>                 The Cylc Suite Engine <span class="o">[</span><span class="m">7</span>.0.0<span class="o">]</span>
._____._. ._<span class="p">|</span> <span class="p">|</span>_____.           Copyright <span class="o">(</span>C<span class="o">)</span> NIWA <span class="p">&amp;</span> British Crown <span class="o">(</span>Met Office<span class="o">)</span> <span class="p">&amp;</span> Contributors.
<span class="p">|</span> .___<span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> .___<span class="p">|</span>  _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
<span class="p">|</span> !___<span class="p">|</span> !_! <span class="p">|</span> <span class="p">|</span> !___.  This program comes with ABSOLUTELY NO WARRANTY<span class="p">;</span>
!_____!___. <span class="p">|</span>_!_____!  see <span class="sb">`</span>cylc warranty<span class="sb">`</span>.  It is free software, you
      .___! <span class="p">|</span>           are welcome to redistribute it under certain
      !_____!                conditions<span class="p">;</span> see <span class="sb">`</span>cylc conditions<span class="sb">`</span>.

*** listening on https://nwp-1:43027/ ***

To view suite server program contact information:
 $ cylc get-suite-contact tut/oneoff/basic

Other ways to see <span class="k">if</span> the suite is still running:
 $ cylc scan -n <span class="s1">&#39;\btut/oneoff/basic\b&#39;</span> nwp-1
 $ cylc ping -v --host<span class="o">=</span>nwp-1 tut/oneoff/basic
 $ ps h -opid,args <span class="m">123456</span>  <span class="c1"># on nwp-1</span>
</pre></div>
</div>
<p>If you’re quick enough (this example only takes 10-15 seconds to run) the
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">scan</span></code> command will detect the running suite:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc scan
tut/oneoff/basic oliverh@nwp-1:43027
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can use the <code class="docutils literal notranslate"><span class="pre">--no-detach</span></code> and <code class="docutils literal notranslate"><span class="pre">--debug</span></code> options
to <code class="docutils literal notranslate"><span class="pre">cylc-run</span></code> to prevent the suite from daemonizing (i.e. to make
it stay attached to your terminal until it exits).</p>
</div>
<p>When a task is ready cylc generates a <em>job script</em> to run it, by
default as a background jobs on the suite host.  The job process ID is
captured, and job output is directed to log files in standard
locations under the suite run directory.</p>
<p>Log file locations relative to the suite run directory look like
<code class="docutils literal notranslate"><span class="pre">job/1/hello/01/</span></code> where the first digit is the <em>cycle point</em> of
the task <code class="docutils literal notranslate"><span class="pre">hello</span></code> (for non-cycling tasks this is just <code class="docutils literal notranslate"><span class="pre">1</span></code>); and the
final <code class="docutils literal notranslate"><span class="pre">01</span></code> is the <em>submit number</em> (so that job logs do not get
overwritten if a job is resubmitted for any reason).</p>
<p>The suite shuts down automatically once all tasks have succeeded.</p>
</div>
<div class="section" id="gui">
<h4>7.11.2. GUI<a class="headerlink" href="#gui" title="Permalink to this headline">¶</a></h4>
<p>The cylc GUI can start and stop suites, or (re)connect to suites that
are already running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc gui tut/oneoff/basic <span class="p">&amp;</span>
</pre></div>
</div>
<p>Use the tool bar <em>Play</em> button, or the <em>Control</em> <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> <em>Run</em> menu item, to
run the suite again. You may want to alter the suite configuration slightly
to make the task take longer to run. Try right-clicking on the
<code class="docutils literal notranslate"><span class="pre">hello</span></code> task to view its output logs. The relative merits of the three
<em>suite views</em> - dot, text, and graph - will be more apparent later when we
have more tasks. Closing the GUI does not affect the suite itself.</p>
</div>
</div>
<div class="section" id="remote-suites">
<span id="remotesuites"></span><h3>7.12. Remote Suites<a class="headerlink" href="#remote-suites" title="Permalink to this headline">¶</a></h3>
<p>Suites can run on <em>localhost</em> or on a <em>remote</em> host.</p>
<p>To start up a suite on a given host, specify it explicitly via the
<code class="docutils literal notranslate"><span class="pre">--host=</span></code> option to a <code class="docutils literal notranslate"><span class="pre">run</span></code> or <code class="docutils literal notranslate"><span class="pre">restart</span></code> command.</p>
<p>Otherwise, Cylc selects the best host to start up on from allowed
<code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">hosts</span></code> as specified in the global config under
<code class="docutils literal notranslate"><span class="pre">[suite</span> <span class="pre">servers]</span></code>, which defaults to localhost. Should there be
more than one allowed host set, the <em>most suitable</em> is determined
according to the settings specified under <code class="docutils literal notranslate"><span class="pre">[[run</span> <span class="pre">host</span> <span class="pre">select]]</span></code>,
namely exclusion of hosts not meeting suitability <em>thresholds</em>, if
provided, then ranking according to the given <em>rank</em> method.</p>
</div>
<div class="section" id="discovering-running-suites">
<h3>7.13. Discovering Running Suites<a class="headerlink" href="#discovering-running-suites" title="Permalink to this headline">¶</a></h3>
<p>Suites that are currently running can be detected with command line or
GUI tools:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># list currently running suites and their port numbers:</span>
$ cylc scan
tut/oneoff/basic oliverh@nwp-1:43001

<span class="c1"># GUI summary view of running suites:</span>
$ cylc gscan <span class="p">&amp;</span>
</pre></div>
</div>
<p>The scan GUI is shown in <a class="reference internal" href="index.html#fig-gscan"><span class="std std-numref">Fig. 12</span></a>; clicking on a suite in
it opens gcylc.</p>
</div>
<div class="section" id="task-identifiers">
<span id="taskidentifiers"></span><h3>7.14. Task Identifiers<a class="headerlink" href="#task-identifiers" title="Permalink to this headline">¶</a></h3>
<p>At run time, task instances are identified by their <em>name</em> (see
<a class="reference internal" href="index.html#tasknames"><span class="std std-ref">Task and Namespace Names</span></a>), which is determined entirely by the suite configuration,
and a <em>cycle point</em> which is usually a date-time or an integer:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>foo.20100808T00Z   <span class="c1"># a task with a date-time cycle point</span>
bar.1              <span class="c1"># a task with an integer cycle point (could be non-cycling)</span>
</pre></div>
</div>
<p>Non-cycling tasks usually just have the cycle point <code class="docutils literal notranslate"><span class="pre">1</span></code>, but this
still has to be used to target the task instance with cylc commands.</p>
</div>
<div class="section" id="job-submission-how-tasks-are-executed">
<h3>7.15. Job Submission: How Tasks Are Executed<a class="headerlink" href="#job-submission-how-tasks-are-executed" title="Permalink to this headline">¶</a></h3>
<p><strong>suite</strong>: <code class="docutils literal notranslate"><span class="pre">tut/oneoff/jobsub</span></code></p>
<p>Task <em>job scripts</em> are generated by cylc to wrap the task implementation
specified in the suite configuration (environment, script, etc.) in
error trapping code, messaging calls to report task progress back to the suite
server program, and so forth. Job scripts are written to the <em>suite job log
directory</em> where they can be viewed alongside the job output logs. They
can be accessed at run time by right-clicking on the task in the cylc GUI, or
printed to the terminal:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc cat-log tut/oneoff/basic hello.1
</pre></div>
</div>
<p>This command can also print the suite log (and stdout and stderr for suites
in daemon mode) and task stdout and stderr logs (see
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">cat-log</span> <span class="pre">--help</span></code>).</p>
<p>A new job script can also be generated on the fly for inspection:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc jobscript tut/oneoff/basic hello.1
</pre></div>
</div>
<p>Take a look at the job script generated for <code class="docutils literal notranslate"><span class="pre">hello.1</span></code> during
the suite run above. The custom scripting should be clearly visible
toward the bottom of the file.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">hello</span></code> task in the first tutorial suite defaults to
running as a background job on the suite host. To submit it to the Unix
<code class="docutils literal notranslate"><span class="pre">at</span></code> scheduler instead, configure its job submission settings
as in <code class="docutils literal notranslate"><span class="pre">tut/oneoff/jobsub</span></code>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[hello]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;sleep 10; echo Hello World!&quot;</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> at</span>
</pre></div>
</div>
<p>Run the suite again after checking that <code class="docutils literal notranslate"><span class="pre">at</span></code> is running on your
system.</p>
<p>Cylc supports a number of different batch systems. Tasks
submitted to external batch queuing systems like <code class="docutils literal notranslate"><span class="pre">at</span></code>,
<code class="docutils literal notranslate"><span class="pre">PBS</span></code>, <code class="docutils literal notranslate"><span class="pre">SLURM</span></code>, <code class="docutils literal notranslate"><span class="pre">Moab</span></code>, or <code class="docutils literal notranslate"><span class="pre">LoadLeveler</span></code>, are displayed as
<em>submitted</em> in the cylc GUI until they start executing.</p>
<ul class="simple">
<li>For more on task job scripts, see <a class="reference internal" href="index.html#jobscripts"><span class="std std-ref">Task Job Scripts</span></a>.</li>
<li>For more on batch systems, see <a class="reference internal" href="index.html#availablemethods"><span class="std std-ref">Supported Job Submission Methods</span></a>.</li>
</ul>
</div>
<div class="section" id="locating-suite-and-task-output">
<h3>7.16. Locating Suite And Task Output<a class="headerlink" href="#locating-suite-and-task-output" title="Permalink to this headline">¶</a></h3>
<p>If the <code class="docutils literal notranslate"><span class="pre">--no-detach</span></code> option is not used, suite stdout and
stderr will be directed to the suite run directory along with the
time-stamped suite log file, and task job scripts and job logs
(task stdout and stderr). The default suite run directory location is
<code class="docutils literal notranslate"><span class="pre">$HOME/cylc-run</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ tree <span class="nv">$HOME</span>/cylc-run/tut/oneoff/basic/
<span class="p">|</span>-- .service              <span class="c1"># location of run time service files</span>
<span class="p">|</span>    <span class="p">|</span>-- contact          <span class="c1"># detail on how to contact the running suite</span>
<span class="p">|</span>    <span class="p">|</span>-- db               <span class="c1"># private suite run database</span>
<span class="p">|</span>    <span class="p">|</span>-- passphrase       <span class="c1"># passphrase for client authentication</span>
<span class="p">|</span>    <span class="p">|</span>-- <span class="nb">source</span>           <span class="c1"># symbolic link to source directory</span>
<span class="p">|</span>    <span class="p">|</span>-- ssl.cert         <span class="c1"># SSL certificate for the suite server</span>
<span class="p">|</span>    <span class="sb">`</span>-- ssl.pem          <span class="c1"># SSL private key</span>
<span class="p">|</span>-- cylc-suite.db         <span class="c1"># back compat symlink to public suite run database</span>
<span class="p">|</span>-- share                 <span class="c1"># suite share directory (not used in this example)</span>
<span class="p">|</span>-- work                  <span class="c1"># task work space (sub-dirs are deleted if not used)</span>
<span class="p">|</span>    <span class="sb">`</span>-- <span class="m">1</span>                   <span class="c1"># task cycle point directory (or 1)</span>
<span class="p">|</span>        <span class="sb">`</span>-- hello              <span class="c1"># task work directory (deleted if not used)</span>
<span class="p">|</span>-- log                   <span class="c1"># suite log directory</span>
<span class="p">|</span>   <span class="p">|</span>-- db                   <span class="c1"># public suite run database</span>
<span class="p">|</span>   <span class="p">|</span>-- job                  <span class="c1"># task job log directory</span>
<span class="p">|</span>   <span class="p">|</span>   <span class="sb">`</span>-- <span class="m">1</span>                   <span class="c1"># task cycle point directory (or 1)</span>
<span class="p">|</span>   <span class="p">|</span>       <span class="sb">`</span>-- hello              <span class="c1"># task name</span>
<span class="p">|</span>   <span class="p">|</span>           <span class="p">|</span>-- <span class="m">01</span>                <span class="c1"># task submission number</span>
<span class="p">|</span>   <span class="p">|</span>           <span class="p">|</span>   <span class="p">|</span>-- job              <span class="c1"># task job script</span>
<span class="p">|</span>   <span class="p">|</span>           <span class="p">|</span>   <span class="sb">`</span>-- job-activity.log <span class="c1"># task job activity log</span>
<span class="p">|</span>   <span class="p">|</span>           <span class="p">|</span>   <span class="p">|</span>-- job.err          <span class="c1"># task stderr log</span>
<span class="p">|</span>   <span class="p">|</span>           <span class="p">|</span>   <span class="p">|</span>-- job.out          <span class="c1"># task stdout log</span>
<span class="p">|</span>   <span class="p">|</span>           <span class="p">|</span>   <span class="sb">`</span>-- job.status       <span class="c1"># task status file</span>
<span class="p">|</span>   <span class="p">|</span>           <span class="sb">`</span>-- NN -&gt; <span class="m">01</span>          <span class="c1"># symlink to latest submission number</span>
<span class="p">|</span>   <span class="sb">`</span>-- suite                <span class="c1"># suite server log directory</span>
<span class="p">|</span>       <span class="p">|</span>-- err                 <span class="c1"># suite server stderr log (daemon mode only)</span>
<span class="p">|</span>       <span class="p">|</span>-- out                 <span class="c1"># suite server stdout log (daemon mode only)</span>
<span class="p">|</span>       <span class="sb">`</span>-- log                 <span class="c1"># suite server event log (timestamped info)</span>
</pre></div>
</div>
<p>The suite run database files, suite environment file,
and task status files are used internally by cylc. Tasks execute in
private <code class="docutils literal notranslate"><span class="pre">work/</span></code> directories that are deleted automatically
if empty when the task finishes. The suite
<code class="docutils literal notranslate"><span class="pre">share/</span></code> directory is made available to all tasks (by
<code class="docutils literal notranslate"><span class="pre">$CYLC_SUITE_SHARE_DIR</span></code>) as a common share space. The task submission
number increments from <code class="docutils literal notranslate"><span class="pre">1</span></code> if a task retries; this is used as a
sub-directory of the log tree to avoid overwriting log files from earlier
job submissions.</p>
<p>The top level run directory location can be changed in site and user
config files if necessary, and the suite share and work locations can be
configured separately because of the potentially larger disk space
requirement.</p>
<p>Task job logs can be viewed by right-clicking on tasks in the gcylc
GUI (so long as the task proxy is live in the suite), manually
accessed from the log directory (of course), or printed to the terminal
with the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">cat-log</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># suite logs:</span>
$ cylc cat-log    tut/oneoff/basic           <span class="c1"># suite event log</span>
$ cylc cat-log -o tut/oneoff/basic           <span class="c1"># suite stdout log</span>
$ cylc cat-log -e tut/oneoff/basic           <span class="c1"># suite stderr log</span>
<span class="c1"># task logs:</span>
$ cylc cat-log    tut/oneoff/basic hello.1   <span class="c1"># task job script</span>
$ cylc cat-log -o tut/oneoff/basic hello.1   <span class="c1"># task stdout log</span>
$ cylc cat-log -e tut/oneoff/basic hello.1   <span class="c1"># task stderr log</span>
</pre></div>
</div>
<ul class="simple">
<li>For a web-based interface to suite and task logs (and much more),
see <em>Rose</em> in <a class="reference internal" href="index.html#suitestorageetc"><span class="std std-ref">Suite Storage, Discovery, Revision Control, and Deployment</span></a>.</li>
<li>For more on environment variables supplied to tasks, such as
<code class="docutils literal notranslate"><span class="pre">$CYLC_SUITE_SHARE_DIR</span></code>, see <a class="reference internal" href="index.html#taskexecutionenvironment"><span class="std std-ref">Task Execution Environment</span></a>.</li>
</ul>
</div>
<div class="section" id="viewing-suite-logs-in-a-web-browser-cylc-review">
<span id="viewingsuitelogscylcreview"></span><h3>7.17. Viewing Suite Logs in a Web Browser: Cylc Review<a class="headerlink" href="#viewing-suite-logs-in-a-web-browser-cylc-review" title="Permalink to this headline">¶</a></h3>
<p>The Cylc Review web service displays suite job logs and other information in
web pages, as shown in <a class="reference internal" href="#fig-review-screenshot"><span class="std std-numref">Fig. 14</span></a>. It can run under a
WSGI server (e.g. Apache with <code class="docutils literal notranslate"><span class="pre">mod_wsgi</span></code>) as a service for all
users, or as an ad hoc service under your own user account.</p>
<p>If a central Cylc Review service has been set up at your site (e.g. as
described in <a class="reference internal" href="index.html#configuringcylcreviewapache"><span class="std std-ref">Configuring Cylc Review Under Apache</span></a>) the URL will typically be
something like <code class="docutils literal notranslate"><span class="pre">http://&lt;server&gt;/cylc-review/</span></code>.</p>
<div class="figure align-center" id="id4">
<span id="fig-review-screenshot"></span><img alt="_images/cylc-review-screenshot.png" src="_images/cylc-review-screenshot.png" />
<p class="caption"><span class="caption-number">Fig. 14 </span><span class="caption-text">Screenshot of a Cylc Review web page</span></p>
</div>
<p>Otherwise, to start an ad hoc Cylc Review service to view your own suite logs
(or those of others, if you have read access to them), run:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>setsid cylc review start 0&lt;/dev/null 1&gt;/dev/null 2&gt;&amp;1 &amp;
</pre></div>
</div>
<p>The service should start at <code class="docutils literal notranslate"><span class="pre">http://&lt;server&gt;:8080</span></code> (the port number
can optionally be set on the command line). Service logs are written to
<code class="docutils literal notranslate"><span class="pre">~/.cylc/cylc-review*</span></code>. Run <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">review</span></code> to view
status information, and <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">review</span> <span class="pre">stop</span></code> to stop the service.</p>
</div>
<div class="section" id="remote-tasks">
<span id="remotetasks"></span><h3>7.18. Remote Tasks<a class="headerlink" href="#remote-tasks" title="Permalink to this headline">¶</a></h3>
<p><strong>suite</strong>: <code class="docutils literal notranslate"><span class="pre">tut/oneoff/remote</span></code></p>
<p>The <code class="docutils literal notranslate"><span class="pre">hello</span></code> task in the first two tutorial suites defaults to
running on the suite host <a class="reference internal" href="#remotesuites"><span class="std std-ref">Remote Suites</span></a>. To make it run on a different
host instead change its runtime configuration as in <code class="docutils literal notranslate"><span class="pre">tut/oneoff/remote</span></code>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[hello]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;sleep 10; echo Hello World!&quot;</span>
        <span class="nt">[[[remote]]]</span>
            <span class="nv">host </span><span class="o">=</span><span class="s"> server1.niwa.co.nz</span>
</pre></div>
</div>
<p>In general, a <em>task remote</em> is a user account, other than the account
running the suite server program, where a task job is submitted to run. It can
be on the same machine running the suite or on another machine.</p>
<p>A task remote account must satisfy several requirements:</p>
<ul class="simple">
<li>Non-interactive ssh must be enabled from the account running the suite
server program to the account for submitting (and managing) the remote
task job.</li>
<li>Network settings must allow communication <em>back</em> from the remote task
job to the suite, either by network ports or ssh, unless the last-resort one
way <em>task polling</em> communication method is used.</li>
<li>Cylc must be installed and runnable on the task remote account. Other
software dependencies like graphviz are not required there.</li>
<li>Any files needed by a remote task must be installed on the task
host. In this example there is nothing to install because the
implementation of <code class="docutils literal notranslate"><span class="pre">hello</span></code> is inlined in the suite configuration
and thus ends up entirely contained within the task job script.</li>
</ul>
<p>If your username is different on the task host, you can add a <code class="docutils literal notranslate"><span class="pre">User</span></code>
setting for the relevant host in your <code class="docutils literal notranslate"><span class="pre">~/.ssh/config</span></code>.
If you are unable to do so, the <code class="docutils literal notranslate"><span class="pre">[[[remote]]]</span></code> section also supports an
<code class="docutils literal notranslate"><span class="pre">owner=username</span></code> item.</p>
<p>If you configure a task account according to the requirements cylc will invoke
itself on the remote account (with a login shell by default) to create log
directories, transfer any essential service files, send the task job script
over, and submit it to run there by the configured batch system.</p>
<p>Remote task job logs are saved to the suite run directory on the task remote,
not on the account running the suite. They can be retrieved by right-clicking
on the task in the GUI, or to have cylc pull them back to the suite account
automatically do this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[hello]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;sleep 10; echo Hello World!&quot;</span>
        <span class="nt">[[[remote]]]</span>
            <span class="nv">host </span><span class="o">=</span><span class="s"> server1.niwa.co.nz</span>
            <span class="nv">retrieve job logs </span><span class="o">=</span><span class="s"> True</span>
</pre></div>
</div>
<p>This suite will attempt to <code class="docutils literal notranslate"><span class="pre">rsync</span></code> job logs from the remote
host each time a task job completes.</p>
<p>Some batch systems have considerable delays between the time when the job
completes and when it writes the job logs in its normal location. If this is
the case, you can configure an initial delay and retry delays for job log
retrieval by setting some delays. E.g.:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[hello]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;sleep 10; echo Hello World!&quot;</span>
        <span class="nt">[[[remote]]]</span>
            <span class="nv">host </span><span class="o">=</span><span class="s"> server1.niwa.co.nz</span>
            <span class="nv">retrieve job logs </span><span class="o">=</span><span class="s"> True</span>
            <span class="c1"># Retry after 10 seconds, 1 minute and 3 minutes</span>
            <span class="nv">retrieve job logs retry delays </span><span class="o">=</span><span class="s"> PT10S, PT1M, PT3M</span>
</pre></div>
</div>
<p>Finally, if the disk space of the suite host is limited, you may want to set
<code class="docutils literal notranslate"><span class="pre">[[[remote]]]retrieve</span> <span class="pre">job</span> <span class="pre">logs</span> <span class="pre">max</span> <span class="pre">size=SIZE</span></code>. The value of SIZE can
be anything that is accepted by the <code class="docutils literal notranslate"><span class="pre">--max-size=SIZE</span></code> option of the
<code class="docutils literal notranslate"><span class="pre">rsync</span></code> command. E.g.:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[hello]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;sleep 10; echo Hello World!&quot;</span>
        <span class="nt">[[[remote]]]</span>
            <span class="nv">host </span><span class="o">=</span><span class="s"> server1.niwa.co.nz</span>
            <span class="nv">retrieve job logs </span><span class="o">=</span><span class="s"> True</span>
            <span class="c1"># Don&#39;t get anything bigger than 10MB</span>
            <span class="nv">retrieve job logs max size </span><span class="o">=</span><span class="s"> 10M</span>
</pre></div>
</div>
<p>It is worth noting that cylc uses the existence of a job’s <code class="docutils literal notranslate"><span class="pre">job.out</span></code>
or <code class="docutils literal notranslate"><span class="pre">job.err</span></code> in the local file system to indicate a successful job
log retrieval. If <code class="docutils literal notranslate"><span class="pre">retrieve</span> <span class="pre">job</span> <span class="pre">logs</span> <span class="pre">max</span> <span class="pre">size=SIZE</span></code> is set and both
<code class="docutils literal notranslate"><span class="pre">job.out</span></code> and <code class="docutils literal notranslate"><span class="pre">job.err</span></code> are bigger than <code class="docutils literal notranslate"><span class="pre">SIZE</span></code>
then cylc will consider the retrieval as failed. If retry delays are specified,
this will trigger some useless (but harmless) retries. If this occurs
regularly, you should try the following:</p>
<ul class="simple">
<li>Reduce the verbosity of STDOUT or STDERR from the task.</li>
<li>Redirect the verbosity from STDOUT or STDERR to an alternate log file.</li>
<li>Adjust the size limit with tolerance to the expected size of STDOUT or
STDERR.</li>
<li>For more on remote tasks see <a class="reference internal" href="index.html#runningtasksonaremotehost"><span class="std std-ref">Remote Task Hosting</span></a></li>
<li>For more on task communications, see <a class="reference internal" href="index.html#taskcomms"><span class="std std-ref">Tracking Task State</span></a>.</li>
<li>For more on suite passphrases and authentication,
see <a class="reference internal" href="#tutpassphrases"><span class="std std-ref">Suite Passphrases</span></a> and <a class="reference internal" href="index.html#connectionauthentication"><span class="std std-ref">Client-Server Interaction</span></a>.</li>
</ul>
</div>
<div class="section" id="task-triggering">
<h3>7.19. Task Triggering<a class="headerlink" href="#task-triggering" title="Permalink to this headline">¶</a></h3>
<p><strong>suite</strong>: <code class="docutils literal notranslate"><span class="pre">tut/oneoff/goodbye</span></code></p>
<p>To make a second task called <code class="docutils literal notranslate"><span class="pre">goodbye</span></code> trigger after
<code class="docutils literal notranslate"><span class="pre">hello</span></code> finishes successfully, return to the original
example, <code class="docutils literal notranslate"><span class="pre">tut/oneoff/basic</span></code>, and change the suite graph
as in <code class="docutils literal notranslate"><span class="pre">tut/oneoff/goodbye</span></code>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">hello</span> <span class="o">=&gt;</span> <span class="kd">goodbye</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>or to trigger it at the same time as <code class="docutils literal notranslate"><span class="pre">hello</span></code>,</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">hello</span> <span class="o">&amp;</span> <span class="kd">goodbye</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>and configure the new task’s behaviour under <code class="docutils literal notranslate"><span class="pre">[runtime]</span></code>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[goodbye]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;sleep 10; echo Goodbye World!&quot;</span>
</pre></div>
</div>
<p>Run <code class="docutils literal notranslate"><span class="pre">tut/oneoff/goodbye</span></code> and check the output from the new task:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cat ~/cylc-run/tut/oneoff/goodbye/log/job/1/goodbye/01/job.out
  <span class="c1"># or</span>
$ cylc cat-log -o tut/oneoff/goodbye goodbye.1
JOB SCRIPT STARTING
cylc <span class="o">(</span>scheduler - <span class="m">2014</span>-08-14T15:09:30+12<span class="o">)</span>: goodbye.1 started at <span class="m">2014</span>-08-14T15:09:30+12
cylc Suite and Task Identity:
  Suite Name  : tut/oneoff/goodbye
  Suite Host  : oliverh-34403dl.niwa.local
  Suite Port  : <span class="m">43001</span>
  Suite Owner : oliverh
  Task ID     : goodbye.1
  Task Host   : nwp-1
  Task Owner  : oliverh
  Task Try No.: <span class="m">1</span>

Goodbye World!
cylc <span class="o">(</span>scheduler - <span class="m">2014</span>-08-14T15:09:40+12<span class="o">)</span>: goodbye.1 succeeded at <span class="m">2014</span>-08-14T15:09:40+12
JOB SCRIPT EXITING <span class="o">(</span>TASK SUCCEEDED<span class="o">)</span>
</pre></div>
</div>
<div class="section" id="task-failure-and-suicide-triggering">
<h4>7.19.1. Task Failure And Suicide Triggering<a class="headerlink" href="#task-failure-and-suicide-triggering" title="Permalink to this headline">¶</a></h4>
<p><strong>suite</strong>: <code class="docutils literal notranslate"><span class="pre">tut/oneoff/suicide</span></code></p>
<p>Task names in the graph string can be qualified with a state indicator
to trigger off task states other than success:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span>    <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="kd">a</span> <span class="o">=&gt;</span> <span class="kd">b</span>        <span class="c1"># trigger b if a succeeds</span>
<span class="kd">c</span><span class="c">:</span><span class="kd">submit</span> <span class="o">=&gt;</span> <span class="kd">d</span> <span class="c1"># trigger d if c submits</span>
<span class="kd">e</span><span class="c">:</span><span class="kd">finish</span> <span class="o">=&gt;</span> <span class="kd">f</span> <span class="c1"># trigger f if e succeeds or fails</span>
<span class="kd">g</span><span class="c">:</span><span class="kd">start</span>  <span class="o">=&gt;</span> <span class="kd">h</span> <span class="c1"># trigger h if g starts executing</span>
<span class="kd">i</span><span class="c">:</span><span class="kd">fail</span>   <span class="o">=&gt;</span> <span class="kd">j</span> <span class="c1"># trigger j if i fails</span>
            <span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>A common use of this is to automate recovery from known modes of failure:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">goodbye</span><span class="c">:</span><span class="kd">fail</span> <span class="o">=&gt;</span> <span class="kd">really_goodbye</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>i.e. if task <code class="docutils literal notranslate"><span class="pre">goodbye</span></code> fails, trigger another task that
(presumably) really says goodbye.</p>
<p>Failure triggering generally requires use of <em>suicide triggers</em> as
well, to remove the recovery task if it isn’t required (otherwise it
would hang about indefinitely in the waiting state):</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">hello</span> <span class="o">=&gt;</span> <span class="kd">goodbye</span>
            <span class="kd">goodbye</span><span class="c">:</span><span class="kd">fail</span> <span class="o">=&gt;</span> <span class="kd">really_goodbye</span>
         <span class="kd">goodbye</span> <span class="o">=&gt;</span> <span class="x">!really_goodbye</span> <span class="c1"># suicide&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>This means if <code class="docutils literal notranslate"><span class="pre">goodbye</span></code> fails, trigger
<code class="docutils literal notranslate"><span class="pre">really_goodbye</span></code>; and otherwise, if <code class="docutils literal notranslate"><span class="pre">goodbye</span></code>
succeeds, remove <code class="docutils literal notranslate"><span class="pre">really_goodbye</span></code> from the suite.</p>
<p>Try running <code class="docutils literal notranslate"><span class="pre">tut/oneoff/suicide</span></code>, which also configures
the <code class="docutils literal notranslate"><span class="pre">hello</span></code> task’s runtime to make it fail, to see how this works.</p>
<ul class="simple">
<li>For more on suite dependency graphs see <a class="reference internal" href="index.html#configuringscheduling"><span class="std std-ref">Scheduling - Dependency Graphs</span></a>.</li>
<li>For more on task triggering see <a class="reference internal" href="index.html#triggertypes"><span class="std std-ref">Task Triggering</span></a>.</li>
</ul>
</div>
</div>
<div class="section" id="runtime-inheritance">
<h3>7.20. Runtime Inheritance<a class="headerlink" href="#runtime-inheritance" title="Permalink to this headline">¶</a></h3>
<p><strong>suite</strong>: <code class="docutils literal notranslate"><span class="pre">tut/oneoff/inherit</span></code></p>
<p>The <code class="docutils literal notranslate"><span class="pre">[runtime]</span></code> section is actually a <em>multiple inheritance</em> hierarchy.
Each subsection is a <em>namespace</em> that represents a task, or if it is
inherited by other namespaces, a <em>family</em>. This allows common configuration
to be factored out of related tasks very efficiently.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;Simple runtime inheritance example&quot;</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">hello</span> <span class="o">=&gt;</span> <span class="kd">goodbye</span><span class="c">&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;sleep 10; echo $GREETING World!&quot;</span>
    <span class="nt">[[hello]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">GREETING </span><span class="o">=</span><span class="s"> Hello</span>
    <span class="nt">[[goodbye]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">GREETING </span><span class="o">=</span><span class="s"> Goodbye</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">[root]</span></code> namespace provides defaults for all tasks in the suite.
Here both tasks inherit <code class="docutils literal notranslate"><span class="pre">script</span></code> from <code class="docutils literal notranslate"><span class="pre">root</span></code>, which they
customize with different values of the environment variable
<code class="docutils literal notranslate"><span class="pre">$GREETING</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Inheritance from <code class="docutils literal notranslate"><span class="pre">root</span></code> is
implicit; from other parents an explicit <code class="docutils literal notranslate"><span class="pre">inherit</span> <span class="pre">=</span> <span class="pre">PARENT</span></code>
is required, as shown below.</p>
</div>
<ul class="simple">
<li>For more on runtime inheritance, see <a class="reference internal" href="index.html#niorp"><span class="std std-ref">Runtime - Task Configuration</span></a>.</li>
</ul>
</div>
<div class="section" id="triggering-families">
<h3>7.21. Triggering Families<a class="headerlink" href="#triggering-families" title="Permalink to this headline">¶</a></h3>
<p><strong>suite</strong>: <code class="docutils literal notranslate"><span class="pre">tut/oneoff/ftrigger1</span></code></p>
<p>Task families defined by runtime inheritance can also be used as
shorthand in graph trigger expressions. To see this, consider two
“greeter” tasks that trigger off another task <code class="docutils literal notranslate"><span class="pre">foo</span></code>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">greeter_1</span> <span class="o">&amp;</span> <span class="kd">greeter_2</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>If we put the common greeting functionality of <code class="docutils literal notranslate"><span class="pre">greeter_1</span></code>
and <code class="docutils literal notranslate"><span class="pre">greeter_2</span></code> into a special <code class="docutils literal notranslate"><span class="pre">GREETERS</span></code> family,
the graph can be expressed more efficiently like this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">GREETERS</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>i.e. if <code class="docutils literal notranslate"><span class="pre">foo</span></code> succeeds, trigger all members of
<code class="docutils literal notranslate"><span class="pre">GREETERS</span></code> at once. Here’s the full suite with runtime
hierarchy shown:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;Triggering a family of tasks&quot;</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">GREETERS</span><span class="c">&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nv">pre-script </span><span class="o">=</span><span class="s"> &quot;sleep 10&quot;</span>
    <span class="nt">[[foo]]</span>
        <span class="c1"># empty (creates a dummy task)</span>
    <span class="nt">[[GREETERS]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;echo $GREETING World!&quot;</span>
    <span class="nt">[[greeter_1]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> GREETERS</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">GREETING </span><span class="o">=</span><span class="s"> Hello</span>
    <span class="nt">[[greeter_2]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> GREETERS</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">GREETING </span><span class="o">=</span><span class="s"> Goodbye</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We recommend given ALL-CAPS names to task families to help
distinguish them from task names. However, this is just a convention.</p>
</div>
<p>Experiment with the <code class="docutils literal notranslate"><span class="pre">tut/oneoff/ftrigger1</span></code> suite to see
how this works.</p>
</div>
<div class="section" id="triggering-off-of-families">
<h3>7.22. Triggering Off Of Families<a class="headerlink" href="#triggering-off-of-families" title="Permalink to this headline">¶</a></h3>
<p><strong>suite</strong>: <code class="docutils literal notranslate"><span class="pre">tut/oneoff/ftrigger2</span></code></p>
<p>Tasks (or families) can also trigger <em>off</em> other families, but
in this case we need to specify what the trigger means in terms of
the upstream family members. Here’s how to trigger another task
<code class="docutils literal notranslate"><span class="pre">bar</span></code> if all members of <code class="docutils literal notranslate"><span class="pre">GREETERS</span></code> succeed:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">GREETERS</span>
            <span class="kd">GREETERS</span><span class="c">:</span><span class="kd">succeed</span><span class="c">-</span><span class="kd">all</span> <span class="o">=&gt;</span> <span class="kd">bar</span><span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Verbose validation in this case reports:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc val -v tut/oneoff/ftrigger2
...
Graph line substitutions occurred:
  IN: GREETERS:succeed-all <span class="o">=</span>&gt; bar
  OUT: greeter_1:succeed <span class="p">&amp;</span> greeter_2:succeed <span class="o">=</span>&gt; bar
...
</pre></div>
</div>
<p>Cylc ignores family member qualifiers like <code class="docutils literal notranslate"><span class="pre">succeed-all</span></code> on
the right side of a trigger arrow, where they don’t make sense, to
allow the two graph lines above to be combined in simple cases:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">GREETERS</span><span class="c">:</span><span class="kd">succeed</span><span class="c">-</span><span class="kd">all</span> <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>Any task triggering status qualified by <code class="docutils literal notranslate"><span class="pre">-all</span></code> or
<code class="docutils literal notranslate"><span class="pre">-any</span></code>, for the members, can be used with a family trigger.
For example, here’s how to trigger <code class="docutils literal notranslate"><span class="pre">bar</span></code> if all members
of <code class="docutils literal notranslate"><span class="pre">GREETERS</span></code> finish (succeed or fail) and any of them succeed:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">GREETERS</span>
    <span class="kd">GREETERS</span><span class="c">:</span><span class="kd">finish</span><span class="c">-</span><span class="kd">all</span> <span class="o">&amp;</span> <span class="kd">GREETERS</span><span class="c">:</span><span class="kd">succeed</span><span class="c">-</span><span class="kd">any</span> <span class="o">=&gt;</span> <span class="kd">bar</span><span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>(use of <code class="docutils literal notranslate"><span class="pre">GREETERS:succeed-any</span></code> by itself here would trigger
<code class="docutils literal notranslate"><span class="pre">bar</span></code> as soon as any one member of <code class="docutils literal notranslate"><span class="pre">GREETERS</span></code>
completed successfully). Verbose validation now begins to show how
family triggers can simplify complex graphs, even for this tiny
two-member family:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc val -v tut/oneoff/ftrigger2
...
Graph line substitutions occurred:
  IN: GREETERS:finish-all <span class="p">&amp;</span> GREETERS:succeed-any <span class="o">=</span>&gt; bar
  OUT: <span class="o">(</span> greeter_1:succeed <span class="p">|</span> greeter_1:fail <span class="o">)</span> <span class="p">&amp;</span> <span class="se">\</span>
       <span class="o">(</span> greeter_2:succeed <span class="p">|</span> greeter_2:fail <span class="o">)</span> <span class="p">&amp;</span> <span class="se">\</span>
       <span class="o">(</span> greeter_1:succeed <span class="p">|</span> greeter_2:succeed <span class="o">)</span> <span class="o">=</span>&gt; bar
...
</pre></div>
</div>
<p>Experiment with <code class="docutils literal notranslate"><span class="pre">tut/oneoff/ftrigger2</span></code> to see how this works.</p>
<ul class="simple">
<li>For more on family triggering, see <a class="reference internal" href="index.html#familytriggers"><span class="std std-ref">Family Triggers</span></a>.</li>
</ul>
</div>
<div class="section" id="suite-visualization">
<h3>7.23. Suite Visualization<a class="headerlink" href="#suite-visualization" title="Permalink to this headline">¶</a></h3>
<p>You can style dependency graphs with an optional
<code class="docutils literal notranslate"><span class="pre">[visualization]</span></code> section, as shown in <code class="docutils literal notranslate"><span class="pre">tut/oneoff/ftrigger2</span></code>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[visualization]</span>
    <span class="nv">default node attributes </span><span class="o">=</span><span class="s"> &quot;style=filled&quot;</span>
    <span class="nt">[[node attributes]]</span>
        <span class="nv">foo </span><span class="o">=</span><span class="s"> &quot;fillcolor=</span><span class="c1">#6789ab&quot;, &quot;color=magenta&quot;</span>
        <span class="nv">GREETERS </span><span class="o">=</span><span class="s"> &quot;fillcolor=</span><span class="c1">#ba9876&quot;</span>
        <span class="nv">bar </span><span class="o">=</span><span class="s"> &quot;fillcolor=</span><span class="c1">#89ab67&quot;</span>
</pre></div>
</div>
<p>To display the graph in an interactive viewer:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc graph tut/oneoff/ftrigger2 <span class="p">&amp;</span>    <span class="c1"># dependency graph</span>
$ cylc graph -n tut/oneoff/ftrigger2 <span class="p">&amp;</span> <span class="c1"># runtime inheritance graph</span>
</pre></div>
</div>
<p>It should look like <a class="reference internal" href="#fig-tut-hello-multi"><span class="std std-numref">Fig. 15</span></a> (with the
<code class="docutils literal notranslate"><span class="pre">GREETERS</span></code> family node expanded on the right).</p>
<div class="figure align-center" id="fig-tut-hello-multi">
<img alt="_images/tut-hello-multi-1.png" src="_images/tut-hello-multi-1.png" />
</div>
<div class="figure align-center">
<img alt="_images/tut-hello-multi-2.png" src="_images/tut-hello-multi-2.png" />
</div>
<div class="figure align-center" id="id5">
<img alt="_images/tut-hello-multi-3.png" src="_images/tut-hello-multi-3.png" />
<p class="caption"><span class="caption-number">Fig. 16 </span><span class="caption-text">The <code class="docutils literal notranslate"><span class="pre">tut/oneoff/ftrigger2</span></code> dependency and runtime inheritance graphs</span></p>
</div>
<p>Graph styling can be applied to entire families at once, and custom
“node groups” can also be defined for non-family groups.</p>
</div>
<div class="section" id="external-task-scripts">
<h3>7.24. External Task Scripts<a class="headerlink" href="#external-task-scripts" title="Permalink to this headline">¶</a></h3>
<p><strong>suite</strong>: <code class="docutils literal notranslate"><span class="pre">tut/oneoff/external</span></code></p>
<p>The tasks in our examples so far have all had inlined implementation, in
the suite configuration, but real tasks often need to call external
commands, scripts, or executables. To try this, let’s return to the
basic Hello World suite and cut the implementation of the task
<code class="docutils literal notranslate"><span class="pre">hello</span></code> out to a file <code class="docutils literal notranslate"><span class="pre">hello.sh</span></code> in the suite bin directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="nb">set</span> -e

<span class="nv">GREETING</span><span class="o">=</span><span class="si">${</span><span class="nv">GREETING</span><span class="k">:-</span><span class="nv">Goodbye</span><span class="si">}</span>
<span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$GREETING</span><span class="s2"> World! from </span><span class="nv">$0</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>Make the task script executable, and change the <code class="docutils literal notranslate"><span class="pre">hello</span></code> task
runtime section to invoke it:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;Hello World! from an external task script&quot;</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">hello</span><span class="c">&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[hello]]</span>
        <span class="nv">pre-script </span><span class="o">=</span><span class="s"> sleep 10</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> hello.sh</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">GREETING </span><span class="o">=</span><span class="s"> Hello</span>
</pre></div>
</div>
<p>If you run the suite now the new greeting from the external task script
should appear in the <code class="docutils literal notranslate"><span class="pre">hello</span></code> task stdout log. This works
because cylc automatically adds the suite bin directory to
<code class="docutils literal notranslate"><span class="pre">$PATH</span></code> in the environment passed to tasks via their job
scripts. To execute scripts (etc.) located elsewhere you can
refer to the file by its full file path, or set <code class="docutils literal notranslate"><span class="pre">$PATH</span></code>
appropriately yourself (this could be done via
<code class="docutils literal notranslate"><span class="pre">$HOME/.profile</span></code>, which is sourced at the top of the task job
script, or in the suite configuration itself).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The use of <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">-e</span></code> above to make the script abort on
error. This allows the error trapping code in the task job script to
automatically detect unforeseen errors.</p>
</div>
</div>
<div class="section" id="cycling-tasks">
<h3>7.25. Cycling Tasks<a class="headerlink" href="#cycling-tasks" title="Permalink to this headline">¶</a></h3>
<p><strong>suite</strong>: <code class="docutils literal notranslate"><span class="pre">tut/cycling/one</span></code></p>
<p>So far we’ve considered non-cycling tasks, which finish without spawning
a successor.</p>
<p>Cycling is based around iterating through date-time or integer sequences. A
cycling task may run at each cycle point in a given sequence (cycle). For
example, a sequence might be a set of date-times every 6 hours starting from a
particular date-time. A cycling task may run for each date-time item (cycle
point) in that sequence.</p>
<p>There may be multiple instances of this type of task running in parallel, if
the opportunity arises and their dependencies allow it. Alternatively, a
sequence can be defined with only one valid cycle point - in that case, a task
belonging to that sequence may only run once.</p>
<p>Open the <code class="docutils literal notranslate"><span class="pre">tut/cycling/one</span></code> suite:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;Two cycling tasks, no inter-cycle dependence&quot;</span>
<span class="nt">[cylc]</span>
    <span class="nv">UTC mode </span><span class="o">=</span><span class="s"> True</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20130808T00</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20130812T00</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[T00,T12]]]</span> <span class="c1"># 00 and 12 hours UTC every day</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
<span class="nt">[visualization]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20130808T00</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20130809T00</span>
    <span class="nt">[[node attributes]]</span>
        <span class="nv">foo </span><span class="o">=</span><span class="s"> &quot;color=red&quot;</span>
        <span class="nv">bar </span><span class="o">=</span><span class="s"> &quot;color=blue&quot;</span>
</pre></div>
</div>
<p>The difference between cycling and non-cycling suites is all in the
<code class="docutils literal notranslate"><span class="pre">[scheduling]</span></code> section, so we will leave the
<code class="docutils literal notranslate"><span class="pre">[runtime]</span></code> section alone for now (this will result in
cycling dummy tasks).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The graph is now defined under a new section heading that makes each
task under it have a succession of cycle points ending in <code class="docutils literal notranslate"><span class="pre">00</span></code> or
<code class="docutils literal notranslate"><span class="pre">12</span></code> hours, between specified initial and final cycle
points (or indefinitely if no final cycle point is given), as shown in
<a class="reference internal" href="#fig-tut-one"><span class="std std-numref">Fig. 17</span></a>.</p>
</div>
<div class="figure align-center" id="id6">
<span id="fig-tut-one"></span><img alt="_images/tut-one.png" src="_images/tut-one.png" />
<p class="caption"><span class="caption-number">Fig. 17 </span><span class="caption-text">The <code class="docutils literal notranslate"><span class="pre">tut/cycling/one</span></code> suite</span></p>
</div>
<p>If you run this suite instances of <code class="docutils literal notranslate"><span class="pre">foo</span></code> will spawn in parallel out
to the <em>runahead limit</em>, and each <code class="docutils literal notranslate"><span class="pre">bar</span></code> will trigger off the
corresponding instance of <code class="docutils literal notranslate"><span class="pre">foo</span></code> at the same cycle point. The
runahead limit, which defaults to a few cycles but is configurable, prevents
uncontrolled spawning of cycling tasks in suites that are not constrained by
clock triggers in real time operation.</p>
<p>Experiment with <code class="docutils literal notranslate"><span class="pre">tut/cycling/one</span></code> to see how cycling tasks work.</p>
<div class="section" id="iso-8601-date-time-syntax">
<h4>7.25.1. ISO 8601 Date-Time Syntax<a class="headerlink" href="#iso-8601-date-time-syntax" title="Permalink to this headline">¶</a></h4>
<p>The suite above is a very simple example of a cycling date-time workflow. More
generally, cylc comprehensively supports the ISO 8601 standard for date-time
instants, intervals, and sequences. Cycling graph sections can be specified
using full ISO 8601 recurrence expressions, but these may be simplified
by assuming context information from the suite - namely initial and final cycle
points. One form of the recurrence syntax looks like
<code class="docutils literal notranslate"><span class="pre">Rn/start-date-time/period</span></code> (<code class="docutils literal notranslate"><span class="pre">Rn</span></code> means run <code class="docutils literal notranslate"><span class="pre">n</span></code> times). In the example
above, if the initial cycle point
is always at <code class="docutils literal notranslate"><span class="pre">00</span></code> or <code class="docutils literal notranslate"><span class="pre">12</span></code> hours then <code class="docutils literal notranslate"><span class="pre">[[[T00,T12]]]</span></code> could be
written as <code class="docutils literal notranslate"><span class="pre">[[[PT12H]]]</span></code>, which is short for
<code class="docutils literal notranslate"><span class="pre">[[[R/initial-cycle-point/PT12H/]]]</span></code> - i.e. run every 12 hours
indefinitely starting at the initial cycle point. It is possible to add
constraints to the suite to only allow initial cycle points at <code class="docutils literal notranslate"><span class="pre">00</span></code> or
<code class="docutils literal notranslate"><span class="pre">12</span></code> hours e.g.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20130808T00</span>
    <span class="nv">initial cycle point constraints </span><span class="o">=</span><span class="s"> T00, T12</span>
</pre></div>
</div>
<ul class="simple">
<li>For a comprehensive description of ISO 8601 based date-time cycling,
see <a class="reference internal" href="index.html#advancedcycling"><span class="std std-ref">Advanced Examples</span></a></li>
<li>For more on runahead limiting in cycling suites,
see <a class="reference internal" href="index.html#runaheadlimit"><span class="std std-ref">Runahead Limiting</span></a>.</li>
</ul>
</div>
<div class="section" id="inter-cycle-triggers">
<span id="tutintercyclepointtriggers"></span><h4>7.25.2. Inter-Cycle Triggers<a class="headerlink" href="#inter-cycle-triggers" title="Permalink to this headline">¶</a></h4>
<p><strong>suite</strong>: <code class="docutils literal notranslate"><span class="pre">tut/cycling/two</span></code></p>
<p>The <code class="docutils literal notranslate"><span class="pre">tut/cycling/two</span></code> suite adds inter-cycle dependence
to the previous example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="c1"># Repeat with cycle points of 00 and 12 hours every day:</span>
        <span class="nt">[[[T00,T12]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span>[<span class="nb">-PT12H</span>] <span class="o">=&gt;</span> <span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>For any given cycle point in the sequence defined by the
cycling graph section heading, <code class="docutils literal notranslate"><span class="pre">bar</span></code> triggers off
<code class="docutils literal notranslate"><span class="pre">foo</span></code> as before, but now <code class="docutils literal notranslate"><span class="pre">foo</span></code> triggers off its own
previous instance <code class="docutils literal notranslate"><span class="pre">foo[-PT12H]</span></code>. Date-time offsets in
inter-cycle triggers are expressed as ISO 8601 intervals (12 hours
in this case). <a class="reference internal" href="#fig-tut-two"><span class="std std-numref">Fig. 18</span></a> shows how this connects the
cycling graph sections together.</p>
<div class="figure align-center" id="id7">
<span id="fig-tut-two"></span><img alt="_images/tut-two.png" src="_images/tut-two.png" />
<p class="caption"><span class="caption-number">Fig. 18 </span><span class="caption-text">The <code class="docutils literal notranslate"><span class="pre">tut/cycling/two</span></code> suite</span></p>
</div>
<p>Experiment with this suite to see how inter-cycle triggers work.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The first instance of <code class="docutils literal notranslate"><span class="pre">foo</span></code>, at suite start-up, will
trigger immediately in spite of its inter-cycle trigger, because cylc
ignores dependence on points earlier than the initial cycle point.
However, the presence of an inter-cycle trigger usually implies something
special has to happen at start-up. If a model depends on its own previous
instance for restart files, for example, then some special process has to
generate the initial set of restart files when there is no previous cycle
point to do it. The following section shows one way to handle this
in cylc suites.</p>
</div>
</div>
<div class="section" id="initial-non-repeating-r1-tasks">
<span id="id3"></span><h4>7.25.3. Initial Non-Repeating (R1) Tasks<a class="headerlink" href="#initial-non-repeating-r1-tasks" title="Permalink to this headline">¶</a></h4>
<p><strong>suite</strong>: <code class="docutils literal notranslate"><span class="pre">tut/cycling/three</span></code></p>
<p>Sometimes we want to be able to run a task at the initial cycle point, but
refrain from running it in subsequent cycles. We can do this by writing an
extra set of dependencies that are only valid at a single date-time cycle
point. If we choose this to be the initial cycle point, these will only apply
at the very start of the suite.</p>
<p>The cylc syntax for writing this single date-time cycle point occurrence is
<code class="docutils literal notranslate"><span class="pre">R1</span></code>, which stands for <code class="docutils literal notranslate"><span class="pre">R1/no-specified-date-time/no-specified-period</span></code>.
This is an adaptation of part of the ISO 8601 date-time standard’s recurrence
syntax (<code class="docutils literal notranslate"><span class="pre">Rn/date-time/period</span></code>) with some special context information
supplied by cylc for the <code class="docutils literal notranslate"><span class="pre">no-specified-*</span></code> data.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">1</span></code> in the <code class="docutils literal notranslate"><span class="pre">R1</span></code> means run once. As we’ve specified
no date-time, Cylc will use the initial cycle point date-time by default,
which is what we want. We’ve also missed out specifying the period - this is
set by cylc to a zero amount of time in this case (as it never
repeats, this is not significant).</p>
<p>For example, in <code class="docutils literal notranslate"><span class="pre">tut/cycling/three</span></code>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nv">cycle point time zone </span><span class="o">=</span><span class="s"> +13</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20130808T00</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20130812T00</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[R1]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">prep</span> <span class="o">=&gt;</span> <span class="kd">foo</span><span class="c">&quot;</span>
        <span class="nt">[[[T00,T12]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span>[<span class="nb">-PT12H</span>] <span class="o">=&gt;</span> <span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>This is shown in <a class="reference internal" href="#fig-tut-three"><span class="std std-numref">Fig. 19</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The time zone has been set to <code class="docutils literal notranslate"><span class="pre">+1300</span></code> in this case,
instead of UTC (<code class="docutils literal notranslate"><span class="pre">Z</span></code>) as before. If no time zone or UTC mode was set,
the local time zone of your machine will be used in the cycle points.</p>
</div>
<p>At the initial cycle point, <code class="docutils literal notranslate"><span class="pre">foo</span></code> will depend on <code class="docutils literal notranslate"><span class="pre">foo[-PT12H]</span></code> and also
on <code class="docutils literal notranslate"><span class="pre">prep</span></code>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">prep.20130808T0000+13 &amp; foo.20130807T1200+13 </span><span class="o">=</span><span class="s">&gt; foo.20130808T0000+13</span>
</pre></div>
</div>
<p>Thereafter, it will just look like e.g.:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">foo.20130808T0000+13 </span><span class="o">=</span><span class="s">&gt; foo.20130808T1200+13</span>
</pre></div>
</div>
<p>However, in our initial cycle point example, the dependence on
<code class="docutils literal notranslate"><span class="pre">foo.20130807T1200+13</span></code> will be ignored, because that task’s cycle
point is earlier than the suite’s initial cycle point and so it cannot run.
This means that the initial cycle point dependencies for <code class="docutils literal notranslate"><span class="pre">foo</span></code>
actually look like:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">prep.20130808T0000+13 </span><span class="o">=</span><span class="s">&gt; foo.20130808T0000+13</span>
</pre></div>
</div>
<div class="figure align-center" id="id8">
<span id="fig-tut-three"></span><img alt="_images/tut-three.png" src="_images/tut-three.png" />
<p class="caption"><span class="caption-number">Fig. 19 </span><span class="caption-text">The <code class="docutils literal notranslate"><span class="pre">tut/cycling/three</span></code> suite</span></p>
</div>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">R1</span></code> tasks can also be used to make something special
happen at suite shutdown, or at any single cycle point throughout the
suite run. For a full primer on cycling syntax, see <a class="reference internal" href="index.html#advancedcycling"><span class="std std-ref">Advanced Examples</span></a>.</li>
</ul>
</div>
<div class="section" id="integer-cycling">
<span id="tutinteger"></span><h4>7.25.4. Integer Cycling<a class="headerlink" href="#integer-cycling" title="Permalink to this headline">¶</a></h4>
<p><strong>suite</strong>: <code class="docutils literal notranslate"><span class="pre">tut/cycling/integer</span></code></p>
<p>Cylc can do also do integer cycling for repeating workflows that are not
date-time based.</p>
<p>Open the <code class="docutils literal notranslate"><span class="pre">tut/cycling/integer</span></code> suite, which is plotted in
<a class="reference internal" href="#fig-tut-int"><span class="std std-numref">Fig. 20</span></a>.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">cycling mode </span><span class="o">=</span><span class="s"> integer</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 1</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 3</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[R1]]]</span> <span class="c1"># = R1/1/?</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">start</span> <span class="o">=&gt;</span> <span class="kd">foo</span>
        <span class="nt">[[[P1]]]</span> <span class="c1"># = R/1/P1</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">foo</span>[<span class="nb">-P1</span>] <span class="o">=&gt;</span> <span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">bar</span>
        <span class="nt">[[[R2/P1]]]</span> <span class="c1"># = R2/P1/3</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">bar</span> <span class="o">=&gt;</span> <span class="kd">stop</span>

<span class="nt">[visualization]</span>
    <span class="nt">[[node attributes]]</span>
        <span class="nv">start </span><span class="o">=</span><span class="s"> &quot;style=filled&quot;, &quot;fillcolor=skyblue&quot;</span>
        <span class="nv">foo </span><span class="o">=</span><span class="s"> &quot;style=filled&quot;, &quot;fillcolor=slategray&quot;</span>
        <span class="nv">bar </span><span class="o">=</span><span class="s"> &quot;style=filled&quot;, &quot;fillcolor=seagreen3&quot;</span>
        <span class="nv">stop </span><span class="o">=</span><span class="s"> &quot;style=filled&quot;, &quot;fillcolor=orangered&quot;</span>
</pre></div>
</div>
<div class="figure align-center" id="id9">
<span id="fig-tut-int"></span><img alt="_images/tut-cyc-int.png" src="_images/tut-cyc-int.png" />
<p class="caption"><span class="caption-number">Fig. 20 </span><span class="caption-text">The <code class="docutils literal notranslate"><span class="pre">tut/cycling/integer</span></code> suite</span></p>
</div>
<p>The integer cycling notation is intended to look similar to the ISO 8601
date-time notation, but it is simpler for obvious reasons. The example suite
illustrates two recurrence forms,
<code class="docutils literal notranslate"><span class="pre">Rn/start-point/period</span></code> and
<code class="docutils literal notranslate"><span class="pre">Rn/period/stop-point</span></code>, simplified somewhat using suite context
information (namely the initial and final cycle points). The first form is
used to run one special task called <code class="docutils literal notranslate"><span class="pre">start</span></code> at start-up, and for the
main cycling body of the suite; and the second form to run another special task
called <code class="docutils literal notranslate"><span class="pre">stop</span></code> in the final two cycles. The <code class="docutils literal notranslate"><span class="pre">P</span></code> character
denotes period (interval) just like in the date-time notation.
<code class="docutils literal notranslate"><span class="pre">R/1/P2</span></code> would generate the sequence of points <code class="docutils literal notranslate"><span class="pre">1,3,5,...</span></code>.</p>
<ul class="simple">
<li>For more on integer cycling, including a more realistic usage example
see <a class="reference internal" href="index.html#integercycling"><span class="std std-ref">Integer Cycling</span></a>.</li>
</ul>
</div>
</div>
<div class="section" id="jinja2">
<h3>7.26. Jinja2<a class="headerlink" href="#jinja2" title="Permalink to this headline">¶</a></h3>
<p><strong>suite</strong>: <code class="docutils literal notranslate"><span class="pre">tut/oneoff/jinja2</span></code></p>
<p>Cylc has built in support for the Jinja2 template processor, which
allows us to embed code in suite configurations to generate the
final result seen by cylc.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">tut/oneoff/jinja2</span></code> suite illustrates two common
uses of Jinja2: changing suite content or structure based on the value
of a logical switch; and iteratively generating dependencies and runtime
configuration for groups of related tasks:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="ch">#!jinja2</span>

<span class="cp">{% set MULTI = True %}</span>
<span class="cp">{% set N_GOODBYES = 3 %}</span>

<span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;A Jinja2 Hello World! suite&quot;</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
<span class="cp">{% if MULTI %}</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">hello</span> <span class="o">=&gt;</span> <span class="kd">BYE</span><span class="c">&quot;</span>
<span class="cp">{% else %}</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">hello</span><span class="c">&quot;</span>
<span class="cp">{% endif %}</span>

<span class="nt">[runtime]</span>
    <span class="nt">[[hello]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;sleep 10; echo Hello World!&quot;</span>
<span class="cp">{% if MULTI %}</span>
    <span class="nt">[[BYE]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;sleep 10; echo Goodbye World!&quot;</span>
    <span class="cp">{% for I in range(0,N_GOODBYES) %}</span>
    <span class="nt">[[ goodbye_</span><span class="cp">{{I}}</span><span class="nt"> ]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> BYE</span>
    <span class="cp">{% endfor %}</span>
<span class="cp">{% endif %}</span>
</pre></div>
</div>
<p>To view the result of Jinja2 processing with the Jinja2 flag
<code class="docutils literal notranslate"><span class="pre">MULTI</span></code> set to <code class="docutils literal notranslate"><span class="pre">False</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc view --jinja2 --stdout tut/oneoff/jinja2
</pre></div>
</div>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;A Jinja2 Hello World! suite&quot;</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">hello</span><span class="c">&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[hello]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;sleep 10; echo Hello World!&quot;</span>
</pre></div>
</div>
<p>And with <code class="docutils literal notranslate"><span class="pre">MULTI</span></code> set to <code class="docutils literal notranslate"><span class="pre">True</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc view --jinja2 --stdout tut/oneoff/jinja2
</pre></div>
</div>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;A Jinja2 Hello World! suite&quot;</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">hello</span> <span class="o">=&gt;</span> <span class="kd">BYE</span><span class="c">&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[hello]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;sleep 10; echo Hello World!&quot;</span>
    <span class="nt">[[BYE]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;sleep 10; echo Goodbye World!&quot;</span>
    <span class="nt">[[ goodbye_0 ]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> BYE</span>
    <span class="nt">[[ goodbye_1 ]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> BYE</span>
    <span class="nt">[[ goodbye_2 ]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> BYE</span>
</pre></div>
</div>
</div>
<div class="section" id="task-retry-on-failure">
<h3>7.27. Task Retry On Failure<a class="headerlink" href="#task-retry-on-failure" title="Permalink to this headline">¶</a></h3>
<p><strong>suite</strong>: <code class="docutils literal notranslate"><span class="pre">tut/oneoff/retry</span></code></p>
<p>Tasks can be configured to retry a number of times if they fail.
An environment variable <code class="docutils literal notranslate"><span class="pre">$CYLC_TASK_TRY_NUMBER</span></code> increments
from <code class="docutils literal notranslate"><span class="pre">1</span></code> on each successive try, and is passed to the task to allow
different behaviour on the retry:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;A task with automatic retry on failure&quot;</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">hello</span><span class="c">&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[hello]]</span>
        <span class="nv">script </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">sleep 10</span>
<span class="s2">if [[ $CYLC_TASK_TRY_NUMBER &lt; 3 ]]; then</span>
<span class="s2">    echo &quot;Hello ... aborting!&quot;</span>
<span class="s2">    exit 1</span>
<span class="s2">else</span>
<span class="s2">    echo &quot;Hello World!&quot;</span>
<span class="s2">fi&quot;&quot;&quot;</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">execution retry delays </span><span class="o">=</span><span class="s"> 2*PT6S</span> <span class="c1"># retry twice after 6-second delays</span>
</pre></div>
</div>
<p>If a task with configured retries fails, it goes into the <em>retrying</em> state
until the next retry delay is up, then it resubmits. It only enters the
<em>failed</em> state on a final definitive failure.</p>
<p>If a task with configured retries is <em>killed</em> (by <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">kill</span></code> or
via the GUI) it goes to the <em>held</em> state so that the operator can decide
whether to release it and continue the retry sequence or to abort the retry
sequence by manually resetting it to the <em>failed</em> state.</p>
<p>Experiment with <code class="docutils literal notranslate"><span class="pre">tut/oneoff/retry</span></code> to see how this works.</p>
</div>
<div class="section" id="other-users-suites">
<h3>7.28. Other Users’ Suites<a class="headerlink" href="#other-users-suites" title="Permalink to this headline">¶</a></h3>
<p>If you have read access to another user’s account (even on another host)
it is possible to use <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">monitor</span></code> to look at their suite’s
progress without full shell access to their account. To do this, you
will need to copy their suite passphrase to</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$HOME</span>/.cylc/SUITE_OWNER@SUITE_HOST/SUITE_NAME/passphrase
</pre></div>
</div>
<p>(use of the host and owner names is optional here - see <a class="reference internal" href="index.html#passphrases"><span class="std std-ref">Full Control - With Auth Files</span></a>)
<em>and</em> also retrieve the port number of the running suite from:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>~SUITE_OWNER/cylc-run/SUITE_NAME/.service/contact
</pre></div>
</div>
<p>Once you have this information, you can run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc monitor --user<span class="o">=</span>SUITE_OWNER --port<span class="o">=</span>SUITE_PORT SUITE_NAME
</pre></div>
</div>
<p>to view the progress of their suite.</p>
<p>Other suite-connecting commands work in the same way; see
<a class="reference internal" href="index.html#remotecontrol"><span class="std std-ref">Remote Control</span></a>.</p>
</div>
<div class="section" id="other-things-to-try">
<h3>7.29. Other Things To Try<a class="headerlink" href="#other-things-to-try" title="Permalink to this headline">¶</a></h3>
<p>Almost every feature of cylc can be tested quickly and easily with a
simple dummy suite. You can write your own, or start from one of the
example suites in <code class="docutils literal notranslate"><span class="pre">/path/to/cylc/examples</span></code> (see use of
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">import-examples</span></code> above) - they all run “out the box”
and can be copied and modified at will.</p>
<ul class="simple">
<li>Change the suite runahead limit in a cycling suite.</li>
<li>Stop a suite mid-run with <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">stop</span></code>, and restart
it again with <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">restart</span></code>.</li>
<li>Hold (pause) a suite mid-run with <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">hold</span></code>,
then modify the suite configuration and <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">reload</span></code> it
before using <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">release</span></code> to continue (you can also
reload without holding).</li>
<li>Use the gcylc View menu to show the task state color key and
watch tasks in the <code class="docutils literal notranslate"><span class="pre">task-states</span></code> example evolve
as the suite runs.</li>
<li>Manually re-run a task that has already completed or failed,
with <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">trigger</span></code>.</li>
<li>Use an <em>internal queue</em> to prevent more than an alotted number
of tasks from running at once even though they are ready -
see <a class="reference internal" href="index.html#internalqueues"><span class="std std-ref">Limiting Activity With Internal Queues</span></a>.</li>
<li>Configure task event hooks to send an email, or shut the suite down,
on task failure.</li>
</ul>
</div>
</div>
<span id="document-suite-name-reg"></span><div class="section" id="suite-name-registration">
<span id="suiteregistration"></span><h2>8. Suite Name Registration<a class="headerlink" href="#suite-name-registration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="suite-registration">
<h3>8.1. Suite Registration<a class="headerlink" href="#suite-registration" title="Permalink to this headline">¶</a></h3>
<p>Cylc commands target suites via their names, which are relative path names
under the suite run directory (<code class="docutils literal notranslate"><span class="pre">~/cylc-run/</span></code> by default). Suites can
be grouped together under sub-directories. E.g.:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc print -t nwp
nwp
 <span class="p">|</span>-oper
 <span class="p">|</span> <span class="p">|</span>-region1  Local Model Region1       /home/oliverh/cylc-run/nwp/oper/region1
 <span class="p">|</span> <span class="sb">`</span>-region2  Local Model Region2       /home/oliverh/cylc-run/nwp/oper/region2
 <span class="sb">`</span>-test
   <span class="sb">`</span>-region1  Local Model TEST Region1  /home/oliverh/cylc-run/nwp/test/region1
</pre></div>
</div>
<p>Suite names can be pre-registered with the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">register</span></code> command,
which creates the suite run directory structure and some service files
underneath it. Otherwise, <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">run</span></code> will do this at suite start up.</p>
</div>
<div class="section" id="suite-names">
<span id="suitenames"></span><h3>8.2. Suite Names<a class="headerlink" href="#suite-names" title="Permalink to this headline">¶</a></h3>
<p>Suite names are not validated. Names for suites can be anything that is a
<a class="reference external" href="https://en.wikipedia.org/wiki/Filename#Comparison_of_filename_limitations">valid filename</a> within your operating system’s file system, which includes
restrictions on name length (as described under <a class="reference internal" href="index.html#tasknames"><span class="std std-ref">Task and Namespace Names</span></a>), with the
exceptions of:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">/</span></code>, which is not supported for general filenames on e.g. Linux systems
but is allowed for suite names to generate hierarchical suites
(see <a class="reference internal" href="index.html#command-register"><span class="std std-ref">register</span></a>);</li>
<li>while possible in filenames on many systems, it is strongly advised that
suite names do not contain any whitespace characters (e.g. as
in <code class="docutils literal notranslate"><span class="pre">my</span> <span class="pre">suite</span></code>).</li>
</ul>
</div>
</div>
<span id="document-suite-config"></span><div class="section" id="suite-configuration">
<span id="suitedefinition"></span><h2>9. Suite Configuration<a class="headerlink" href="#suite-configuration" title="Permalink to this headline">¶</a></h2>
<p>Cylc suites are defined in structured, validated, <em>suite.rc</em> files
that concisely specify the properties of, and the relationships
between, the various tasks managed by the suite. This section of the
User Guide deals with the format and content of the suite.rc file,
including task definition. Task implementation - what’s required of the
real commands, scripts, or programs that do the processing that the
tasks represent - is covered in <a class="reference internal" href="index.html#taskimplementation"><span class="std std-ref">Task Implementation</span></a>; and
task job submission - how tasks are submitted to run - is
in <a class="reference internal" href="index.html#taskjobsubmission"><span class="std std-ref">Task Job Submission and Management</span></a>.</p>
<div class="section" id="suite-configuration-directories">
<span id="suitedefinitiondirectories"></span><h3>9.1. Suite Configuration Directories<a class="headerlink" href="#suite-configuration-directories" title="Permalink to this headline">¶</a></h3>
<p>A cylc <em>suite configuration directory</em> contains:</p>
<ul class="simple">
<li><strong>A suite.rc file</strong>: this is the suite configuration.<ul>
<li>And any include-files used in it (see below; may be
kept in sub-directories).</li>
</ul>
</li>
<li><strong>A</strong> <code class="docutils literal notranslate"><span class="pre">bin/</span></code> <strong>sub-directory</strong> (optional)<ul>
<li>For scripts and executables that implement, or are
used by, suite tasks.</li>
<li>Automatically added to <code class="docutils literal notranslate"><span class="pre">$PATH</span></code> in task
execution environments.</li>
<li>Alternatively, tasks can call external
commands, scripts, or programs; or they can be scripted
entirely within the suite.rc file.</li>
</ul>
</li>
<li><strong>A</strong> <code class="docutils literal notranslate"><span class="pre">lib/python/</span></code> <strong>sub-directory</strong> (optional)<ul>
<li>For custom job submission modules
(see <a class="reference internal" href="index.html#customjobsubmissionmethods"><span class="std std-ref">Custom Job Submission Methods</span></a>)
and local Python modules imported by custom Jinja2 filters,
tests and globals (see <a class="reference internal" href="#customjinja2filters"><span class="std std-ref">Custom Jinja2 Filters, Tests and Globals</span></a>).</li>
</ul>
</li>
<li><strong>Any other sub-directories and files</strong> - documentation,
control files, etc. (optional)<ul>
<li>Holding everything in one place makes proper suite
revision control possible.</li>
<li>Portable access to files here, for running tasks, is
provided through <code class="docutils literal notranslate"><span class="pre">$CYLC_SUITE_DEF_PATH</span></code>
(see <a class="reference internal" href="#taskexecutionenvironment"><span class="std std-ref">Task Execution Environment</span></a>).</li>
<li>Ignored by cylc, but the entire suite configuration
directory tree is copied when you copy a
suite using cylc commands.</li>
</ul>
</li>
</ul>
<p>A typical example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/path/to/my/suite   <span class="c1"># suite configuration directory</span>
    suite.rc           <span class="c1"># THE SUITE CONFIGURATION FILE</span>
    bin/               <span class="c1"># scripts and executables used by tasks</span>
        foo.sh
        bar.sh
        ...
    <span class="c1"># (OPTIONAL) any other suite-related files, for example:</span>
    inc/               <span class="c1"># suite.rc include-files</span>
        nwp-tasks.rc
        globals.rc
        ...
    doc/               <span class="c1"># documentation</span>
    control/           <span class="c1"># control files</span>
    ancil/             <span class="c1"># ancillary files</span>
    ...
</pre></div>
</div>
</div>
<div class="section" id="suite-rc-file-overview">
<span id="suitercfile"></span><h3>9.2. Suite.rc File Overview<a class="headerlink" href="#suite-rc-file-overview" title="Permalink to this headline">¶</a></h3>
<p>Suite.rc files are an extended-INI format with section nesting.</p>
<p>Embedded template processor expressions may also be used in the file, to
programatically generate the final suite configuration seen by
cylc. Currently the <a class="reference external" href="http://jinja.pocoo.org/docs">Jinja2</a> and
<a class="reference external" href="http://www.alcyone.com/software/empy">EmPy</a> template processors are
supported; see <a class="reference internal" href="#jinja"><span class="std std-ref">Jinja2</span></a> and <a class="reference internal" href="#empylabel"><span class="std std-ref">EmPy</span></a> for examples. In the future
cylc may provide a plug-in interface to allow use of other template
engines too.</p>
<div class="section" id="syntax">
<span id="id1"></span><h4>9.2.1. Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h4>
<p>The following defines legal suite.rc syntax:</p>
<ul class="simple">
<li><strong>Items</strong> are of the form <code class="docutils literal notranslate"><span class="pre">item</span> <span class="pre">=</span> <span class="pre">value</span></code>.</li>
<li><strong>[Section]</strong> headings are enclosed in square brackets.</li>
<li><strong>Sub-section [[nesting]]</strong> is defined by repeated square brackets.<ul>
<li>Sections are <strong>closed</strong> by the next section heading.</li>
</ul>
</li>
<li><strong>Comments</strong> (line and trailing) follow a hash character: <code class="docutils literal notranslate"><span class="pre">#</span></code></li>
<li><strong>List values</strong> are comma-separated.</li>
<li><strong>Single-line string values</strong> can be single-, double-, or un-quoted.</li>
<li><strong>Multi-line string values</strong> are triple-quoted (using
single or double quote characters).</li>
<li><strong>Boolean values</strong> are capitalized: True, False.</li>
<li><strong>Leading and trailing whitespace</strong> is ignored.</li>
<li><strong>Indentation</strong> is optional but should be used for clarity.</li>
<li><strong>Continuation lines</strong> follow a trailing backslash: <code class="docutils literal notranslate"><span class="pre">\</span></code></li>
<li><strong>Duplicate sections</strong> add their items to those previously
defined under the same section.</li>
<li><strong>Duplicate items</strong> override, <em>except for dependency
``graph`` strings, which are additive</em>.</li>
<li><strong>Include-files</strong> <code class="docutils literal notranslate"><span class="pre">%include</span> <span class="pre">inc/foo.rc</span></code> can be
used as a verbatim inlining mechanism.</li>
</ul>
<p>Suites that embed templating code (see <a class="reference internal" href="#jinja"><span class="std std-ref">Jinja2</span></a> and <a class="reference internal" href="#empylabel"><span class="std std-ref">EmPy</span></a>) must
process to raw suite.rc syntax.</p>
</div>
<div class="section" id="include-files">
<h4>9.2.2. Include-Files<a class="headerlink" href="#include-files" title="Permalink to this headline">¶</a></h4>
<p>Cylc has native support for suite.rc include-files, which may help to
organize large suites. Inclusion boundaries are completely arbitrary -
you can think of include-files as chunks of the suite.rc file simply
cut-and-pasted into another file. Include-files may be included
multiple times in the same file, and even nested. Include-file paths
can be specified portably relative to the suite configuration directory,
e.g.:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># include the file $CYLC_SUITE_DEF_PATH/inc/foo.rc:</span>
<span class="o">%include</span> <span class="s">inc/foo.rc</span>
</pre></div>
</div>
<div class="section" id="editing-temporarily-inlined-suites">
<h5>9.2.2.1. Editing Temporarily Inlined Suites<a class="headerlink" href="#editing-temporarily-inlined-suites" title="Permalink to this headline">¶</a></h5>
<p>Cylc’s native file inclusion mechanism supports optional inlined
editing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc edit --inline SUITE
</pre></div>
</div>
<p>The suite will be split back into its constituent include-files when you
exit the edit session. While editing, the inlined file becomes the
official suite configuration so that changes take effect whenever you save
the file. See <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">prep</span> <span class="pre">edit</span> <span class="pre">--help</span></code> for more information.</p>
</div>
<div class="section" id="include-files-via-jinja2">
<h5>9.2.2.2. Include-Files via Jinja2<a class="headerlink" href="#include-files-via-jinja2" title="Permalink to this headline">¶</a></h5>
<p>Jinja2 (<a class="reference internal" href="#jinja"><span class="std std-ref">Jinja2</span></a>) also has template inclusion functionality.</p>
</div>
</div>
<div class="section" id="syntax-highlighting-for-suite-configuration">
<span id="syntaxhighlighting"></span><h4>9.2.3. Syntax Highlighting For Suite Configuration<a class="headerlink" href="#syntax-highlighting-for-suite-configuration" title="Permalink to this headline">¶</a></h4>
<p>Cylc comes with syntax files for a number of text editors:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;cylc-dir&gt;/etc/syntax/cylc.vim     <span class="c1"># vim</span>
&lt;cylc-dir&gt;/etc/syntax/cylc-mode.el <span class="c1"># emacs</span>
&lt;cylc-dir&gt;/etc/syntax/cylc.lang    <span class="c1"># gedit (and other gtksourceview programs)</span>
&lt;cylc-dir&gt;/etc/syntax/cylc.xml     <span class="c1"># kate</span>
</pre></div>
</div>
<p>Refer to comments at the top of each file to see how to use them.</p>
</div>
<div class="section" id="gross-file-structure">
<h4>9.2.4. Gross File Structure<a class="headerlink" href="#gross-file-structure" title="Permalink to this headline">¶</a></h4>
<p>Cylc suite.rc files consist of a suite title and description followed by
configuration items grouped under several top level section headings:</p>
<ul class="simple">
<li><strong>[cylc]</strong> - <em>non task-specific suite configuration</em></li>
<li><strong>[scheduling]</strong> - <em>determines when tasks are ready to run</em><ul>
<li>tasks with special behaviour, e.g. clock-trigger tasks</li>
<li>the dependency graph, which defines the relationships
between tasks</li>
</ul>
</li>
<li><strong>[runtime]</strong> - <em>determines how, where, and what to
execute when tasks are ready</em><ul>
<li>script, environment, job submission, remote hosting, etc.</li>
<li>suite-wide defaults in the <em>root</em> namespace</li>
<li>a nested family hierarchy with common properties
inherited by related tasks</li>
</ul>
</li>
<li><strong>[visualization]</strong> - suite graph styling</li>
</ul>
</div>
<div class="section" id="validation">
<span id="id2"></span><h4>9.2.5. Validation<a class="headerlink" href="#validation" title="Permalink to this headline">¶</a></h4>
<p>Cylc suite.rc files are automatically validated against a specification
that defines all legal entries, values, options, and defaults. This
detects formatting errors, typographic errors, illegal items and illegal
values prior to run time. Some values are complex strings that require
further parsing by cylc to determine their correctness (this is also
done during validation). All legal entries are documented in
(<a class="reference internal" href="index.html#suitercreference"><span class="std std-ref">Suite.rc Reference</span></a>).</p>
<p>The validator reports the line numbers of detected errors. Here’s an
example showing a section heading with a missing right bracket:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc validate my.suite
    <span class="o">[[</span>special tasks<span class="o">]</span>
<span class="s1">&#39;Section bracket mismatch, line 19&#39;</span>
</pre></div>
</div>
<p>If the suite.rc file uses include-files <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">view</span></code> will
show an inlined copy of the suite with correct line numbers
(you can also edit suites in a temporarily inlined state with
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">edit</span> <span class="pre">--inline</span></code>).</p>
<p>Validation does not check the validity of chosen batch systems.</p>
</div>
</div>
<div class="section" id="scheduling-dependency-graphs">
<span id="configuringscheduling"></span><h3>9.3. Scheduling - Dependency Graphs<a class="headerlink" href="#scheduling-dependency-graphs" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">[scheduling]</span></code> section of a suite.rc file defines the
relationships between tasks in a suite - the information that allows
cylc to determine when tasks are ready to run. The most important
component of this is the suite dependency graph. Cylc graph notation
makes clear textual graph representations that are very concise because
sections of the graph that repeat at different hours of the day, say,
only have to be defined once. Here’s an example with dependencies that
vary depending on the particular cycle point:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20200401</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20200405</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[T00,T06,T12,T18]]]</span> <span class="c1"># validity (hours)</span>
            <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="kd">A</span> <span class="o">=&gt;</span> <span class="kd">B</span> <span class="o">&amp;</span> <span class="kd">C</span>   <span class="c1"># B and C trigger off A</span>
<span class="kd">A</span>[<span class="nb">-PT6H</span>] <span class="o">=&gt;</span> <span class="kd">A</span>  <span class="c1"># Model A restart trigger</span>
                    <span class="s2">&quot;&quot;&quot;</span>
        <span class="nt">[[[T06,T18]]]</span> <span class="c1"># hours</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">C</span> <span class="o">=&gt;</span> <span class="kd">X</span><span class="c">&quot;</span>
</pre></div>
</div>
<p><a class="reference internal" href="#fig-dep-eg-1"><span class="std std-numref">Fig. 21</span></a> shows the complete suite.rc listing alongside
the suite graph. This is a complete, valid, runnable suite (it will
use default task runtime properties such as <code class="docutils literal notranslate"><span class="pre">script</span></code>).</p>
<div class="twocol docutils container">
<div class="image docutils container">
<div class="figure align-center" id="fig-dep-eg-1">
<img alt="_images/dep-eg-1.png" src="_images/dep-eg-1.png" />
</div>
</div>
<div class="caption docutils container">
<p>Example Suite</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;Dependency Example 1&quot;</span>
<span class="nt">[cylc]</span>
    <span class="nv">UTC mode </span><span class="o">=</span><span class="s"> True</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20200401</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20200405</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[T00,T06,T12,T18]]]</span> <span class="c1"># validity (hours)</span>
            <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="kd">A</span> <span class="o">=&gt;</span> <span class="kd">B</span> <span class="o">&amp;</span> <span class="kd">C</span>   <span class="c1"># B and C trigger off A</span>
<span class="kd">A</span>[<span class="nb">-PT6H</span>] <span class="o">=&gt;</span> <span class="kd">A</span>  <span class="c1"># Model A restart trigger</span>
                    <span class="s2">&quot;&quot;&quot;</span>
        <span class="nt">[[[T06,T18]]]</span> <span class="c1"># hours</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">C</span> <span class="o">=&gt;</span> <span class="kd">X</span><span class="c">&quot;</span>
<span class="nt">[visualization]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20200401</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20200401T06</span>
    <span class="nt">[[node attributes]]</span>
        <span class="nv">X </span><span class="o">=</span><span class="s"> &quot;color=red&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="graph-string-syntax">
<h4>9.3.1. Graph String Syntax<a class="headerlink" href="#graph-string-syntax" title="Permalink to this headline">¶</a></h4>
<p>Multiline graph strings may contain:</p>
<ul class="simple">
<li><strong>blank lines</strong></li>
<li><strong>arbitrary white space</strong></li>
<li><strong>internal comments</strong>: following the <code class="docutils literal notranslate"><span class="pre">#</span></code> character</li>
<li><strong>conditional task trigger expressions</strong> - see below.</li>
</ul>
</div>
<div class="section" id="interpreting-graph-strings">
<h4>9.3.2. Interpreting Graph Strings<a class="headerlink" href="#interpreting-graph-strings" title="Permalink to this headline">¶</a></h4>
<p>Suite dependency graphs can be broken down into pairs in which the left
side (which may be a single task or family, or several that are
conditionally related) defines a trigger for the task or family on the
right. For instance the “word graph” <em>C triggers off B which
triggers off A</em> can be deconstructed into pairs <em>C triggers off B</em>
and <em>B triggers off A</em>. In this section we use only the default
trigger type, which is to trigger off the upstream task succeeding;
see <a class="reference internal" href="#triggertypes"><span class="std std-ref">Task Triggering</span></a> for other available triggers.</p>
<p>In the case of cycling tasks, the triggers defined by a graph string are
valid for cycle points matching the list of hours specified for the
graph section. For example this graph:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[T00,T12]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span> <span class="o">=&gt;</span> <span class="kd">B</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>implies that B triggers off A for cycle points in which the hour matches <code class="docutils literal notranslate"><span class="pre">00</span></code>
or <code class="docutils literal notranslate"><span class="pre">12</span></code>.</p>
<p>To define inter-cycle dependencies, attach an offset indicator to the
left side of a pair:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[T00,T12]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span>[<span class="nb">-PT12H</span>] <span class="o">=&gt;</span> <span class="kd">B</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>This means B[time] triggers off A[time-PT12H] (12 hours before) for cycle
points with hours matching <code class="docutils literal notranslate"><span class="pre">00</span></code> or <code class="docutils literal notranslate"><span class="pre">12</span></code>. <code class="docutils literal notranslate"><span class="pre">time</span></code> is implicit because
this keeps graphs clean and concise, given that the
majority of tasks will typically
depend only on others with the same cycle point. Cycle point offsets can only
appear on the left of a pair, because a pairs define triggers for the right
task at cycle point <code class="docutils literal notranslate"><span class="pre">time</span></code>. However, <code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">=&gt;</span> <span class="pre">B[-PT6H]</span></code>, which is
illegal, can be reformulated as a <em>future trigger</em>
<code class="docutils literal notranslate"><span class="pre">A[+PT6H]</span> <span class="pre">=&gt;</span> <span class="pre">B</span></code> (see <a class="reference internal" href="#intercyclepointtriggers"><span class="std std-ref">Inter-Cycle Triggers</span></a>). It is also
possible to combine multiple offsets within a cycle point offset e.g.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[T00,T12]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span>[<span class="nb">-P1D-PT12H</span>] <span class="o">=&gt;</span> <span class="kd">B</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>This means that B[Time] triggers off A[time-P1D-PT12H] (1 day and 12 hours
before).</p>
<p>Triggers can be chained together. This graph:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">A</span> <span class="o">=&gt;</span> <span class="kd">B</span>  <span class="c1"># B triggers off A</span>
           <span class="kd">B</span> <span class="o">=&gt;</span> <span class="kd">C</span>  <span class="c1"># C triggers off B&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>is equivalent to this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span> <span class="o">=&gt;</span> <span class="kd">B</span> <span class="o">=&gt;</span> <span class="kd">C</span><span class="c">&quot;</span>
</pre></div>
</div>
<p><em>Each trigger in the graph must be unique</em> but <em>the same task
can appear in multiple pairs or chains</em>. Separately defined triggers
for the same task have an AND relationship. So this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">A</span> <span class="o">=&gt;</span> <span class="kd">X</span>  <span class="c1"># X triggers off A</span>
           <span class="kd">B</span> <span class="o">=&gt;</span> <span class="kd">X</span>  <span class="c1"># X also triggers off B&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>is equivalent to this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span> <span class="o">&amp;</span> <span class="kd">B</span> <span class="o">=&gt;</span> <span class="kd">X</span><span class="c">&quot;</span>  <span class="c1"># X triggers off A AND B</span>
</pre></div>
</div>
<p>In summary, the branching tree structure of a dependency graph can
be partitioned into lines (in the suite.rc graph string) of pairs
or chains, in any way you like, with liberal use of internal white space
and comments to make the graph structure as clear as possible.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># B triggers if A succeeds, then C and D trigger if B succeeds:</span>
    <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span> <span class="o">=&gt;</span> <span class="kd">B</span> <span class="o">=&gt;</span> <span class="kd">C</span> <span class="o">&amp;</span> <span class="kd">D</span><span class="c">&quot;</span>
<span class="c1"># which is equivalent to this:</span>
    <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">A</span> <span class="o">=&gt;</span> <span class="kd">B</span> <span class="o">=&gt;</span> <span class="kd">C</span>
               <span class="kd">B</span> <span class="o">=&gt;</span> <span class="kd">D</span><span class="s2">&quot;&quot;&quot;</span>
<span class="c1"># and to this:</span>
    <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">A</span> <span class="o">=&gt;</span> <span class="kd">B</span> <span class="o">=&gt;</span> <span class="kd">D</span>
               <span class="kd">B</span> <span class="o">=&gt;</span> <span class="kd">C</span><span class="s2">&quot;&quot;&quot;</span>
<span class="c1"># and to this:</span>
    <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">A</span> <span class="o">=&gt;</span> <span class="kd">B</span>
               <span class="kd">B</span> <span class="o">=&gt;</span> <span class="kd">C</span>
               <span class="kd">B</span> <span class="o">=&gt;</span> <span class="kd">D</span><span class="s2">&quot;&quot;&quot;</span>
<span class="c1"># and it can even be written like this:</span>
    <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">A</span> <span class="o">=&gt;</span> <span class="kd">B</span> <span class="c1"># blank line follows:</span>

               <span class="kd">B</span> <span class="o">=&gt;</span> <span class="kd">C</span> <span class="c1"># comment ...</span>
               <span class="kd">B</span> <span class="o">=&gt;</span> <span class="kd">D</span><span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="section" id="splitting-up-long-graph-lines">
<h5>9.3.2.1. Splitting Up Long Graph Lines<a class="headerlink" href="#splitting-up-long-graph-lines" title="Permalink to this headline">¶</a></h5>
<p>It is not necessary to use the general line continuation marker
<code class="docutils literal notranslate"><span class="pre">\</span></code> to split long graph lines. Just break at dependency arrows,
or split long chains into smaller ones. This graph:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span> <span class="o">=&gt;</span> <span class="kd">B</span> <span class="o">=&gt;</span> <span class="kd">C</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>is equivalent to this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">A</span> <span class="o">=&gt;</span> <span class="kd">B</span> <span class="o">=&gt;</span>
           <span class="kd">C</span><span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>and also to this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">A</span> <span class="o">=&gt;</span> <span class="kd">B</span>
           <span class="kd">B</span> <span class="o">=&gt;</span> <span class="kd">C</span><span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="graph-types">
<span id="graphtypes"></span><h4>9.3.3. Graph Types<a class="headerlink" href="#graph-types" title="Permalink to this headline">¶</a></h4>
<p>A suite configuration can contain multiple graph strings that are combined
to generate the final graph.</p>
<div class="section" id="one-off-non-cycling">
<h5>9.3.3.1. One-off (Non-Cycling)<a class="headerlink" href="#one-off-non-cycling" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="#fig-test1"><span class="std std-numref">Fig. 22</span></a> shows a small suite of one-off non-cycling
tasks; these all share a single cycle point (<code class="docutils literal notranslate"><span class="pre">1</span></code>) and don’t spawn
successors (once they’re all finished the suite just exits). The integer
<code class="docutils literal notranslate"><span class="pre">1</span></code> attached to each graph node is just an arbitrary label here.</p>
<div class="twocol docutils container">
<div class="image docutils container">
<div class="figure align-center" id="fig-test1">
<img alt="_images/test1.png" src="_images/test1.png" />
</div>
</div>
<div class="caption docutils container">
<p>One-off (Non-Cycling) Tasks.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> some one-off tasks</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">bar</span> <span class="o">&amp;</span> <span class="kd">baz</span> <span class="o">=&gt;</span> <span class="kd">qux</span><span class="c">&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="cycling-graphs">
<h5>9.3.3.2. Cycling Graphs<a class="headerlink" href="#cycling-graphs" title="Permalink to this headline">¶</a></h5>
<p>For cycling tasks the graph section heading defines a sequence of cycle points
for which the subsequent graph section is valid. <a class="reference internal" href="#fig-test2"><span class="std std-numref">Fig. 23</span></a>
shows a small suite of cycling tasks.</p>
<div class="twocol docutils container">
<div class="image docutils container">
<div class="figure align-center" id="fig-test2">
<img alt="_images/test2.png" src="_images/test2.png" />
</div>
</div>
<div class="caption docutils container">
<p>Cycling Tasks.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> some cycling tasks</span>
<span class="c1"># (no dependence between cycle points)</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[T00,T12]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">bar</span> <span class="o">&amp;</span> <span class="kd">baz</span> <span class="o">=&gt;</span> <span class="kd">qux</span><span class="c">&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="graph-section-headings">
<h4>9.3.4. Graph Section Headings<a class="headerlink" href="#graph-section-headings" title="Permalink to this headline">¶</a></h4>
<p>Graph section headings define recurrence expressions, the graph within a graph
section heading defines a workflow at each point of the recurrence. For
example in the following scenario:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[ T06 ]]]</span>  <span class="c1"># A graph section heading</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">bar</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">T06</span></code> means “Run every day starting at 06:00 after the
initial cycle point”. Cylc allows you to start (or end) at any particular
time, repeat at whatever frequency you like, and even optionally limit the
number of repetitions.</p>
<p>Graph section heading can also be used with integer cycling see
<a class="reference internal" href="#integercycling"><span class="std std-ref">Integer Cycling</span></a>.</p>
<div class="section" id="syntax-rules">
<h5>9.3.4.1. Syntax Rules<a class="headerlink" href="#syntax-rules" title="Permalink to this headline">¶</a></h5>
<p>Date-time cycling information is made up of a starting <em>date-time</em>, an
<em>interval</em>, and an optional <em>limit</em>.</p>
<p>The time is assumed to be in the local time zone unless you set
<code class="docutils literal notranslate"><span class="pre">[cylc]cycle</span> <span class="pre">point</span> <span class="pre">time</span> <span class="pre">zone</span></code> or <code class="docutils literal notranslate"><span class="pre">[cylc]UTC</span> <span class="pre">mode</span></code>. The
calendar is assumed to be the proleptic Gregorian calendar unless you set
<code class="docutils literal notranslate"><span class="pre">[scheduling]cycling</span> <span class="pre">mode</span></code>.</p>
<p>The syntax for representations is based on the ISO 8601 date-time standard.
This includes the representation of <em>date-time</em>, <em>interval</em>. What we
define for cylc’s cycling syntax is our own optionally-heavily-condensed form
of ISO 8601 recurrence syntax. The most common full form is:
<code class="docutils literal notranslate"><span class="pre">R[limit?]/[date-time]/[interval]</span></code>. However, we allow omitting
information that can be guessed from the context (rules below). This means
that it can be written as:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>R[limit?]/[date-time]
R[limit?]//[interval]
[date-time]/[interval]
R[limit?] # Special limit of 1 case
[date-time]
[interval]
</pre></div>
</div>
<p>with example graph headings for each form being:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[[[ R5/T00 ]]]</span>           <span class="c1"># Run 5 times at 00:00 every day</span>
<span class="nt">[[[ R//PT1H ]]]</span>          <span class="c1"># Run every hour (Note the R// is redundant)</span>
<span class="nt">[[[ 20000101T00Z/P1D ]]]</span> <span class="c1"># Run every day starting at 00:00 1st Jan 2000</span>
<span class="nt">[[[ R1 ]]]</span>               <span class="c1"># Run once at the initial cycle point</span>
<span class="nt">[[[ R1/20000101T00Z ]]]</span>  <span class="c1"># Run once at 00:00 1st Jan 2000</span>
<span class="nt">[[[ P1Y ]]]</span>              <span class="c1"># Run every year</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">T00</span></code> is an example of <code class="docutils literal notranslate"><span class="pre">[date-time]</span></code>, with an
inferred 1 day period and no limit.</p>
</div>
<p>Where some or all <em>date-time</em> information is omitted, it is inferred to
be relative to the initial date-time cycle point. For example, <code class="docutils literal notranslate"><span class="pre">T00</span></code>
by itself would mean the next occurrence of midnight that follows, or is, the
initial cycle point. Entering <code class="docutils literal notranslate"><span class="pre">+PT6H</span></code> would mean 6 hours after the
initial cycle point. Entering <code class="docutils literal notranslate"><span class="pre">-P1D</span></code> would mean 1 day before the
initial cycle point. Entering no information for the <em>date-time</em> implies
the initial cycle point date-time itself.</p>
<p>Where the <em>interval</em> is omitted and some (but not all) <em>date-time</em>
information is omitted, it is inferred to be a single unit above
the largest given specific <em>date-time</em> unit. For example, the largest
given specific unit in <code class="docutils literal notranslate"><span class="pre">T00</span></code> is hours, so the inferred interval is
1 day (daily), <code class="docutils literal notranslate"><span class="pre">P1D</span></code>.</p>
<p>Where the <em>limit</em> is omitted, unlimited cycling is assumed. This will be
bounded by the final cycle point’s date-time if given.</p>
<p>Another supported form of ISO 8601 recurrence is:
<code class="docutils literal notranslate"><span class="pre">R[limit?]/[interval]/[date-time]</span></code>. This form uses the
<em>date-time</em> as the end of the cycling sequence rather than the start.
For example, <code class="docutils literal notranslate"><span class="pre">R3/P5D/20140430T06</span></code> means:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>20140420T06
20140425T06
20140430T06
</pre></div>
</div>
<p>This kind of form can be used for specifying special behaviour near the end of
the suite, at the final cycle point’s date-time. We can also represent this in
cylc with a collapsed form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>R[limit?]/[interval]
R[limit?]//[date-time]
[interval]/[date-time]
</pre></div>
</div>
<p>So, for example, you can write:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[[[ R1//+P0D ]]]</span>  <span class="c1"># Run once at the final cycle point</span>
<span class="nt">[[[ R5/P1D ]]]</span>    <span class="c1"># Run 5 times, every 1 day, ending at the final</span>
                  <span class="c1"># cycle point</span>
<span class="nt">[[[ P2W/T00 ]]]</span>   <span class="c1"># Run every 2 weeks ending at 00:00 following</span>
                  <span class="c1"># the final cycle point</span>
<span class="nt">[[[ R//T00 ]]]</span>    <span class="c1"># Run every 1 day ending at 00:00 following the</span>
                  <span class="c1"># final cycle point</span>
</pre></div>
</div>
</div>
<div class="section" id="referencing-the-initial-and-final-cycle-points">
<span id="id3"></span><h5>9.3.4.2. Referencing The Initial And Final Cycle Points<a class="headerlink" href="#referencing-the-initial-and-final-cycle-points" title="Permalink to this headline">¶</a></h5>
<p>For convenience the caret and dollar symbols may be used as shorthand for the
initial and final cycle points. Using this shorthand you can write:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[[[ R1/^+PT12H ]]]</span>  <span class="c1"># Repeat once 12 hours after the initial cycle point</span>
                    <span class="c1"># R[limit]/[date-time]</span>
                    <span class="c1"># Equivalent to [[[ R1/+PT12H ]]]</span>
<span class="nt">[[[ R1/$ ]]]</span>        <span class="c1"># Repeat once at the final cycle point</span>
                    <span class="c1"># R[limit]/[date-time]</span>
                    <span class="c1"># Equivalent to [[[ R1//+P0D ]]]</span>
<span class="nt">[[[ $-P2D/PT3H ]]]</span>  <span class="c1"># Repeat 3 hourly starting two days before the</span>
                    <span class="c1"># [date-time]/[interval]</span>
                    <span class="c1"># final cycle point</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>There can be multiple ways to write the same headings, for instance
the following all run once at the final cycle point:</p>
<div class="last highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[[[ R1/P0Y ]]]</span>      <span class="c1"># R[limit]/[interval]</span>
<span class="nt">[[[ R1/P0Y/$ ]]]</span>    <span class="c1"># R[limit]/[interval]/[date-time]</span>
<span class="nt">[[[ R1/$ ]]]</span>        <span class="c1"># R[limit]/[date-time]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="excluding-dates">
<span id="id4"></span><h5>9.3.4.3. Excluding Dates<a class="headerlink" href="#excluding-dates" title="Permalink to this headline">¶</a></h5>
<p>Date-times can be excluded from a recurrence by an exclamation mark for
example <code class="docutils literal notranslate"><span class="pre">[[[</span> <span class="pre">PT1D!20000101</span> <span class="pre">]]]</span></code> means run daily except on the
first of January 2000.</p>
<p>This syntax can be used to exclude one or multiple date-times from a
recurrence. Multiple date-times are excluded using the syntax
<code class="docutils literal notranslate"><span class="pre">[[[</span> <span class="pre">PT1D!(20000101,20000102,...)</span> <span class="pre">]]]</span></code>. All date-times listed within
the parentheses after the exclamation mark will be excluded.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">^</span></code> and <code class="docutils literal notranslate"><span class="pre">$</span></code> symbols (shorthand for the initial
and final cycle points) are both date-times so <code class="docutils literal notranslate"><span class="pre">[[[</span> <span class="pre">T12!$-PT1D</span> <span class="pre">]]]</span></code>
is valid.</p>
</div>
<p>If using a run limit in combination with an exclusion, the heading might not
run the number of times specified in the limit. For example in the following
suite <code class="docutils literal notranslate"><span class="pre">foo</span></code> will only run once as its second run has been excluded.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20000101T00Z</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20000105T00Z</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[ R2/P1D!20000102 ]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">foo</span>
</pre></div>
</div>
</div>
<div class="section" id="advanced-exclusion-syntax">
<h5>9.3.4.4. Advanced exclusion syntax<a class="headerlink" href="#advanced-exclusion-syntax" title="Permalink to this headline">¶</a></h5>
<p>In addition to excluding isolated date-time points or lists of date-time points
from recurrences, exclusions themselves may be date-time recurrence sequences.
Any partial date-time or sequence given after the exclamation mark will be
excluded from the main sequence.</p>
<p>For example, partial date-times can be excluded using the syntax:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[[[ PT1H ! T12 ]]]</span>          <span class="c1"># Run hourly but not at 12:00 from the initial</span>
                            <span class="c1"># cycle point.</span>
<span class="nt">[[[ T-00 ! (T00, T06, T12, T18) ]]]</span>   <span class="c1"># Run hourly but not at 00:00, 06:00,</span>
                                      <span class="c1"># 12:00, 18:00.</span>
<span class="nt">[[[ PT5M ! T-15 ]]]</span>         <span class="c1"># Run 5-minutely but not at 15 minutes past the</span>
                            <span class="c1"># hour from the initial cycle point.</span>
<span class="nt">[[[ T00 ! W-1T00 ]]]</span>        <span class="c1"># Run daily at 00:00 except on Mondays.</span>
</pre></div>
</div>
<p>It is also valid to use sequences for exclusions. For example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[[[ PT1H ! PT6H ]]]</span>         <span class="c1"># Run hourly from the initial cycle point but</span>
                            <span class="c1"># not 6-hourly from the initial cycle point.</span>
<span class="nt">[[[ T-00 ! PT6H ]]]</span>         <span class="c1"># Run hourly on the hour but not 6-hourly</span>
                            <span class="c1"># on the hour.</span>
    <span class="c1"># Same as [[[ T-00 ! T-00/PT6H ]]] (T-00 context is implied)</span>
    <span class="c1"># Same as [[[ T-00 ! (T00, T06, T12, T18) ]]]</span>
    <span class="c1"># Same as [[[ PT1H ! (T00, T06, T12, T18) ]]] Initial cycle point dependent</span>

<span class="nt">[[[ T12 ! T12/P15D ]]]</span>      <span class="c1"># Run daily at 12:00 except every 15th day.</span>

<span class="nt">[[[ R/^/P1H ! R5/20000101T00/P1D ]]]</span>    <span class="c1"># Any valid recurrence may be used to</span>
                                        <span class="c1"># determine exclusions. This example</span>
                                        <span class="c1"># translates to: Repeat every hour from</span>
                                        <span class="c1"># the initial cycle point, but exclude</span>
                                        <span class="c1"># 00:00 for 5 days from the 1st January</span>
                                        <span class="c1"># 2000.</span>
</pre></div>
</div>
<p>You can combine exclusion sequences and single point exclusions within a
comma separated list enclosed in parentheses:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[[[ T-00 ! (20000101T07, PT2H) ]]]</span>      <span class="c1"># Run hourly on the hour but not at 07:00</span>
                                        <span class="c1"># on the 1st Jan, 2000 and not 2-hourly</span>
                                        <span class="c1"># on the hour.</span>
</pre></div>
</div>
</div>
<div class="section" id="how-multiple-graph-strings-combine">
<span id="howmultiplegraphstringscombine"></span><h5>9.3.4.5. How Multiple Graph Strings Combine<a class="headerlink" href="#how-multiple-graph-strings-combine" title="Permalink to this headline">¶</a></h5>
<p>For a cycling graph with multiple validity sections for different
hours of the day, the different sections <em>add</em> to generate the
complete graph. Different graph sections can overlap (i.e. the same
hours may appear in multiple section headings) and the same tasks may
appear in multiple sections, but individual dependencies should be
unique across the entire graph. For example, the following graph defines
a duplicate prerequisite for task C:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[T00,T06,T12,T18]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span> <span class="o">=&gt;</span> <span class="kd">B</span> <span class="o">=&gt;</span> <span class="kd">C</span><span class="c">&quot;</span>
        <span class="nt">[[[T06,T18]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">B</span> <span class="o">=&gt;</span> <span class="kd">C</span> <span class="o">=&gt;</span> <span class="kd">X</span><span class="c">&quot;</span>
            <span class="c1"># duplicate prerequisite: B =&gt; C already defined at T06, T18</span>
</pre></div>
</div>
<p>This does not affect scheduling, but for the sake of clarity and brevity
the graph should be written like this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[T00,T06,T12,T18]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span> <span class="o">=&gt;</span> <span class="kd">B</span> <span class="o">=&gt;</span> <span class="kd">C</span><span class="c">&quot;</span>
        <span class="nt">[[[T06,T18]]]</span>
            <span class="c1"># X triggers off C only at 6 and 18 hours</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">C</span> <span class="o">=&gt;</span> <span class="kd">X</span><span class="c">&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="advanced-examples">
<span id="advancedcycling"></span><h5>9.3.4.6. Advanced Examples<a class="headerlink" href="#advanced-examples" title="Permalink to this headline">¶</a></h5>
<p>The following examples show the various ways of writing graph headings in cylc.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[[[ R1 ]]]</span>         <span class="c1"># Run once at the initial cycle point</span>
<span class="nt">[[[ P1D ]]]</span>        <span class="c1"># Run every day starting at the initial cycle point</span>
<span class="nt">[[[ PT5M ]]]</span>       <span class="c1"># Run every 5 minutes starting at the initial cycle</span>
                   <span class="c1"># point</span>
<span class="nt">[[[ T00/P2W ]]]</span>    <span class="c1"># Run every 2 weeks starting at 00:00 after the</span>
                   <span class="c1"># initial cycle point</span>
<span class="nt">[[[ +P5D/P1M ]]]</span>   <span class="c1"># Run every month, starting 5 days after the initial</span>
                   <span class="c1"># cycle point</span>
<span class="nt">[[[ R1/T06 ]]]</span>     <span class="c1"># Run once at 06:00 after the initial cycle point</span>
<span class="nt">[[[ R1/P0Y ]]]</span>     <span class="c1"># Run once at the final cycle point</span>
<span class="nt">[[[ R1/$ ]]]</span>       <span class="c1"># Run once at the final cycle point (alternative</span>
                   <span class="c1"># form)</span>
<span class="nt">[[[ R1/$-P3D ]]]</span>   <span class="c1"># Run once three days before the final cycle point</span>
<span class="nt">[[[ R3/T0830 ]]]</span>   <span class="c1"># Run 3 times, every day at 08:30 after the initial</span>
                   <span class="c1"># cycle point</span>
<span class="nt">[[[ R3/01T00 ]]]</span>   <span class="c1"># Run 3 times, every month at 00:00 on the first</span>
                   <span class="c1"># of the month after the initial cycle point</span>
<span class="nt">[[[ R5/W-1/P1M ]]]</span> <span class="c1"># Run 5 times, every month starting on Monday</span>
                   <span class="c1"># following the initial cycle point</span>
<span class="nt">[[[ T00!^ ]]]</span>      <span class="c1"># Run at the first occurrence of T00 that isn&#39;t the</span>
                   <span class="c1"># initial cycle point</span>
<span class="nt">[[[ PT1D!20000101 ]]]</span>  <span class="c1"># Run every day days excluding 1st Jan 2000</span>
<span class="nt">[[[ 20140201T06/P1D ]]]</span>    <span class="c1"># Run every day starting at 20140201T06</span>
<span class="nt">[[[ R1/min(T00,T06,T12,T18) ]]]</span>  <span class="c1"># Run once at the first instance</span>
                                 <span class="c1"># of either T00, T06, T12 or T18</span>
                                 <span class="c1"># starting at the initial cycle</span>
                                 <span class="c1"># point</span>
</pre></div>
</div>
</div>
<div class="section" id="advanced-starting-up">
<span id="advancedstartingup"></span><h5>9.3.4.7. Advanced Starting Up<a class="headerlink" href="#advanced-starting-up" title="Permalink to this headline">¶</a></h5>
<p>Dependencies that are only valid at the initial cycle point can be written
using the <code class="docutils literal notranslate"><span class="pre">R1</span></code> notation (e.g. as in <a class="reference internal" href="index.html#initial-non-repeating-r1-tasks"><span class="std std-ref">Initial Non-Repeating (R1) Tasks</span></a>.
For example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nv">UTC mode </span><span class="o">=</span><span class="s"> True</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20130808T00</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20130812T00</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[R1]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">prep</span> <span class="o">=&gt;</span> <span class="kd">foo</span><span class="c">&quot;</span>
        <span class="nt">[[[T00]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span>[<span class="nb">-P1D</span>] <span class="o">=&gt;</span> <span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>In the example above, <code class="docutils literal notranslate"><span class="pre">R1</span></code> implies <code class="docutils literal notranslate"><span class="pre">R1/20130808T00</span></code>, so
<code class="docutils literal notranslate"><span class="pre">prep</span></code> only runs once at that cycle point (the initial cycle point).
At that cycle point, <code class="docutils literal notranslate"><span class="pre">foo</span></code> will have a dependence on
<code class="docutils literal notranslate"><span class="pre">prep</span></code> - but not at subsequent cycle points.</p>
<p>However, it is possible to have a suite that has multiple effective initial
cycles - for example, one starting at <code class="docutils literal notranslate"><span class="pre">T00</span></code> and another starting
at <code class="docutils literal notranslate"><span class="pre">T12</span></code>. What if they need to share an initial task?</p>
<p>Let’s suppose that we add the following section to the suite example above:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nv">UTC mode </span><span class="o">=</span><span class="s"> True</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20130808T00</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20130812T00</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[R1]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">prep</span> <span class="o">=&gt;</span> <span class="kd">foo</span><span class="c">&quot;</span>
        <span class="nt">[[[T00]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span>[<span class="nb">-P1D</span>] <span class="o">=&gt;</span> <span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
        <span class="nt">[[[T12]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">baz</span>[<span class="nb">-P1D</span>] <span class="o">=&gt;</span> <span class="kd">baz</span> <span class="o">=&gt;</span> <span class="kd">qux</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>We’ll also say that there should be a starting dependence between
<code class="docutils literal notranslate"><span class="pre">prep</span></code> and our new task <code class="docutils literal notranslate"><span class="pre">baz</span></code> - but we still want to have
a single <code class="docutils literal notranslate"><span class="pre">prep</span></code> task, at a single cycle.</p>
<p>We can write this using a special case of the <code class="docutils literal notranslate"><span class="pre">task[-interval]</span></code> syntax -
if the interval is null, this implies the task at the initial cycle point.</p>
<p>For example, we can write our suite like <a class="reference internal" href="#fig-test4"><span class="std std-numref">Fig. 24</span></a>.</p>
<div class="twocol docutils container">
<div class="image docutils container">
<div class="figure align-center" id="fig-test4">
<img alt="_images/test4.png" src="_images/test4.png" />
</div>
</div>
<div class="caption docutils container">
<p>Staggered Start Suite</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nv">UTC mode </span><span class="o">=</span><span class="s"> True</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20130808T00</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20130812T00</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[R1]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">prep</span><span class="c">&quot;</span>
        <span class="nt">[[[R1/T00]]]</span>
<span class="c1"># ^ implies the initial cycle point:</span>
     <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">prep</span>[<span class="nb">^</span>] <span class="o">=&gt;</span> <span class="kd">foo</span><span class="c">&quot;</span>
        <span class="nt">[[[R1/T12]]]</span>
<span class="c1"># ^ is initial cycle point, as above:</span>
     <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">prep</span>[<span class="nb">^</span>] <span class="o">=&gt;</span> <span class="kd">baz</span><span class="c">&quot;</span>
        <span class="nt">[[[T00]]]</span>
     <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span>[<span class="nb">-P1D</span>] <span class="o">=&gt;</span> <span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
        <span class="nt">[[[T12]]]</span>
     <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">baz</span>[<span class="nb">-P1D</span>] <span class="o">=&gt;</span> <span class="kd">baz</span> <span class="o">=&gt;</span> <span class="kd">qux</span><span class="c">&quot;</span>
<span class="nt">[visualization]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20130808T00</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20130810T00</span>
    <span class="nt">[[node attributes]]</span>
        <span class="nv">foo </span><span class="o">=</span><span class="s"> &quot;color=red&quot;</span>
        <span class="nv">bar </span><span class="o">=</span><span class="s"> &quot;color=orange&quot;</span>
        <span class="nv">baz </span><span class="o">=</span><span class="s"> &quot;color=green&quot;</span>
        <span class="nv">qux </span><span class="o">=</span><span class="s"> &quot;color=blue&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>This neatly expresses what we want - a task running at the initial cycle point
that has one-off dependencies with other task sets at different cycles.</p>
<div class="twocol docutils container">
<div class="image docutils container">
<div class="figure align-center" id="fig-test5">
<img alt="_images/test5.png" src="_images/test5.png" />
</div>
</div>
<div class="caption docutils container">
<p>Restricted First Cycle Point Suite</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nv">UTC mode </span><span class="o">=</span><span class="s"> True</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20130808T00</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20130808T18</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[R1]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">setup_foo</span> <span class="o">=&gt;</span> <span class="kd">foo</span><span class="c">&quot;</span>
        <span class="nt">[[[+PT6H/PT6H]]]</span>
            <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
                <span class="kd">foo</span>[<span class="nb">-PT6H</span>] <span class="o">=&gt;</span> <span class="kd">foo</span>
                <span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">bar</span>
            <span class="s2">&quot;&quot;&quot;</span>
<span class="nt">[visualization]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20130808T00</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20130808T18</span>
    <span class="nt">[[node attributes]]</span>
        <span class="nv">foo </span><span class="o">=</span><span class="s"> &quot;color=red&quot;</span>
        <span class="nv">bar </span><span class="o">=</span><span class="s"> &quot;color=orange&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>A different kind of requirement is displayed in <a class="reference internal" href="#fig-test5"><span class="std std-numref">Fig. 25</span></a>.
Usually, we want to specify additional tasks and dependencies at the initial
cycle point. What if we want our first cycle point to be entirely special,
with some tasks missing compared to subsequent cycle points?</p>
<p>In <a class="reference internal" href="#fig-test5"><span class="std std-numref">Fig. 25</span></a>, <code class="docutils literal notranslate"><span class="pre">bar</span></code> will not be run at the initial
cycle point, but will still run at subsequent cycle points.
<code class="docutils literal notranslate"><span class="pre">[[[+PT6H/PT6H]]]</span></code> means start at <code class="docutils literal notranslate"><span class="pre">+PT6H</span></code> (6 hours after
the initial cycle point) and then repeat every <code class="docutils literal notranslate"><span class="pre">PT6H</span></code> (6 hours).</p>
<p>Some suites may have staggered start-up sequences where different tasks need
running once but only at specific cycle points, potentially due to differing
data sources at different cycle points with different possible initial cycle
points. To allow this cylc provides a <code class="docutils literal notranslate"><span class="pre">min(</span> <span class="pre">)</span></code> function that can be
used as follows:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nv">UTC mode </span><span class="o">=</span><span class="s"> True</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20100101T03</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[R1/min(T00,T12)]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">prep1</span> <span class="o">=&gt;</span> <span class="kd">foo</span><span class="c">&quot;</span>
        <span class="nt">[[[R1/min(T06,T18)]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">prep2</span> <span class="o">=&gt;</span> <span class="kd">foo</span><span class="c">&quot;</span>
        <span class="nt">[[[T00,T06,T12,T18]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>In this example the initial cycle point is <code class="docutils literal notranslate"><span class="pre">20100101T03</span></code>, so the
<code class="docutils literal notranslate"><span class="pre">prep1</span></code> task will run once at <code class="docutils literal notranslate"><span class="pre">20100101T12</span></code> and the
<code class="docutils literal notranslate"><span class="pre">prep2</span></code> task will run once at <code class="docutils literal notranslate"><span class="pre">20100101T06</span></code> as these are
the first cycle points after the initial cycle point in the respective
<code class="docutils literal notranslate"><span class="pre">min(</span> <span class="pre">)</span></code> entries.</p>
</div>
<div class="section" id="integer-cycling">
<span id="integercycling"></span><h5>9.3.4.8. Integer Cycling<a class="headerlink" href="#integer-cycling" title="Permalink to this headline">¶</a></h5>
<p>In addition to non-repeating and date-time cycling workflows, cylc can do
integer cycling for repeating workflows that are not date-time based.</p>
<p>To construct an integer cycling suite, set
<code class="docutils literal notranslate"><span class="pre">[scheduling]cycling</span> <span class="pre">mode</span> <span class="pre">=</span> <span class="pre">integer</span></code>, and specify integer values for
the initial and (optional) final cycle points. The notation for intervals,
offsets, and recurrences (sequences) is similar to the date-time cycling
notation, except for the simple integer values.</p>
<p>The full integer recurrence expressions supported are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Rn/start-point/interval</span> <span class="pre">#</span> <span class="pre">e.g.</span> <span class="pre">R3/1/P2</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Rn/interval/end-point</span> <span class="pre">#</span> <span class="pre">e.g.</span> <span class="pre">R3/P2/9</span></code></li>
</ul>
<p>But, as for date-time cycling, sequence start and end points can be omitted
where suite initial and final cycle points can be assumed. Some examples:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[[[ R1 ]]]</span>        <span class="c1"># Run once at the initial cycle point</span>
                  <span class="c1"># (short for R1/initial-point/?)</span>
<span class="nt">[[[ P1 ]]]</span>        <span class="c1"># Repeat with step 1 from the initial cycle point</span>
                  <span class="c1"># (short for R/initial-point/P1)</span>
<span class="nt">[[[ P5 ]]]</span>        <span class="c1"># Repeat with step 5 from the initial cycle point</span>
                  <span class="c1"># (short for R/initial-point/P5)</span>
<span class="nt">[[[ R2//P2 ]]]</span>    <span class="c1"># Run twice with step 3 from the initial cycle point</span>
                  <span class="c1"># (short for R2/initial-point/P2)</span>
<span class="nt">[[[ R/+P1/P2 ]]]</span>  <span class="c1"># Repeat with step 2, from 1 after the initial cycle point</span>
<span class="nt">[[[ R2/P2 ]]]</span>     <span class="c1"># Run twice with step 2, to the final cycle point</span>
                  <span class="c1"># (short for R2/P2/final-point)</span>
<span class="nt">[[[ R1/P0 ]]]</span>     <span class="c1"># Run once at the final cycle point</span>
                  <span class="c1"># (short for R1/P0/final-point)</span>
</pre></div>
</div>
<div class="section" id="example">
<h6>9.3.4.8.1. Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h6>
<p>The tutorial illustrates integer cycling in <a class="reference internal" href="index.html#tutinteger"><span class="std std-ref">Integer Cycling</span></a>, and
<code class="docutils literal notranslate"><span class="pre">&lt;cylc-dir&gt;/etc/examples/satellite/</span></code> is a
self-contained example of a realistic use for integer cycling. It simulates
the processing of incoming satellite data: each new dataset arrives after a
random (as far as the suite is concerned) interval, and is labeled by an
arbitrary (as far as the suite is concerned) ID in the filename. A task called
<code class="docutils literal notranslate"><span class="pre">get_data</span></code> at the top of the repeating workflow waits on the next
dataset and, when it finds one, moves it to a cycle-point-specific shared
workspace for processing by the downstream tasks. When <code class="docutils literal notranslate"><span class="pre">get_data.1</span></code>
finishes, <code class="docutils literal notranslate"><span class="pre">get_data.2</span></code> triggers and begins waiting for the next
dataset at the same time as the downstream tasks in cycle point 1 are
processing the first one, and so on. In this way multiple datasets can be
processed at once if they happen to come in quickly. A single shutdown task
runs at the end of the final cycle to collate results. The suite graph is
shown in <a class="reference internal" href="#fig-satellite"><span class="std std-numref">Fig. 26</span></a>.</p>
<div class="figure align-center" id="id13">
<span id="fig-satellite"></span><img alt="_images/satellite.png" src="_images/satellite.png" />
<p class="caption"><span class="caption-number">Fig. 26 </span><span class="caption-text">The <code class="docutils literal notranslate"><span class="pre">etc/examples/satellite</span></code> integer suite.</span></p>
</div>
</div>
<div class="section" id="advanced-integer-cycling-syntax">
<h6>9.3.4.8.2. Advanced Integer Cycling Syntax<a class="headerlink" href="#advanced-integer-cycling-syntax" title="Permalink to this headline">¶</a></h6>
<p>The same syntax used to reference the initial and final cycle points
(introduced in <a class="reference internal" href="#referencing-the-initial-and-final-cycle-points"><span class="std std-ref">Referencing The Initial And Final Cycle Points</span></a>) for
use with date-time cycling can also be used for integer cycling. For
example you can write:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[[[ R1/^ ]]]</span>     <span class="c1"># Run once at the initial cycle point</span>
<span class="nt">[[[ R1/$ ]]]</span>     <span class="c1"># Run once at the final cycle point</span>
<span class="nt">[[[ R3/^/P2 ]]]</span>  <span class="c1"># Run three times with step two starting at the</span>
                 <span class="c1"># initial cycle point</span>
</pre></div>
</div>
<p>Likewise the syntax introduced in <a class="reference internal" href="#excluding-dates"><span class="std std-ref">Excluding Dates</span></a> for excluding
a particular point from a recurrence also works for integer cycling. For
example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[[[ R/P4!8 ]]]</span>       <span class="c1"># Run with step 4, to the final cycle point</span>
                     <span class="c1"># but not at point 8</span>
<span class="nt">[[[ R3/3/P2!5 ]]]</span>    <span class="c1"># Run with step 2 from point 3 but not at</span>
                     <span class="c1"># point 5</span>
<span class="nt">[[[ R/+P1/P6!14 ]]]</span>  <span class="c1"># Run with step 6 from 1 step after the</span>
                     <span class="c1"># initial cycle point but not at point 14</span>
</pre></div>
</div>
<p>Multiple integer exclusions are also valid in the same way as the syntax
in <a class="reference internal" href="#excluding-dates"><span class="std std-ref">Excluding Dates</span></a>. Integer exclusions may be a list of single
integer points, an integer sequence, or a combination of both:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[[[ R/P1!(2,3,7) ]]]</span>  <span class="c1"># Run with step 1 to the final cycle point,</span>
                      <span class="c1"># but not at points 2, 3, or 7.</span>
<span class="nt">[[[ P1 ! P2 ]]]</span>       <span class="c1"># Run with step 1 from the initial to final</span>
                      <span class="c1"># cycle point, skipping every other step from</span>
                      <span class="c1"># the initial cycle point.</span>
<span class="nt">[[[ P1 ! +P1/P2 ]]]</span>   <span class="c1"># Run with step 1 from the initial cycle point,</span>
                      <span class="c1"># excluding every other step beginning one step</span>
                      <span class="c1"># after the initial cycle point.</span>
<span class="nt">[[[ P1 !(P2,6,8) ]]]</span>  <span class="c1"># Run with step 1 from the initial cycle point,</span>
                      <span class="c1"># excluding every other step, and also excluding</span>
                      <span class="c1"># steps 6 and 8.</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="task-triggering">
<span id="triggertypes"></span><h4>9.3.5. Task Triggering<a class="headerlink" href="#task-triggering" title="Permalink to this headline">¶</a></h4>
<p>A task is said to “trigger” when it submits its job to run, as soon as all of
its dependencies (also known as its separate “triggers”) are met. Tasks can
be made to trigger off of the state of other tasks (indicated by a
<code class="docutils literal notranslate"><span class="pre">:state</span></code> qualifier on the upstream task (or family)
name in the graph) and, and off the clock, and arbitrary external events.</p>
<p>External triggering is relatively more complicated, and is documented
separately in <a class="reference internal" href="index.html#external-triggers"><span class="std std-ref">External Triggers</span></a>.</p>
<div class="section" id="success-triggers">
<h5>9.3.5.1. Success Triggers<a class="headerlink" href="#success-triggers" title="Permalink to this headline">¶</a></h5>
<p>The default, with no trigger type specified, is to trigger off the
upstream task succeeding:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># B triggers if A SUCCEEDS:</span>
    <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span> <span class="o">=&gt;</span> <span class="kd">B</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>For consistency and completeness, however, the success trigger can be
explicit:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># B triggers if A SUCCEEDS:</span>
    <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span> <span class="o">=&gt;</span> <span class="kd">B</span><span class="c">&quot;</span>
<span class="c1"># or:</span>
    <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span><span class="c">:</span><span class="kd">succeed</span> <span class="o">=&gt;</span> <span class="kd">B</span><span class="c">&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="failure-triggers">
<h5>9.3.5.2. Failure Triggers<a class="headerlink" href="#failure-triggers" title="Permalink to this headline">¶</a></h5>
<p>To trigger off the upstream task reporting failure:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># B triggers if A FAILS:</span>
    <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span><span class="c">:</span><span class="kd">fail</span> <span class="o">=&gt;</span> <span class="kd">B</span><span class="c">&quot;</span>
</pre></div>
</div>
<p><em>Suicide triggers</em> can be used to remove task <code class="docutils literal notranslate"><span class="pre">B</span></code> here if
<code class="docutils literal notranslate"><span class="pre">A</span></code> does not fail, see <a class="reference internal" href="#suicidetriggers"><span class="std std-ref">Suicide Triggers</span></a>.</p>
</div>
<div class="section" id="start-triggers">
<h5>9.3.5.3. Start Triggers<a class="headerlink" href="#start-triggers" title="Permalink to this headline">¶</a></h5>
<p>To trigger off the upstream task starting to execute:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># B triggers if A STARTS EXECUTING:</span>
    <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span><span class="c">:</span><span class="kd">start</span> <span class="o">=&gt;</span> <span class="kd">B</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>This can be used to trigger tasks that monitor other tasks once they
(the target tasks) start executing. Consider a long-running forecast model,
for instance, that generates a sequence of output files as it runs. A
postprocessing task could be launched with a start trigger on the model
(<code class="docutils literal notranslate"><span class="pre">model:start</span> <span class="pre">=&gt;</span> <span class="pre">post</span></code>) to process the model output as it
becomes available. Note, however, that there are several alternative
ways of handling this scenario: both tasks could be triggered at the
same time (<code class="docutils literal notranslate"><span class="pre">foo</span> <span class="pre">=&gt;</span> <span class="pre">model</span> <span class="pre">&amp;</span> <span class="pre">post</span></code>), but depending on
external queue delays this could result in the monitoring task starting
to execute first; or a different postprocessing task could be
triggered off a message output for each data file
(<code class="docutils literal notranslate"><span class="pre">model:out1</span> <span class="pre">=&gt;</span> <span class="pre">post1</span></code> etc.; see <a class="reference internal" href="#messagetriggers"><span class="std std-ref">Message Triggers</span></a>), but this
may not be practical if the
number of output files is large or if it is difficult to add cylc
messaging calls to the model.</p>
</div>
<div class="section" id="finish-triggers">
<h5>9.3.5.4. Finish Triggers<a class="headerlink" href="#finish-triggers" title="Permalink to this headline">¶</a></h5>
<p>To trigger off the upstream task succeeding or failing, i.e. finishing
one way or the other:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># B triggers if A either SUCCEEDS or FAILS:</span>
    <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span> <span class="o">|</span> <span class="kd">A</span><span class="c">:</span><span class="kd">fail</span> <span class="o">=&gt;</span> <span class="kd">B</span><span class="c">&quot;</span>
<span class="c1"># or</span>
    <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span><span class="c">:</span><span class="kd">finish</span> <span class="o">=&gt;</span> <span class="kd">B</span><span class="c">&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="message-triggers">
<span id="messagetriggers"></span><h5>9.3.5.5. Message Triggers<a class="headerlink" href="#message-triggers" title="Permalink to this headline">¶</a></h5>
<p>Tasks can also trigger off custom output messages. These must be registered in
the <code class="docutils literal notranslate"><span class="pre">[runtime]</span></code> section of the emitting task, and reported using the
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">message</span></code> command in task scripting. The graph trigger notation
refers to the item name of the registered output message.
The example suite <code class="docutils literal notranslate"><span class="pre">&lt;cylc-dir&gt;/etc/examples/message-triggers</span></code> illustrates
message triggering.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;test suite for cylc-6 message triggers&quot;</span>

<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20140801T00</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20141201T00</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[P2M]]]</span>
           <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">foo</span><span class="c">:</span><span class="kd">out1</span> <span class="o">=&gt;</span> <span class="kd">bar</span>
                      <span class="kd">foo</span>[<span class="nb">-P2M</span>]<span class="c">:</span><span class="kd">out2</span> <span class="o">=&gt;</span> <span class="kd">baz</span><span class="s2">&quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nv">script </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">sleep 5</span>
<span class="s2">cylc message -- &quot;${CYLC_SUITE_NAME}&quot; &quot;${CYLC_TASK_JOB}&quot; &quot;file 1 done&quot;</span>
<span class="s2">sleep 10</span>
<span class="s2">cylc message -- &quot;${CYLC_SUITE_NAME}&quot; &quot;${CYLC_TASK_JOB}&quot; &quot;file 2 done&quot;</span>
<span class="s2">sleep 10&quot;&quot;&quot;</span>
        <span class="nt">[[[outputs]]]</span>
            <span class="nv">out1 </span><span class="o">=</span><span class="s"> &quot;file 1 done&quot;</span>
            <span class="nv">out2 </span><span class="o">=</span><span class="s"> &quot;file 2 done&quot;</span>
    <span class="nt">[[bar, baz]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> sleep 10</span>
</pre></div>
</div>
</div>
<div class="section" id="job-submission-triggers">
<h5>9.3.5.6. Job Submission Triggers<a class="headerlink" href="#job-submission-triggers" title="Permalink to this headline">¶</a></h5>
<p>It is also possible to trigger off a task submitting, or failing to submit:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># B triggers if A submits successfully:</span>
    <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span><span class="c">:</span><span class="kd">submit</span> <span class="o">=&gt;</span> <span class="kd">B</span><span class="c">&quot;</span>
<span class="c1"># D triggers if C fails to submit successfully:</span>
    <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">C</span><span class="c">:</span><span class="kd">submit</span><span class="c">-</span><span class="kd">fail</span> <span class="o">=&gt;</span> <span class="kd">D</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>A possible use case for submit-fail triggers: if a task goes into the
submit-failed state, possibly after several job submission retries,
another task that inherits the same runtime but sets a different job
submission method and/or host could be triggered to, in effect, run the
same job on a different platform.</p>
</div>
<div class="section" id="conditional-triggers">
<h5>9.3.5.7. Conditional Triggers<a class="headerlink" href="#conditional-triggers" title="Permalink to this headline">¶</a></h5>
<p>AND operators (<code class="docutils literal notranslate"><span class="pre">&amp;</span></code>) can appear on both sides of an arrow. They
provide a concise alternative to defining multiple triggers separately:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1/ this:</span>
    <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span> <span class="o">&amp;</span> <span class="kd">B</span> <span class="o">=&gt;</span> <span class="kd">C</span><span class="c">&quot;</span>
<span class="c1"># is equivalent to:</span>
    <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">A</span> <span class="o">=&gt;</span> <span class="kd">C</span>
               <span class="kd">B</span> <span class="o">=&gt;</span> <span class="kd">C</span><span class="s2">&quot;&quot;&quot;</span>
<span class="c1"># 2/ this:</span>
    <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span> <span class="o">=&gt;</span> <span class="kd">B</span> <span class="o">&amp;</span> <span class="kd">C</span><span class="c">&quot;</span>
<span class="c1"># is equivalent to:</span>
    <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">A</span> <span class="o">=&gt;</span> <span class="kd">B</span>
               <span class="kd">A</span> <span class="o">=&gt;</span> <span class="kd">C</span><span class="s2">&quot;&quot;&quot;</span>
<span class="c1"># 3/ and this:</span>
    <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span> <span class="o">&amp;</span> <span class="kd">B</span> <span class="o">=&gt;</span> <span class="kd">C</span> <span class="o">&amp;</span> <span class="kd">D</span><span class="c">&quot;</span>
<span class="c1"># is equivalent to this:</span>
    <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">A</span> <span class="o">=&gt;</span> <span class="kd">C</span>
               <span class="kd">B</span> <span class="o">=&gt;</span> <span class="kd">C</span>
               <span class="kd">A</span> <span class="o">=&gt;</span> <span class="kd">D</span>
               <span class="kd">B</span> <span class="o">=&gt;</span> <span class="kd">D</span><span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>OR operators (<code class="docutils literal notranslate"><span class="pre">|</span></code>) which result in true conditional triggers,
can only appear on the left <a class="footnote-reference" href="#id11" id="id5">[1]</a> :</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># C triggers when either A or B finishes:</span>
    <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span> <span class="o">|</span> <span class="kd">B</span> <span class="o">=&gt;</span> <span class="kd">C</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>Forecasting suites typically have simple conditional
triggering requirements, but any valid conditional expression can be
used, as shown in <a class="reference internal" href="#fig-conditional"><span class="std std-numref">Fig. 27</span></a>
(conditional triggers are plotted with open arrow heads).</p>
<div class="twocol docutils container">
<div class="image docutils container">
<div class="figure align-center" id="fig-conditional">
<img alt="_images/conditional-triggers.png" src="_images/conditional-triggers.png" />
</div>
</div>
<div class="caption docutils container">
<p>Conditional triggers, which are plotted with open arrow heads.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span>        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="c1"># D triggers if A or (B and C) succeed</span>
<span class="kd">A</span> <span class="o">|</span> <span class="kd">B</span> <span class="o">&amp;</span> <span class="kd">C</span> <span class="o">=&gt;</span> <span class="kd">D</span>
<span class="c1"># just to align the two graph sections</span>
<span class="kd">D</span> <span class="o">=&gt;</span> <span class="kd">W</span>
<span class="c1"># Z triggers if (W or X) and Y succeed</span>
<span class="p">(</span><span class="kd">W</span><span class="o">|</span><span class="kd">X</span><span class="p">)</span> <span class="o">&amp;</span> <span class="kd">Y</span> <span class="o">=&gt;</span> <span class="kd">Z</span>
                <span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="suicide-triggers">
<span id="suicidetriggers"></span><h5>9.3.5.8. Suicide Triggers<a class="headerlink" href="#suicide-triggers" title="Permalink to this headline">¶</a></h5>
<p>Suicide triggers take tasks out of the suite. This can be used for
automated failure recovery. The suite.rc listing and accompanying
graph in <a class="reference internal" href="#fig-suicide"><span class="std std-numref">Fig. 28</span></a> show how to define a chain of failure
recovery tasks that trigger if they’re needed but
otherwise remove themselves from the
suite (you can run the <em>AutoRecover.async</em> example suite to see how
this works). The dashed graph edges ending in solid dots indicate
suicide triggers, and the open arrowheads indicate conditional triggers
as usual. Suicide triggers are ignored by default in the graph view, unless
you toggle them on with <em>View</em> <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> <em>Options</em> <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code>
<em>Ignore Suicide Triggers</em>.</p>
<div class="twocol docutils container">
<div class="image docutils container">
<div class="figure align-center" id="fig-suicide">
<img alt="_images/suicide.png" src="_images/suicide.png" />
</div>
</div>
<div class="caption docutils container">
<p>Automated failure recovery via suicide triggers.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> automated failure recovery</span>
    <span class="nv">description </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Model task failure triggers diagnosis</span>
<span class="s2">and recovery tasks, which take themselves</span>
<span class="s2">out of the suite if model succeeds. Model</span>
<span class="s2">post processing triggers off model OR</span>
<span class="s2">recovery tasks.</span>
<span class="s2">              &quot;&quot;&quot;</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="kd">pre</span> <span class="o">=&gt;</span> <span class="kd">model</span>
<span class="kd">model</span><span class="c">:</span><span class="kd">fail</span> <span class="o">=&gt;</span> <span class="kd">diagnose</span> <span class="o">=&gt;</span> <span class="kd">recover</span>
<span class="kd">model</span> <span class="o">=&gt;</span> <span class="x">!diagnose</span> <span class="o">&amp;</span> <span class="x">!recover</span>
<span class="kd">model</span> <span class="o">|</span> <span class="kd">recover</span> <span class="o">=&gt;</span> <span class="kd">post</span>
                <span class="s2">&quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[model]]</span>
        <span class="c1"># UNCOMMENT TO TEST FAILURE:</span>
        <span class="c1"># script = /bin/false</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Multiple suicide triggers combine in the same way as other
triggers, so this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">foo </span><span class="o">=</span><span class="s">&gt; !baz</span>
<span class="nv">bar </span><span class="o">=</span><span class="s">&gt; !baz</span>
</pre></div>
</div>
<p>is equivalent to this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">foo &amp; bar </span><span class="o">=</span><span class="s">&gt; !baz</span>
</pre></div>
</div>
<p>i.e. both <code class="docutils literal notranslate"><span class="pre">foo</span></code> and <code class="docutils literal notranslate"><span class="pre">bar</span></code> must succeed for
<code class="docutils literal notranslate"><span class="pre">baz</span></code> to be taken out of the suite. If you really want a task
to be taken out if any one of several events occurs then be careful to
write it that way:</p>
<div class="last highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">foo | bar </span><span class="o">=</span><span class="s">&gt; !baz</span>
</pre></div>
</div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>A word of warning on the meaning of “bare suicide triggers”. Consider
the following suite:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="x">!bar</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>Task <code class="docutils literal notranslate"><span class="pre">bar</span></code> has a suicide trigger but no normal prerequisites
(a suicide trigger is not a task triggering prerequisite, it is a task
removal prerequisite) so this is entirely equivalent to:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
            <span class="kd">foo</span> <span class="o">&amp;</span> <span class="kd">bar</span>
           <span class="kd">foo</span> <span class="o">=&gt;</span> <span class="x">!bar</span>
                <span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p class="last">In other words both tasks will trigger immediately, at the same time,
and then <code class="docutils literal notranslate"><span class="pre">bar</span></code> will be removed if <code class="docutils literal notranslate"><span class="pre">foo</span></code> succeeds.</p>
</div>
<p>If an active task proxy (currently in the submitted or running states)
is removed from the suite by a suicide trigger, a warning will be logged.</p>
</div>
<div class="section" id="family-triggers">
<span id="familytriggers"></span><h5>9.3.5.9. Family Triggers<a class="headerlink" href="#family-triggers" title="Permalink to this headline">¶</a></h5>
<p>Families defined by the namespace inheritance hierarchy
(<a class="reference internal" href="#niorp"><span class="std std-ref">Runtime - Task Configuration</span></a>) can be used in the graph trigger whole groups of
tasks at the same time (e.g. forecast model ensembles and groups of
tasks for processing different observation types at the same time) and
for triggering downstream tasks off families as a whole. Higher level
families, i.e. families of families, can also be used, and are reduced
to the lowest level member tasks.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Tasks can also trigger off individual family members if necessary.</p>
</div>
<p>To trigger an entire task family at once:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">FAM</span><span class="c">&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[FAM]]</span>    <span class="c1"># a family (because others inherit from it)</span>
    <span class="nt">[[m1,m2]]</span>  <span class="c1"># family members (inherit from namespace FAM)</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> FAM</span>
</pre></div>
</div>
<p>This is equivalent to:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">m1</span> <span class="o">&amp;</span> <span class="kd">m2</span><span class="c">&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[FAM]]</span>
    <span class="nt">[[m1,m2]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> FAM</span>
</pre></div>
</div>
<p>To trigger other tasks off families we have to specify whether
to triggering off <em>all members</em> starting, succeeding, failing,
or finishing, or off <em>any</em> members (doing the same). Legal family
triggers are thus:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
      <span class="c1"># all-member triggers:</span>
    <span class="kd">FAM</span><span class="c">:</span><span class="kd">start</span><span class="c">-</span><span class="kd">all</span> <span class="o">=&gt;</span> <span class="kd">one</span>
    <span class="kd">FAM</span><span class="c">:</span><span class="kd">succeed</span><span class="c">-</span><span class="kd">all</span> <span class="o">=&gt;</span> <span class="kd">one</span>
    <span class="kd">FAM</span><span class="c">:</span><span class="kd">fail</span><span class="c">-</span><span class="kd">all</span> <span class="o">=&gt;</span> <span class="kd">one</span>
    <span class="kd">FAM</span><span class="c">:</span><span class="kd">finish</span><span class="c">-</span><span class="kd">all</span> <span class="o">=&gt;</span> <span class="kd">one</span>
      <span class="c1"># any-member triggers:</span>
    <span class="kd">FAM</span><span class="c">:</span><span class="kd">start</span><span class="c">-</span><span class="kd">any</span> <span class="o">=&gt;</span> <span class="kd">one</span>
    <span class="kd">FAM</span><span class="c">:</span><span class="kd">succeed</span><span class="c">-</span><span class="kd">any</span> <span class="o">=&gt;</span> <span class="kd">one</span>
    <span class="kd">FAM</span><span class="c">:</span><span class="kd">fail</span><span class="c">-</span><span class="kd">any</span> <span class="o">=&gt;</span> <span class="kd">one</span>
    <span class="kd">FAM</span><span class="c">:</span><span class="kd">finish</span><span class="c">-</span><span class="kd">any</span> <span class="o">=&gt;</span> <span class="kd">one</span>
                <span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Here’s how to trigger downstream processing after if one or more family
members succeed, but only after all members have finished (succeeded or
failed):</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
    <span class="kd">FAM</span><span class="c">:</span><span class="kd">finish</span><span class="c">-</span><span class="kd">all</span> <span class="o">&amp;</span> <span class="kd">FAM</span><span class="c">:</span><span class="kd">succeed</span><span class="c">-</span><span class="kd">any</span> <span class="o">=&gt;</span> <span class="kd">foo</span>
                <span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="efficient-inter-family-triggering">
<span id="efficientinterfamilytriggering"></span><h5>9.3.5.10. Efficient Inter-Family Triggering<a class="headerlink" href="#efficient-inter-family-triggering" title="Permalink to this headline">¶</a></h5>
<p>While cylc allows writing dependencies between two families it is important to
consider the number of dependencies this will generate. In the following
example, each member of <code class="docutils literal notranslate"><span class="pre">FAM2</span></code> has dependencies pointing at all the
members of <code class="docutils literal notranslate"><span class="pre">FAM1</span></code>.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
    <span class="kd">FAM1</span><span class="c">:</span><span class="kd">succeed</span><span class="c">-</span><span class="kd">any</span> <span class="o">=&gt;</span> <span class="kd">FAM2</span>
                <span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Expanding this out, you generate <code class="docutils literal notranslate"><span class="pre">N</span> <span class="pre">*</span> <span class="pre">M</span></code> dependencies, where
<code class="docutils literal notranslate"><span class="pre">N</span></code> is the number of members of <code class="docutils literal notranslate"><span class="pre">FAM1</span></code> and <code class="docutils literal notranslate"><span class="pre">M</span></code> is
the number of members of <code class="docutils literal notranslate"><span class="pre">FAM2</span></code>. This can result in high memory use
as the number of members of these families grows, potentially rendering the
suite impractical for running on some systems.</p>
<p>You can greatly reduce the number of dependencies generated in these situations
by putting dummy tasks in the graphing to represent the state of the family you
want to trigger off. For example, if <code class="docutils literal notranslate"><span class="pre">FAM2</span></code> should trigger off any
member of <code class="docutils literal notranslate"><span class="pre">FAM1</span></code> succeeding you can create a dummy task
<code class="docutils literal notranslate"><span class="pre">FAM1_succeed_any_marker</span></code> and place a dependency on it as follows:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
    <span class="kd">FAM1</span><span class="c">:</span><span class="kd">succeed</span><span class="c">-</span><span class="kd">any</span> <span class="o">=&gt;</span> <span class="kd">FAM1_succeed_any_marker</span> <span class="o">=&gt;</span> <span class="kd">FAM2</span>
                <span class="s2">&quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
<span class="c1"># ...</span>
    <span class="nt">[[FAM1_succeed_any_marker]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> true</span>
<span class="c1"># ...</span>
</pre></div>
</div>
<p>This graph generates only <code class="docutils literal notranslate"><span class="pre">N</span> <span class="pre">+</span> <span class="pre">M</span></code> dependencies, which takes
significantly less memory and CPU to store and evaluate.</p>
</div>
<div class="section" id="inter-cycle-triggers">
<span id="intercyclepointtriggers"></span><h5>9.3.5.11. Inter-Cycle Triggers<a class="headerlink" href="#inter-cycle-triggers" title="Permalink to this headline">¶</a></h5>
<p>Typically most tasks in a suite will trigger off others in the same
cycle point, but some may depend on others with other cycle points.
This notably applies to warm-cycled forecast models, which depend on
their own previous instances (see below); but other kinds of inter-cycle
dependence are possible too <a class="footnote-reference" href="#id12" id="id6">[2]</a> . Here’s how to express this
kind of relationship in cylc:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[dependencies]</span>
    <span class="nt">[[PT6H]]</span>
        <span class="c1"># B triggers off A in the previous cycle point</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span>[<span class="nb">-PT6H</span>] <span class="o">=&gt;</span> <span class="kd">B</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>inter-cycle and trigger type (or message trigger) notation can be
combined:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># B triggers if A in the previous cycle point fails:</span>
<span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span>[<span class="nb">-PT6H</span>]<span class="c">:</span><span class="kd">fail</span> <span class="o">=&gt;</span> <span class="kd">B</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>At suite start-up inter-cycle triggers refer to a previous cycle point
that does not exist. This does not cause the dependent task to wait
indefinitely, however, because cylc ignores triggers that reach back
beyond the initial cycle point. That said, the presence of an
inter-cycle trigger does normally imply that something special has to
happen at start-up. If a model depends on its own previous instance for
restart files, for instance, then an initial set of restart files has to be
generated somehow or the first model task will presumably fail with
missing input files. There are several ways to handle this in cylc
using different kinds of one-off (non-cycling) tasks that run at suite
start-up. They are illustrated in <a class="reference internal" href="index.html#tutintercyclepointtriggers"><span class="std std-ref">Inter-Cycle Triggers</span></a>; to
summarize here briefly:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">R1</span></code> tasks (recommended):</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[R1]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">prep</span><span class="c">&quot;</span>
        <span class="nt">[[[R1/T00,R1/T12]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">prep</span>[<span class="nb">^</span>] <span class="o">=&gt;</span> <span class="kd">foo</span><span class="c">&quot;</span>
        <span class="nt">[[[T00,T12]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span>[<span class="nb">-PT12H</span>] <span class="o">=&gt;</span> <span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
</pre></div>
</div>
</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">R1</span></code>, or <code class="docutils literal notranslate"><span class="pre">R1/date-time</span></code> tasks are the recommended way to
specify unusual start up conditions. They allow you to specify a clean
distinction between the dependencies of initial cycles and the dependencies
of the subsequent cycles.</p>
<p>Initial tasks can be used for real model cold-start processes, whereby a
warm-cycled model at any given cycle point can in principle have its inputs
satisfied by a previous instance of itself, <em>or</em> by an initial task with
(nominally) the same cycle point.</p>
<p>In effect, the <code class="docutils literal notranslate"><span class="pre">R1</span></code> task masquerades as the previous-cycle-point trigger
of its associated cycling task. At suite start-up initial tasks will
trigger the first cycling tasks, and thereafter the inter-cycle trigger
will take effect.</p>
<p>If a task has a dependency on another task in a different cycle point, the
dependency can be written using the <code class="docutils literal notranslate"><span class="pre">[offset]</span></code> syntax such as
<code class="docutils literal notranslate"><span class="pre">[-PT12H]</span></code> in <code class="docutils literal notranslate"><span class="pre">foo[-PT12H]</span> <span class="pre">=&gt;</span> <span class="pre">foo</span></code>. This means that
<code class="docutils literal notranslate"><span class="pre">foo</span></code> at the current cycle point depends on a previous instance of
<code class="docutils literal notranslate"><span class="pre">foo</span></code> at 12 hours before the current cycle point. Unlike the
cycling section headings (e.g. <code class="docutils literal notranslate"><span class="pre">[[[T00,T12]]]</span></code>), dependencies
assume that relative times are relative to the current cycle point, not the
initial cycle point.</p>
<p>However, it can be useful to have specific dependencies on tasks at or near
the initial cycle point. You can switch the context of the offset to be
the initial cycle point by using the caret symbol: <code class="docutils literal notranslate"><span class="pre">^</span></code>.</p>
<p>For example, you can write <code class="docutils literal notranslate"><span class="pre">foo[^]</span></code> to mean foo at the initial
cycle point, and <code class="docutils literal notranslate"><span class="pre">foo[^+PT6H]</span></code> to mean foo 6 hours after the initial
cycle point. Usually, this kind of dependency will only apply in a limited
number of cycle points near the start of the suite, so you may want to write
it in <code class="docutils literal notranslate"><span class="pre">R1</span></code>-based cycling sections. Here’s the example inter-cycle
<code class="docutils literal notranslate"><span class="pre">R1</span></code> suite from above again.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[R1]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">prep</span><span class="c">&quot;</span>
        <span class="nt">[[[R1/T00,R1/T12]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">prep</span>[<span class="nb">^</span>] <span class="o">=&gt;</span> <span class="kd">foo</span><span class="c">&quot;</span>
        <span class="nt">[[[T00,T12]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span>[<span class="nb">-PT12H</span>] <span class="o">=&gt;</span> <span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>You can see there is a dependence on the initial <code class="docutils literal notranslate"><span class="pre">R1</span></code> task
<code class="docutils literal notranslate"><span class="pre">prep</span></code> for <code class="docutils literal notranslate"><span class="pre">foo</span></code> at the first <code class="docutils literal notranslate"><span class="pre">T00</span></code> cycle point,
and at the first <code class="docutils literal notranslate"><span class="pre">T12</span></code> cycle point. Thereafter, <code class="docutils literal notranslate"><span class="pre">foo</span></code> just
depends on its previous (12 hours ago) instance.</p>
<p>Finally, it is also possible to have a dependency on a task at a specific cycle
point.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[R1/20200202]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">baz</span>[<span class="err">20200101</span>] <span class="o">=&gt;</span> <span class="kd">qux</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>However, in a long running suite, a repeating cycle should avoid having a
dependency on a task with a specific cycle point (including the initial cycle
point) - as it can currently cause performance issue. In the following example,
all instances of <code class="docutils literal notranslate"><span class="pre">qux</span></code> will depend on <code class="docutils literal notranslate"><span class="pre">baz.20200101</span></code>, which
will never be removed from the task pool:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2010</span>
    <span class="nt">[[dependencies]]</span>
        <span class="c1"># Can cause performance issue!</span>
        <span class="nt">[[[P1D]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">baz</span>[<span class="err">20200101</span>] <span class="o">=&gt;</span> <span class="kd">qux</span><span class="c">&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="special-sequential-tasks">
<span id="sequentialtasks"></span><h5>9.3.5.12. Special Sequential Tasks<a class="headerlink" href="#special-sequential-tasks" title="Permalink to this headline">¶</a></h5>
<p>Tasks that depend on their own previous-cycle instance can be declared as
<em>sequential</em>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[special tasks]]</span>
        <span class="c1"># foo depends on its previous instance:</span>
        <span class="nv">sequential </span><span class="o">=</span><span class="s"> foo</span>  <span class="c1"># deprecated - see below!</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[T00,T12]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
</pre></div>
</div>
<p><em>The sequential declaration is deprecated</em> however, in favor of explicit
inter-cycle triggers which clearly expose the same scheduling behaviour in the
graph:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[T00,T12]]]</span>
            <span class="c1"># foo depends on its previous instance:</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span>[<span class="nb">-PT12H</span>] <span class="o">=&gt;</span> <span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>The sequential declaration is arguably convenient in one unusual situation
though: if a task has a non-uniform cycling sequence then multiple explicit
triggers,</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[T00,T03,T11]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
        <span class="nt">[[[T00]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span>[<span class="nb">-PT13H</span>] <span class="o">=&gt;</span> <span class="kd">foo</span><span class="c">&quot;</span>
        <span class="nt">[[[T03]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span>[<span class="nb">-PT3H</span>] <span class="o">=&gt;</span> <span class="kd">foo</span><span class="c">&quot;</span>
        <span class="nt">[[[T11]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span>[<span class="nb">-PT8H</span>] <span class="o">=&gt;</span> <span class="kd">foo</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>can be replaced by a single sequential declaration,</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[special tasks]]</span>
        <span class="nv">sequential </span><span class="o">=</span><span class="s"> foo</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[T00,T03,T11]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="future-triggers">
<h5>9.3.5.13. Future Triggers<a class="headerlink" href="#future-triggers" title="Permalink to this headline">¶</a></h5>
<p>Cylc also supports inter-cycle triggering off tasks “in the future” (with
respect to cycle point - which has no bearing on wall-clock job submission time
unless the task has a clock trigger):</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[[dependencies]]</span>
    <span class="nt">[[[T00,T06,T12,T18]]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
    <span class="c1"># A runs in this cycle:</span>
            <span class="kd">A</span>
    <span class="c1"># B in this cycle triggers off A in the next cycle.</span>
            <span class="kd">A</span>[<span class="nb">PT6H</span>] <span class="o">=&gt;</span> <span class="kd">B</span>
        <span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Future triggers present a problem at suite shutdown rather than at start-up.
Here, <code class="docutils literal notranslate"><span class="pre">B</span></code> at the final cycle point wants to trigger off an instance
of <code class="docutils literal notranslate"><span class="pre">A</span></code> that will never exist because it is beyond the suite stop
point. Consequently Cylc prevents tasks from spawning successors that depend on
other tasks beyond the final point.</p>
</div>
<div class="section" id="clock-triggers">
<span id="clocktriggertasks"></span><h5>9.3.5.14. Clock Triggers<a class="headerlink" href="#clock-triggers" title="Permalink to this headline">¶</a></h5>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please read External Triggers (<a class="reference internal" href="index.html#external-triggers"><span class="std std-ref">External Triggers</span></a>) before
using the older clock triggers described in this section.</p>
</div>
<p>By default, date-time cycle points are not connected to the real time “wall
clock”. They are just labels that are passed to task jobs (e.g. to
initialize an atmospheric model run with a particular date-time value). In real
time cycling systems, however, some tasks - typically those near the top of the
graph in each cycle - need to trigger at or near the time when their cycle point
is equal to the real clock date-time.</p>
<p>So <em>clock triggers</em> allow tasks to trigger at (or after, depending on other
triggers) a wall clock time expressed as an offset from cycle point:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[special tasks]]</span>
        <span class="nv">clock-trigger </span><span class="o">=</span><span class="s"> foo(PT2H)</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[T00]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">foo</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">foo[2015-08-23T00]</span></code> would trigger (other dependencies allowing)
when the wall clock time reaches <code class="docutils literal notranslate"><span class="pre">2015-08-23T02</span></code>. Clock-trigger
offsets are normally positive, to trigger some time <em>after</em> the wall-clock
time is equal to task cycle point.</p>
<p>Clock-triggers have no effect on scheduling if a suite is running sufficiently
far behind the clock (e.g. after a delay, or because it is processing archived
historical data) that the trigger times, which are relative to task cycle
point, have already passed.</p>
</div>
<div class="section" id="clock-expire-triggers">
<span id="clockexpiretasks"></span><h5>9.3.5.15. Clock-Expire Triggers<a class="headerlink" href="#clock-expire-triggers" title="Permalink to this headline">¶</a></h5>
<p>Tasks can be configured to <em>expire</em> - i.e. to skip job submission and
enter the <em>expired</em> state - if they are too far behind the wall clock when
they become ready to run, and other tasks can trigger off this. As a possible
use case, consider a cycling task that copies the latest of a set of files to
overwrite the previous set: if the task is delayed by more than one cycle there
may be no point in running it because the freshly copied files will just be
overwritten immediately by the next task instance as the suite catches back up
to real time operation. Clock-expire tasks are configured like clock-trigger
tasks, with a date-time offset relative to cycle point (<a class="reference internal" href="index.html#clockexpireref"><span class="std std-ref">[scheduling] -&gt; [[special tasks]] -&gt; clock-expire</span></a>).
The offset should be positive to make the task expire if the wall-clock time
has gone beyond the cycle point. Triggering off an expired task typically
requires suicide triggers to remove the workflow that runs if the task has not
expired. Here a task called <code class="docutils literal notranslate"><span class="pre">copy</span></code> expires, and its downstream
workflow is skipped, if it is more than one day behind the wall-clock (see also
<code class="docutils literal notranslate"><span class="pre">etc/examples/clock-expire</span></code>):</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
   <span class="nv">cycle point format </span><span class="o">=</span><span class="s"> %Y-%m-%dT%H</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2015-08-15T00</span>
    <span class="nt">[[special tasks]]</span>
        <span class="nv">clock-expire </span><span class="o">=</span><span class="s"> copy(-P1D)</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[P1D]]]</span>
            <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
        <span class="kd">model</span>[<span class="nb">-P1D</span>] <span class="o">=&gt;</span> <span class="kd">model</span> <span class="o">=&gt;</span> <span class="kd">copy</span> <span class="o">=&gt;</span> <span class="kd">proc</span>
              <span class="kd">copy</span><span class="c">:</span><span class="kd">expired</span> <span class="o">=&gt;</span> <span class="x">!proc</span><span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="external-event-triggers">
<h5>9.3.5.16. External Event Triggers<a class="headerlink" href="#external-event-triggers" title="Permalink to this headline">¶</a></h5>
<p>This is a substantial topic, documented in <a class="reference internal" href="index.html#external-triggers"><span class="std std-ref">External Triggers</span></a>.</p>
</div>
</div>
<div class="section" id="model-restart-dependencies">
<span id="modelrestartdependencies"></span><h4>9.3.6. Model Restart Dependencies<a class="headerlink" href="#model-restart-dependencies" title="Permalink to this headline">¶</a></h4>
<p>Warm-cycled forecast models generate <em>restart files</em>, e.g. model
background fields, to initialize the next forecast. This kind of
dependence requires an inter-cycle trigger:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[T00,T06,T12,T18]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span>[<span class="nb">-PT6H</span>] <span class="o">=&gt;</span> <span class="kd">A</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>If your model is configured to write out additional restart files
to allow one or more cycle points to be skipped in an emergency <em>do not
represent these potential dependencies in the suite graph</em> as they
should not be used under normal circumstances. For example, the
following graph would result in task <code class="docutils literal notranslate"><span class="pre">A</span></code> erroneously
triggering off <code class="docutils literal notranslate"><span class="pre">A[T-24]</span></code> as a matter of course, instead of
off <code class="docutils literal notranslate"><span class="pre">A[T-6]</span></code>, because <code class="docutils literal notranslate"><span class="pre">A[T-24]</span></code> will always
be finished first:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[T00,T06,T12,T18]]]</span>
            <span class="c1"># DO NOT DO THIS (SEE ACCOMPANYING TEXT):</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">A</span>[<span class="nb">-PT24H</span>] <span class="o">|</span> <span class="kd">A</span>[<span class="nb">-PT18H</span>] <span class="o">|</span> <span class="kd">A</span>[<span class="nb">-PT12H</span>] <span class="o">|</span> <span class="kd">A</span>[<span class="nb">-PT6H</span>] <span class="o">=&gt;</span> <span class="kd">A</span><span class="c">&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="how-the-graph-determines-task-instantiation">
<h4>9.3.7. How The Graph Determines Task Instantiation<a class="headerlink" href="#how-the-graph-determines-task-instantiation" title="Permalink to this headline">¶</a></h4>
<p>A graph trigger pair like <code class="docutils literal notranslate"><span class="pre">foo</span> <span class="pre">=&gt;</span> <span class="pre">bar</span></code> determines the existence and
prerequisites (dependencies) of the downstream task <code class="docutils literal notranslate"><span class="pre">bar</span></code>, for
the cycle points defined by the associated graph section heading. In general it
does not say anything about the dependencies or existence of the upstream task
<code class="docutils literal notranslate"><span class="pre">foo</span></code>. However <em>if the trigger has no cycle point offset</em> Cylc
will infer that <code class="docutils literal notranslate"><span class="pre">bar</span></code> must exist at the same cycle points as
<code class="docutils literal notranslate"><span class="pre">foo</span></code>. This is a convenience to allow this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>to be written as shorthand for this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">foo</span>
           <span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">bar</span><span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>(where <code class="docutils literal notranslate"><span class="pre">foo</span></code> by itself means <code class="docutils literal notranslate"><span class="pre">&lt;nothing&gt;</span> <span class="pre">=&gt;</span> <span class="pre">foo</span></code>, i.e. the
task exists at these cycle points but has no prerequisites - although other
prerequisites may be defined for it in other parts of the graph).</p>
<p><em>Cylc does not infer the existence of the upstream task in offset
triggers</em> like <code class="docutils literal notranslate"><span class="pre">foo[-P1D]</span> <span class="pre">=&gt;</span> <span class="pre">bar</span></code> because, as explained in
<a class="reference internal" href="index.html#cylc-6-migration-implicit-cycling"><span class="std std-ref">No Implicit Creation of Tasks by Offset Triggers</span></a>, a typo in the offset interval
should generate an error rather than silently creating tasks on an erroneous
cycling sequence.</p>
<p>As a result you need to be careful not to define inter-cycle dependencies that
cannot be satisfied at run time. Suite validation catches this kind of error if
the existence of the cycle offset task is not defined anywhere at all:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2020</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[P1Y]]]</span>
            <span class="c1"># ERROR</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span>[<span class="nb">-P1Y</span>] <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc validate SUITE
<span class="s1">&#39;ERROR: No cycling sequences defined for foo&#39;</span>
</pre></div>
</div>
<p>To fix this, use another line in the graph to tell Cylc to define
<code class="docutils literal notranslate"><span class="pre">foo</span></code> at each cycle point:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2020</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[P1Y]]]</span>
            <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
                <span class="kd">foo</span>
                <span class="kd">foo</span>[<span class="nb">-P1Y</span>] <span class="o">=&gt;</span> <span class="kd">bar</span><span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>But validation does not catch this kind of error if the offset task
is defined only on a different cycling sequence:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2020</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[P2Y]]]</span>
            <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">foo</span>
                <span class="c1"># ERROR</span>
                <span class="kd">foo</span>[<span class="nb">-P1Y</span>] <span class="o">=&gt;</span> <span class="kd">bar</span><span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>This suite will validate OK, but it will stall at runtime with <code class="docutils literal notranslate"><span class="pre">bar</span></code>
waiting on <code class="docutils literal notranslate"><span class="pre">foo[-P1Y]</span></code> at the intermediate years where it does not
exist. The offset <code class="docutils literal notranslate"><span class="pre">[-P1Y]</span></code> is presumably an error (it should be
<code class="docutils literal notranslate"><span class="pre">[-P2Y]</span></code>), or else another graph line is needed to generate
<code class="docutils literal notranslate"><span class="pre">foo</span></code> instances on the yearly sequence:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2020</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[P1Y]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span><span class="c">&quot;</span>
        <span class="nt">[[[P2Y]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span>[<span class="nb">-P1Y</span>] <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>Similarly the following suite will validate OK, but it will stall at
runtime with <code class="docutils literal notranslate"><span class="pre">bar</span></code> waiting on <code class="docutils literal notranslate"><span class="pre">foo[-P1Y]</span></code> in
every cycle point, when only a single instance of it exists, at the initial
cycle point:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2020</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[R1]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">foo</span>
        <span class="nt">[[[P1Y]]]</span>
            <span class="c1"># ERROR</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">foo</span>[<span class="nb">-P1Y</span>] <span class="o">=&gt;</span> <span class="kd">bar</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">graph</span></code> will display un-satisfiable inter-cycle
dependencies as “ghost nodes”. <a class="reference internal" href="#ghost-node-screenshot"><span class="std std-numref">Fig. 29</span></a>
is a screenshot of cylc graph displaying the above example with the
un-satisfiable task (foo) displayed as a “ghost node”.</p>
</div>
<div class="figure align-center" id="id14">
<span id="ghost-node-screenshot"></span><img alt="_images/ghost-node-example.png" src="_images/ghost-node-example.png" />
<p class="caption"><span class="caption-number">Fig. 29 </span><span class="caption-text">Screenshot of <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">graph</span></code> showing one task as a “ghost node”.</span></p>
</div>
</div>
</div>
<div class="section" id="runtime-task-configuration">
<span id="niorp"></span><h3>9.4. Runtime - Task Configuration<a class="headerlink" href="#runtime-task-configuration" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">[runtime]</span></code> section of a suite configuration configures what
to execute (and where and how to execute it) when each task is ready to
run, in a <em>multiple inheritance hierarchy</em> of <em>namespaces</em> culminating in
individual tasks. This allows all common configuration detail to be
factored out and defined in one place.</p>
<p>Any namespace can configure any or all of the items defined in
<a class="reference internal" href="index.html#suitercreference"><span class="std std-ref">Suite.rc Reference</span></a>.</p>
<p>Namespaces that do not explicitly inherit from others automatically
inherit from the <em>root</em> namespace (below).</p>
<p>Nested namespaces define <em>task families</em> that can be used in the
graph as convenient shorthand for triggering all member tasks at once,
or for triggering other tasks off all members at once -
see <a class="reference internal" href="#familytriggers"><span class="std std-ref">Family Triggers</span></a>. Nested namespaces can be
progressively expanded and collapsed in the dependency graph viewer, and
in the gcylc graph and text views. Only the first parent of each
namespace (as for single-inheritance) is used for suite visualization
purposes.</p>
<div class="section" id="task-and-namespace-names">
<span id="tasknames"></span><h4>9.4.1. Task and Namespace Names<a class="headerlink" href="#task-and-namespace-names" title="Permalink to this headline">¶</a></h4>
<p>There are restrictions on names that can be used for tasks and namespaces
to ensure all tasks are processed and implemented correctly. Valid names
must:</p>
<ol class="arabic simple">
<li><em>begin with</em> (or consist only of, as single-character task names are
allowed) either:<ul>
<li>an alphanumeric character, i.e. a letter in either upper or lower case
(<code class="docutils literal notranslate"><span class="pre">a-z</span></code> or <code class="docutils literal notranslate"><span class="pre">A-Z</span></code>), or a digit (<code class="docutils literal notranslate"><span class="pre">0-9</span></code>);</li>
<li>an underscore (<code class="docutils literal notranslate"><span class="pre">_</span></code>).</li>
</ul>
</li>
<li><em>otherwise</em> contain <em>only</em> characters from the following options:<ul>
<li>alphanumeric characters or underscores (as above);</li>
<li>any of these additional character symbols:<ul>
<li>hyphens (<code class="docutils literal notranslate"><span class="pre">-</span></code>);</li>
<li>plus characters (<code class="docutils literal notranslate"><span class="pre">+</span></code>);</li>
<li>percent signs (<code class="docutils literal notranslate"><span class="pre">%</span></code>);</li>
<li>“at” signs (<code class="docutils literal notranslate"><span class="pre">&#64;</span></code>).</li>
</ul>
</li>
</ul>
</li>
<li>not be so long, typically over <code class="docutils literal notranslate"><span class="pre">255</span></code> characters, as to raise errors
from exceeding maximum filename length on the operating system for
generated outputs e.g. directories named (in part) after the task they
concern.</li>
</ol>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Task and namespace names may not contain colons (<code class="docutils literal notranslate"><span class="pre">:</span></code>), which would
preclude use of directory paths involving the registration name in
<code class="docutils literal notranslate"><span class="pre">$PATH</span></code> variables). They also may not contain the dot (<code class="docutils literal notranslate"><span class="pre">.</span></code>) character,
as it will be interpreted as the delimiter separating the task name from
an appended cycle point (see <a class="reference internal" href="index.html#taskidentifiers"><span class="std std-ref">Task Identifiers</span></a>).</p>
</div>
<p>Invalid names for tasks or namespaces will be raised as errors
by <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">validate</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><em>Task names need not be hardwired into task implementations</em>
because task and suite identity can be extracted portably from the task
execution environment supplied by the suite server program
(<a class="reference internal" href="#taskexecutionenvironment"><span class="std std-ref">Task Execution Environment</span></a>) - then to rename a task you can
just change its name in the suite configuration.</p>
</div>
</div>
<div class="section" id="root-runtime-defaults">
<h4>9.4.2. Root - Runtime Defaults<a class="headerlink" href="#root-runtime-defaults" title="Permalink to this headline">¶</a></h4>
<p>The root namespace, at the base of the inheritance hierarchy,
provides default configuration for all tasks in the suite.
Most root items are unset by default, but some have default values
sufficient to allow test suites to be defined by dependency graph alone.
The <em>script</em> item, for example, defaults to code that
prints a message then sleeps for between 1 and 15 seconds and
exits. Default values are documented with each item in
<a class="reference internal" href="index.html#suitercreference"><span class="std std-ref">Suite.rc Reference</span></a>. You can override the defaults or
provide your own defaults by explicitly configuring the root namespace.</p>
</div>
<div class="section" id="defining-multiple-namespaces-at-once">
<span id="multitaskdef"></span><h4>9.4.3. Defining Multiple Namespaces At Once<a class="headerlink" href="#defining-multiple-namespaces-at-once" title="Permalink to this headline">¶</a></h4>
<p>If a namespace section heading is a comma-separated list of names
then the subsequent configuration applies to each list member.
Particular tasks can be singled out at run time using the
<code class="docutils literal notranslate"><span class="pre">$CYLC_TASK_NAME</span></code> variable.</p>
<p>As an example, consider a suite containing an ensemble of closely
related tasks that each invokes the same script but with a unique
argument that identifies the calling task name:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[ENSEMBLE]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;run-model.sh $CYLC_TASK_NAME&quot;</span>
    <span class="nt">[[m1, m2, m3]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> ENSEMBLE</span>
</pre></div>
</div>
<p>For large ensembles template processing can be used to
automatically generate the member names and associated dependencies
(see <a class="reference internal" href="#jinja"><span class="std std-ref">Jinja2</span></a> and <a class="reference internal" href="#empylabel"><span class="std std-ref">EmPy</span></a>).</p>
</div>
<div class="section" id="runtime-inheritance-single">
<h4>9.4.4. Runtime Inheritance - Single<a class="headerlink" href="#runtime-inheritance-single" title="Permalink to this headline">¶</a></h4>
<p>The following listing of the <em>inherit.single.one</em> example suite
illustrates basic runtime inheritance with single parents.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># SUITE.RC</span>
<span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;User Guide [runtime] example.&quot;</span>
<span class="nt">[cylc]</span>
    <span class="nv">required run mode </span><span class="o">=</span><span class="s"> simulation</span> <span class="c1"># (no task implementations)</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20110101T06</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 20110102T00</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[T00]]]</span>
            <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">OBS</span>
                 <span class="kd">OBS</span><span class="c">:</span><span class="kd">succeed</span><span class="c">-</span><span class="kd">all</span> <span class="o">=&gt;</span> <span class="kd">bar</span><span class="s2">&quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span> <span class="c1"># base namespace for all tasks (defines suite-wide defaults)</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> at</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">COLOR </span><span class="o">=</span><span class="s"> red</span>
    <span class="nt">[[OBS]]</span>  <span class="c1"># family (inherited by land, ship); implicitly inherits root</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> run-${CYLC_TASK_NAME}.sh</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">RUNNING_DIR </span><span class="o">=</span><span class="s"> $HOME/running/$CYLC_TASK_NAME</span>
    <span class="nt">[[land]]</span> <span class="c1"># a task (a leaf on the inheritance tree) in the OBS family</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> OBS</span>
        <span class="nt">[[[meta]]]</span>
            <span class="nv">description </span><span class="o">=</span><span class="s"> land obs processing</span>
    <span class="nt">[[ship]]</span> <span class="c1"># a task (a leaf on the inheritance tree) in the OBS family</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> OBS</span>
        <span class="nt">[[[meta]]]</span>
            <span class="nv">description </span><span class="o">=</span><span class="s"> ship obs processing</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> loadleveler</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">RUNNING_DIR </span><span class="o">=</span><span class="s"> $HOME/running/ship</span>  <span class="c1"># override OBS environment</span>
            <span class="nv">OUTPUT_DIR </span><span class="o">=</span><span class="s"> $HOME/output/ship</span>    <span class="c1"># add to OBS environment</span>
    <span class="nt">[[foo]]</span>
        <span class="c1"># (just inherits from root)</span>

    <span class="c1"># The task [[bar]] is implicitly defined by its presence in the</span>
    <span class="c1"># graph; it is also a dummy task that just inherits from root.</span>
</pre></div>
</div>
</div>
<div class="section" id="runtime-inheritance-multiple">
<h4>9.4.5. Runtime Inheritance - Multiple<a class="headerlink" href="#runtime-inheritance-multiple" title="Permalink to this headline">¶</a></h4>
<p>If a namespace inherits from multiple parents the linear order of
precedence (which namespace overrides which) is determined by the
so-called <em>C3 algorithm</em> used to find the linear <em>method
resolution order</em> for class hierarchies in Python and several other
object oriented programming languages. The result of this should be
fairly obvious for typical use of multiple inheritance in cylc suites,
but for detailed documentation of how the algorithm works refer to the
<a class="reference external" href="http://www.python.org/download/releases/2.3/mro/">official Python documentation</a>.</p>
<p>The <em>inherit.multi.one</em> example suite, listed here, makes use of
multiple inheritance:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;multiple inheritance example&quot;</span>

    <span class="nv">description </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;To see how multiple inheritance works:</span>

<span class="s2"> % cylc list -tb[m] SUITE</span> <span class="c1"># list namespaces</span><span class="s2"></span>
<span class="s2"> % cylc graph -n SUITE</span> <span class="c1"># graph namespaces</span><span class="s2"></span>
<span class="s2"> % cylc graph SUITE</span> <span class="c1"># dependencies, collapse on first-parent namespaces</span><span class="s2"></span>

<span class="s2">  % cylc get-config --sparse --item [runtime]ops_s1 SUITE</span>
<span class="s2">  % cylc get-config --sparse --item [runtime]var_p2 foo&quot;&quot;&quot;</span>

<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">OPS</span><span class="c">:</span><span class="kd">finish</span><span class="c">-</span><span class="kd">all</span> <span class="o">=&gt;</span> <span class="kd">VAR</span><span class="c">&quot;</span>

<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
    <span class="nt">[[OPS]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> echo &quot;RUN: run-ops.sh&quot;</span>
    <span class="nt">[[VAR]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> echo &quot;RUN: run-var.sh&quot;</span>
    <span class="nt">[[SERIAL]]</span>
        <span class="nt">[[[directives]]]</span>
            <span class="nv">job_type </span><span class="o">=</span><span class="s"> serial</span>
    <span class="nt">[[PARALLEL]]</span>
        <span class="nt">[[[directives]]]</span>
            <span class="nv">job_type </span><span class="o">=</span><span class="s"> parallel</span>
    <span class="nt">[[ops_s1, ops_s2]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> OPS, SERIAL</span>

    <span class="nt">[[ops_p1, ops_p2]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> OPS, PARALLEL</span>
        
    <span class="nt">[[var_s1, var_s2]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> VAR, SERIAL</span>

    <span class="nt">[[var_p1, var_p2]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> VAR, PARALLEL</span>

<span class="nt">[visualization]</span>
    <span class="c1"># NOTE ON VISUALIZATION AND MULTIPLE INHERITANCE: overlapping</span>
    <span class="c1"># family groups can have overlapping attributes, so long as </span>
    <span class="c1"># non-conflictling attributes are used to style each group. Below,</span>
    <span class="c1"># for example, OPS tasks are filled green and SERIAL tasks are</span>
    <span class="c1"># outlined blue, so that ops_s1 and ops_s2 are green with a blue</span>
    <span class="c1"># outline. But if the SERIAL tasks are explicitly styled as &quot;not</span>
    <span class="c1"># filled&quot; (by setting &quot;style=&quot;) this will override the fill setting</span>
    <span class="c1"># in the (previously defined and therefore lower precedence) OPS</span>
    <span class="c1"># group, making ops_s1 and ops_s2 unfilled with a blue outline.</span>
    <span class="c1"># Alternatively you can just create a manual node group for ops_s1</span>
    <span class="c1"># and ops_s2 and style them separately.</span>
    <span class="nt">[[node groups]]</span>
        <span class="c1">#(see comment above:)</span>
        <span class="c1">#serial_ops = ops_s1, ops_s2</span>
    <span class="nt">[[node attributes]]</span>
        <span class="nv">OPS </span><span class="o">=</span><span class="s"> &quot;style=filled&quot;, &quot;fillcolor=green&quot;</span>
        <span class="nv">SERIAL </span><span class="o">=</span><span class="s"> &quot;color=blue&quot;</span> <span class="c1">#(see comment above:), &quot;style=&quot;</span>
        <span class="c1">#(see comment above:)</span>
        <span class="c1">#serial_ops = &quot;color=blue&quot;, &quot;style=filled&quot;, &quot;fillcolor=green&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">get-suite-config</span></code> provides an easy way to check the result of
inheritance in a suite. You can extract specific items, e.g.:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc get-suite-config --item <span class="s1">&#39;[runtime][var_p2]script&#39;</span> <span class="se">\</span>
    inherit.multi.one
<span class="nb">echo</span> <span class="sb">``</span>RUN: run-var.sh<span class="s1">&#39;&#39;</span>
</pre></div>
</div>
<p>or use the <code class="docutils literal notranslate"><span class="pre">--sparse</span></code> option to print entire namespaces
without obscuring the result with the dense runtime structure obtained
from the root namespace:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc get-suite-config --sparse --item <span class="s1">&#39;[runtime]ops_s1&#39;</span> inherit.multi.one
<span class="nv">script</span> <span class="o">=</span> <span class="nb">echo</span> <span class="sb">``</span>RUN: run-ops.sh<span class="s1">&#39;&#39;</span>
<span class="nv">inherit</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;OPS&#39;</span>, <span class="s1">&#39;SERIAL&#39;</span><span class="o">]</span>
<span class="o">[</span>directives<span class="o">]</span>
   <span class="nv">job_type</span> <span class="o">=</span> serial
</pre></div>
</div>
<div class="section" id="suite-visualization-and-multiple-inheritance">
<h5>9.4.5.1. Suite Visualization And Multiple Inheritance<a class="headerlink" href="#suite-visualization-and-multiple-inheritance" title="Permalink to this headline">¶</a></h5>
<p>The first parent inherited by a namespace is also used as the
collapsible family group when visualizing the suite. If this is not what
you want, you can demote the first parent for visualization purposes,
without affecting the order of inheritance of runtime properties:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[BAR]]</span>
        <span class="c1"># ...</span>
    <span class="nt">[[foo]]</span>
        <span class="c1"># inherit properties from BAR, but stay under root for visualization:</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> None, BAR</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="how-runtime-inheritance-works">
<h4>9.4.6. How Runtime Inheritance Works<a class="headerlink" href="#how-runtime-inheritance-works" title="Permalink to this headline">¶</a></h4>
<p>The linear precedence order of ancestors is computed for each namespace
using the C3 algorithm. Then any runtime items that are explicitly
configured in the suite configuration are “inherited” up the linearized
hierarchy for each task, starting at the root namespace: if a particular
item is defined at multiple levels in the hierarchy, the level nearest
the final task namespace takes precedence. Finally, root namespace
defaults are applied for every item that has not been configured in the
inheritance process (this is more efficient than carrying the full dense
namespace structure through from root from the beginning).</p>
</div>
<div class="section" id="task-execution-environment">
<span id="taskexecutionenvironment"></span><h4>9.4.7. Task Execution Environment<a class="headerlink" href="#task-execution-environment" title="Permalink to this headline">¶</a></h4>
<p>The task execution environment contains suite and task identity variables
provided by the suite server program, and user-defined environment variables.
The environment is explicitly exported (by the task job script) prior to
executing the task <code class="docutils literal notranslate"><span class="pre">script</span></code> (see <a class="reference internal" href="index.html#taskjobsubmission"><span class="std std-ref">Task Job Submission and Management</span></a>).</p>
<p>Suite and task identity are exported first, so that user-defined
variables can refer to them. Order of definition is preserved throughout
so that variable assignment expressions can safely refer to previously
defined variables.</p>
<p>Additionally, access to cylc itself is configured prior to the user-defined
environment, so that variable assignment expressions can make use of
cylc utility commands:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">REFERENCE_TIME </span><span class="o">=</span><span class="s"> $( cylc util cycletime --offset-hours=6 )</span>
</pre></div>
</div>
<div class="section" id="user-environment-variables">
<h5>9.4.7.1. User Environment Variables<a class="headerlink" href="#user-environment-variables" title="Permalink to this headline">¶</a></h5>
<p>A task’s user-defined environment results from its inherited
<code class="docutils literal notranslate"><span class="pre">[[[environment]]]</span></code> sections:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">COLOR </span><span class="o">=</span><span class="s"> red</span>
            <span class="nv">SHAPE </span><span class="o">=</span><span class="s"> circle</span>
    <span class="nt">[[foo]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">COLOR </span><span class="o">=</span><span class="s"> blue</span>  <span class="c1"># root override</span>
            <span class="nv">TEXTURE </span><span class="o">=</span><span class="s"> rough</span> <span class="c1"># new variable</span>
</pre></div>
</div>
<p>This results in a task <em>foo</em> with <code class="docutils literal notranslate"><span class="pre">SHAPE=circle</span></code>, <code class="docutils literal notranslate"><span class="pre">COLOR=blue</span></code>,
and <code class="docutils literal notranslate"><span class="pre">TEXTURE=rough</span></code> in its environment.</p>
</div>
<div class="section" id="overriding-environment-variables">
<h5>9.4.7.2. Overriding Environment Variables<a class="headerlink" href="#overriding-environment-variables" title="Permalink to this headline">¶</a></h5>
<p>When you override inherited namespace items the original parent
item definition is <em>replaced</em> by the new definition. This applies to
all items including those in the environment sub-sections which,
strictly speaking, are not “environment variables” until they are
written, post inheritance processing, to the task job script that
executes the associated task. Consequently, if you override an
environment variable you cannot also access the original parent value:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[FOO]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">COLOR </span><span class="o">=</span><span class="s"> red</span>
    <span class="nt">[[bar]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> FOO</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">tmp </span><span class="o">=</span><span class="s"> $COLOR</span>        <span class="c1"># !! ERROR: $COLOR is undefined here</span>
            <span class="nv">COLOR </span><span class="o">=</span><span class="s"> dark-$tmp</span>   <span class="c1"># !! as this overrides COLOR in FOO.</span>
</pre></div>
</div>
<p>The compressed variant of this, <code class="docutils literal notranslate"><span class="pre">COLOR</span> <span class="pre">=</span> <span class="pre">dark-$COLOR</span></code>, is
also in error for the same reason. To achieve the desired result you
must use a different name for the parent variable:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[FOO]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">FOO_COLOR </span><span class="o">=</span><span class="s"> red</span>
    <span class="nt">[[bar]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> FOO</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">COLOR </span><span class="o">=</span><span class="s"> dark-$FOO_COLOR</span>  <span class="c1"># OK</span>
</pre></div>
</div>
</div>
<div class="section" id="task-job-script-variables">
<span id="id7"></span><h5>9.4.7.3. Task Job Script Variables<a class="headerlink" href="#task-job-script-variables" title="Permalink to this headline">¶</a></h5>
<p>These are variables that can be referenced (but should not be modified) in a
task job script.</p>
<p>The task job script may export the following environment variables:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>CYLC_DEBUG                      <span class="c1"># Debug mode, true or not defined</span>
CYLC_DIR                        <span class="c1"># Location of cylc installation used</span>
CYLC_VERSION                    <span class="c1"># Version of cylc installation used</span>

CYLC_CYCLING_MODE               <span class="c1"># Cycling mode, e.g. gregorian</span>
CYLC_SUITE_FINAL_CYCLE_POINT    <span class="c1"># Final cycle point</span>
CYLC_SUITE_INITIAL_CYCLE_POINT  <span class="c1"># Initial cycle point</span>
CYLC_SUITE_NAME                 <span class="c1"># Suite name</span>
CYLC_UTC                        <span class="c1"># UTC mode, True or False</span>
CYLC_VERBOSE                    <span class="c1"># Verbose mode, True or False</span>
TZ                              <span class="c1"># Set to &quot;UTC&quot; in UTC mode or not defined</span>

CYLC_SUITE_RUN_DIR              <span class="c1"># Location of the suite run directory in</span>
                                <span class="c1"># job host, e.g. ~/cylc-run/foo</span>
CYLC_SUITE_DEF_PATH             <span class="c1"># Location of the suite configuration directory in</span>
                                <span class="c1"># job host, e.g. ~/cylc-run/foo</span>
CYLC_SUITE_HOST                 <span class="c1"># Host running the suite process</span>
CYLC_SUITE_OWNER                <span class="c1"># User ID running the suite process</span>
CYLC_SUITE_DEF_PATH_ON_SUITE_HOST
                                <span class="c1"># Location of the suite configuration directory in</span>
                                <span class="c1"># suite host, e.g. ~/cylc-run/foo</span>
CYLC_SUITE_SHARE_DIR            <span class="c1"># Suite (or task!) shared directory (see below)</span>
CYLC_SUITE_UUID                 <span class="c1"># Suite UUID string</span>
CYLC_SUITE_WORK_DIR             <span class="c1"># Suite work directory (see below)</span>

CYLC_TASK_JOB                   <span class="c1"># Task job identifier expressed as</span>
                                <span class="c1"># CYCLE-POINT/TASK-NAME/SUBMIT-NUM</span>
                                <span class="c1"># e.g. 20110511T1800Z/t1/01</span>
CYLC_TASK_CYCLE_POINT           <span class="c1"># Cycle point, e.g. 20110511T1800Z</span>
CYLC_TASK_NAME                  <span class="c1"># Job&#39;s task name, e.g. t1</span>
CYLC_TASK_SUBMIT_NUMBER         <span class="c1"># Job&#39;s submit number, e.g. 1,</span>
                                <span class="c1"># increments with every submit</span>
CYLC_TASK_TRY_NUMBER            <span class="c1"># Number of execution tries, e.g. 1</span>
                                <span class="c1"># increments with automatic retry-on-fail</span>
CYLC_TASK_ID                    <span class="c1"># Task instance identifier expressed as</span>
                                <span class="c1"># TASK-NAME.CYCLE-POINT</span>
                                <span class="c1"># e.g. t1.20110511T1800Z</span>
CYLC_TASK_LOG_DIR               <span class="c1"># Location of the job log directory</span>
                                <span class="c1"># e.g. ~/cylc-run/foo/log/job/20110511T1800Z/t1/01/</span>
CYLC_TASK_LOG_ROOT              <span class="c1"># The task job file path</span>
                                <span class="c1"># e.g. ~/cylc-run/foo/log/job/20110511T1800Z/t1/01/job</span>
CYLC_TASK_WORK_DIR              <span class="c1"># Location of task work directory (see below)</span>
                                <span class="c1"># e.g. ~/cylc-run/foo/work/20110511T1800Z/t1</span>
CYLC_TASK_NAMESPACE_HIERARCHY   <span class="c1"># Linearised family namespace of the task,</span>
                                <span class="c1"># e.g. root postproc t1</span>
CYLC_TASK_DEPENDENCIES          <span class="c1"># List of met dependencies that triggered the task</span>
                                <span class="c1"># e.g. foo.1 bar.1</span>

CYLC_TASK_COMMS_METHOD          <span class="c1"># Set to &quot;ssh&quot; if communication method is &quot;ssh&quot;</span>
CYLC_TASK_SSH_LOGIN_SHELL       <span class="c1"># With &quot;ssh&quot; communication, if set to &quot;True&quot;,</span>
                                <span class="c1"># use login shell on suite host</span>
</pre></div>
</div>
<p>There are also some global shell variables that may be defined in the task job
script (but not exported to the environment). These include:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>CYLC_FAIL_SIGNALS               <span class="c1"># List of signals trapped by the error trap</span>
CYLC_VACATION_SIGNALS           <span class="c1"># List of signals trapped by the vacation trap</span>
CYLC_SUITE_WORK_DIR_ROOT        <span class="c1"># Root directory above the suite work directory</span>
                                <span class="c1"># in the job host</span>
CYLC_TASK_MESSAGE_STARTED_PID   <span class="c1"># PID of &quot;cylc message&quot; job started&quot; command</span>
CYLC_TASK_WORK_DIR_BASE         <span class="c1"># Alternate task work directory,</span>
                                <span class="c1"># relative to the suite work directory</span>
</pre></div>
</div>
</div>
<div class="section" id="suite-share-directories">
<h5>9.4.7.4. Suite Share Directories<a class="headerlink" href="#suite-share-directories" title="Permalink to this headline">¶</a></h5>
<p>A <em>suite share directory</em> is created automatically under the suite run
directory as a share space for tasks. The location is available to tasks as
<code class="docutils literal notranslate"><span class="pre">$CYLC_SUITE_SHARE_DIR</span></code>. In a cycling suite, output files are
typically held in cycle point sub-directories of the suite share directory.</p>
<p>The top level share and work directory (below) location can be changed
(e.g. to a large data area) by a global config setting
(see <a class="reference internal" href="index.html#workdirectory"><span class="std std-ref">[hosts] -&gt; [[HOST]] -&gt; work directory</span></a>).</p>
</div>
<div class="section" id="task-work-directories">
<h5>9.4.7.5. Task Work Directories<a class="headerlink" href="#task-work-directories" title="Permalink to this headline">¶</a></h5>
<p>Task job scripts are executed from within <em>work directories</em> created
automatically under the suite run directory. A task can get its own work
directory from <code class="docutils literal notranslate"><span class="pre">$CYLC_TASK_WORK_DIR</span></code> (or simply <code class="docutils literal notranslate"><span class="pre">$PWD</span></code> if
it does not <code class="docutils literal notranslate"><span class="pre">cd</span></code> elsewhere at runtime). By default the location
contains task name and cycle point, to provide a unique workspace for every
instance of every task. This can be overridden in the suite configuration,
however, to get several tasks to share the same work directory
(see <a class="reference internal" href="index.html#worksubdirectory"><span class="std std-ref">[runtime] -&gt; [[__NAME__]] -&gt; work sub-directory</span></a>).</p>
<p>The top level work and share directory (above) location can be changed
(e.g. to a large data area) by a global config setting
(see <a class="reference internal" href="index.html#workdirectory"><span class="std std-ref">[hosts] -&gt; [[HOST]] -&gt; work directory</span></a>).</p>
</div>
<div class="section" id="environment-variable-evaluation">
<h5>9.4.7.6. Environment Variable Evaluation<a class="headerlink" href="#environment-variable-evaluation" title="Permalink to this headline">¶</a></h5>
<p>Variables in the task execution environment are not evaluated in the
shell in which the suite is running prior to submitting the task. They
are written in unevaluated form to the job script that is submitted by
cylc to run the task (<a class="reference internal" href="index.html#jobscripts"><span class="std std-ref">Task Job Scripts</span></a>) and are therefore
evaluated when the task begins executing under the task owner account
on the task host. Thus <code class="docutils literal notranslate"><span class="pre">$HOME</span></code>, for instance, evaluates at
run time to the home directory of task owner on the task host.</p>
</div>
</div>
<div class="section" id="how-tasks-get-access-to-the-suite-directory">
<h4>9.4.8. How Tasks Get Access To The Suite Directory<a class="headerlink" href="#how-tasks-get-access-to-the-suite-directory" title="Permalink to this headline">¶</a></h4>
<p>Tasks can use <code class="docutils literal notranslate"><span class="pre">$CYLC_SUITE_DEF_PATH</span></code> to access suite files on
the task host, and the suite bin directory is automatically added
<code class="docutils literal notranslate"><span class="pre">$PATH</span></code>. If a remote suite configuration directory is not
specified the local (suite host) path will be assumed with the local
home directory, if present, swapped for literal <code class="docutils literal notranslate"><span class="pre">$HOME</span></code> for
evaluation on the task host.</p>
</div>
<div class="section" id="remote-task-hosting">
<span id="runningtasksonaremotehost"></span><h4>9.4.9. Remote Task Hosting<a class="headerlink" href="#remote-task-hosting" title="Permalink to this headline">¶</a></h4>
<p>If a task declares an owner other than the suite owner and/or
a host other than the suite host, cylc will use non-interactive ssh to
execute the task on the <code class="docutils literal notranslate"><span class="pre">owner&#64;host</span></code> account by the configured
batch system:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nt">[[[remote]]]</span>
            <span class="nv">host </span><span class="o">=</span><span class="s"> orca.niwa.co.nz</span>
            <span class="nv">owner </span><span class="o">=</span><span class="s"> bob</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> pbs</span>
</pre></div>
</div>
<p>For this to work:</p>
<ul class="simple">
<li>non-interactive ssh is required from the suite host to the remote
task accounts.</li>
<li>cylc must be installed on task hosts.<ul>
<li>Optional software dependencies such as graphviz and
Jinja2 are not needed on task hosts.</li>
<li>If polling task communication is used, there is no other
requirement.</li>
<li>If SSH task communication is configured, non-interactive ssh is
required from the task host to the suite host.</li>
<li>If (default) task communication is configured, the task host
should have access to the port on the suite host.</li>
</ul>
</li>
<li>the suite configuration directory, or some fraction of its
content, can be installed on the task host, if needed.</li>
</ul>
<p>To learn how to give remote tasks access to cylc,
see <a class="reference internal" href="index.html#howtasksgetaccesstocylc"><span class="std std-ref">Task Job Access To Cylc</span></a>.</p>
<p>Tasks running on the suite host under another user account are treated as
remote tasks.</p>
<p>Remote hosting, like all namespace settings, can be declared globally in
the root namespace, or per family, or for individual tasks.</p>
<div class="section" id="dynamic-host-selection">
<h5>9.4.9.1. Dynamic Host Selection<a class="headerlink" href="#dynamic-host-selection" title="Permalink to this headline">¶</a></h5>
<p>Instead of hardwiring host names into the suite configuration you can
specify a shell command that prints a hostname, or an environment
variable that holds a hostname, as the value of the host config item.
See <a class="reference internal" href="index.html#dynamichostselection"><span class="std std-ref">[runtime] -&gt; [[__NAME__]] -&gt; [[[remote]]] -&gt; host</span></a>.</p>
</div>
<div class="section" id="remote-task-log-directories">
<h5>9.4.9.2. Remote Task Log Directories<a class="headerlink" href="#remote-task-log-directories" title="Permalink to this headline">¶</a></h5>
<p>Task stdout and stderr streams are written to log files in a
suite-specific sub-directory of the <em>suite run directory</em>, as
explained in <a class="reference internal" href="index.html#whitherstdoutandstderr"><span class="std std-ref">Task stdout And stderr Logs</span></a>. For remote tasks
the same directory is used, but <em>on the task host</em>.
Remote task log directories, like local ones, are created on the fly, if
necessary, during job submission.</p>
</div>
</div>
</div>
<div class="section" id="visualization">
<span id="viso"></span><h3>9.5. Visualization<a class="headerlink" href="#visualization" title="Permalink to this headline">¶</a></h3>
<p>The visualization section of a suite configuration is used to configure
suite graphing, principally graph node (task) and edge (dependency
arrow) style attributes. Tasks can be grouped for the purpose of
applying common style attributes. See <a class="reference internal" href="index.html#suitercreference"><span class="std std-ref">Suite.rc Reference</span></a> for details.</p>
<div class="section" id="collapsible-families-in-suite-graphs">
<h4>9.5.1. Collapsible Families In Suite Graphs<a class="headerlink" href="#collapsible-families-in-suite-graphs" title="Permalink to this headline">¶</a></h4>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[visualization]</span>
    <span class="nv">collapsed families </span><span class="o">=</span><span class="s"> family1, family2</span>
</pre></div>
</div>
<p>Nested families from the runtime inheritance hierarchy can be expanded
and collapsed in suite graphs and the gcylc graph view. All families
are displayed in the collapsed state at first, unless
<code class="docutils literal notranslate"><span class="pre">[visualization]collapsed</span> <span class="pre">families</span></code> is used to single out
specific families for initial collapsing.</p>
<p>In the gcylc graph view, nodes outside of the main graph (such as the
members of collapsed families) are plotted as rectangular nodes to
the right if they are doing anything interesting (submitted, running,
failed).</p>
<p><a class="reference internal" href="#fig-namespaces"><span class="std std-numref">Fig. 30</span></a> illustrates successive expansion of nested
task families in the <em>namespaces</em> example suite.</p>
<div class="figure align-center">
<img alt="_images/inherit-2.png" src="_images/inherit-2.png" />
</div>
<div class="figure align-center">
<img alt="_images/inherit-3.png" src="_images/inherit-3.png" />
</div>
<div class="figure align-center">
<img alt="_images/inherit-4.png" src="_images/inherit-4.png" />
</div>
<div class="figure align-center">
<img alt="_images/inherit-5.png" src="_images/inherit-5.png" />
</div>
<div class="figure align-center">
<img alt="_images/inherit-6.png" src="_images/inherit-6.png" />
</div>
<div class="figure align-center" id="id15">
<span id="fig-namespaces"></span><img alt="_images/inherit-7.png" src="_images/inherit-7.png" />
<p class="caption"><span class="caption-number">Fig. 30 </span><span class="caption-text">Graphs of the <em>namespaces</em> example suite showing various states of
expansion of the nested namespace family hierarchy, from all families
collapsed (top left) through to all expanded (bottom right). This
can also be done by right-clicking on tasks in the gcylc graph view.</span></p>
</div>
</div>
</div>
<div class="section" id="parameterized-tasks">
<span id="parameterized-tasks-label"></span><h3>9.6. Parameterized Tasks<a class="headerlink" href="#parameterized-tasks" title="Permalink to this headline">¶</a></h3>
<p>Cylc can automatically generate tasks and dependencies by expanding
parameterized task names over lists of parameter values. Uses for this
include:</p>
<ul class="simple">
<li>generating an ensemble of similar model runs</li>
<li>generating chains of tasks to process similar datasets</li>
<li>replicating an entire workflow, or part thereof, over several runs</li>
<li>splitting a long model run into smaller steps or <code class="docutils literal notranslate"><span class="pre">chunks</span></code>
(parameterized cycling)</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This can be done with Jinja2 loops too (<a class="reference internal" href="#jinja"><span class="std std-ref">Jinja2</span></a>)
but parameterization is much cleaner (nested loops can seriously reduce
the clarity of a suite configuration).*</p>
</div>
<div class="section" id="parameter-expansion">
<h4>9.6.1. Parameter Expansion<a class="headerlink" href="#parameter-expansion" title="Permalink to this headline">¶</a></h4>
<p>Parameter values can be lists of strings, or lists of integers and
integer ranges (with inclusive bounds). Numeric values in a list of strings are
considered strings. It is not possible to mix strings with integer ranges.</p>
<p>For example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="c1"># parameters: &quot;ship&quot;, &quot;buoy&quot;, &quot;plane&quot;</span>
        <span class="c1"># default task suffixes: _ship, _buoy, _plane</span>
        <span class="nv">obs </span><span class="o">=</span><span class="s"> ship, buoy, plane</span>

        <span class="c1"># parameters: 1, 2, 3, 4, 5</span>
        <span class="c1"># default task suffixes: _run1, _run2, _run3, _run4, _run5</span>
        <span class="nv">run </span><span class="o">=</span><span class="s"> 1..5</span>

        <span class="c1"># parameters: 1, 3, 5, 7, 9</span>
        <span class="c1"># default task suffixes: _idx1, _idx3, _idx5, _idx7, _idx9</span>
        <span class="nv">idx </span><span class="o">=</span><span class="s"> 1..9..2</span>

        <span class="c1"># parameters: -11, -1, 9</span>
        <span class="c1"># default task suffixes: _idx-11, _idx-01, _idx+09</span>
        <span class="nv">idx </span><span class="o">=</span><span class="s"> -11..9..10</span>

        <span class="c1"># parameters: 1, 3, 5, 10, 11, 12, 13</span>
        <span class="c1"># default task suffixes: _i01, _i03, _i05, _i10, _i11, _i12, _i13</span>
        <span class="nv">i </span><span class="o">=</span><span class="s"> 1..5..2, 10, 11..13</span>

        <span class="c1"># parameters: &quot;0&quot;, &quot;1&quot;, &quot;e&quot;, &quot;pi&quot;, &quot;i&quot;</span>
        <span class="c1"># default task suffixes: _0, _1, _e, _pi, _i</span>
        <span class="nv">item </span><span class="o">=</span><span class="s"> 0, 1, e, pi, i</span>

        <span class="c1"># ERROR: mix strings with int range</span>
        <span class="nv">p </span><span class="o">=</span><span class="s"> one, two, 3..5</span>
</pre></div>
</div>
<p>Then angle brackets denote use of these parameters throughout the suite
configuration. For the values above, this parameterized name:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>model&lt;run&gt;  # for run = 1..5
</pre></div>
</div>
<p>expands to these concrete task names:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>model_run1, model_run2, model_run3, model_run4, model_run5
</pre></div>
</div>
<p>and this parameterized name:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>proc&lt;obs&gt;  # for obs = ship, buoy, plane
</pre></div>
</div>
<p>expands to these concrete task names:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>proc_ship, proc_buoy, proc_plane
</pre></div>
</div>
<p>By default, to avoid any ambiguity, the parameter name appears in the expanded
task names for integer values, but not for string values. For example,
<code class="docutils literal notranslate"><span class="pre">model_run1</span></code> for <code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">=</span> <span class="pre">1</span></code>, but <code class="docutils literal notranslate"><span class="pre">proc_ship</span></code> for
<code class="docutils literal notranslate"><span class="pre">obs</span> <span class="pre">=</span> <span class="pre">ship</span></code>. However, the default expansion templates can be
overridden if need be:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">obs </span><span class="o">=</span><span class="s"> ship, buoy, plane</span>
        <span class="nv">run </span><span class="o">=</span><span class="s"> 1..5</span>
    <span class="nt">[[parameter templates]]</span>
        <span class="nv">run </span><span class="o">=</span><span class="s"> -R%(run)s</span>  <span class="c1"># Make foo&lt;run&gt; expand to foo-R1 etc.</span>
</pre></div>
</div>
<p>(See <a class="reference internal" href="index.html#refparametertemplates"><span class="std std-ref">[cylc] -&gt; [[parameter templates]]</span></a> for more on the string template syntax.)</p>
<p>Any number of parameters can be used at once. This parameterization:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>model&lt;run,obs&gt;  # for run = 1..2 and obs = ship, buoy, plane
</pre></div>
</div>
<p>expands to these tasks names:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>model_run1_ship, model_run1_buoy, model_run1_plane,
model_run2_ship, model_run2_buoy, model_run2_plane
</pre></div>
</div>
<p>Here’s a simple but complete example suite:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">run </span><span class="o">=</span><span class="s"> 1..2</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">prep</span> <span class="o">=&gt;</span> <span class="kd">model</span>&lt;<span class="nb">run</span>&gt;<span class="c">&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[model</span>&lt;<span class="nb">run</span>&gt;<span class="nt">]]</span>
        <span class="c1"># ...</span>
</pre></div>
</div>
<p>The result, post parameter expansion, is this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">prep</span> <span class="o">=&gt;</span> <span class="kd">model_run1</span> <span class="o">&amp;</span> <span class="kd">model_run2</span><span class="c">&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[model_run1]]</span>
        <span class="c1"># ...</span>
    <span class="nt">[[model_run2]]</span>
        <span class="c1"># ...</span>
</pre></div>
</div>
<p>Here’s a more complex graph using two parameters (<code class="docutils literal notranslate"><span class="pre">[runtime]</span></code> omitted):</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">run </span><span class="o">=</span><span class="s"> 1..2</span>
        <span class="nv">mem </span><span class="o">=</span><span class="s"> cat, dog</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">prep</span> <span class="o">=&gt;</span> <span class="kd">init</span>&lt;<span class="nb">run</span>&gt; <span class="o">=&gt;</span> <span class="kd">model</span>&lt;<span class="nb">run,mem</span>&gt; <span class="o">=&gt;</span>
                      <span class="kd">post</span>&lt;<span class="nb">run,mem</span>&gt; <span class="o">=&gt;</span> <span class="kd">wrap</span>&lt;<span class="nb">run</span>&gt; <span class="o">=&gt;</span> <span class="kd">done</span><span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p><a class="reference internal" href="#fig-params-1"><span class="std std-numref">Fig. 31</span></a> shows the result as visualized by
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">graph</span></code>.</p>
<div class="figure align-center" id="id16">
<span id="fig-params-1"></span><img alt="_images/params1.png" src="_images/params1.png" />
<p class="caption"><span class="caption-number">Fig. 31 </span><span class="caption-text">Parameter expansion example.</span></p>
</div>
<div class="section" id="zero-padded-integer-values">
<h5>9.6.1.1. Zero-Padded Integer Values<a class="headerlink" href="#zero-padded-integer-values" title="Permalink to this headline">¶</a></h5>
<p>Integer parameter values are given a default template for generating task
suffixes that are zero-padded according to the longest size of their values.
For example, the default template for <code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">=</span> <span class="pre">9..10</span></code> would be
<code class="docutils literal notranslate"><span class="pre">_p%(p)02d</span></code>, so that <code class="docutils literal notranslate"><span class="pre">foo&lt;p&gt;</span></code> would become <code class="docutils literal notranslate"><span class="pre">foo_p09,</span> <span class="pre">foo_p10</span></code>.
If negative values are present in the parameter list, the
default template will include the sign.
For example, the default template for <code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">=</span> <span class="pre">-1..1</span></code> would be
<code class="docutils literal notranslate"><span class="pre">_p%(p)+02d</span></code>, so that <code class="docutils literal notranslate"><span class="pre">foo&lt;p&gt;</span></code> would become
<code class="docutils literal notranslate"><span class="pre">foo_p-1,</span> <span class="pre">foo_p+0,</span> <span class="pre">foo_p+1</span></code>.</p>
<p>To get thicker padding and/or alternate suffixes, use a template. E.g.:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">i </span><span class="o">=</span><span class="s"> 1..9</span>
        <span class="nv">p </span><span class="o">=</span><span class="s"> 3..14</span>
    <span class="nt">[[parameter templates]]</span>
        <span class="nv">i </span><span class="o">=</span><span class="s"> _i%(i)02d</span>  <span class="c1"># suffixes = _i01, _i02, ..., _i09</span>
        <span class="c1"># A double-percent gives a literal percent character</span>
        <span class="nv">p </span><span class="o">=</span><span class="s"> %%p%(p)03d</span>  <span class="c1"># suffixes = %p003, %p004, ..., %p013, %p014</span>
</pre></div>
</div>
</div>
<div class="section" id="parameters-as-full-task-names">
<h5>9.6.1.2. Parameters as Full Task Names<a class="headerlink" href="#parameters-as-full-task-names" title="Permalink to this headline">¶</a></h5>
<p>Parameter values can be used as full task names, but the default template
should be overridden to remove the initial underscore. For example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">i </span><span class="o">=</span><span class="s"> 1..4</span>
        <span class="nv">obs </span><span class="o">=</span><span class="s"> ship, buoy, plane</span>
    <span class="nt">[[parameter templates]]</span>
        <span class="nv">i </span><span class="o">=</span><span class="s"> i%(i)d</span>  <span class="c1"># task name must begin with an alphabet</span>
        <span class="nv">obs </span><span class="o">=</span><span class="s"> %(obs)s</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="kd">foo</span> <span class="o">=&gt;</span> &lt;<span class="nb">i</span>&gt;  <span class="c1"># foo =&gt; i1 &amp; i2 &amp; i3 &amp; i4</span>
&lt;<span class="nb">obs</span>&gt; <span class="o">=&gt;</span> <span class="kd">bar</span>  <span class="c1"># ship &amp; buoy &amp; plane =&gt; bar</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="passing-parameter-values-to-tasks">
<h4>9.6.2. Passing Parameter Values To Tasks<a class="headerlink" href="#passing-parameter-values-to-tasks" title="Permalink to this headline">¶</a></h4>
<p>Parameter values are passed as environment variables to tasks generated by
parameter expansion. For example, if we have:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">obs </span><span class="o">=</span><span class="s"> ship, buoy, plane</span>
        <span class="nv">run </span><span class="o">=</span><span class="s"> 1..5</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">model</span>&lt;<span class="nb">run,obs</span>&gt;
</pre></div>
</div>
<p>Then task <code class="docutils literal notranslate"><span class="pre">model_run2_ship</span></code> would get the following standard
environment variables:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># In a job script of an instance of the &quot;model_run2_ship&quot; task:</span>
<span class="nb">export</span> <span class="nv">CYLC_TASK_PARAM_run</span><span class="o">=</span><span class="s2">&quot;2&quot;</span>
<span class="nb">export</span> <span class="nv">CYLC_TASK_PARAM_obs</span><span class="o">=</span><span class="s2">&quot;ship&quot;</span>
</pre></div>
</div>
<p>These variables allow tasks to determine which member of a parameterized
group they are, and so to vary their behaviour accordingly.</p>
<p>You can also define custom variables and string templates for parameter value
substitution. For example, if we add this to the above configuration:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[model</span>&lt;<span class="nb">run,obs</span>&gt;<span class="nt">]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">MYNAME </span><span class="o">=</span><span class="s"> %(obs)sy-mc%(obs)sface</span>
            <span class="nv">MYFILE </span><span class="o">=</span><span class="s"> /path/to/run%(run)03d/%(obs)s</span>
</pre></div>
</div>
<p>Then task <code class="docutils literal notranslate"><span class="pre">model_run2_ship</span></code> would get the following custom
environment variables:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># In a job script of an instance of the &quot;model_run2_ship&quot; task:</span>
<span class="nb">export</span> MYNAME MYFILE
<span class="nv">MYNAME</span><span class="o">=</span>shipy-mcshipface
<span class="nv">MYFILE</span><span class="o">=</span>/path/to/run002/ship
</pre></div>
</div>
</div>
<div class="section" id="selecting-specific-parameter-values">
<h4>9.6.3. Selecting Specific Parameter Values<a class="headerlink" href="#selecting-specific-parameter-values" title="Permalink to this headline">¶</a></h4>
<p>Specific parameter values can be singled out in the graph and under
<code class="docutils literal notranslate"><span class="pre">[runtime]</span></code> with the notation <code class="docutils literal notranslate"><span class="pre">&lt;p=5&gt;</span></code> (for example).
Here’s how to make a special task trigger off just the first of a
set of model runs:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">run </span><span class="o">=</span><span class="s"> 1..5</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span> <span class="kd">model</span>&lt;<span class="nb">run</span>&gt; <span class="o">=&gt;</span> <span class="kd">post_proc</span>&lt;<span class="nb">run</span>&gt;  <span class="c1"># general case</span>
                    <span class="kd">model</span>&lt;<span class="nb">run=1</span>&gt; <span class="o">=&gt;</span> <span class="kd">check_first_run</span> <span class="s2">&quot;&quot;&quot;</span>  <span class="c1"># special case</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[model</span>&lt;<span class="nb">run</span>&gt;<span class="nt">]]</span>
        <span class="c1"># config for all &quot;model&quot; runs...</span>
    <span class="nt">[[model</span>&lt;<span class="nb">run=1</span>&gt;<span class="nt">]]</span>
        <span class="c1"># special config (if any) for the first model run...</span>
    <span class="c1">#...</span>
</pre></div>
</div>
</div>
<div class="section" id="selecting-partial-parameter-ranges">
<h4>9.6.4. Selecting Partial Parameter Ranges<a class="headerlink" href="#selecting-partial-parameter-ranges" title="Permalink to this headline">¶</a></h4>
<p>The parameter notation does not currently support partial range selection such
as <code class="docutils literal notranslate"><span class="pre">foo&lt;p=5..10&gt;</span></code>, but you can achieve the same result by defining a
second parameter that covers the partial range and giving it the same expansion
template as the full-range parameter. For example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">run </span><span class="o">=</span><span class="s"> 1..10</span>  <span class="c1"># 1, 2, ..., 10</span>
        <span class="nv">runx </span><span class="o">=</span><span class="s"> 1..3</span>  <span class="c1"># 1, 2, 3</span>
    <span class="nt">[[parameter templates]]</span>
        <span class="nv">run </span><span class="o">=</span><span class="s"> _R%(run)02d</span>   <span class="c1"># _R01, _R02, ..., _R10</span>
        <span class="nv">runx </span><span class="o">=</span><span class="s"> _R%(runx)02d</span>  <span class="c1"># _R01, _R02, _R03</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">model</span>&lt;<span class="nb">run</span>&gt; <span class="o">=&gt;</span> <span class="kd">post</span>&lt;<span class="nb">run</span>&gt;
                   <span class="kd">model</span>&lt;<span class="nb">runx</span>&gt; <span class="o">=&gt;</span> <span class="kd">checkx</span>&lt;<span class="nb">runx</span>&gt;<span class="s2">&quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[model</span>&lt;<span class="nb">run</span>&gt;<span class="nt">]]</span>
        <span class="c1"># ...</span>
    <span class="c1">#...</span>
</pre></div>
</div>
</div>
<div class="section" id="parameter-offsets-in-the-graph">
<h4>9.6.5. Parameter Offsets In The Graph<a class="headerlink" href="#parameter-offsets-in-the-graph" title="Permalink to this headline">¶</a></h4>
<p>A negative offset notation <code class="docutils literal notranslate"><span class="pre">&lt;NAME-1&gt;</span></code> is interpreted as the previous
value in the ordered list of parameter values, while a positive offset is
interpreted as the next value. For example, to split a model run into multiple
steps with each step depending on the previous one, either of these graphs:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">model</span>&lt;<span class="nb">run-1</span>&gt; <span class="o">=&gt;</span> <span class="kd">model</span>&lt;<span class="nb">run</span>&gt;<span class="c">&quot;</span>  <span class="c1"># for run = 1, 2, 3</span>
<span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">model</span>&lt;<span class="nb">run</span>&gt; <span class="o">=&gt;</span> <span class="kd">model</span>&lt;<span class="nb">run+1</span>&gt;<span class="c">&quot;</span>  <span class="c1"># for run = 1, 2, 3</span>
</pre></div>
</div>
<p>expands to:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">model_run1</span> <span class="o">=&gt;</span> <span class="kd">model_run2</span>
           <span class="kd">model_run2</span> <span class="o">=&gt;</span> <span class="kd">model_run3</span><span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># or equivalently:</span>

<span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">model_run1</span> <span class="o">=&gt;</span> <span class="kd">model_run2</span> <span class="o">=&gt;</span> <span class="kd">model_run3</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>And this graph:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">proc</span>&lt;<span class="nb">size-1</span>&gt; <span class="o">=&gt;</span> <span class="kd">proc</span>&lt;<span class="nb">size</span>&gt;<span class="c">&quot;</span>  <span class="c1"># for size = small, big, huge</span>
</pre></div>
</div>
<p>expands to:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">proc_small</span> <span class="o">=&gt;</span> <span class="kd">proc_big</span>
           <span class="kd">proc_big</span> <span class="o">=&gt;</span> <span class="kd">proc_huge</span><span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># or equivalently:</span>

<span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">proc_small</span> <span class="o">=&gt;</span> <span class="kd">proc_big</span> <span class="o">=&gt;</span> <span class="kd">proc_huge</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>However, a quirk in the current system means that you should avoid mixing
conditional logic in these statements. For example, the following will do the
unexpected:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">foo</span>&lt;<span class="nb">m-1</span>&gt; <span class="o">&amp;</span> <span class="kd">baz</span> <span class="o">=&gt;</span> <span class="kd">foo</span>&lt;<span class="nb">m</span>&gt;  <span class="c1"># for m = cat, dog</span>
</pre></div>
</div>
<p>currently expands to:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">foo_cat</span> <span class="o">&amp;</span> <span class="kd">baz</span> <span class="o">=&gt;</span> <span class="kd">foo_dog</span>

<span class="c1"># when users may expect it to be:</span>
<span class="c1">#    graph = foo_cat =&gt; foo_dog</span>
<span class="c1">#    graph = baz =&gt; foo_cat &amp; foo_dog</span>
</pre></div>
</div>
<p>For the time being, writing out the logic explicitly will give you the correct
graph.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">foo</span>&lt;<span class="nb">m-1</span>&gt; <span class="o">=&gt;</span> <span class="kd">foo</span>&lt;<span class="nb">m</span>&gt;  <span class="c1"># for m = cat, dog</span>
           <span class="kd">baz</span> <span class="o">=&gt;</span> <span class="kd">foo</span>&lt;<span class="nb">m</span>&gt;<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="task-families-and-parameterization">
<h4>9.6.6. Task Families And Parameterization<a class="headerlink" href="#task-families-and-parameterization" title="Permalink to this headline">¶</a></h4>
<p>Task family members can be generated by parameter expansion:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[FAM]]</span>
    <span class="nt">[[member</span>&lt;<span class="nb">r</span>&gt;<span class="nt">]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> FAM</span>
<span class="c1"># Result: family FAM contains member_r1, member_r2, etc.</span>
</pre></div>
</div>
<p>Family names can be parameterized too, just like task names:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[RUN</span>&lt;<span class="nb">r</span>&gt;<span class="nt">]]</span>
    <span class="nt">[[model</span>&lt;<span class="nb">r</span>&gt;<span class="nt">]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> RUN&lt;r&gt;</span>
    <span class="nt">[[post_proc</span>&lt;<span class="nb">r</span>&gt;<span class="nt">]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> RUN&lt;r&gt;</span>
<span class="c1"># Result: family RUN_r1 contains model_r1 and post_proc_r1,</span>
<span class="c1">#         family RUN_r2 contains model_r2 and post_proc_r1, etc.</span>
</pre></div>
</div>
<p>As described in <a class="reference internal" href="#familytriggers"><span class="std std-ref">Family Triggers</span></a> family names can be used to
trigger all members at once:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">FAMILY</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>or to trigger off all members:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">FAMILY</span><span class="c">:</span><span class="kd">succeed</span><span class="c">-</span><span class="kd">all</span> <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>or to trigger off any members:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">FAMILY</span><span class="c">:</span><span class="kd">succeed</span><span class="c">-</span><span class="kd">any</span> <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>If the members of <code class="docutils literal notranslate"><span class="pre">FAMILY</span></code> were generated with parameters, you can
also trigger them all at once with parameter notation:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">member</span>&lt;<span class="nb">m</span>&gt;<span class="c">&quot;</span>
</pre></div>
</div>
<p>Similarly, to trigger off all members:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">member</span>&lt;<span class="nb">m</span>&gt; <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
<span class="c1"># (member&lt;m&gt;:fail etc., for other trigger types)</span>
</pre></div>
</div>
<p>Family names are still needed in the graph, however, to succinctly express
“succeed-any” triggering semantics, and all-to-all or any-to-all triggering:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">FAM1</span><span class="c">:</span><span class="kd">succeed</span><span class="c">-</span><span class="kd">any</span> <span class="o">=&gt;</span> <span class="kd">FAM2</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>(Direct all-to-all and any-to-all family triggering is not recommended for
efficiency reasons though - see <a class="reference internal" href="#efficientinterfamilytriggering"><span class="std std-ref">Efficient Inter-Family Triggering</span></a>).</p>
<p>For family <em>member-to-member</em> triggering use parameterized members.
For example, if family <code class="docutils literal notranslate"><span class="pre">OBS_GET</span></code> has members <code class="docutils literal notranslate"><span class="pre">get&lt;obs&gt;</span></code> and
family <code class="docutils literal notranslate"><span class="pre">OBS_PROC</span></code> has members <code class="docutils literal notranslate"><span class="pre">proc&lt;obs&gt;</span></code> then this graph:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">get</span>&lt;<span class="nb">obs</span>&gt; <span class="o">=&gt;</span> <span class="kd">proc</span>&lt;<span class="nb">obs</span>&gt;<span class="c">&quot;</span>  <span class="c1"># for obs = ship, buoy, plane</span>
</pre></div>
</div>
<p>expands to:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>get_ship =&gt; proc_ship
get_buoy =&gt; proc_buoy
get_plane =&gt; proc_plane
</pre></div>
</div>
</div>
<div class="section" id="parameterized-cycling">
<span id="id8"></span><h4>9.6.7. Parameterized Cycling<a class="headerlink" href="#parameterized-cycling" title="Permalink to this headline">¶</a></h4>
<p>Two ways of constructing cycling systems are described and contrasted in
<a class="reference internal" href="index.html#workflows-for-cycling-systems"><span class="std std-ref">Workflows For Cycling Systems</span></a>.  For most purposes use of
a proper <em>cycling workflow</em> is recommended, wherein cylc incrementally
generates the date-time sequence and extends the workflow, potentially
indefinitely, at run time. For smaller systems of finite duration, however,
parameter expansion can be used to generate a sequence of pre-defined tasks
as a proxy for cycling.</p>
<p>Here’s a cycling workflow of two-monthly model runs for one year,
with previous-instance model dependence (e.g. for model restart files):</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2020-01</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 2020-12</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[R1]]]</span>  <span class="c1"># Run once, at the initial point.</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">prep</span> <span class="o">=&gt;</span> <span class="kd">model</span><span class="c">&quot;</span>
        <span class="nt">[[[P2M]]]</span>  <span class="c1"># Run at 2-month intervals between the initial and final points.</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">model</span>[<span class="nb">-P2M</span>] <span class="o">=&gt;</span> <span class="kd">model</span> <span class="o">=&gt;</span> <span class="kd">post_proc</span> <span class="o">&amp;</span> <span class="kd">archive</span><span class="c">&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[model]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;run-model $CYLC_TASK_CYCLE_POINT&quot;</span>
</pre></div>
</div>
<p>And here’s how to do the same thing with parameterized tasks:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">chunk </span><span class="o">=</span><span class="s"> 1..6</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">prep</span> <span class="o">=&gt;</span> <span class="kd">model</span>&lt;<span class="nb">chunk=1</span>&gt;
                     <span class="kd">model</span>&lt;<span class="nb">chunk-1</span>&gt; <span class="o">=&gt;</span> <span class="kd">model</span>&lt;<span class="nb">chunk</span>&gt; <span class="o">=&gt;</span>
                       <span class="kd">post_proc</span>&lt;<span class="nb">chunk</span>&gt; <span class="o">&amp;</span> <span class="kd">archive</span>&lt;<span class="nb">chunk</span>&gt;<span class="s2">&quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[model</span>&lt;<span class="nb">chunk</span>&gt;<span class="nt">]]</span>
        <span class="nv">script </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="c1"># Compute start date from chunk index and interval, then run the model.</span><span class="s2"></span>
<span class="s2">INITIAL_POINT=2020-01</span>
<span class="s2">INTERVAL_MONTHS=2</span>
<span class="s2">OFFSET_MONTHS=(( (CYLC_TASK_PARAM_chunk - 1)*INTERVAL_MONTHS ))</span>
<span class="s2">OFFSET=P${OFFSET_MONTHS}M</span>  <span class="c1"># e.g. P4M for chunk=3</span><span class="s2"></span>
<span class="s2">run-model $(cylc cyclepoint --offset=$OFFSET $INITIAL_POINT)&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>The two workflows are shown together in <a class="reference internal" href="#fig-eg2"><span class="std std-numref">Fig. 32</span></a>.
They both achieve the same result, and both can
include special tasks at the start, end, or
anywhere in between. But as noted earlier the parameterized version has
several disadvantages: it must be finite in extent and not too large; the
date-time arithmetic has to be done by the user; and the full extent of the
workflow will be visible at all times as the suite runs.</p>
<div class="figure align-center">
<img alt="_images/eg2-static.png" src="_images/eg2-static.png" />
</div>
<div class="figure align-center" id="id17">
<span id="fig-eg2"></span><img alt="_images/eg2-dynamic.png" src="_images/eg2-dynamic.png" />
<p class="caption"><span class="caption-number">Fig. 32 </span><span class="caption-text">Parameterized (top) and cycling (bottom) versions of the same
workflow. The first three cycle points are shown in the
cycling case. The parameterized case does not have “cycle points”.</span></p>
</div>
<p>Here’s a yearly-cycling suite with four parameterized chunks in each cycle
point:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">chunk </span><span class="o">=</span><span class="s"> 1..4</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2020-01</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[P1Y]]]</span>
            <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">model</span>&lt;<span class="nb">chunk-1</span>&gt; <span class="o">=&gt;</span> <span class="kd">model</span>&lt;<span class="nb">chunk</span>&gt;
                    <span class="kd">model</span>&lt;<span class="nb">chunk=4</span>&gt;[<span class="nb">-P1Y</span>] <span class="o">=&gt;</span> <span class="kd">model</span>&lt;<span class="nb">chunk=1</span>&gt;<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The inter-cycle trigger connects the first chunk in each cycle point
to the last chunk in the previous cycle point. Of course it would be simpler
to just use 3-monthly cycling:</p>
<div class="last highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2020-01</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[P3M]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">model</span>[<span class="nb">-P3M</span>] <span class="o">=&gt;</span> <span class="kd">model</span><span class="c">&quot;</span>
</pre></div>
</div>
</div>
<p>Here’s a possible valid use-case for mixed cycling: consider a portable
date-time cycling workflow of model jobs that can each take too long to run on
some supported platforms. This could be handled without changing the cycling
structure of the suite by splitting the run (at each cycle point) into a
variable number of shorter steps, using more steps on less powerful hosts.</p>
<div class="section" id="cycle-point-and-parameter-offsets-at-start-up">
<h5>9.6.7.1. Cycle Point And Parameter Offsets At Start-Up<a class="headerlink" href="#cycle-point-and-parameter-offsets-at-start-up" title="Permalink to this headline">¶</a></h5>
<p>In cycling workflows cylc ignores anything earlier than the suite initial
cycle point. So this graph:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">model</span>[<span class="nb">-P1D</span>] <span class="o">=&gt;</span> <span class="kd">model</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>simplifies at the initial cycle point to this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">model</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>Similarly, parameter offsets are ignored if they extend beyond the start
of the parameter value list. So this graph:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">model</span>&lt;<span class="nb">chunk-1</span>&gt; <span class="o">=&gt;</span> <span class="kd">model</span>&lt;<span class="nb">chunk</span>&gt;<span class="c">&quot;</span>
</pre></div>
</div>
<p>simplifies for <code class="docutils literal notranslate"><span class="pre">chunk=1</span></code> to this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">model_chunk1</span><span class="c">&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The initial cut-off applies to every parameter list, but only
to cycle point sequences that start at the suite initial cycle point.
Therefore it may be somewhat easier to use parameterized cycling if you
need multiple date-time sequences <em>with different start points</em> in the
same suite. We plan to allow this sequence-start simplification for any
date-time sequence in the future, not just at the suite initial point,
but it needs to be optional because delayed-start cycling tasks
sometimes need to trigger off earlier cycling tasks.</p>
</div>
</div>
</div>
</div>
<div class="section" id="jinja">
<span id="id9"></span><h3>9.7. Jinja2<a class="headerlink" href="#jinja" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section needs to be revised - the Parameterized Task feature
introduced in cylc-6.11.0 (see <a class="reference internal" href="#parameterized-tasks-label"><span class="std std-ref">Parameterized Tasks</span></a>) provides
a cleaner way to auto-generate tasks without coding messy Jinja2 loops.</p>
</div>
<p>Cylc has built in support for the Jinja2 template processor in suite
configurations. Jinja2 variables, mathematical expressions, loop control
structures, conditional logic, etc., are automatically processed to
generate the final suite configuration seen by cylc.</p>
<p>The need for Jinja2 processing must be declared with a hash-bang
comment as the first line of the suite.rc file:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="ch">#!jinja2</span>
<span class="c1"># ...</span>
</pre></div>
</div>
<p>Potential uses for this include automatic generation of repeated groups
of similar tasks and dependencies, and inclusion or exclusion of entire
suite sections according to the value of a single flag. Consider a
large complicated operational suite and several related parallel test
suites with slightly different task content and structure (the parallel
suites, for instance, might take certain large input files from the
operation or the archive rather than downloading them again) - these can
now be maintained as a single master suite configuration that reconfigures
itself according to the value of a flag variable indicating the intended use.</p>
<p>Template processing is the first thing done on parsing a suite
configuration so Jinja2 expressions can appear anywhere in the file (inside
strings and namespace headings, for example).</p>
<p>Jinja2 is <a class="reference external" href="http://jinja.pocoo.org/docs">well documented</a>, so here
we just provide an example suite that uses it. The meaning of the
embedded Jinja2 code should be reasonably self-evident to anyone familiar
with standard programming techniques.</p>
<div class="figure align-center" id="id18">
<span id="fig-jinja2-ensemble"></span><img alt="_images/jinja2-ensemble-graph.png" src="_images/jinja2-ensemble-graph.png" />
<p class="caption"><span class="caption-number">Fig. 33 </span><span class="caption-text">The Jinja2 ensemble example suite graph.</span></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">jinja2.ensemble</span></code> example, graphed in
<a class="reference internal" href="#fig-jinja2-ensemble"><span class="std std-numref">Fig. 33</span></a>, shows an ensemble of similar tasks
generated using Jinja2:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="ch">#!jinja2</span>
<span class="cp">{% set N_MEMBERS = 5 %}</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="c c-Multi">{# generate ensemble dependencies #}</span>
            <span class="cp">{% for I in range( 0, N_MEMBERS ) %}</span>
               <span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">mem_</span><span class="cp">{{ I }}</span> <span class="o">=&gt;</span> <span class="kd">post_</span><span class="cp">{{ I }}</span> <span class="o">=&gt;</span> <span class="kd">bar</span>
            <span class="cp">{% endfor %}</span><span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Here is the generated suite configuration, after Jinja2 processing:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="ch">#!jinja2</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
          <span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">mem_0</span> <span class="o">=&gt;</span> <span class="kd">post_0</span> <span class="o">=&gt;</span> <span class="kd">bar</span>
          <span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">mem_1</span> <span class="o">=&gt;</span> <span class="kd">post_1</span> <span class="o">=&gt;</span> <span class="kd">bar</span>
          <span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">mem_2</span> <span class="o">=&gt;</span> <span class="kd">post_2</span> <span class="o">=&gt;</span> <span class="kd">bar</span>
          <span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">mem_3</span> <span class="o">=&gt;</span> <span class="kd">post_3</span> <span class="o">=&gt;</span> <span class="kd">bar</span>
          <span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">mem_4</span> <span class="o">=&gt;</span> <span class="kd">post_4</span> <span class="o">=&gt;</span> <span class="kd">bar</span>
                <span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>And finally, the <code class="docutils literal notranslate"><span class="pre">jinja2.cities</span></code> example uses variables,
includes or excludes special cleanup tasks according to the value of a
logical flag, and it automatically generates all dependencies and family
relationships for a group of tasks that is repeated for each city in the
suite. To add a new city and associated tasks and dependencies simply
add the city name to list at the top of the file. The suite is graphed,
with the New York City task family expanded, in
<a class="reference internal" href="#fig-jinja2-cities"><span class="std std-numref">Fig. 34</span></a>.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="ch">#!Jinja2</span>
<span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;Jinja2 city suite example.&quot;</span>
    <span class="nv">description </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Illustrates use of variables and math expressions, and programmatic</span>
<span class="s2">generation of groups of related dependencies and runtime properties.&quot;&quot;&quot;</span>

<span class="cp">{% set HOST = &quot;SuperComputer&quot; %}</span>
<span class="cp">{% set CITIES = &#39;NewYork&#39;, &#39;Philadelphia&#39;, &#39;Newark&#39;, &#39;Houston&#39;, &#39;SantaFe&#39;, &#39;Chicago&#39; %}</span>
<span class="cp">{% set CITYJOBS = &#39;one&#39;, &#39;two&#39;, &#39;three&#39;, &#39;four&#39; %}</span>
<span class="cp">{% set LIMIT_MINS = 20 %}</span>

<span class="cp">{% set CLEANUP = True %}</span>

<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2011-08-08T12</span>
    <span class="nt">[[ dependencies ]]</span>
<span class="cp">{% if CLEANUP %}</span>
        <span class="nt">[[[T23]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">clean</span><span class="c">&quot;</span>
<span class="cp">{% endif %}</span>
        <span class="nt">[[[T00,T12]]]</span>
            <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
                    <span class="kd">setup</span> <span class="o">=&gt;</span> <span class="kd">get_lbc</span> <span class="o">&amp;</span> <span class="kd">get_ic</span> <span class="c1"># foo</span>
<span class="cp">{% for CITY in CITIES %}</span> <span class="c c-Multi">{# comment #}</span>
                    <span class="kd">get_lbc</span> <span class="o">=&gt;</span> <span class="cp">{{ CITY }}</span><span class="kd">_one</span>
                    <span class="kd">get_ic</span> <span class="o">=&gt;</span> <span class="cp">{{ CITY }}</span><span class="kd">_two</span>
                    <span class="cp">{{ CITY }}</span><span class="kd">_one</span> <span class="o">&amp;</span> <span class="cp">{{ CITY }}</span><span class="kd">_two</span> <span class="o">=&gt;</span> <span class="cp">{{ CITY }}</span><span class="kd">_three</span> <span class="o">&amp;</span> <span class="cp">{{ CITY }}</span><span class="kd">_four</span>
<span class="cp">{% if CLEANUP %}</span>
                    <span class="cp">{{ CITY }}</span><span class="kd">_three</span> <span class="o">&amp;</span> <span class="cp">{{ CITY }}</span><span class="kd">_four</span> <span class="o">=&gt;</span> <span class="kd">cleanup</span>
<span class="cp">{% endif %}</span>
<span class="cp">{% endfor %}</span>
                    <span class="s2">&quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[on_</span><span class="cp">{{ HOST }}</span><span class="nt"> ]]</span>
        <span class="nt">[[[remote]]]</span>
            <span class="nv">host </span><span class="o">=</span><span class="s"> </span><span class="cp">{{ HOST }}</span>
            <span class="c1"># (remote cylc directory is set in site/user config for this host)</span>
        <span class="nt">[[[directives]]]</span>
            <span class="nv">wall_clock_limit </span><span class="o">=</span><span class="s"> &quot;00:</span><span class="cp">{{ LIMIT_MINS|int() + 2 }}</span><span class="s">:00,00:</span><span class="cp">{{ LIMIT_MINS }}</span><span class="s">:00&quot;</span>

<span class="cp">{% for CITY in CITIES %}</span>
    <span class="nt">[[ </span><span class="cp">{{ CITY }}</span><span class="nt"> ]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> on_</span><span class="cp">{{ HOST }}</span>
<span class="cp">{% for JOB in CITYJOBS %}</span>
    <span class="nt">[[ </span><span class="cp">{{ CITY }}</span><span class="nt">_</span><span class="cp">{{ JOB }}</span><span class="nt"> ]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> </span><span class="cp">{{ CITY }}</span>
<span class="cp">{% endfor %}</span>
<span class="cp">{% endfor %}</span>

<span class="nt">[visualization]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2011-08-08T12</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 2011-08-08T23</span>
    <span class="nt">[[node groups]]</span>
        <span class="nv">cleaning </span><span class="o">=</span><span class="s"> clean, cleanup</span>
    <span class="nt">[[node attributes]]</span>
        <span class="nv">cleaning </span><span class="o">=</span><span class="s"> &#39;style=filled&#39;, &#39;fillcolor=yellow&#39;</span>
        <span class="nv">NewYork </span><span class="o">=</span><span class="s"> &#39;style=filled&#39;, &#39;fillcolor=lightblue&#39;        </span>
</pre></div>
</div>
<div class="figure align-center" id="id19">
<span id="fig-jinja2-cities"></span><img alt="_images/jinja2-suite-graph.png" src="_images/jinja2-suite-graph.png" />
<p class="caption"><span class="caption-number">Fig. 34 </span><span class="caption-text">The Jinja2 cities example suite graph, with the
New York City task family expanded.</span></p>
</div>
<div class="section" id="accessing-environment-variables-with-jinja2">
<h4>9.7.1. Accessing Environment Variables With Jinja2<a class="headerlink" href="#accessing-environment-variables-with-jinja2" title="Permalink to this headline">¶</a></h4>
<p>This functionality is not provided by Jinja2 by default, but cylc
automatically imports the user environment to template’s global namespace
(see <a class="reference internal" href="#customjinja2filters"><span class="std std-ref">Custom Jinja2 Filters, Tests and Globals</span></a>) in a dictionary structure called
<em>environ</em>. A usage example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="ch">#!Jinja2</span>
<span class="c1">#...</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">SUITE_OWNER_HOME_DIR_ON_SUITE_HOST </span><span class="o">=</span><span class="s"> </span><span class="cp">{{environ[&#39;HOME&#39;]}}</span>
</pre></div>
</div>
<p>In addition, the following variables are exported to this environment
prior to configuration parsing to provide suite context:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>CYLC_DEBUG                      <span class="c1"># Debug mode, true or not defined</span>
CYLC_DIR                        <span class="c1"># Location of cylc installation used</span>
CYLC_VERBOSE                    <span class="c1"># Verbose mode, True or False</span>
CYLC_VERSION                    <span class="c1"># Version of cylc installation used</span>

CYLC_SUITE_NAME                 <span class="c1"># Suite name</span>

CYLC_SUITE_DEF_PATH             <span class="c1"># Location of the suite configuration</span>
                                <span class="c1"># source path on suite host,</span>
                                <span class="c1"># e.g. ~/cylc-run/foo</span>
CYLC_SUITE_LOG_DIR              <span class="c1"># Suite log directory.</span>
CYLC_SUITE_RUN_DIR              <span class="c1"># Location of the suite run directory in</span>
                                <span class="c1"># suite host, e.g. ~/cylc-run/foo</span>
CYLC_SUITE_SHARE_DIR            <span class="c1"># Suite (or task post parsing!)</span>
                                <span class="c1"># shared directory.</span>
CYLC_SUITE_WORK_DIR             <span class="c1"># Suite work directory.</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The example above emphasizes that <em>the environment - including the suite
context variables - is read on the suite host when the suite configuration
is parsed</em>, not at task run time on job hosts.</p>
</div>
</div>
<div class="section" id="custom-jinja2-filters-tests-and-globals">
<span id="customjinja2filters"></span><h4>9.7.2. Custom Jinja2 Filters, Tests and Globals<a class="headerlink" href="#custom-jinja2-filters-tests-and-globals" title="Permalink to this headline">¶</a></h4>
<p>Jinja2 has three different namespaces used to separate “globals”,
“filters” and “tests”. Globals are template-wide accessible variables
and functions. Cylc extends this namespace with “environ” dictionary and
“raise” and “assert” functions for raising exceptions
(see <a class="reference internal" href="#jinja2raisingexceptions"><span class="std std-ref">Raising Exceptions</span></a>).</p>
<p>Filters can be used to modify variable values and are applied using pipe
notation. For example, the built-in <code class="docutils literal notranslate"><span class="pre">trim</span></code> filter strips leading
and trailing white space from a string:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="cp">{% set MyString = &quot;   dog   &quot; %}</span>
<span class="cp">{{ MyString | trim() }}</span>  <span class="c1"># &quot;dog&quot;</span>
</pre></div>
</div>
<p>Additionally, variable values can be tested using “is” keyword followed by
the name of the test, e.g. <code class="docutils literal notranslate"><span class="pre">VARIABLE</span> <span class="pre">is</span> <span class="pre">defined</span></code>.
See official Jinja2 documentation for available built-in globals, filters
and tests.</p>
<p>Cylc also supports custom Jinja2 globals, filters and tests. A custom global,
filter or test is a single Python function in a source file with the same name
as the function (plus “.py” extension) and stored in one of the following
locations:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&lt;cylc-dir&gt;/lib/Jinja2[namespace]/</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">[suite</span> <span class="pre">configuration</span> <span class="pre">directory]/Jinja2[namespace]/</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">$HOME/.cylc/Jinja2[namespace]/</span></code></li>
</ul>
<p>where <code class="docutils literal notranslate"><span class="pre">[namespace]/</span></code> is one of <code class="docutils literal notranslate"><span class="pre">Globals/</span></code>, <code class="docutils literal notranslate"><span class="pre">Filters/</span></code> or <code class="docutils literal notranslate"><span class="pre">Tests/</span></code>.</p>
<p>In the argument list of filter or test function, the first argument is
the variable value to be “filtered” or “tested”, respectively, and
subsequent arguments can be whatever else is needed. Currently there are three
custom filters:</p>
<div class="section" id="pad">
<h5>9.7.2.1. pad<a class="headerlink" href="#pad" title="Permalink to this headline">¶</a></h5>
<p>The “pad” filter is for padding string values to some
constant length with a fill character - useful for generating task names
and related values in ensemble suites:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="cp">{% for i in range(0,100) %}</span>  <span class="c1"># 0, 1, ..., 99</span>
    <span class="cp">{% set j = i | pad(2,&#39;0&#39;) %}</span>
    <span class="nt">[[A_</span><span class="cp">{{j}}</span><span class="nt">]]</span>         <span class="c1"># [[A_00]], [[A_01]], ..., [[A_99]]</span>
<span class="cp">{% endfor %}</span>
</pre></div>
</div>
</div>
<div class="section" id="strftime">
<h5>9.7.2.2. strftime<a class="headerlink" href="#strftime" title="Permalink to this headline">¶</a></h5>
<p>The “strftime” filter can be used to format ISO8601 date-time strings using
an strftime string.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="cp">{% set START_CYCLE = &#39;10661004T08+01&#39; %}</span>
<span class="cp">{{ START_CYCLE | strftime(&#39;%H&#39;) }}</span>  <span class="c1"># 00</span>
</pre></div>
</div>
<p>Examples:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">{{START_CYCLE</span> <span class="pre">|</span> <span class="pre">strftime('%Y')}}</span></code> - 1066</li>
<li><code class="docutils literal notranslate"><span class="pre">{{START_CYCLE</span> <span class="pre">|</span> <span class="pre">strftime('%m')}}</span></code> - 10</li>
<li><code class="docutils literal notranslate"><span class="pre">{{START_CYCLE</span> <span class="pre">|</span> <span class="pre">strftime('%d')}}</span></code> - 14</li>
<li><code class="docutils literal notranslate"><span class="pre">{{START_CYCLE</span> <span class="pre">|</span> <span class="pre">strftime('%H:%M:%S</span> <span class="pre">%z')}}</span></code> - 08:00:00 +01</li>
</ul>
<p>It is also possible to parse non-standard date-time strings by passing a
strptime string as the second argument.</p>
<p>Examples:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">{{'12,30,2000'</span> <span class="pre">|</span> <span class="pre">strftime('%m',</span> <span class="pre">'%m,%d,%Y')}}</span></code> - 12</li>
<li><code class="docutils literal notranslate"><span class="pre">{{'1066/10/14</span> <span class="pre">08:00:00'</span> <span class="pre">|</span> <span class="pre">strftime('%Y%m%dT%H',</span> <span class="pre">'%Y/%m/%d</span> <span class="pre">%H:%M:%S')}}</span></code> - 10661014T08</li>
</ul>
</div>
<div class="section" id="duration-as">
<h5>9.7.2.3. duration_as<a class="headerlink" href="#duration-as" title="Permalink to this headline">¶</a></h5>
<p>The “duration_as” filter can be used to format ISO8601 duration
strings as a floating-point number of several different units.  Units
for the conversion can be specified in a case-insensitive short or long
form:</p>
<ul class="simple">
<li>Seconds - “s” or “seconds”</li>
<li>Minutes - “m” or “minutes”</li>
<li>Hours - “h” or “hours”</li>
<li>Days - “d” or “days”</li>
<li>Weeks - “w” or “weeks”</li>
</ul>
<p>Within the suite, this becomes:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="cp">{% set CYCLE_INTERVAL = &#39;PT1D&#39; %}</span>
<span class="cp">{{ CYCLE_INTERVAL | duration_as(&#39;h&#39;) }}</span>  <span class="c1"># 24.0</span>
<span class="cp">{% set CYCLE_SUBINTERVAL = &#39;PT30M&#39; %}</span>
<span class="cp">{{ CYCLE_SUBINTERVAL | duration_as(&#39;hours&#39;) }}</span>  <span class="c1"># 0.5</span>
<span class="cp">{% set CYCLE_INTERVAL = &#39;PT1D&#39; %}</span>
<span class="cp">{{ CYCLE_INTERVAL | duration_as(&#39;s&#39;) }}</span>  <span class="c1"># 86400.0</span>
<span class="cp">{% set CYCLE_SUBINTERVAL = &#39;PT30M&#39; %}</span>
<span class="cp">{{ CYCLE_SUBINTERVAL | duration_as(&#39;seconds&#39;) }}</span>  <span class="c1"># 1800.0</span>
</pre></div>
</div>
<p>While the filtered value is a floating-point number, it is often required to
supply an integer to suite entities (e.g. environment variables) that require
it.  This is accomplished by chaining filters:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">{{CYCLE_INTERVAL</span> <span class="pre">|</span> <span class="pre">duration_as('h')</span> <span class="pre">|</span> <span class="pre">int}}</span></code> - 24</li>
<li><code class="docutils literal notranslate"><span class="pre">{{CYCLE_SUBINTERVAL</span> <span class="pre">|</span> <span class="pre">duration_as('h')</span> <span class="pre">|</span> <span class="pre">int}}</span></code> - 0</li>
<li><code class="docutils literal notranslate"><span class="pre">{{CYCLE_INTERVAL</span> <span class="pre">|</span> <span class="pre">duration_as('s')</span> <span class="pre">|</span> <span class="pre">int}}</span></code> - 86400</li>
<li><code class="docutils literal notranslate"><span class="pre">{{CYCLE_SUBINTERVAL</span> <span class="pre">|</span> <span class="pre">duration_as('s')</span> <span class="pre">|</span> <span class="pre">int}}</span></code> - 1800</li>
</ul>
</div>
</div>
<div class="section" id="associative-arrays-in-jinja2">
<h4>9.7.3. Associative Arrays In Jinja2<a class="headerlink" href="#associative-arrays-in-jinja2" title="Permalink to this headline">¶</a></h4>
<p>Associative arrays (<em>dicts</em> in Python) can be very useful.
Here’s an example, from <code class="docutils literal notranslate"><span class="pre">&lt;cylc-dir&gt;/etc/examples/jinja2/dict</span></code>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="ch">#!Jinja2</span>
<span class="cp">{% set obs_types = [&#39;airs&#39;, &#39;iasi&#39;] %}</span>
<span class="cp">{% set resource = { &#39;airs&#39;:&#39;ncpus=9&#39;, &#39;iasi&#39;:&#39;ncpus=20&#39; } %}</span>

<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">OBS</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[OBS]]</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> pbs</span>
    <span class="cp">{% for i in obs_types %}</span>
    <span class="nt">[[ </span><span class="cp">{{i}}</span><span class="nt"> ]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> OBS</span>
        <span class="nt">[[[directives]]]</span>
             <span class="nv">-I </span><span class="o">=</span><span class="s"> </span><span class="cp">{{ resource[i] }}</span>
     <span class="cp">{% endfor %}</span>
</pre></div>
</div>
<p>Here’s the result:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc get-suite-config -i <span class="o">[</span>runtime<span class="o">][</span>airs<span class="o">]</span>directives SUITE
-I <span class="o">=</span> <span class="nv">ncpus</span><span class="o">=</span><span class="m">9</span>
</pre></div>
</div>
</div>
<div class="section" id="jinja2-default-values-and-template-inputs">
<h4>9.7.4. Jinja2 Default Values And Template Inputs<a class="headerlink" href="#jinja2-default-values-and-template-inputs" title="Permalink to this headline">¶</a></h4>
<p>The values of Jinja2 variables can be passed in from the cylc command
line rather than hardwired in the suite configuration.
Here’s an example, from <code class="docutils literal notranslate"><span class="pre">&lt;cylc-dir&gt;/etc/examples/jinja2/defaults</span></code>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="ch">#!Jinja2</span>

<span class="nt">[meta]</span>

    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;Jinja2 example: use of defaults and external input&quot;</span>

    <span class="nv">description </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">The template variable FIRST_TASK must be given on the cylc command line</span>
<span class="s2">using --set or --set-file=FILE; two other variables, LAST_TASK and</span>
<span class="s2">N_MEMBERS can be set similarly, but if not they have default values.&quot;&quot;&quot;</span>

<span class="cp">{% set LAST_TASK = LAST_TASK | default( &#39;baz&#39; ) %}</span>
<span class="cp">{% set N_MEMBERS = N_MEMBERS | default( 3 ) | int %}</span>

<span class="c c-Multi">{# input of FIRST_TASK is required - no default #}</span>

<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20100808T00</span>
    <span class="nv">final cycle point   </span><span class="o">=</span><span class="s"> 20100816T00</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[0]]]</span>
            <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="cp">{{ FIRST_TASK }}</span> <span class="o">=&gt;</span> <span class="kd">ENS</span>
                 <span class="kd">ENS</span><span class="c">:</span><span class="kd">succeed</span><span class="c">-</span><span class="kd">all</span> <span class="o">=&gt;</span> <span class="cp">{{ LAST_TASK }}</span><span class="s2">&quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[ENS]]</span>
<span class="cp">{% for I in range( 0, N_MEMBERS ) %}</span>
    <span class="nt">[[ mem_</span><span class="cp">{{ I }}</span><span class="nt"> ]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> ENS</span>
<span class="cp">{% endfor %}</span>
</pre></div>
</div>
<p>Here’s the result:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc list SUITE
Jinja2 Template Error
<span class="s1">&#39;FIRST_TASK&#39;</span> is undefined
cylc-list foo  failed:  <span class="m">1</span>

$ cylc list --set <span class="nv">FIRST_TASK</span><span class="o">=</span>bob foo
bob
baz
mem_2
mem_1
mem_0

$ cylc list --set <span class="nv">FIRST_TASK</span><span class="o">=</span>bob --set <span class="nv">LAST_TASK</span><span class="o">=</span>alice foo
bob
alice
mem_2
mem_1
mem_0

$ cylc list --set <span class="nv">FIRST_TASK</span><span class="o">=</span>bob --set <span class="nv">N_MEMBERS</span><span class="o">=</span><span class="m">10</span> foo
mem_9
mem_8
mem_7
mem_6
mem_5
mem_4
mem_3
mem_2
mem_1
mem_0
baz
bob
</pre></div>
</div>
<p>Note also that <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">view</span> <span class="pre">--set</span> <span class="pre">FIRST_TASK=bob</span> <span class="pre">--jinja2</span> <span class="pre">SUITE</span></code>
will show the suite with the Jinja2 variables as set.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Suites started with template variables set on the command
line will <em>restart</em> with the same settings. However, you can set
them again on the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">restart</span></code> command line if they need to
be overridden.</p>
</div>
</div>
<div class="section" id="jinja2-variable-scope">
<h4>9.7.5. Jinja2 Variable Scope<a class="headerlink" href="#jinja2-variable-scope" title="Permalink to this headline">¶</a></h4>
<p>Jinja2 variable scoping rules may be surprising. Variables set inside a
<em>for loop</em> block, for instance, are not accessible outside of the block,
so the following will print <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">FOO</span> <span class="pre">is</span> <span class="pre">0</span></code>, not <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">FOO</span> <span class="pre">is</span> <span class="pre">9</span></code>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="cp">{% set FOO = false %}</span>
<span class="cp">{% for item in items %}</span>
    <span class="cp">{% if item.check_something() %}</span>
        <span class="cp">{% set FOO = true %}</span>
    <span class="cp">{% endif %}</span>
<span class="cp">{% endfor %}</span>
<span class="c1"># FOO is {{FOO}}</span>
</pre></div>
</div>
<p>Jinja2 documentation suggests using alternative constructs like the loop else
block or the special <code class="docutils literal notranslate"><span class="pre">loop</span></code> variable. More complex use cases can be
handled using <code class="docutils literal notranslate"><span class="pre">namespace</span></code> objects which allow propagating of changes
across scopes:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="cp">{% set ns = namespace(foo=false) %}</span>
<span class="cp">{% for item in items %}</span>
    <span class="cp">{% if item.check_something() %}</span>
        <span class="cp">{% set ns.foo = true %}</span>
    <span class="cp">{% endif %}</span>
<span class="cp">{% endfor %}</span>
<span class="c1"># FOO is {{ns.foo}}</span>
</pre></div>
</div>
<p>For detail, see
<a class="reference external" href="http://jinja.pocoo.org/docs/2.10/templates/#assignments">Jinja2 Template Designer Documentation &gt;
Assignments</a></p>
</div>
<div class="section" id="raising-exceptions">
<span id="jinja2raisingexceptions"></span><h4>9.7.6. Raising Exceptions<a class="headerlink" href="#raising-exceptions" title="Permalink to this headline">¶</a></h4>
<p>Cylc provides two functions for raising exceptions using Jinja2. These
exceptions are raised when the suite.rc file is loaded and will prevent a suite
from running.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These functions must be contained within <code class="docutils literal notranslate"><span class="pre">{{</span></code> Jinja2
blocks as opposed to <code class="docutils literal notranslate"><span class="pre">{%</span></code> blocks.</p>
</div>
<div class="section" id="raise">
<h5>9.7.6.1. Raise<a class="headerlink" href="#raise" title="Permalink to this headline">¶</a></h5>
<p>The “raise” function will result in an error containing the provided text.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="cp">{% if not VARIABLE is defined %}</span>
    <span class="cp">{{ raise(&#39;VARIABLE must be defined for this suite.&#39;) }}</span>
<span class="cp">{% endif %}</span>
</pre></div>
</div>
</div>
<div class="section" id="assert">
<h5>9.7.6.2. Assert<a class="headerlink" href="#assert" title="Permalink to this headline">¶</a></h5>
<p>The “assert” function will raise an exception containing the text provided in
the second argument providing that the first argument evaluates as False. The
following example is equivalent to the “raise” example above.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="cp">{{ assert(VARIABLE is defined, &#39;VARIABLE must be defined for this suite.&#39;) }}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="importing-additional-python-modules">
<h4>9.7.7. Importing additional Python modules<a class="headerlink" href="#importing-additional-python-modules" title="Permalink to this headline">¶</a></h4>
<p>Jinja2 allows to gather variable and macro definitions in a separate template
that can be imported into (and thus shared among) other templates.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="cp">{% import &quot;suite-utils.rc&quot; as utils %}</span>
<span class="cp">{% from &quot;suite-utils.rc&quot; import VARIABLE as ALIAS %}</span>
<span class="cp">{{ utils.VARIABLE is equalto(ALIAS)) }}</span>
</pre></div>
</div>
<p>Cylc extends this functionality to allow import of arbitrary Python modules.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="cp">{% from &quot;itertools&quot; import product %}</span>
<span class="nt">[runtime]</span>
<span class="cp">{% for group, member in product([&#39;a&#39;, &#39;b&#39;], [0, 1, 2]) %}</span>
    <span class="nt">[[</span><span class="cp">{{group}}</span><span class="nt">_</span><span class="cp">{{member}}</span><span class="nt">]]</span>
<span class="cp">{% endfor %}</span>
</pre></div>
</div>
<p>For better clarity and disambiguation Python modules can be prefixed with
<code class="docutils literal notranslate"><span class="pre">__python__</span></code>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="cp">{% from &quot;__python__.itertools&quot; import product %}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="empylabel">
<span id="id10"></span><h3>9.8. EmPy<a class="headerlink" href="#empylabel" title="Permalink to this headline">¶</a></h3>
<p>In addition to Jinja2, Cylc supports EmPy template processor in suite
configurations. Similarly to Jinja2, EmPy provides variables, mathematical
expressions, loop control structures, conditional logic, etc., that are
expanded to generate the final suite configuration seen by Cylc. See the
<a class="reference external" href="http://www.alcyone.com/software/empy">EmPy documentation</a> for more
details on its templating features and how to use them.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">EmPy is not bundled with Cylc and must be installed separately. It
should be available to Python through standard <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">em</span></code>. Please also
note that there is another Python package called “em” that provides
a conflicting module of the same name. You can run
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">check-software</span></code> command to check your installation.</p>
</div>
<p>The need for EmPy processing must be declared with a hash-bang comment as
the first line of the suite.rc file:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="ch">#!empy</span>
<span class="c1"># ...</span>
</pre></div>
</div>
<p>An example suite <code class="docutils literal notranslate"><span class="pre">empy.cities</span></code> demonstrating its use is shown below.
It is a translation of <code class="docutils literal notranslate"><span class="pre">jinja2.cities</span></code> example from
<a class="reference internal" href="#jinja"><span class="std std-ref">Jinja2</span></a> and can be directly compared against it.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1">#!EmPy</span>
<span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;EmPy city suite example.&quot;</span>
    <span class="nv">description </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Illustrates use of variables and math expressions, and programmatic</span>
<span class="s2">generation of groups of related dependencies and runtime properties.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="cp">@{</span>
<span class="cp">HOST = &quot;SuperComputer&quot;</span>
<span class="cp">CITIES = &#39;NewYork&#39;, &#39;Philadelphia&#39;, &#39;Newark&#39;, &#39;Houston&#39;, &#39;SantaFe&#39;, &#39;Chicago&#39;</span>
<span class="cp">CITYJOBS = &#39;one&#39;, &#39;two&#39;, &#39;three&#39;, &#39;four&#39;</span>
<span class="cp">LIMIT_MINS = 20</span>
<span class="cp">CLEANUP = True</span>
<span class="cp">}</span>

<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2011-08-08T12</span>
    <span class="nt">[[ dependencies ]]</span>
<span class="cp">@[ if CLEANUP ]</span>
        <span class="nt">[[[T23]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">clean</span><span class="c">&quot;</span>
<span class="cp">@[ end if ]</span>
        <span class="nt">[[[T00,T12]]]</span>
            <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
                <span class="kd">setup</span> <span class="o">=&gt;</span> <span class="kd">get_lbc</span> <span class="o">&amp;</span> <span class="kd">get_ic</span> <span class="c1"># foo</span>
<span class="cp">@[ for CITY in CITIES ]</span><span class="c c-Multi">@# comment</span>
                <span class="kd">get_lbc</span> <span class="o">=&gt;</span> <span class="cp">@(CITY)</span><span class="kd">_one</span>
                <span class="kd">get_ic</span> <span class="o">=&gt;</span> <span class="cp">@(CITY)</span><span class="kd">_two</span>
                <span class="cp">@(CITY)</span><span class="kd">_one</span> <span class="o">&amp;</span> <span class="cp">@(CITY)</span><span class="kd">_two</span> <span class="o">=&gt;</span> <span class="cp">@(CITY)</span><span class="kd">_three</span> <span class="o">&amp;</span> <span class="cp">@(CITY)</span><span class="kd">_four</span>
    <span class="cp">@[ if CLEANUP ]</span>
                <span class="cp">@(CITY)</span><span class="kd">_three</span> <span class="o">&amp;</span> <span class="cp">@(CITY)</span><span class="kd">_four</span> <span class="o">=&gt;</span> <span class="kd">cleanup</span>
    <span class="cp">@[ end if ]</span>
<span class="cp">@[ end for ]</span>
            <span class="s2">&quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[on_</span><span class="cp">@HOST</span><span class="nt"> ]]</span>
        <span class="nt">[[[remote]]]</span>
            <span class="nv">host </span><span class="o">=</span><span class="s"> </span><span class="cp">@HOST</span>
            <span class="c1"># (remote cylc directory is set in site/user config for this host)</span>
        <span class="nt">[[[directives]]]</span>
            <span class="nv">wall_clock_limit </span><span class="o">=</span><span class="s"> &quot;00:</span><span class="cp">@(LIMIT_MINS + 2)</span><span class="s">:00,00:</span><span class="cp">@(LIMIT_MINS)</span><span class="s">:00&quot;</span>

<span class="cp">@[ for CITY in CITIES ]</span>
    <span class="nt">[[ </span><span class="cp">@(CITY)</span><span class="nt"> ]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> on_</span><span class="cp">@(HOST)</span>
    <span class="cp">@[ for JOB in CITYJOBS ]</span>
    <span class="nt">[[ </span><span class="cp">@(CITY)</span><span class="nt">_</span><span class="cp">@(JOB)</span><span class="nt"> ]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> </span><span class="cp">@CITY</span>
    <span class="cp">@[ end for ]</span>
<span class="cp">@[ end for ]</span>

<span class="cp">@empy.include(&quot;./suite-visualization.rc&quot;)</span>
</pre></div>
</div>
<p>For basic usage the difference between Jinja2 and EmPy amounts to a different
markup syntax with little else to distinguish them. EmPy might be preferable,
however, in cases where more complicated processing logic have to be
implemented.</p>
<p>EmPy is a system for embedding Python expressions and statements in template
text. It makes the full power of Python language and its ecosystem easily
accessible from within the template. This might be desirable for several
reasons:</p>
<ul class="simple">
<li>no need to learn different language and its idiosyncrasies just for
writing template logic</li>
<li>availability of lambda functions, list and dictionary comprehensions
can make template code smaller and more readable compared to Jinja2</li>
<li>natural and straightforward integration with Python package ecosystem</li>
<li>no two-language barrier between writing template logic and processing
extensions makes it easier to refactor and maintain the template code
as its complexity grows - inline pieces of Python code can be
gathered into subroutines and eventually into separate modules and
packages in a seamless manner.</li>
</ul>
</div>
<div class="section" id="omitting-tasks-at-runtime">
<h3>9.9. Omitting Tasks At Runtime<a class="headerlink" href="#omitting-tasks-at-runtime" title="Permalink to this headline">¶</a></h3>
<p>It is sometimes convenient to omit certain tasks from the suite at
runtime without actually deleting their definitions from the suite.</p>
<p>Defining <code class="docutils literal notranslate"><span class="pre">[runtime]</span></code> properties for tasks that do not appear in the suite
graph results in verbose-mode validation warnings that the tasks are
disabled. They cannot be used because the suite graph is what defines
their dependencies and valid cycle points. Nevertheless, it is legal to
leave these orphaned runtime sections in the suite configuration because it
allows you to temporarily remove tasks from the suite by simply
commenting them out of the graph.</p>
<p>To omit a task from the suite at runtime but still leave it fully
defined and available for use (by insertion or <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">submit</span></code>)
use one or both of <code class="docutils literal notranslate"><span class="pre">[scheduling][[special</span> <span class="pre">task]]</span></code> lists, <em>include at
start-up</em> or <em>exclude at start-up</em> (documented in <a class="reference internal" href="index.html#iasu"><span class="std std-ref">[scheduling] -&gt; [[special tasks]] -&gt; include at start-up</span></a>
and <a class="reference internal" href="index.html#easu"><span class="std std-ref">[scheduling] -&gt; [[special tasks]] -&gt; exclude at start-up</span></a>). Then the graph still defines the
validity of the tasks and their dependencies, but they are not actually
loaded into the suite at start-up. Other tasks that depend on the
omitted ones, if any, will have to wait on their insertion at a later
time or otherwise be triggered manually.</p>
<p>Finally, with Jinja2 (<a class="reference internal" href="#jinja"><span class="std std-ref">Jinja2</span></a>) you can radically alter
suite structure by including or excluding tasks from the <code class="docutils literal notranslate"><span class="pre">[scheduling]</span></code>
and <code class="docutils literal notranslate"><span class="pre">[runtime]</span></code> sections according to the value of a single logical flag
defined at the top of the suite.</p>
</div>
<div class="section" id="naked-dummy-tasks-and-strict-validation">
<h3>9.10. Naked Dummy Tasks And Strict Validation<a class="headerlink" href="#naked-dummy-tasks-and-strict-validation" title="Permalink to this headline">¶</a></h3>
<p>A <em>naked dummy task</em> appears in the suite graph but has no
explicit runtime configuration section. Such tasks automatically
inherit the default “dummy task” configuration from the root
namespace. This is very useful because it allows functional suites to
be mocked up quickly for test and demonstration purposes by simply
defining the graph. It is somewhat dangerous, however, because there
is no way to distinguish an intentional naked dummy task from one
generated by typographic error: misspelling a task name in the graph
results in a new naked dummy task replacing the intended task in the
affected trigger expression; and misspelling a task name in a runtime
section heading results in the intended task becoming a dummy task
itself (by divorcing it from its intended runtime config section).</p>
<p>To avoid this problem any dummy task used in a real suite should not be
naked - i.e. it should have an explicit entry in under the runtime
section of the suite configuration, even if the section is empty. This
results in exactly the same dummy task behaviour, via implicit
inheritance from root, but it allows use of
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">validate</span> <span class="pre">--strict</span></code>
to catch errors in task names by failing the suite if any naked dummy
tasks are detected.</p>
<table class="docutils footnote" frame="void" id="id11" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[1]</a></td><td>An OR operator on the right doesn’t make much sense: if “B or C”
triggers off A, what exactly should cylc do when A finishes?</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[2]</a></td><td>In NWP forecast analysis suites parts of the observation
processing and data assimilation subsystem will typically also
depend on model background fields generated by the previous forecast.</td></tr>
</tbody>
</table>
</div>
</div>
<span id="document-task-implementation"></span><div class="section" id="task-implementation">
<span id="taskimplementation"></span><h2>10. Task Implementation<a class="headerlink" href="#task-implementation" title="Permalink to this headline">¶</a></h2>
<p>Existing scripts and executables can be used as cylc tasks without modification
so long as they return standard exit status - zero on success, non-zero
for failure - and do not spawn detaching processes internally
(see <a class="reference internal" href="#detachingjobs"><span class="std std-ref">Avoid Detaching Processes</span></a>).</p>
<div class="section" id="task-job-scripts">
<span id="jobscripts"></span><h3>10.1. Task Job Scripts<a class="headerlink" href="#task-job-scripts" title="Permalink to this headline">¶</a></h3>
<p>When the suite server program determines that a task is ready to run it
generates a <em>job script</em> for the task, and submits it to run (see
<a class="reference internal" href="index.html#taskjobsubmission"><span class="std std-ref">Task Job Submission and Management</span></a>).</p>
<p>Job scripts encapsulate configured task runtime settings: <code class="docutils literal notranslate"><span class="pre">script</span></code> and
<code class="docutils literal notranslate"><span class="pre">environment</span></code> items, if defined, are just concatenated in the order shown in
<a class="reference internal" href="#fig-anatomy-of-a-job-script"><span class="std std-numref">Fig. 35</span></a>, to make the job script. Everything
executes in the same shell, so each part of the script can potentially affect
the environment of subsequent parts.</p>
<div class="figure align-center" id="id1">
<span id="fig-anatomy-of-a-job-script"></span><img alt="_images/anatomy-of-a-job-script.png" src="_images/anatomy-of-a-job-script.png" />
<p class="caption"><span class="caption-number">Fig. 35 </span><span class="caption-text">The order in which task runtime script and environment configuration items
are combined, in the same shell, to create a task job script. <code class="docutils literal notranslate"><span class="pre">cylc-env</span></code>
represents Cylc-defined environment variables, and <code class="docutils literal notranslate"><span class="pre">user-env</span></code> user-defined
variables from the task <code class="docutils literal notranslate"><span class="pre">[environment]</span></code> section. (Note this is not a suite
dependency graph).</span></p>
</div>
<p>Task job scripts are written to the suite’s job log directory. They can be
printed with <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">cat-log</span></code> or generated and printed with
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">jobscript</span></code>.</p>
</div>
<div class="section" id="inlined-tasks">
<h3>10.2. Inlined Tasks<a class="headerlink" href="#inlined-tasks" title="Permalink to this headline">¶</a></h3>
<p>Task <em>script</em> items can be multi-line strings of <code class="docutils literal notranslate"><span class="pre">bash</span></code>  code, so
many tasks can be entirely inlined in the suite.rc file. For anything more than
a few lines of code, however, we recommend using external shell scripts to allow
independent testing, re-use, and shell mode editing.</p>
</div>
<div class="section" id="task-messages">
<h3>10.3. Task Messages<a class="headerlink" href="#task-messages" title="Permalink to this headline">¶</a></h3>
<p>Tasks messages can be sent back to the suite server program to report completed
outputs and arbitrary messages of different severity levels.</p>
<p>Some types of message - in addition to events like task failure -  can
optionally trigger execution of event handlers in the suite server program
(see <a class="reference internal" href="index.html#eventhandling"><span class="std std-ref">Task Event Handling</span></a>).</p>
<p>Normal severity messages are printed to <code class="docutils literal notranslate"><span class="pre">job.out</span></code> and logged by the
suite server program:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cylc message -- <span class="s2">&quot;</span><span class="si">${</span><span class="nv">CYLC_SUITE_NAME</span><span class="si">}</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">CYLC_TASK_JOB</span><span class="si">}</span><span class="s2">&quot;</span> <span class="se">\</span>
  <span class="s2">&quot;Hello from </span><span class="si">${</span><span class="nv">CYLC_TASK_ID</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>CUSTOM severity messages are printed to <code class="docutils literal notranslate"><span class="pre">job.out</span></code>, logged by the
suite server program, and can be used to trigger <em>custom</em>
event handlers:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cylc message -- <span class="s2">&quot;</span><span class="si">${</span><span class="nv">CYLC_SUITE_NAME</span><span class="si">}</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">CYLC_TASK_JOB</span><span class="si">}</span><span class="s2">&quot;</span> <span class="se">\</span>
  <span class="s2">&quot;CUSTOM:data available for </span><span class="si">${</span><span class="nv">CYLC_TASK_CYCLE_POINT</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>Custom severity messages and event handlers can be used to signal special
events that are neither routine information or an error condition, such as
production of a particular data file. Task output messages, used for triggering
other tasks, can also be sent with custom severity if need be.</p>
<p>WARNING severity messages are printed to <code class="docutils literal notranslate"><span class="pre">job.err</span></code>, logged by the
suite server program, and can be passed to <em>warning</em> event handlers:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cylc message -- <span class="s2">&quot;</span><span class="si">${</span><span class="nv">CYLC_SUITE_NAME</span><span class="si">}</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">CYLC_TASK_JOB</span><span class="si">}</span><span class="s2">&quot;</span> <span class="se">\</span>
  <span class="s2">&quot;WARNING:Uh-oh, something&#39;s not right here.&quot;</span>
</pre></div>
</div>
<p>CRITICAL severity messages are printed to <code class="docutils literal notranslate"><span class="pre">job.err</span></code>, logged by the
suite server program, and can be passed to <em>critical</em> event handlers:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cylc message -- <span class="s2">&quot;</span><span class="si">${</span><span class="nv">CYLC_SUITE_NAME</span><span class="si">}</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">CYLC_TASK_JOB</span><span class="si">}</span><span class="s2">&quot;</span> <span class="se">\</span>
  <span class="s2">&quot;CRITICAL:ERROR occurred in process X!&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="aborting-job-scripts-on-error">
<h3>10.4. Aborting Job Scripts on Error<a class="headerlink" href="#aborting-job-scripts-on-error" title="Permalink to this headline">¶</a></h3>
<p>Task job scripts use <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">-x</span></code> to abort on any error, and
trap ERR, EXIT, and SIGTERM to send task failed messages back to the
suite server program before aborting. Other scripts called from job scripts
should therefore abort with standard non-zero exit status on error, to trigger
the job script error trap.</p>
<p>To prevent a command that is expected to generate a non-zero exit status from
triggering the exit trap, protect it with a control statement such as:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> cmp FILE1 FILE2<span class="p">;</span> <span class="k">then</span>
    :  <span class="c1"># success: do stuff</span>
<span class="k">else</span>
    :  <span class="c1"># failure: do other stuff</span>
<span class="k">fi</span>
</pre></div>
</div>
<p>Task job scripts also use <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">-u</span></code> to abort on referencing any
undefined variable (useful for picking up typos); and <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">-o</span> <span class="pre">pipefail</span></code>
to abort if any part of a pipe fails (by default the shell only returns the
exit status of the final command in a pipeline).</p>
<div class="section" id="custom-failure-messages">
<h4>10.4.1. Custom Failure Messages<a class="headerlink" href="#custom-failure-messages" title="Permalink to this headline">¶</a></h4>
<p>Critical events normally warrant aborting a job script rather than just sending
a message. As described just above, <code class="docutils literal notranslate"><span class="pre">exit</span> <span class="pre">1</span></code> or any failing command
not protected by the surrounding scripting will cause a job script to abort and
report failure to the suite server program, potentially triggering a
<em>failed</em> task event handler.</p>
<p>For failures detected by the scripting you could send a critical message back
before aborting, potentially triggering a <em>critical</em> task event handler:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> ! /bin/false<span class="p">;</span> <span class="k">then</span>
  cylc message -- <span class="s2">&quot;</span><span class="si">${</span><span class="nv">CYLC_SUITE_NAME</span><span class="si">}</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">CYLC_TASK_JOB</span><span class="si">}</span><span class="s2">&quot;</span> <span class="se">\</span>
    <span class="s2">&quot;CRITICAL:ERROR: /bin/false failed!&quot;</span>
  <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>
</pre></div>
</div>
<p>To abort a job script with a custom message that can be passed to a
<em>failed</em> task event handler, use the built-in <code class="docutils literal notranslate"><span class="pre">cylc__job_abort</span></code> shell
function:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> ! /bin/false<span class="p">;</span> <span class="k">then</span>
  cylc__job_abort <span class="s2">&quot;ERROR: /bin/false failed!&quot;</span>
<span class="k">fi</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="avoid-detaching-processes">
<span id="detachingjobs"></span><h3>10.5. Avoid Detaching Processes<a class="headerlink" href="#avoid-detaching-processes" title="Permalink to this headline">¶</a></h3>
<p>If a task script starts background sub-processes and does not wait on them, or
internally submits jobs to a batch scheduler and then exits immediately, the
detached processes will not be visible to cylc and the task will appear to
finish when the top-level script finishes. You will need to modify scripts
like this to make them execute all sub-processes in the foreground (or use the
shell <code class="docutils literal notranslate"><span class="pre">wait</span></code> command to wait on them before exiting) and to prevent
job submission commands from returning before the job completes (e.g.
<code class="docutils literal notranslate"><span class="pre">llsubmit</span> <span class="pre">-s</span></code> for Loadleveler,
<code class="docutils literal notranslate"><span class="pre">qsub</span> <span class="pre">-sync</span> <span class="pre">yes</span></code> for Sun Grid Engine, and
<code class="docutils literal notranslate"><span class="pre">qsub</span> <span class="pre">-W</span> <span class="pre">block=true</span></code> for PBS).</p>
<p>If this is not possible - perhaps you don’t have control over the script
or can’t work out how to fix it - one alternative approach is to use another
task to repeatedly poll for the results of the detached processes:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">model</span> <span class="o">=&gt;</span> <span class="kd">checker</span> <span class="o">=&gt;</span> <span class="kd">post</span><span class="c">-</span><span class="kd">proc</span><span class="c">&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[model]]</span>
        <span class="c1"># Uh-oh, this script does an internal job submission to run model.exe:</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;run-model.sh&quot;</span>
    <span class="nt">[[checker]]</span>
        <span class="c1"># Fail and retry every minute (for 10 tries at the most) if model&#39;s</span>
        <span class="c1"># job.done indicator file does not exist yet.</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;[[ ! -f $RUN_DIR/job.done ]] &amp;&amp; exit 1&quot;</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">execution retry delays </span><span class="o">=</span><span class="s"> 10 * PT1M</span>
</pre></div>
</div>
</div>
</div>
<span id="document-task-job-submission"></span><div class="section" id="task-job-submission-and-management">
<span id="taskjobsubmission"></span><h2>11. Task Job Submission and Management<a class="headerlink" href="#task-job-submission-and-management" title="Permalink to this headline">¶</a></h2>
<p>For the requirements a command, script, or program, must fulfill in order
to function as a cylc task, see <a class="reference internal" href="index.html#taskimplementation"><span class="std std-ref">Task Implementation</span></a>.
This section explains how tasks are submitted by the suite server program when
they are ready to run, and how to define new batch system handlers.</p>
<p>When a task is ready cylc generates a job script (see <a class="reference internal" href="index.html#jobscripts"><span class="std std-ref">Task Job Scripts</span></a>). The
job script is submitted to run by the <em>batch system</em> chosen for
the task. Different tasks can use different batch systems.  Like
other runtime properties, you can set a suite default batch system and
override it for specific tasks or families:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
   <span class="nt">[[root]]</span> <span class="c1"># suite defaults</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> loadleveler</span>
   <span class="nt">[[foo]]</span> <span class="c1"># just task foo</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> at</span>
</pre></div>
</div>
<div class="section" id="supported-job-submission-methods">
<span id="availablemethods"></span><h3>11.1. Supported Job Submission Methods<a class="headerlink" href="#supported-job-submission-methods" title="Permalink to this headline">¶</a></h3>
<p>Cylc supports a number of commonly used batch systems.
See <a class="reference internal" href="#customjobsubmissionmethods"><span class="std std-ref">Custom Job Submission Methods</span></a> for how to add new job
submission methods.</p>
<div class="section" id="background">
<h4>11.1.1. background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h4>
<p>Runs task job scripts as Unix background processes.</p>
<p>If an execution time limit is specified for a task, its job will be wrapped
by the <code class="docutils literal notranslate"><span class="pre">timeout</span></code> command.</p>
</div>
<div class="section" id="at">
<h4>11.1.2. at<a class="headerlink" href="#at" title="Permalink to this headline">¶</a></h4>
<p>Submits task job scripts to the rudimentary Unix <code class="docutils literal notranslate"><span class="pre">at</span></code> scheduler. The
<code class="docutils literal notranslate"><span class="pre">atd</span></code> daemon must be running.</p>
<p>If an execution time limit is specified for a task, its job will be wrapped
by the <code class="docutils literal notranslate"><span class="pre">timeout</span></code> command.</p>
</div>
<div class="section" id="loadleveler">
<h4>11.1.3. loadleveler<a class="headerlink" href="#loadleveler" title="Permalink to this headline">¶</a></h4>
<p>Submits task job scripts to loadleveler by the <code class="docutils literal notranslate"><span class="pre">llsubmit</span></code> command.
Loadleveler directives can be provided in the suite.rc file:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[my_task]]</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> loadleveler</span>
            <span class="nv">execution time limit </span><span class="o">=</span><span class="s"> PT10M</span>
        <span class="nt">[[[directives]]]</span>
            <span class="nv">foo </span><span class="o">=</span><span class="s"> bar</span>
            <span class="nv">baz </span><span class="o">=</span><span class="s"> qux</span>
</pre></div>
</div>
<p>These are written to the top of the task job script like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># DIRECTIVES</span>
<span class="c1"># @ foo = bar</span>
<span class="c1"># @ baz = qux</span>
<span class="c1"># @ wall_clock_limit = 660,600</span>
<span class="c1"># @ queue</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">restart=yes</span></code> is specified as a directive for loadleveler, the job will
automatically trap SIGUSR1, which loadleveler may use to preempt the job. On
trapping SIGUSR1, the job will inform the suite that it has been vacated by
loadleveler. This will put it back to the submitted state, until it starts
running again.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">execution</span> <span class="pre">time</span> <span class="pre">limit</span></code> is specified, it is used to generate the
<code class="docutils literal notranslate"><span class="pre">wall_clock_limit</span></code> directive. The setting is assumed to be the soft
limit. The hard limit will be set by adding an extra minute to the soft limit.
Do not specify the <code class="docutils literal notranslate"><span class="pre">wall_clock_limit</span></code> directive explicitly if
<code class="docutils literal notranslate"><span class="pre">execution</span> <span class="pre">time</span> <span class="pre">limit</span></code> is specified. Otherwise, the execution time
limit known by the suite may be out of sync with what is submitted to the batch
system.</p>
</div>
<div class="section" id="lsf">
<h4>11.1.4. lsf<a class="headerlink" href="#lsf" title="Permalink to this headline">¶</a></h4>
<p>Submits task job scripts to IBM Platform LSF by the <code class="docutils literal notranslate"><span class="pre">bsub</span></code> command.
LSF directives can be provided in the suite.rc file:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[my_task]]</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> lsf</span>
            <span class="nv">execution time limit </span><span class="o">=</span><span class="s"> PT10M</span>
        <span class="nt">[[[directives]]]</span>
            <span class="nv">-q </span><span class="o">=</span><span class="s"> foo</span>
</pre></div>
</div>
<p>These are written to the top of the task job script like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># DIRECTIVES</span>
<span class="c1">#BSUB -q = foo</span>
<span class="c1">#BSUB -W = 10</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">execution</span> <span class="pre">time</span> <span class="pre">limit</span></code> is specified, it is used to generate the
<code class="docutils literal notranslate"><span class="pre">-W</span></code> directive. Do not specify the <code class="docutils literal notranslate"><span class="pre">-W</span></code> directive
explicitly if <code class="docutils literal notranslate"><span class="pre">execution</span> <span class="pre">time</span> <span class="pre">limit</span></code> is specified. Otherwise, the
execution time limit known by the suite may be out of sync with what is
submitted to the batch system.</p>
</div>
<div class="section" id="pbs">
<h4>11.1.5. pbs<a class="headerlink" href="#pbs" title="Permalink to this headline">¶</a></h4>
<p>Submits task job scripts to PBS (or Torque) by the <code class="docutils literal notranslate"><span class="pre">qsub</span></code> command.
PBS directives can be provided in the suite.rc file:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[my_task]]</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> pbs</span>
            <span class="nv">execution time limit </span><span class="o">=</span><span class="s"> PT1M</span>
        <span class="nt">[[[directives]]]</span>
            <span class="nv">-V </span><span class="o">=</span>
            <span class="nv">-q </span><span class="o">=</span><span class="s"> foo</span>
            <span class="nv">-l nodes </span><span class="o">=</span><span class="s"> 1</span>
</pre></div>
</div>
<p>These are written to the top of the task job script like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># DIRECTIVES</span>
<span class="c1">#PBS -V</span>
<span class="c1">#PBS -q foo</span>
<span class="c1">#PBS -l nodes=1</span>
<span class="c1">#PBS -l walltime=60</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">execution</span> <span class="pre">time</span> <span class="pre">limit</span></code> is specified, it is used to generate the
<code class="docutils literal notranslate"><span class="pre">-l</span> <span class="pre">walltime</span></code> directive. Do not specify the <code class="docutils literal notranslate"><span class="pre">-l</span> <span class="pre">walltime</span></code>
directive explicitly if <code class="docutils literal notranslate"><span class="pre">execution</span> <span class="pre">time</span> <span class="pre">limit</span></code> is specified.
Otherwise, the execution time limit known by the suite may be out of sync with
what is submitted to the batch system.</p>
</div>
<div class="section" id="moab">
<h4>11.1.6. moab<a class="headerlink" href="#moab" title="Permalink to this headline">¶</a></h4>
<p>Submits task job scripts to the Moab workload manager by the <code class="docutils literal notranslate"><span class="pre">msub</span></code>
command.  Moab directives can be provided in the suite.rc file; the syntax is
very similar to PBS:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[my_task]]</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> moab</span>
            <span class="nv">execution time limit </span><span class="o">=</span><span class="s"> PT1M</span>
        <span class="nt">[[[directives]]]</span>
            <span class="nv">-V </span><span class="o">=</span>
            <span class="nv">-q </span><span class="o">=</span><span class="s"> foo</span>
            <span class="nv">-l nodes </span><span class="o">=</span><span class="s"> 1</span>
</pre></div>
</div>
<p>These are written to the top of the task job script like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># DIRECTIVES</span>
<span class="c1">#PBS -V</span>
<span class="c1">#PBS -q foo</span>
<span class="c1">#PBS -l nodes=1</span>
<span class="c1">#PBS -l walltime=60</span>
</pre></div>
</div>
<p>(Moab understands <code class="docutils literal notranslate"><span class="pre">#PBS</span></code> directives).</p>
<p>If <code class="docutils literal notranslate"><span class="pre">execution</span> <span class="pre">time</span> <span class="pre">limit</span></code> is specified, it is used to generate the
<code class="docutils literal notranslate"><span class="pre">-l</span> <span class="pre">walltime</span></code> directive. Do not specify the <code class="docutils literal notranslate"><span class="pre">-l</span> <span class="pre">walltime</span></code>
directive explicitly if <code class="docutils literal notranslate"><span class="pre">execution</span> <span class="pre">time</span> <span class="pre">limit</span></code> is specified.
Otherwise, the execution time limit known by the suite may be out of sync with
what is submitted to the batch system.</p>
</div>
<div class="section" id="sge">
<h4>11.1.7. sge<a class="headerlink" href="#sge" title="Permalink to this headline">¶</a></h4>
<p>Submits task job scripts to Sun/Oracle Grid Engine by the <code class="docutils literal notranslate"><span class="pre">qsub</span></code>
command.  SGE directives can be provided in the suite.rc file:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[my_task]]</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> sge</span>
            <span class="nv">execution time limit </span><span class="o">=</span><span class="s"> P1D</span>
        <span class="nt">[[[directives]]]</span>
            <span class="nv">-cwd </span><span class="o">=</span>
            <span class="nv">-q </span><span class="o">=</span><span class="s"> foo</span>
            <span class="nv">-l h_data </span><span class="o">=</span><span class="s"> 1024M</span>
            <span class="nv">-l h_rt </span><span class="o">=</span><span class="s"> 24:00:00</span>
</pre></div>
</div>
<p>These are written to the top of the task job script like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># DIRECTIVES</span>
<span class="c1">#$ -cwd</span>
<span class="c1">#$ -q foo</span>
<span class="c1">#$ -l h_data=1024M</span>
<span class="c1">#$ -l h_rt=24:00:00</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">execution</span> <span class="pre">time</span> <span class="pre">limit</span></code> is specified, it is used to generate the
<code class="docutils literal notranslate"><span class="pre">-l</span> <span class="pre">h_rt</span></code> directive. Do not specify the <code class="docutils literal notranslate"><span class="pre">-l</span> <span class="pre">h_rt</span></code>
directive explicitly if <code class="docutils literal notranslate"><span class="pre">execution</span> <span class="pre">time</span> <span class="pre">limit</span></code> is specified.
Otherwise, the execution time limit known by the suite may be out of sync with
what is submitted to the batch system.</p>
</div>
<div class="section" id="slurm">
<h4>11.1.8. slurm<a class="headerlink" href="#slurm" title="Permalink to this headline">¶</a></h4>
<p>Submits task job scripts to Simple Linux Utility for Resource Management by the
<code class="docutils literal notranslate"><span class="pre">sbatch</span></code> command. SLURM directives can be provided in the suite.rc file:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[my_task]]</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> slurm</span>
            <span class="nv">execution time limit </span><span class="o">=</span><span class="s"> PT1H</span>
        <span class="nt">[[[directives]]]</span>
            <span class="nv">--nodes </span><span class="o">=</span><span class="s"> 5</span>
            <span class="nv">--account </span><span class="o">=</span><span class="s"> QXZ5W2</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Since not all SLURM commands have a short form, cylc requires
the long form directives.</p>
</div>
<p>These are written to the top of the task job script like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --nodes=5</span>
<span class="c1">#SBATCH --time=60:00</span>
<span class="c1">#SBATCH --account=QXZ5W2</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">execution</span> <span class="pre">time</span> <span class="pre">limit</span></code> is specified, it is used to generate the
<code class="docutils literal notranslate"><span class="pre">--time</span></code> directive. Do not specify the <code class="docutils literal notranslate"><span class="pre">--time</span></code>
directive explicitly if <code class="docutils literal notranslate"><span class="pre">execution</span> <span class="pre">time</span> <span class="pre">limit</span></code> is specified.
Otherwise, the execution time limit known by the suite may be out of sync with
what is submitted to the batch system.</p>
<p>Cylc supports heterogeneous Slurm jobs via special numbered directive prefixes
that distinguish repeated directives from one another:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="c1"># run two heterogenous job components:</span>
    <span class="nv">script </span><span class="o">=</span><span class="s"> srun sleep 10 : sleep 30</span>
    <span class="nt">[[my_task]]</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> slurm</span>
            <span class="nv">execution time limit </span><span class="o">=</span><span class="s"> PT1H</span>
        <span class="nt">[[[directives]]]</span>
            <span class="nv">--account </span><span class="o">=</span><span class="s"> QXZ5W2</span>
            <span class="nv">hetjob_0_--mem </span><span class="o">=</span><span class="s"> 1G</span>  <span class="c1"># first prefix must be &quot;0&quot;</span>
            <span class="nv">hetjob_0_--nodes </span><span class="o">=</span><span class="s"> 3</span>
            <span class="nv">hetjob_1_--mem </span><span class="o">=</span><span class="s"> 2G</span>
            <span class="nv">hetjob_1_--nodes </span><span class="o">=</span><span class="s"> 6</span>
</pre></div>
</div>
<p>The resulting formatted directives are:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --time=60:00</span>
<span class="c1">#SBATCH --account=QXZ5W2</span>
<span class="c1">#SBATCH --mem=1G</span>
<span class="c1">#SBATCH --nodes=3</span>
<span class="c1">#SBATCH hetjob</span>
<span class="c1">#SBATCH --mem=2G</span>
<span class="c1">#SBATCH --nodes=6</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For older Slurm versions with <em>packjob</em> instead of <em>hetjob</em>, use
<code class="docutils literal notranslate"><span class="pre">batch</span> <span class="pre">system</span> <span class="pre">=</span> <span class="pre">slurm_packjob</span></code> and directive prefixes <code class="docutils literal notranslate"><span class="pre">packjob_0_</span></code> etc.</p>
</div>
</div>
<div class="section" id="default-directives-provided">
<h4>11.1.9. Default Directives Provided<a class="headerlink" href="#default-directives-provided" title="Permalink to this headline">¶</a></h4>
<p>For batch systems that use job file directives (PBS, Loadleveler,
etc.) default directives are provided to set the job name, stdout and stderr
file paths, and the execution time limit (if specified).</p>
<p>Cylc constructs the job name string using a combination of the task ID and the
suite name. PBS fails a job submit if the job name in <code class="docutils literal notranslate"><span class="pre">-N</span> <span class="pre">name</span></code> is
too long. For version 12 or below, this is 15 characters. For version 13, this
is 236 characters. The default setting will truncate the job name string to 15
characters. If you have PBS 13 at your site, you should modify your site’s
global configuration file to allow the job name to be longer. (See also
<a class="reference internal" href="index.html#jobnamelengthmaximum"><span class="std std-ref">[hosts] -&gt; [[HOST]] -&gt; [[[batch systems]]] -&gt; [[[[SYSTEM]]]] -&gt; job name length maximum</span></a>.) For example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[hosts]</span>
    <span class="nt">[[myhpc*]]</span>
        <span class="nt">[[[batch systems]]]</span>
            <span class="nt">[[[[pbs]]]]</span>
                <span class="c1"># PBS 13</span>
                <span class="nv">job name length maximum </span><span class="o">=</span><span class="s"> 236</span>
</pre></div>
</div>
</div>
<div class="section" id="directives-section-quirks-pbs-sge">
<h4>11.1.10. Directives Section Quirks (PBS, SGE, …)<a class="headerlink" href="#directives-section-quirks-pbs-sge" title="Permalink to this headline">¶</a></h4>
<p>To specify an option with no argument, such as <code class="docutils literal notranslate"><span class="pre">-V</span></code> in PBS or
<code class="docutils literal notranslate"><span class="pre">-cwd</span></code> in SGE you must give a null string as the directive value in
the suite.rc file.</p>
<p>The left hand side of a setting (i.e. the string before the first equal sign)
must be unique. To specify multiple values using an option such as
<code class="docutils literal notranslate"><span class="pre">-l</span></code> option in PBS, SGE, etc., either specify all items in a single
line:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-l=select=28:ncpus=36:mpiprocs=18:ompthreads=2:walltime=12:00:00
</pre></div>
</div>
<p>(Left hand side is <code class="docutils literal notranslate"><span class="pre">-l</span></code>. A second <code class="docutils literal notranslate"><span class="pre">-l=...</span></code> line will
override the first.)</p>
<p>Or separate the items:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-l select=28
-l ncpus=36
-l mpiprocs=18
-l ompthreads=2
-l walltime=12:00:00
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There is no equal sign after <code class="docutils literal notranslate"><span class="pre">-l</span></code>.</p>
</div>
<p>(Left hand sides are now <code class="docutils literal notranslate"><span class="pre">-l</span> <span class="pre">select</span></code>, <code class="docutils literal notranslate"><span class="pre">-l</span> <span class="pre">ncpus</span></code>, etc.)</p>
</div>
</div>
<div class="section" id="task-stdout-and-stderr-logs">
<span id="whitherstdoutandstderr"></span><h3>11.2. Task stdout And stderr Logs<a class="headerlink" href="#task-stdout-and-stderr-logs" title="Permalink to this headline">¶</a></h3>
<p>When a task is ready to run cylc generates a filename root to be used
for the task job script and log files. The filename containing the task
name, cycle point, and a submit number that increments if the same task is
re-triggered multiple times:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># task job script:</span>
~/cylc-run/tut/oneoff/basic/log/job/1/hello/01/job
<span class="c1"># task stdout:</span>
~/cylc-run/tut/oneoff/basic/log/job/1/hello/01/job.out
<span class="c1"># task stderr:</span>
~/cylc-run/tut/oneoff/basic/log/job/1/hello/01/job.err
</pre></div>
</div>
<p>How the stdout and stderr streams are directed into these files depends
on the batch system. The <code class="docutils literal notranslate"><span class="pre">background</span></code> method just uses
appropriate output redirection on the command line, as shown above. The
<code class="docutils literal notranslate"><span class="pre">loadleveler</span></code> method writes appropriate directives to the job
script that is submitted to loadleveler.</p>
<p>Cylc obviously has no control over the stdout and stderr output from
tasks that do their own internal output management (e.g. tasks
that submit internal jobs and direct the associated output to other
files). For less internally complex tasks, however, the files referred
to here will be complete task job logs.</p>
<p>Some batch systems, such as <code class="docutils literal notranslate"><span class="pre">pbs</span></code>, redirect a job’s stdout
and stderr streams to a separate cache area while the job is running. The
contents are only copied to the normal locations when the job completes. This
means that <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">cat-log</span></code> or the gcylc GUI will be unable to find the
job’s stdout and stderr streams while the job is running. Some sites with these
batch systems are known to provide commands for viewing and/or
tail-follow a job’s stdout and stderr streams that are redirected to these
cache areas. If this is the case at your site, you can configure cylc to make
use of the provided commands by adding some settings to the global site/user
config. E.g.:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[hosts]</span>
    <span class="nt">[[HOST]]</span>  <span class="c1"># &lt;= replace this with a real host name</span>
        <span class="nt">[[[batch systems]]]</span>
            <span class="nt">[[[[pbs]]]]</span>
                <span class="nv">err tailer </span><span class="o">=</span><span class="s"> qcat -f -e \%(job_id)s</span>
                <span class="nv">out tailer </span><span class="o">=</span><span class="s"> qcat -f -o \%(job_id)s</span>
                <span class="nv">err viewer </span><span class="o">=</span><span class="s"> qcat -e \%(job_id)s</span>
                <span class="nv">out viewer </span><span class="o">=</span><span class="s"> qcat -o \%(job_id)s</span>
</pre></div>
</div>
</div>
<div class="section" id="overriding-the-job-submission-command">
<span id="commandtemplate"></span><h3>11.3. Overriding The Job Submission Command<a class="headerlink" href="#overriding-the-job-submission-command" title="Permalink to this headline">¶</a></h3>
<p>To change the form of the actual command used to submit a job you do not
need to define a new batch system handler; just override the
<code class="docutils literal notranslate"><span class="pre">command</span> <span class="pre">template</span></code> in the relevant job submission sections of
your suite.rc file:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> loadleveler</span>
            <span class="c1"># Use &#39;-s&#39; to stop llsubmit returning</span>
            <span class="c1"># until all job steps have completed:</span>
            <span class="nv">batch submit command template </span><span class="o">=</span><span class="s"> llsubmit -s %(job)s</span>
</pre></div>
</div>
<p>As explained in <a class="reference internal" href="index.html#suitercreference"><span class="std std-ref">Suite.rc Reference</span></a>
the template’s %(job)s will be substituted by the job file path.</p>
</div>
<div class="section" id="job-polling">
<h3>11.4. Job Polling<a class="headerlink" href="#job-polling" title="Permalink to this headline">¶</a></h3>
<p>For supported batch systems, one-way polling can be used to determine actual
job status: the suite server program executes a process on the task host, by
non-interactive ssh, to interrogate the batch queueing system there, and to
read a <em>status file</em> that is automatically generated by the task job script
as it runs.</p>
<p>Polling may be required to update the suite state correctly after unusual
events such as a machine being rebooted with tasks running on it, or network
problems that prevent task messages from getting back to the suite host.</p>
<p>Tasks can be polled on demand by right-clicking on them in gcylc or using the
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">poll</span></code> command.</p>
<p>Tasks are polled automatically, once, if they timeout while queueing in a
batch scheduler and submission timeout is set. (See <a class="reference internal" href="index.html#taskeventhandling"><span class="std std-ref">[runtime] -&gt; [[__NAME__]] -&gt; [[[events]]]</span></a>
for how to configure timeouts).</p>
<p>Tasks are polled multiple times, where necessary, when they exceed their
execution time limits. These are normally set with some initial delays to allow
the batch systems to kill the jobs.
(See <a class="reference internal" href="index.html#executiontimelimitpollingintervals"><span class="std std-ref">[hosts] -&gt; [[HOST]] -&gt; [[[batch systems]]] -&gt; [[[[SYSTEM]]]] -&gt; execution time limit polling intervals</span></a> for how to configure the polling
intervals).</p>
<p>Any tasks recorded in the <em>submitted</em> or <em>running</em> states at suite
restart are automatically polled to determine what happened to them while the
suite was down.</p>
<p>Regular polling can also be configured as a health check on tasks submitted to
hosts that are known to be flaky, or as the sole method of determining task
status on hosts that do not allow task messages to be routed back to the suite
host.</p>
<p>To use polling instead of task-to-suite messaging set
<code class="docutils literal notranslate"><span class="pre">task</span> <span class="pre">communication</span> <span class="pre">method</span> <span class="pre">=</span> <span class="pre">poll</span></code>
in cylc site and user global config (see <a class="reference internal" href="index.html#task-comms-method"><span class="std std-ref">[hosts] -&gt; [[HOST]] -&gt; task communication method</span></a>).
The default polling intervals can be overridden for all suites there too
(see <a class="reference internal" href="index.html#submission-polling"><span class="std std-ref">[hosts] -&gt; [[HOST]] -&gt; submission polling intervals</span></a> and <a class="reference internal" href="index.html#execution-polling"><span class="std std-ref">[hosts] -&gt; [[HOST]] -&gt; execution polling intervals</span></a>), or in specific
suite configurations (in which case polling will be done regardless of the
task communication method configured for the host;
see <a class="reference internal" href="index.html#submissionpollingintervals"><span class="std std-ref">[runtime] -&gt; [[__NAME__]] -&gt; [[[job]]] -&gt; submission polling intervals</span></a> and <a class="reference internal" href="index.html#executionpollingintervals"><span class="std std-ref">[runtime] -&gt; [[__NAME__]] -&gt; [[[job]]] -&gt; execution polling intervals</span></a>).</p>
<p>Note that regular polling is not as efficient as task messaging in updating
task status, and it should be used sparingly in large suites.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For polling to work correctly, the batch queueing system must have a
job listing command for listing your jobs, and that the job listing must
display job IDs as they are returned by the batch queueing system submit
command. For example, for pbs, moab and sge, the <code class="docutils literal notranslate"><span class="pre">qstat</span></code> command
should list jobs with their IDs displayed in exactly the same format as they
are returned by the <code class="docutils literal notranslate"><span class="pre">qsub</span></code> command.</p>
</div>
</div>
<div class="section" id="job-killing">
<h3>11.5. Job Killing<a class="headerlink" href="#job-killing" title="Permalink to this headline">¶</a></h3>
<p>For supported batch systems, the suite server program can execute a process on
the task host, by non-interactive ssh, to kill a submitted or running job
according to its batch system.</p>
<p>Tasks can be killed on demand by right-clicking on them in gcylc or using the
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">kill</span></code> command.</p>
</div>
<div class="section" id="execution-time-limit">
<h3>11.6. Execution Time Limit<a class="headerlink" href="#execution-time-limit" title="Permalink to this headline">¶</a></h3>
<p>You can specify an <code class="docutils literal notranslate"><span class="pre">execution</span> <span class="pre">time</span> <span class="pre">limit</span></code> for all supported job
submission methods. E.g.:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[task-x]]</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">execution time limit </span><span class="o">=</span><span class="s"> PT1H</span>
</pre></div>
</div>
<p>For tasks running with <code class="docutils literal notranslate"><span class="pre">background</span></code> or <code class="docutils literal notranslate"><span class="pre">at</span></code>, their jobs
will be wrapped using the <code class="docutils literal notranslate"><span class="pre">timeout</span></code> command. For all other methods,
the relevant time limit directive will be added to their job files.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">execution</span> <span class="pre">time</span> <span class="pre">limit</span></code> setting will also inform the suite when a
a task job should complete by. If a task job has not reported completing within
the specified time, the suite will poll the task job. (The default
setting is PT1M, PT2M, PT7M. The accumulated times for these intervals will be
roughly 1 minute, 1 + 2 = 3 minutes and 1 + 2 + 7 = 10 minutes after a task job
exceeds its execution time limit.)</p>
<div class="section" id="execution-time-limit-and-execution-timeout">
<h4>11.6.1. Execution Time Limit and Execution Timeout<a class="headerlink" href="#execution-time-limit-and-execution-timeout" title="Permalink to this headline">¶</a></h4>
<p>If you specify an <code class="docutils literal notranslate"><span class="pre">execution</span> <span class="pre">time</span> <span class="pre">limit</span></code> the
<code class="docutils literal notranslate"><span class="pre">execution</span> <span class="pre">timeout</span> <span class="pre">event</span> <span class="pre">handler</span></code> will only be called if the job has
not completed after the final poll (by default, 10 min after the time limit).
This should only happen if the submission method you are using is not enforcing
wallclock limits (unlikely) or you are unable to contact the machine to confirm
the job status.</p>
<p>If you specify an <code class="docutils literal notranslate"><span class="pre">execution</span> <span class="pre">timeout</span></code> and not an
<code class="docutils literal notranslate"><span class="pre">execution</span> <span class="pre">time</span> <span class="pre">limit</span></code> then the
<code class="docutils literal notranslate"><span class="pre">execution</span> <span class="pre">timeout</span> <span class="pre">event</span> <span class="pre">handler</span></code> will be called as soon as the
specified time is reached. The job will also be polled to check its latest
status (possibly resulting in an update in its status and the calling of the
relevant event handler). This behaviour is deprecated, which users should avoid
using.</p>
<p>If you specify an <code class="docutils literal notranslate"><span class="pre">execution</span> <span class="pre">timeout</span></code> and an
<code class="docutils literal notranslate"><span class="pre">execution</span> <span class="pre">time</span> <span class="pre">limit</span></code> then the execution timeout setting will be
ignored.</p>
</div>
</div>
<div class="section" id="custom-job-submission-methods">
<span id="customjobsubmissionmethods"></span><h3>11.7. Custom Job Submission Methods<a class="headerlink" href="#custom-job-submission-methods" title="Permalink to this headline">¶</a></h3>
<p>Defining a new batch system handler requires a little Python programming. Use
the built-in handlers as examples, and read the documentation in
<code class="docutils literal notranslate"><span class="pre">lib/cylc/batch_sys_manager.py</span></code>.</p>
<div class="section" id="an-example">
<h4>11.7.1. An Example<a class="headerlink" href="#an-example" title="Permalink to this headline">¶</a></h4>
<p>The following <code class="docutils literal notranslate"><span class="pre">qsub.py</span></code> module overrides the built-in <em>pbs</em>
batch system handler to change the directive prefix from <code class="docutils literal notranslate"><span class="pre">#PBS</span></code> to
<code class="docutils literal notranslate"><span class="pre">#QSUB</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python2</span>

<span class="kn">from</span> <span class="nn">cylc.batch_sys_handlers.pbs</span> <span class="kn">import</span> <span class="n">PBSHandler</span>

<span class="k">class</span> <span class="nc">QSUBHandler</span><span class="p">(</span><span class="n">PBSHandler</span><span class="p">):</span>
    <span class="n">DIRECTIVE_PREFIX</span> <span class="o">=</span> <span class="s2">&quot;#QSUB &quot;</span>

<span class="n">BATCH_SYS_HANDLER</span> <span class="o">=</span> <span class="n">QSUBHandler</span><span class="p">()</span>
</pre></div>
</div>
<p>If this is in the Python search path (see
<a class="reference internal" href="#where-to-put-batch-system-handler-modules"><span class="std std-ref">Where To Put Batch System Handler Modules</span></a> below) you can use it by
name in suite configurations:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">a</span><span class="c">&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> qsub</span>  <span class="c1"># &lt;---!</span>
            <span class="nv">execution time limit </span><span class="o">=</span><span class="s"> PT1M</span>
        <span class="nt">[[[directives]]]</span>
            <span class="nv">-l nodes </span><span class="o">=</span><span class="s"> 1</span>
            <span class="nv">-q </span><span class="o">=</span><span class="s"> long</span>
            <span class="nv">-V </span><span class="o">=</span>
</pre></div>
</div>
<p>Generate a job script to see the resulting directives:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc register <span class="nb">test</span> <span class="nv">$HOME</span>/test
$ cylc jobscript <span class="nb">test</span> a.1 <span class="p">|</span> grep QSUB
<span class="c1">#QSUB -e /home/oliverh/cylc-run/my.suite/log/job/1/a/01/job.err</span>
<span class="c1">#QSUB -l nodes=1</span>
<span class="c1">#QSUB -l walltime=60</span>
<span class="c1">#QSUB -o /home/oliverh/cylc-run/my.suite/log/job/1/a/01/job.out</span>
<span class="c1">#QSUB -N a.1</span>
<span class="c1">#QSUB -q long</span>
<span class="c1">#QSUB -V</span>
</pre></div>
</div>
<p>(Of course this suite will fail at run time because we only changed the
directive format, and PBS does not accept <code class="docutils literal notranslate"><span class="pre">#QSUB</span></code> directives in
reality).</p>
</div>
<div class="section" id="where-to-put-batch-system-handler-modules">
<span id="id1"></span><h4>11.7.2. Where To Put Batch System Handler Modules<a class="headerlink" href="#where-to-put-batch-system-handler-modules" title="Permalink to this headline">¶</a></h4>
<p><em>Custom batch system handlers must be installed on suite and job
hosts</em> in one of these locations:</p>
<ul class="simple">
<li>under <code class="docutils literal notranslate"><span class="pre">SUITE-DEF-PATH/lib/python/</span></code></li>
<li>under <code class="docutils literal notranslate"><span class="pre">CYLC-PATH/lib/cylc/batch_sys_handlers/</span></code></li>
<li>or anywhere in <code class="docutils literal notranslate"><span class="pre">$PYTHONPATH</span></code></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For Rose users: <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">suite-run</span></code> automatically installs
<code class="docutils literal notranslate"><span class="pre">SUITE-DEF-PATH/lib/python/</span></code> to job hosts).</p>
</div>
</div>
</div>
</div>
<span id="document-external-triggers"></span><div class="section" id="external-triggers">
<span id="id1"></span><h2>12. External Triggers<a class="headerlink" href="#external-triggers" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is a new capability and its suite configuration
interface may change somewhat in future releases - see Current
Limitations below in <a class="reference internal" href="#current-trigger-function-limitations"><span class="std std-ref">Current Limitations</span></a>.</p>
</div>
<p>External triggers allow tasks to trigger directly off of external events, which
is often preferable to implementing long-running polling tasks in the workflow.
The triggering mechanism described in this section replaces an older and less
powerful one documented in <a class="reference internal" href="#old-style-external-triggers"><span class="std std-ref">Old-Style External Triggers (Deprecated)</span></a>.</p>
<p>If you can write a Python function to check the status of an external
condition or event, the suite server program can call it at configurable
intervals until it reports success, at which point dependent tasks can trigger
and data returned by the function will be passed to the job environments of
those tasks. Functions can be written for triggering off of almost anything,
such as delivery of a new dataset, creation of a new entry in a database
table, or appearance of new data availability notifications in a message
broker.</p>
<p>External triggers are visible in suite visualizations as bare graph nodes (just
the trigger names). They are plotted against all dependent tasks, not in a
cycle point specific way like tasks. This is because external triggers may or
may not be cycle point (or even task name) specific - it depends on the
arguments passed to the corresponding trigger functions. For example, if an
external trigger does not depend on task name or cycle point it will only be
called once - albeit repeatedly until satisfied - for the entire suite run,
after which the function result will be remembered for all dependent tasks
throughout the suite run.</p>
<p>Several built-in external trigger functions are located in
<code class="docutils literal notranslate"><span class="pre">&lt;cylc-dir&gt;/lib/cylc/xtriggers/</span></code>:</p>
<ul class="simple">
<li>clock triggers - see <a class="reference internal" href="#built-in-clock-triggers"><span class="std std-ref">Built-in Clock Triggers</span></a></li>
<li>inter-suite triggers - see <a class="reference internal" href="#built-in-suite-state-triggers"><span class="std std-ref">Built-in Suite State Triggers</span></a></li>
</ul>
<p>Trigger functions are normal Python functions, with certain constraints as
described below in:</p>
<ul class="simple">
<li>custom trigger functions - see <a class="reference internal" href="#custom-trigger-functions"><span class="std std-ref">Custom Trigger Functions</span></a></li>
</ul>
<div class="section" id="built-in-clock-triggers">
<span id="id2"></span><h3>12.1. Built-in Clock Triggers<a class="headerlink" href="#built-in-clock-triggers" title="Permalink to this headline">¶</a></h3>
<p>These are more transparent (exposed in the graph) and efficient (shared among
dependent tasks) than the older clock triggers described
in <a class="reference internal" href="index.html#clocktriggertasks"><span class="std std-ref">Clock Triggers</span></a>. (However we don’t recommend wholesale conversion
to the new method yet, until its interface has stabilized -
see <a class="reference internal" href="#current-trigger-function-limitations"><span class="std std-ref">Current Limitations</span></a>.)</p>
<p>Clock triggers, unlike other trigger functions, are executed synchronously in
the main process. The clock trigger function signature looks like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">wall_clock</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">offset</span></code> argument is a date-time duration (<code class="docutils literal notranslate"><span class="pre">PT1H</span></code> is 1
hour) relative to the dependent task’s cycle point (automatically passed to the
function via a second argument not shown above).</p>
<p>In the following suite, task <code class="docutils literal notranslate"><span class="pre">foo</span></code> has a daily cycle point sequence,
and each task instance can trigger once the wall clock time has passed its
cycle point value by one hour:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2018-01-01</span>
    <span class="nt">[[xtriggers]]</span>
        <span class="nv">clock_1 </span><span class="o">=</span><span class="s"> wall_clock(offset=PT1H):PT10S</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[P1D]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="cp">@clock_1</span> <span class="o">=&gt;</span> <span class="kd">foo</span><span class="c">&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> run-foo.sh</span>
</pre></div>
</div>
<p>Notice that the short label <code class="docutils literal notranslate"><span class="pre">clock_1</span></code> is used to represent the
trigger function in the graph. The function call interval, which determines how
often the suite server program checks the clock, is optional.  Here it is
<code class="docutils literal notranslate"><span class="pre">PT10S</span></code> (i.e. 10 seconds, which is also the default value).</p>
<p>Argument keywords can be omitted if called in the right order, so the
<code class="docutils literal notranslate"><span class="pre">clock_1</span></code> trigger can also be declared like this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[[xtriggers]]</span>
    <span class="nv">clock_1 </span><span class="o">=</span><span class="s"> wall_clock(PT1H)</span>
</pre></div>
</div>
<p>A zero-offset clock trigger does not need to be declared under
the <code class="docutils literal notranslate"><span class="pre">[xtriggers]</span></code> section:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2018-01-01</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[P1D]]]</span>
            <span class="c1"># zero-offset clock trigger:</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="cp">@wall_clock</span> <span class="o">=&gt;</span> <span class="kd">foo</span><span class="c">&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> run-foo.sh</span>
</pre></div>
</div>
<p>However, when xtriggers are declared the name used must contain only
the letters <code class="docutils literal notranslate"><span class="pre">a</span></code> to <code class="docutils literal notranslate"><span class="pre">z</span></code> in upper or lower case and underscores.</p>
</div>
<div class="section" id="built-in-suite-state-triggers">
<span id="id3"></span><h3>12.2. Built-in Suite State Triggers<a class="headerlink" href="#built-in-suite-state-triggers" title="Permalink to this headline">¶</a></h3>
<p>These can be used instead of the older suite state polling tasks described
in <a class="reference internal" href="index.html#suitestatepolling"><span class="std std-ref">Triggering Off Of Tasks In Other Suites</span></a> for inter-suite triggering - i.e. to trigger local
tasks off of remote task statuses or messages in other suites. (However we
don’t recommend wholesale conversion to the new method yet, until its
interface has stabilized - see <a class="reference internal" href="#current-trigger-function-limitations"><span class="std std-ref">Current Limitations</span></a>.)</p>
<p>The suite state trigger function signature looks like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">suite_state</span><span class="p">(</span><span class="n">suite</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;succeeded&#39;</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cylc_run_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>The first three arguments are compulsory; they single out the target suite name
(<code class="docutils literal notranslate"><span class="pre">suite</span></code>) task name (<code class="docutils literal notranslate"><span class="pre">task</span></code>) and cycle point
(<code class="docutils literal notranslate"><span class="pre">point</span></code>). The function arguments mirror the arguments and options of
the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">suite-state</span></code> command - see
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">suite-state</span> <span class="pre">--help</span></code> for documentation.</p>
<p>As a simple example, consider the suites in
<code class="docutils literal notranslate"><span class="pre">&lt;cylc-dir&gt;/etc/dev-suites/xtrigger/suite_state/</span></code>. The “upstream”
suite (which we want to trigger off of) looks like this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nv">cycle point format </span><span class="o">=</span><span class="s"> %Y</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2005</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 2015</span>
   <span class="nt">[[dependencies]]</span>
      <span class="nt">[[[P1Y]]]</span>
          <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
<span class="nt">[runtime]</span>
   <span class="nt">[[bar]]</span>
      <span class="nv">script </span><span class="o">=</span><span class="s"> sleep 10</span>
   <span class="nt">[[foo]]</span>
      <span class="nv">script </span><span class="o">=</span><span class="s"> sleep 5; cylc message &quot;data ready&quot;</span>
      <span class="nt">[[[outputs]]]</span>
          <span class="nv">x </span><span class="o">=</span><span class="s"> &quot;data ready&quot;</span>
</pre></div>
</div>
<p>It must be registered and run under the name <em>up</em>, as referenced in the
“downstream” suite that depends on it:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
  <span class="nv">cycle point format </span><span class="o">=</span><span class="s"> %Y</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2010</span>
    <span class="nt">[[xtriggers]]</span>
         <span class="nv">upstream </span><span class="o">=</span><span class="s"> suite_state(suite=up, task=foo, point=%(point)s, \</span>
<span class="s">            message=&#39;data ready&#39;):PT10S</span>
         <span class="nv">clock_0 </span><span class="o">=</span><span class="s"> wall_clock(offset=PT0H)</span>
   <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[P1Y]]]</span>
           <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
              <span class="kd">foo</span>
              <span class="cp">@clock_0</span> <span class="o">&amp;</span> <span class="cp">@upstream</span> <span class="o">=&gt;</span> <span class="kd">FAM</span><span class="c">:</span><span class="kd">succeed</span><span class="c">-</span><span class="kd">all</span> <span class="o">=&gt;</span> <span class="kd">blam</span>
                   <span class="s2">&quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> sleep 5</span>
    <span class="nt">[[foo, blam]]</span>
    <span class="nt">[[FAM]]</span>
    <span class="nt">[[f1,f2,f3]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> FAM</span>
</pre></div>
</div>
<p>Try starting the downstream suite first, then the upstream, and
watch what happens.
In each cycle point the <code class="docutils literal notranslate"><span class="pre">&#64;upstream</span></code> trigger in the downstream suite
waits on the task <code class="docutils literal notranslate"><span class="pre">foo</span></code> (with the same cycle point) in the upstream
suite to emit the <em>data ready</em> message.</p>
<p>Some important points to note about this:</p>
<ul class="simple">
<li>the function call interval, which determines how often the suite
server program checks the clock, is optional. Here it is
<code class="docutils literal notranslate"><span class="pre">PT10S</span></code> (i.e. 10 seconds, which is also the default value).</li>
<li>the <code class="docutils literal notranslate"><span class="pre">suite_state</span></code> trigger function, like the
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">suite-state</span></code> command, must have read-access to the upstream
suite’s public database.</li>
<li>the cycle point argument is supplied by a string template
<code class="docutils literal notranslate"><span class="pre">%(point)s</span></code>. The string templates available to trigger function
arguments are described in <a class="reference internal" href="#custom-trigger-functions"><span class="std std-ref">Custom Trigger Functions</span></a>).</li>
</ul>
<p>The return value of the <code class="docutils literal notranslate"><span class="pre">suite_state</span></code> trigger function looks like
this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;suite&#39;</span><span class="p">:</span> <span class="n">suite</span><span class="p">,</span>
    <span class="s1">&#39;task&#39;</span><span class="p">:</span> <span class="n">task</span><span class="p">,</span>
    <span class="s1">&#39;point&#39;</span><span class="p">:</span> <span class="n">point</span><span class="p">,</span>
    <span class="s1">&#39;offset&#39;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
    <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">status</span><span class="p">,</span>
    <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
    <span class="s1">&#39;cylc_run_dir&#39;</span><span class="p">:</span> <span class="n">cylc_run_dir</span>
<span class="p">}</span>
<span class="k">return</span> <span class="p">(</span><span class="n">satisfied</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">satisified</span></code> variable is boolean (value True or False, depending
on whether or not the trigger condition was found to be satisfied). The
<code class="docutils literal notranslate"><span class="pre">results</span></code> dictionary contains the names and values of all of the
target suite state parameters. Each item in it gets qualified with the
unique trigger label (“upstream” here) and passed to the environment of
dependent task jobs (the members of the <code class="docutils literal notranslate"><span class="pre">FAM</span></code> family in this case).
To see this, take a look at the job script for one of the downstream tasks:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>% cylc cat-log -f j dn f2.2011
...
cylc__job__inst__user_env<span class="o">()</span> <span class="o">{</span>
    <span class="c1"># TASK RUNTIME ENVIRONMENT:</span>
    <span class="nb">export</span> upstream_suite upstream_cylc_run_dir upstream_offset <span class="se">\</span>
      upstream_message upstream_status upstream_point upstream_task
    <span class="nv">upstream_suite</span><span class="o">=</span><span class="s2">&quot;up&quot;</span>
    <span class="nv">upstream_cylc_run_dir</span><span class="o">=</span><span class="s2">&quot;/home/vagrant/cylc-run&quot;</span>
    <span class="nv">upstream_offset</span><span class="o">=</span><span class="s2">&quot;None&quot;</span>
    <span class="nv">upstream_message</span><span class="o">=</span><span class="s2">&quot;data ready&quot;</span>
    <span class="nv">upstream_status</span><span class="o">=</span><span class="s2">&quot;succeeded&quot;</span>
    <span class="nv">upstream_point</span><span class="o">=</span><span class="s2">&quot;2011&quot;</span>
    <span class="nv">upstream_task</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span><span class="o">}</span>
...
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The task has to know the name (label) of the external trigger that it
depends on - “upstream” in this case - in order to use this information.
However the name could be given to the task environment in the suite
configuration.</p>
</div>
</div>
<div class="section" id="custom-trigger-functions">
<span id="id4"></span><h3>12.3. Custom Trigger Functions<a class="headerlink" href="#custom-trigger-functions" title="Permalink to this headline">¶</a></h3>
<p>Trigger functions are just normal Python functions, with a few special
properties:</p>
<ul class="simple">
<li>they must:<ul>
<li>be defined in a module with the same name as the function;</li>
<li>be compatible with the same Python version that runs the Cylc workflow
server program (see <a class="reference internal" href="index.html#requirements"><span class="std std-ref">Installation</span></a> for the latest version
specification).</li>
</ul>
</li>
<li>they can be located in:<ul>
<li><code class="docutils literal notranslate"><span class="pre">&lt;cylc-dir&gt;/lib/cylc/xtriggers/</span></code>;</li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;suite-dir&gt;/lib/python/</span></code>;</li>
<li>or anywhere in your Python library path.</li>
</ul>
</li>
<li>they can take arbitrary positional and keyword arguments</li>
<li>suite and task identity, and cycle point, can be passed to trigger
functions by using string templates in function arguments (see below)</li>
<li>integer, float, boolean, and string arguments will be recognized and
passed to the function as such</li>
<li>if a trigger function depends on files or directories (for example)
that might not exist when the function is first called, just return
unsatisified until everything required does exist.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Trigger functions cannot store data Pythonically between invocations
because each call is executed in an independent process in the process
pool. If necessary the filesystem can be used for this purpose.</p>
</div>
<p>The following string templates are available for use, if the trigger function
needs any of this information, in function arguments in the suite configuration:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">%(name)s</span></code> - name of the dependent task</li>
<li><code class="docutils literal notranslate"><span class="pre">%(id)s</span></code> - identity of the dependent task (name.cycle-point)</li>
<li><code class="docutils literal notranslate"><span class="pre">%(point)s</span></code> - cycle point of the dependent task</li>
<li><code class="docutils literal notranslate"><span class="pre">%(debug)s</span></code> - suite debug mode</li>
</ul>
<p>and less commonly needed:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">%(user_name)s</span></code> - suite owner’s user name</li>
<li><code class="docutils literal notranslate"><span class="pre">%(suite_name)s</span></code> - registered suite name</li>
<li><code class="docutils literal notranslate"><span class="pre">%(suite_run_dir)s</span></code> - suite run directory</li>
<li><code class="docutils literal notranslate"><span class="pre">%(suite_share_dir)s</span></code> - suite share directory</li>
</ul>
<p>If you need to pass a string template into an xtrigger function as a string
literal - i.e. to be used as a template inside the function - escape it with
<code class="docutils literal notranslate"><span class="pre">%</span></code> to avoid detection by the Cylc xtrigger parser: <code class="docutils literal notranslate"><span class="pre">%%(cat)s</span></code>.</p>
<p>Function return values should be as follows:</p>
<ul class="simple">
<li>if the trigger condition is <em>not satisfied</em>:<ul>
<li>return <code class="docutils literal notranslate"><span class="pre">(False,</span> <span class="pre">{})</span></code></li>
</ul>
</li>
<li>if the trigger condition is <em>satisfied</em>:<ul>
<li>return <code class="docutils literal notranslate"><span class="pre">(True,</span> <span class="pre">results)</span></code></li>
</ul>
</li>
</ul>
<p>where <code class="docutils literal notranslate"><span class="pre">results</span></code> is an arbitrary dictionary of information to be passed to
dependent tasks, which in terms of format must:</p>
<ul class="simple">
<li>be <em>flat</em> (non-nested);</li>
<li>contain <em>only</em> keys which are
<a class="reference external" href="http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap08.html">valid</a> as environment variable names.</li>
</ul>
<p>See <a class="reference internal" href="#built-in-suite-state-triggers"><span class="std std-ref">Built-in Suite State Triggers</span></a> for an example of one such
<code class="docutils literal notranslate"><span class="pre">results</span></code> dictionary and how it gets processed by the suite.</p>
<p>The suite server program manages trigger functions as follows:</p>
<ul class="simple">
<li>they are called asynchronously in the process pool
- (except for clock triggers, which are called from the main process)</li>
<li>they are called repeatedly on a configurable interval, until satisified
- the call interval defaults to <code class="docutils literal notranslate"><span class="pre">PT10S</span></code> (10 seconds)
- repeat calls are not made until the previous call has returned</li>
<li>they are subject to the normal process pool command time out - if they
take too long to return, the process will be killed</li>
<li>they are shared for efficiency: a single call will be made for all
triggers that share the same function signature - i.e.the same function
name and arguments</li>
<li>their return status and results are stored in the suite DB and persist across
suite restarts</li>
<li>their stdout, if any, is redirected to stderr and will be visible in
the suite log in debug mode (stdout is needed to communicate return values
from the sub-process in which the function executes)</li>
</ul>
<div class="section" id="toy-examples">
<h4>12.3.1. Toy Examples<a class="headerlink" href="#toy-examples" title="Permalink to this headline">¶</a></h4>
<p>A couple of toy examples in <code class="docutils literal notranslate"><span class="pre">&lt;cylc-dir&gt;/lib/cylc/xtriggers/</span></code> may
be a useful aid to understanding trigger functions and how they work.</p>
<div class="section" id="echo">
<h5>12.3.1.1. echo<a class="headerlink" href="#echo" title="Permalink to this headline">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">echo</span></code> function is a trivial one that takes any number of
positional and keyword arguments (from the suite configuration) and simply
prints them to stdout, and then returns False (i.e. trigger condition not
satisfied). Here it is in its entirety.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">echo</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">print</span> <span class="s2">&quot;echo: ARGS:&quot;</span><span class="p">,</span> <span class="n">args</span>
    <span class="nb">print</span> <span class="s2">&quot;echo: KWARGS:&quot;</span><span class="p">,</span> <span class="n">kwargs</span>
    <span class="k">return</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="p">{})</span>
</pre></div>
</div>
<p>Here’s an example echo trigger suite:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> now</span>
    <span class="nt">[[xtriggers]]</span>
        <span class="nv">echo_1 </span><span class="o">=</span><span class="s"> echo(hello, 99, qux=True, point=%(point)s, foo=10)</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[PT1H]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="cp">@echo_1</span> <span class="o">=&gt;</span> <span class="kd">foo</span><span class="c">&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> exit 1</span>
</pre></div>
</div>
<p>To see the result, run this suite in debug mode and take a look at the
suite log (or run <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">run</span> <span class="pre">--debug</span> <span class="pre">--no-detach</span> <span class="pre">&lt;suite&gt;</span></code> and watch
your terminal).</p>
</div>
<div class="section" id="xrandom">
<h5>12.3.1.2. xrandom<a class="headerlink" href="#xrandom" title="Permalink to this headline">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">xrandom</span></code> function sleeps for a configurable amount of time
(useful for testing the effect of a long-running trigger function - which
should be avoided) and has a configurable random chance of success. The
function signature is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xrandom</span><span class="p">(</span><span class="n">percent</span><span class="p">,</span> <span class="n">secs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">percent</span></code> argument sets the odds of success in any given call;
<code class="docutils literal notranslate"><span class="pre">secs</span></code> is the number of seconds to sleep before returning; and the
<code class="docutils literal notranslate"><span class="pre">_</span></code> argument (underscore is a conventional name for a variable
that is not used, in Python) is provided to allow specialization of the trigger
to (for example) task name, task ID, or cycle point (just use the appropriate
string templates in the suite configuration for this).</p>
<p>An example xrandom trigger suite is
<code class="docutils literal notranslate"><span class="pre">&lt;cylc-dir&gt;/etc/dev-suites/xtriggers/xrandom/</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="current-limitations">
<span id="current-trigger-function-limitations"></span><h3>12.4. Current Limitations<a class="headerlink" href="#current-limitations" title="Permalink to this headline">¶</a></h3>
<p>The following issues may be addressed in future Cylc releases:</p>
<ul class="simple">
<li>trigger labels cannot currently be used in conditional (OR) expressions
in the graph; attempts to do so will fail validation.</li>
<li>aside from the predefined zero-offset <code class="docutils literal notranslate"><span class="pre">wall_clock</span></code> trigger, all
unique trigger function calls must be declared <em>with all of
their arguments</em> under the <code class="docutils literal notranslate"><span class="pre">[scheduling][xtriggers]</span></code> section, and
referred to by label alone in the graph. It would be convenient (and less
verbose, although no more functional) if we could just declare a label
against the <em>common</em> arguments, and give remaining arguments (such as
different wall clock offsets in clock triggers) as needed in the graph.</li>
<li>we may move away from the string templating method for providing suite
and task attributes to trigger function arguments.</li>
</ul>
</div>
<div class="section" id="filesystem-events">
<h3>12.5. Filesystem Events?<a class="headerlink" href="#filesystem-events" title="Permalink to this headline">¶</a></h3>
<p>Cylc does not have built-in support for triggering off of filesystem events
such as <code class="docutils literal notranslate"><span class="pre">inotify</span></code> on Linux. There is no cross-platform standard for
this, and in any case filesystem events are not very useful in HPC cluster
environments where events can only be detected at the specific node on which
they were generated.</p>
</div>
<div class="section" id="continuous-event-watchers">
<h3>12.6. Continuous Event Watchers?<a class="headerlink" href="#continuous-event-watchers" title="Permalink to this headline">¶</a></h3>
<p>For some applications a persistent process that continually monitors the
external world is better than discrete periodic checking. This would be more
difficult to support as a plugin mechanism in Cylc, but we may decide to do it
in the future. In the meantime, consider implementing a small daemon process as
the watcher (e.g. to watch continuously for filesystem events) and have your
Cylc trigger functions interact with it.</p>
</div>
<div class="section" id="old-style-external-triggers-deprecated">
<span id="old-style-external-triggers"></span><h3>12.7. Old-Style External Triggers (Deprecated)<a class="headerlink" href="#old-style-external-triggers-deprecated" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This mechanism is now technically deprecated by the newer external
trigger functions (<a class="reference internal" href="#external-triggers"><span class="std std-ref">External Triggers</span></a>). (However we don’t recommend
wholesale conversion to the new method yet, until its interface has
stabilized - see <a class="reference internal" href="#current-trigger-function-limitations"><span class="std std-ref">Current Limitations</span></a>.)</p>
</div>
<p>These old-style external triggers are hidden task prerequisites that must be
satisfied by using the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">ext-trigger</span></code> client command to send an
associated pre-defined event message to the suite along with an ID string that
distinguishes one instance of the event from another (the name of the target
task and its current cycle point are not required). The event ID is just an
arbitrary string to Cylc, but it can be used to identify something associated
with the event to the suite - such as the filename of a new
externally-generated dataset. When the suite server program receives the event
notification it will trigger the next instance of any task waiting on that
trigger (whatever its cycle point) and then broadcast
(see <a class="reference internal" href="index.html#cylc-broadcast"><span class="std std-ref">Cylc Broadcast</span></a>) the event ID to the cycle point of the triggered
task as <code class="docutils literal notranslate"><span class="pre">$CYLC_EXT_TRIGGER_ID</span></code>. Downstream tasks with the same cycle
point therefore know the new event ID too and can use it, if they need to, to
identify the same new dataset. In this way a whole workflow can be associated
with each new dataset, and multiple datasets can be processed in parallel if
they happen to arrive in quick succession.</p>
<p>An externally-triggered task must register the event it waits on in the suite
scheduling section:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># suite &quot;sat-proc&quot;</span>
<span class="nt">[scheduling]</span>
    <span class="nv">cycling mode </span><span class="o">=</span><span class="s"> integer</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 1</span>
    <span class="nt">[[special tasks]]</span>
        <span class="nv">external-trigger </span><span class="o">=</span><span class="s"> get-data(&quot;new sat X data avail&quot;)</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[P1]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">get</span><span class="c">-</span><span class="kd">data</span> <span class="o">=&gt;</span> <span class="kd">conv</span><span class="c">-</span><span class="kd">data</span> <span class="o">=&gt;</span> <span class="kd">products</span>
</pre></div>
</div>
<p>Then, each time a new dataset arrives the external detection system should
notify the suite like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc ext-trigger sat-proc <span class="s2">&quot;new sat X data avail&quot;</span> passX12334a
</pre></div>
</div>
<p>where “sat-proc” is the suite name and “passX12334a” is the ID string for
the new event. The suite passphrase must be installed on triggering account.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only one task in a suite can trigger off a particular external message.
Other tasks can trigger off the externally triggered task as required,
of course.</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&lt;cylc-dir&gt;/etc/examples/satellite/ext-triggers/suite.rc</span></code> is a working
example of a simulated satellite processing suite.</p>
<p>External triggers are not normally needed in date-time cycling suites driven
by real time data that comes in at regular intervals. In these cases a data
retrieval task can be clock-triggered (and have appropriate retry intervals) to
submit at the expected data arrival time, so little time is wasted in polling.
However, if the arrival time of the cycle-point-specific data is highly
variable, external triggering may be used with the cycle point embedded in the
message:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># suite &quot;data-proc&quot;</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20150125T00</span>
    <span class="nv">final cycle point   </span><span class="o">=</span><span class="s"> 20150126T00</span>
    <span class="nt">[[special tasks]]</span>
        <span class="nv">external-trigger </span><span class="o">=</span><span class="s"> get-data(&quot;data arrived for $CYLC_TASK_CYCLE_POINT&quot;)</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[T00]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">init</span><span class="c">-</span><span class="kd">process</span> <span class="o">=&gt;</span> <span class="kd">get</span><span class="c">-</span><span class="kd">data</span> <span class="o">=&gt;</span> <span class="kd">post</span><span class="c">-</span><span class="kd">process</span>
</pre></div>
</div>
<p>Once the variable-length waiting is finished, an external detection system
should notify the suite like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc ext-trigger data-proc <span class="s2">&quot;data arrived for 20150126T00&quot;</span> passX12334a
</pre></div>
</div>
<p>where “data-proc” is the suite name, the cycle point has replaced the
variable in the trigger string, and “passX12334a” is the ID string for
the new event. The suite passphrase must be installed on the triggering
account. In this case, the event will trigger for the second cycle point but
not the first because of the cycle-point matching.</p>
</div>
</div>
<span id="document-running-suites"></span><div class="section" id="running-suites">
<span id="runningsuites"></span><h2>13. Running Suites<a class="headerlink" href="#running-suites" title="Permalink to this headline">¶</a></h2>
<p>This chapter currently features a diverse collection of topics related
to running suites. Please also see <a class="reference internal" href="index.html#tutorial"><span class="std std-ref">Tutorial</span></a> and
<a class="reference internal" href="index.html#commandreference"><span class="std std-ref">Command Reference</span></a>, and experiment with plenty of examples.</p>
<div class="section" id="suite-start-up">
<span id="suitestartup"></span><h3>13.1. Suite Start-Up<a class="headerlink" href="#suite-start-up" title="Permalink to this headline">¶</a></h3>
<p>There are three ways to start a suite running: <em>cold start</em> and <em>warm start</em>,
which start from scratch; and <em>restart</em>, which starts from a prior
suite state checkpoint. The only difference between cold starts and warm starts
is that warm starts start from a point beyond the suite initial cycle point.</p>
<p>Once a suite is up and running it is typically a restart that is needed most
often (but see also <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">reload</span></code>). <em>Be aware that cold and warm
starts wipe out prior suite state, so you can’t go back to a restart if you
decide you made a mistake.</em></p>
<div class="section" id="cold-start">
<span id="id1"></span><h4>13.1.1. Cold Start<a class="headerlink" href="#cold-start" title="Permalink to this headline">¶</a></h4>
<p>A cold start is the primary way to start a suite run from scratch:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc run SUITE <span class="o">[</span>INITIAL_CYCLE_POINT<span class="o">]</span>
</pre></div>
</div>
<p>The initial cycle point may be specified on the command line or in the suite.rc
file. The scheduler starts by loading the first instance of each task at the
suite initial cycle point, or at the next valid point for the task.</p>
</div>
<div class="section" id="warm-start">
<span id="id2"></span><h4>13.1.2. Warm Start<a class="headerlink" href="#warm-start" title="Permalink to this headline">¶</a></h4>
<p>A warm start runs a suite from scratch like a cold start, but from the
beginning of a given cycle point that is beyond the suite initial cycle point.
This is generally inferior to a <em>restart</em> (which loads a previously
recorded suite state - see <a class="reference internal" href="#restartingsuites"><span class="std std-ref">Restart and Suite State Checkpoints</span></a>) because it may result in
some tasks rerunning. However, a warm start may be required if a restart is not
possible, e.g. because the suite run database was accidentally deleted. The
warm start cycle point must be given on the command line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc run --warm SUITE <span class="o">[</span>START_CYCLE_POINT<span class="o">]</span>
</pre></div>
</div>
<p>The original suite initial cycle point is preserved, but all tasks and
dependencies before the given warm start cycle point are ignored.</p>
<p>The scheduler starts by loading a first instance of each task at the warm
start cycle point, or at the next valid point for the task.
<code class="docutils literal notranslate"><span class="pre">R1</span></code>-type tasks behave exactly the same as other tasks - if their
cycle point is at or later than the given start cycle point, they will run; if
not, they will be ignored.</p>
</div>
<div class="section" id="restart-and-suite-state-checkpoints">
<span id="restartingsuites"></span><h4>13.1.3. Restart and Suite State Checkpoints<a class="headerlink" href="#restart-and-suite-state-checkpoints" title="Permalink to this headline">¶</a></h4>
<p>At restart (see <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">restart</span> <span class="pre">--help</span></code>) a suite server program
initializes its task pool from a previously recorded checkpoint state. By
default the latest automatic checkpoint - which is updated with every task
state change - is loaded so that the suite can carry on exactly as it was just
before being shut down or killed.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc restart SUITE
</pre></div>
</div>
<p>Tasks recorded in the “submitted” or “running” states are automatically polled
(see <a class="reference internal" href="#task-job-polling"><span class="std std-ref">Task Job Polling</span></a>) at start-up to determine what happened to
them while the suite was down.</p>
<div class="section" id="restart-from-latest-checkpoint">
<h5>13.1.3.1. Restart From Latest Checkpoint<a class="headerlink" href="#restart-from-latest-checkpoint" title="Permalink to this headline">¶</a></h5>
<p>To restart from the latest checkpoint simply invoke the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">restart</span></code>
command with the suite name (or select “restart” in the GUI suite start dialog
window):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc restart SUITE
</pre></div>
</div>
</div>
<div class="section" id="restart-from-another-checkpoint">
<h5>13.1.3.2. Restart From Another Checkpoint<a class="headerlink" href="#restart-from-another-checkpoint" title="Permalink to this headline">¶</a></h5>
<p>Suite server programs automatically update the “latest” checkpoint every time
a task changes state, and at every suite restart, but you can also take
checkpoints at other times. To tell a suite server program to checkpoint its
current state:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc checkpoint SUITE-NAME CHECKPOINT-NAME
</pre></div>
</div>
<p>The 2nd argument is a name to identify the checkpoint later with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc ls-checkpoints SUITE-NAME
</pre></div>
</div>
<p>For example, with checkpoints named “bob”, “alice”, and “breakfast”:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc ls-checkpoints SUITE-NAME
<span class="c1">#######################################################################</span>
<span class="c1"># CHECKPOINT ID (ID|TIME|EVENT)</span>
<span class="m">1</span><span class="p">|</span><span class="m">2017</span>-11-01T15:48:34+13<span class="p">|</span>bob
<span class="m">2</span><span class="p">|</span><span class="m">2017</span>-11-01T15:48:47+13<span class="p">|</span>alice
<span class="m">3</span><span class="p">|</span><span class="m">2017</span>-11-01T15:49:00+13<span class="p">|</span>breakfast
...
<span class="m">0</span><span class="p">|</span><span class="m">2017</span>-11-01T17:29:19+13<span class="p">|</span>latest
</pre></div>
</div>
<p>To see the actual task state content of a given checkpoint ID (if you need to),
for the moment you have to interrogate the suite DB, e.g.:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sqlite3 ~/cylc-run/SUITE-NAME/log/db <span class="se">\</span>
    <span class="s1">&#39;select * from task_pool_checkpoints where id == 3;&#39;</span>
<span class="m">3</span><span class="p">|</span><span class="m">2012</span><span class="p">|</span>model<span class="p">|</span><span class="m">1</span><span class="p">|</span>running<span class="p">|</span>
<span class="m">3</span><span class="p">|</span><span class="m">2013</span><span class="p">|</span>pre<span class="p">|</span><span class="m">0</span><span class="p">|</span>waiting<span class="p">|</span>
<span class="m">3</span><span class="p">|</span><span class="m">2013</span><span class="p">|</span>post<span class="p">|</span><span class="m">0</span><span class="p">|</span>waiting<span class="p">|</span>
<span class="m">3</span><span class="p">|</span><span class="m">2013</span><span class="p">|</span>model<span class="p">|</span><span class="m">0</span><span class="p">|</span>waiting<span class="p">|</span>
<span class="m">3</span><span class="p">|</span><span class="m">2013</span><span class="p">|</span>upload<span class="p">|</span><span class="m">0</span><span class="p">|</span>waiting<span class="p">|</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A checkpoint captures the instantaneous state of every task in the
suite, including any tasks that are currently active, so you may want
to be careful where you do it. Tasks recorded as active are polled
automatically on restart to determine what happened to them.</p>
</div>
<p>The checkpoint ID 0 (zero) is always used for latest state of the suite, which
is updated continuously as the suite progresses. The checkpoint IDs of earlier
states are positive integers starting from 1, incremented each time a new
checkpoint is stored. Currently suites automatically store checkpoints before
and after reloads, and on restarts (using the latest checkpoints before the
restarts).</p>
<p>Once you have identified the right checkpoint, restart the suite like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc restart --checkpoint<span class="o">=</span>CHECKPOINT-ID SUITE
</pre></div>
</div>
<p>or enter the checkpoint ID in the space provided in the GUI restart window.</p>
</div>
<div class="section" id="checkpointing-with-a-task">
<h5>13.1.3.3. Checkpointing With A Task<a class="headerlink" href="#checkpointing-with-a-task" title="Permalink to this headline">¶</a></h5>
<p>Checkpoints can be generated automatically at particular points in the
workflow by coding tasks that run the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">checkpoint</span></code> command:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
   <span class="nt">[[dependencies]]</span>
      <span class="nt">[[[PT6H]]]</span>
          <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">pre</span> <span class="o">=&gt;</span> <span class="kd">model</span> <span class="o">=&gt;</span> <span class="kd">post</span> <span class="o">=&gt;</span> <span class="kd">checkpointer</span><span class="c">&quot;</span>
<span class="nt">[runtime]</span>
   <span class="c1"># ...</span>
   <span class="nt">[[checkpointer]]</span>
      <span class="nv">script </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">wait &quot;${CYLC_TASK_MESSAGE_STARTED_PID}&quot; 2&gt;/dev/null || true</span>
<span class="s2">cylc checkpoint ${CYLC_SUITE_NAME} CP-${CYLC_TASK_CYCLE_POINT}</span>
<span class="s2">               &quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We need to “wait” on the “task started” message - which
is sent in the background to avoid holding tasks up in a network
outage - to ensure that the checkpointer task is correctly recorded
as running in the checkpoint (at restart the suite server program will
poll to determine that that task job finished successfully). Otherwise
it may be recorded in the waiting state and, if its upstream dependencies
have already been cleaned up, it will need to be manually reset from waiting
to succeeded after the restart to avoid stalling the suite.</p>
</div>
</div>
<div class="section" id="behaviour-of-tasks-on-restart">
<h5>13.1.3.4. Behaviour of Tasks on Restart<a class="headerlink" href="#behaviour-of-tasks-on-restart" title="Permalink to this headline">¶</a></h5>
<p>All tasks are reloaded in exactly their checkpointed states. Failed tasks are
not automatically resubmitted at restart in case the underlying problem has not
been addressed yet.</p>
<p>Tasks recorded in the submitted or running states are automatically polled on
restart, to see if they are still waiting in a batch queue, still running, or
if they succeeded or failed while the suite was down. The suite state will be
updated automatically according to the poll results.</p>
<p>Existing instances of tasks removed from the suite configuration before restart
are not removed from the task pool automatically, but they will not spawn new
instances. They can be removed manually if necessary,
with~``cylc remove``.</p>
<p>Similarly, instances of new tasks added to the suite configuration before
restart are not inserted into the task pool automatically, because it is
very difficult in general to automatically determine the cycle point of
the first instance. Instead, the first instance of a new task should be
inserted manually at the right cycle point, with <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">insert</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="reloading-the-suite-configuration-at-runtime">
<h3>13.2. Reloading The Suite Configuration At Runtime<a class="headerlink" href="#reloading-the-suite-configuration-at-runtime" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">reload</span></code> command tells a suite server program to reload its
suite configuration at run time. This is an alternative to shutting a
suite down and restarting it after making changes.</p>
<p>As for a restart, existing instances of tasks removed from the suite
configuration before reload are not removed from the task pool
automatically, but they will not spawn new instances. They can be removed
manually if necessary, with <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">remove</span></code>.</p>
<p>Similarly, instances of new tasks added to the suite configuration before
reload are not inserted into the pool automatically. The first instance of each
must be inserted manually at the right cycle point, with <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">insert</span></code>.</p>
</div>
<div class="section" id="task-job-access-to-cylc">
<span id="howtasksgetaccesstocylc"></span><h3>13.3. Task Job Access To Cylc<a class="headerlink" href="#task-job-access-to-cylc" title="Permalink to this headline">¶</a></h3>
<p>Task jobs need access to Cylc on the job host, primarily for task messaging,
but also to allow user-defined task scripting to run other Cylc commands.</p>
<p>Cylc should be installed on job hosts as on suite hosts, with different
releases installed side-by-side and invoked via the central Cylc
wrapper according to the value of <code class="docutils literal notranslate"><span class="pre">$CYLC_VERSION</span></code> - see
<a class="reference internal" href="index.html#installcylc"><span class="std std-ref">Installing Cylc</span></a>. Task job scripts set <code class="docutils literal notranslate"><span class="pre">$CYLC_VERSION</span></code> to the
version of the parent suite server program, so that the right Cylc will
be invoked by jobs on the job host.</p>
<p>Access to the Cylc executable (preferably the central wrapper as just
described) for different job hosts can be configured using site and user
global configuration files (on the suite host). If the environment for running
the Cylc executable is only set up correctly in a login shell for a given host,
you can set <code class="docutils literal notranslate"><span class="pre">[hosts][HOST]use</span> <span class="pre">login</span> <span class="pre">shell</span> <span class="pre">=</span> <span class="pre">True</span></code> for the relevant
host (this is the default, to cover more sites automatically). If the
environment is already correct without the login shell, but the Cylc executable
is not in <code class="docutils literal notranslate"><span class="pre">$PATH</span></code>, then <code class="docutils literal notranslate"><span class="pre">[hosts][HOST]cylc</span> <span class="pre">executable</span></code> can
be used to specify the direct path to the executable.</p>
<p>To customize the environment more generally for Cylc on jobs hosts,
use of <code class="docutils literal notranslate"><span class="pre">job-init-env.sh</span></code> is described in
<a class="reference internal" href="index.html#configure-environment-on-job-hosts"><span class="std std-ref">Configure Environment on Job Hosts</span></a>.</p>
</div>
<div class="section" id="the-suite-contact-file">
<span id="id3"></span><h3>13.4. The Suite Contact File<a class="headerlink" href="#the-suite-contact-file" title="Permalink to this headline">¶</a></h3>
<p>At start-up, suite server programs write a <em>suite contact file</em>
<code class="docutils literal notranslate"><span class="pre">$HOME/cylc-run/SUITE/.service/contact</span></code> that records suite host,
user, port number, process ID, Cylc version, and other information. Client
commands can read this file, if they have access to it, to find the target
suite server program.</p>
</div>
<div class="section" id="task-job-polling">
<span id="id4"></span><h3>13.5. Task Job Polling<a class="headerlink" href="#task-job-polling" title="Permalink to this headline">¶</a></h3>
<p>At any point after job submission task jobs can be <em>polled</em> to check that
their true state conforms to what is currently recorded by the suite server
program.  See <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">poll</span> <span class="pre">--help</span></code> for how to poll one or more tasks
manually, or right-click poll a task or family in GUI.</p>
<p>Polling may be necessary if, for example, a task job gets killed by the
untrappable SIGKILL signal (e.g. <code class="docutils literal notranslate"><span class="pre">kill</span> <span class="pre">-9</span> <span class="pre">PID</span></code>), or if a network
outage prevents task success or failure messages getting through, or if the
suite server program itself is down when tasks finish execution.</p>
<p>To poll a task job the suite server program interrogates the
batch system, and the <code class="docutils literal notranslate"><span class="pre">job.status</span></code> file, on the job host. This
information is enough to determine the final task status even if the
job finished while the suite server program was down or unreachable on
the network.</p>
<div class="section" id="routine-polling">
<h4>13.5.1. Routine Polling<a class="headerlink" href="#routine-polling" title="Permalink to this headline">¶</a></h4>
<p>Task jobs are automatically polled at certain times: once on job submission
timeout; several times on exceeding the job execution time limit; and at suite
restart any tasks recorded as active in the suite state checkpoint are polled
to find out what happened to them while the suite was down.</p>
<p>Finally, in necessary routine polling can be configured as a way to track job
status on job hosts that do not allow networking routing back to the suite host
for task messaging by HTTPS or ssh. See <a class="reference internal" href="#polling-to-track-job-status"><span class="std std-ref">Polling to Track Job Status</span></a>.</p>
</div>
</div>
<div class="section" id="tracking-task-state">
<span id="taskcomms"></span><h3>13.6. Tracking Task State<a class="headerlink" href="#tracking-task-state" title="Permalink to this headline">¶</a></h3>
<p>Cylc supports three ways of tracking task state on job hosts:</p>
<ul class="simple">
<li>task-to-suite messaging via HTTPS</li>
<li>task-to-suite messaging via non-interactive ssh to the suite host,
then local HTTPS</li>
<li>regular polling by the suite server program</li>
</ul>
<p>These can be configured per job host in the Cylc global config file - see
<a class="reference internal" href="index.html#sitercreference"><span class="std std-ref">Global (Site, User) Config File Reference</span></a>.</p>
<p>If your site prohibits HTTPS and ssh back from job hosts to
suite hosts, before resorting to the polling method you should
consider installing dedicated Cylc servers or
VMs inside the HPC trust zone (where HTTPS and ssh should be allowed).</p>
<p>It is also possible to run Cylc suite server programs on HPC login
nodes, but this is not recommended for load, run duration,
and GUI reasons.</p>
<p>Finally, it has been suggested that <em>port forwarding</em> may provide another
solution - but that is beyond the scope of this document.</p>
<div class="section" id="https-task-messaging">
<h4>13.6.1. HTTPS Task Messaging<a class="headerlink" href="#https-task-messaging" title="Permalink to this headline">¶</a></h4>
<p>Task job wrappers automatically invoke <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">message</span></code> to report
progress back to the suite server program when they begin executing,
at normal exit (success) and abnormal exit (failure).</p>
<p>By default the messaging occurs via an authenticated, HTTPS connection to the
suite server program. This is the preferred task communications
method - it is efficient and direct.</p>
<p>Suite server programs automatically install suite contact information
and credentials on job hosts.  Users only need to do this manually
for remote access to suites on other hosts, or suites owned by other
users - see <a class="reference internal" href="#remotecontrol"><span class="std std-ref">Remote Control</span></a>.</p>
</div>
<div class="section" id="ssh-task-messaging">
<h4>13.6.2. Ssh Task Messaging<a class="headerlink" href="#ssh-task-messaging" title="Permalink to this headline">¶</a></h4>
<p>Cylc can be configured to re-invoke task messaging commands on the
suite host via non-interactive ssh (from job host to suite host).
Then a local HTTPS connection is made to the suite server program.</p>
<p>(User-invoked client commands (aside from the GUI, which requires HTTPS)
can do the same thing with the <code class="docutils literal notranslate"><span class="pre">--use-ssh</span></code> command option).</p>
<p>This is less efficient than direct HTTPS messaging, but it may be useful at
sites where the HTTPS ports are blocked but non-interactive ssh is allowed.</p>
</div>
<div class="section" id="polling-to-track-job-status">
<span id="id5"></span><h4>13.6.3. Polling to Track Job Status<a class="headerlink" href="#polling-to-track-job-status" title="Permalink to this headline">¶</a></h4>
<p>Finally, suite server programs can actively poll task jobs at
configurable intervals, via non-interactive ssh to the job host.</p>
<p>Polling is the least efficient task communications method because task state is
updated only at intervals, not when task events actually occur.  However, it
may be needed at sites that do not allow HTTPS or non-interactive ssh from job
host to suite host.</p>
<p>Be careful to avoid spamming task hosts with polling commands. Each poll
opens (and then closes) a new ssh connection.</p>
<p>Polling intervals are configurable under <code class="docutils literal notranslate"><span class="pre">[runtime]</span></code> because
they should may depend on the expected execution time. For instance, a
task that typically takes an hour to run might be polled every 10
minutes initially, and then every minute toward the end of its run.
Interval values are used in turn until the last value, which is used
repeatedly until finished:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nt">[[[job]]]</span>
            <span class="c1"># poll every minute in the &#39;submitted&#39; state:</span>
            <span class="nv">submission polling intervals </span><span class="o">=</span><span class="s"> PT1M</span>
            <span class="c1"># poll one minute after foo starts running, then every 10</span>
            <span class="c1"># minutes for 50 minutes, then every minute until finished:</span>
            <span class="nv">execution polling intervals </span><span class="o">=</span><span class="s"> PT1M, 5*PT10M, PT1M</span>
</pre></div>
</div>
<p>A list of intervals with optional multipliers can be used for both
submission and execution polling, although a single value is probably
sufficient for submission polling. If these items are not configured
default values from site and user global config will be used for the polling
task communication method; polling is not done by default under the
other task communications methods (but it can still be used if you
like).</p>
</div>
<div class="section" id="task-communications-configuration">
<h4>13.6.4. Task Communications Configuration<a class="headerlink" href="#task-communications-configuration" title="Permalink to this headline">¶</a></h4>
</div>
</div>
<div class="section" id="the-suite-service-directory">
<span id="id6"></span><h3>13.7. The Suite Service Directory<a class="headerlink" href="#the-suite-service-directory" title="Permalink to this headline">¶</a></h3>
<p>At registration time a <em>suite service directory</em>,
<code class="docutils literal notranslate"><span class="pre">$HOME/cylc-run/&lt;SUITE&gt;/.service/</span></code>, is created and populated
with a private passphrase file (containing random text), a self-signed
SSL certificate (see <a class="reference internal" href="#connectionauthentication"><span class="std std-ref">Client-Server Interaction</span></a>), and a symlink to the
suite source directory.  An existing passphrase file will not be overwritten
if a suite is re-registered.</p>
<p>At run time, the private suite run database is also written to the service
directory, along with a <em>suite contact file</em> that records the host,
user, port number, process ID, Cylc version, and other information about the
suite server program. Client commands automatically read daemon targetting
information from the contact file, if they have access to it.</p>
</div>
<div class="section" id="file-reading-commands">
<h3>13.8. File-Reading Commands<a class="headerlink" href="#file-reading-commands" title="Permalink to this headline">¶</a></h3>
<p>Some Cylc commands and GUI actions parse suite configurations or read
other files
from the suite host account, rather than communicate with a suite server
program over the network. In future we plan to have suite server program serve
up these files to clients, but for the moment this functionality requires
read-access to the relevant files on the suite host.</p>
<p>If you are logged into the suite host account, file-reading commands will just
work.</p>
<div class="section" id="remote-host-shared-home-directory">
<h4>13.8.1. Remote Host, Shared Home Directory<a class="headerlink" href="#remote-host-shared-home-directory" title="Permalink to this headline">¶</a></h4>
<p>If you are logged into another host with shared home directories (shared
filesystems are common in HPC environments) file-reading commands will just
work because suite files will look “local” on both hosts.</p>
</div>
<div class="section" id="remote-host-different-home-directory">
<h4>13.8.2. Remote Host, Different Home Directory<a class="headerlink" href="#remote-host-different-home-directory" title="Permalink to this headline">¶</a></h4>
<p>If you are logged into another host with no shared home directory, file-reading
commands require non-interactive ssh to the suite host account, and use of the
<code class="docutils literal notranslate"><span class="pre">--host</span></code> and <code class="docutils literal notranslate"><span class="pre">--user</span></code> options to re-invoke the command
on the suite account.</p>
</div>
<div class="section" id="same-host-different-user-account">
<h4>13.8.3. Same Host, Different User Account<a class="headerlink" href="#same-host-different-user-account" title="Permalink to this headline">¶</a></h4>
<p>(This is essentially the same as <em>Remote Host, Different Home Directory</em>.)</p>
</div>
</div>
<div class="section" id="client-server-interaction">
<span id="connectionauthentication"></span><h3>13.9. Client-Server Interaction<a class="headerlink" href="#client-server-interaction" title="Permalink to this headline">¶</a></h3>
<p>Cylc server programs listen on dedicated network ports for
HTTPS communications from Cylc clients (task jobs, and user-invoked commands
and GUIs).</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">scan</span></code> to see which suites are listening on which ports on
scanned hosts (this lists your own suites by default, but it can show others
too - see <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">scan</span> <span class="pre">--help</span></code>).</p>
<p>Cylc supports two kinds of access to suite server programs:</p>
<ul class="simple">
<li><em>public</em> (non-authenticated) - the amount of information
revealed is configurable, see <a class="reference internal" href="#publicaccess"><span class="std std-ref">Public Access - No Auth Files</span></a></li>
<li><em>control</em> (authenticated) - full control, suite passphrase
required, see <a class="reference internal" href="#passphrases"><span class="std std-ref">Full Control - With Auth Files</span></a></li>
</ul>
<div class="section" id="public-access-no-auth-files">
<span id="publicaccess"></span><h4>13.9.1. Public Access - No Auth Files<a class="headerlink" href="#public-access-no-auth-files" title="Permalink to this headline">¶</a></h4>
<p>Without a suite passphrase the amount of information revealed by a suite
server program is determined by the public access privilege level set in global
site/user config (<a class="reference internal" href="index.html#globalauth"><span class="std std-ref">[authentication]</span></a>) and optionally overidden in suites
(<a class="reference internal" href="index.html#suiteauth"><span class="std std-ref">[cylc] -&gt; [[authentication]]</span></a>):</p>
<ul class="simple">
<li><em>identity</em> - only suite and owner names revealed</li>
<li><em>description</em> - identity plus suite title and description</li>
<li><em>state-totals</em> - identity, description, and task state totals</li>
<li><em>full-read</em> - full read-only access for monitor and GUI</li>
<li><em>shutdown</em> - full read access plus shutdown, but no other control.</li>
</ul>
<p>The default public access level is <em>state-totals</em>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">scan</span></code> command and the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">gscan</span></code> GUI can print
descriptions and task state totals in addition to basic suite identity, if the
that information is revealed publicly.</p>
</div>
<div class="section" id="full-control-with-auth-files">
<span id="passphrases"></span><h4>13.9.2. Full Control - With Auth Files<a class="headerlink" href="#full-control-with-auth-files" title="Permalink to this headline">¶</a></h4>
<p>Suite auth files (passphrase and SSL certificate) give full control. They are
loaded from the suite service directory by the suite server program at
start-up, and used to authenticate subsequent client connections. Passphrases
are used in a secure encrypted challenge-response scheme, never sent in plain
text over the network.</p>
<p>If two users need access to the same suite server program, they must both
possess the passphrase file for that suite. Fine-grained access to a single
suite server program via distinct user accounts is not currently supported.</p>
<p>Suite server programs automatically install their auth and contact files to job
hosts via ssh, to enable task jobs to connect back to the suite server program
for task messaging.</p>
<p>Client programs invoked by the suite owner automatically load the passphrase,
SSL certificate, and contact file too, for automatic connection to suites.</p>
<p><em>Manual installation of suite auth files is only needed for remote control,
if you do not have a shared filesystem - see below.</em></p>
</div>
</div>
<div class="section" id="gui-to-suite-interaction">
<span id="id7"></span><h3>13.10. GUI-to-Suite Interaction<a class="headerlink" href="#gui-to-suite-interaction" title="Permalink to this headline">¶</a></h3>
<p>The gcylc GUI is mainly a network client to retrieve and display suite status
information from the suite server program, but it can also invoke file-reading
commands to view and graph the suite configuration and so on. This is entirely
transparent if the GUI is running on the suite host account, but full
functionality for remote suites requires either a shared filesystem, or
(see <a class="reference internal" href="#remotecontrol"><span class="std std-ref">Remote Control</span></a>) auth file installation <em>and</em> non-interactive ssh
access to the suite host.  Without the auth files you will not be able
to connect to the suite, and without ssh you will see “permission denied”
errors on attempting file access.</p>
</div>
<div class="section" id="remote-control">
<span id="remotecontrol"></span><h3>13.11. Remote Control<a class="headerlink" href="#remote-control" title="Permalink to this headline">¶</a></h3>
<p>Cylc client programs - command line and GUI - can interact with suite server
programs running on other accounts or hosts. How this works depends on whether
or not you have:</p>
<ul class="simple">
<li>a <em>shared filesystem</em> such that you see the same home directory on
both hosts.</li>
<li><em>non-interactive ssh</em> from the client account to the server
account.</li>
</ul>
<p>With a shared filesystem, a suite registered on the remote (server) host is
also - in effect - registered on the local (client) host.  In this case you
can invoke client commands without the <code class="docutils literal notranslate"><span class="pre">--host</span></code> option; the client
will automatically read the host and port from the contact file in the
suite service directory.</p>
<p>To control suite server programs running under other user accounts or on other
hosts without a shared filesystem, the suite SSL certificate and passphrase
must be installed under your <code class="docutils literal notranslate"><span class="pre">$HOME/.cylc/</span></code> directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$HOME</span>/.cylc/auth/OWNER@HOST/SUITE/
      ssl.cert
      passphrase
      contact  <span class="c1"># (optional - see below)</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">OWNER&#64;HOST</span></code> is the suite host account and <code class="docutils literal notranslate"><span class="pre">SUITE</span></code>
is the suite name. Client commands should then be invoked with the
<code class="docutils literal notranslate"><span class="pre">--user</span></code> and <code class="docutils literal notranslate"><span class="pre">--host</span></code> options, e.g.:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc gui --user<span class="o">=</span>OWNER --host<span class="o">=</span>HOST SUITE
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Remote suite auth files do not need to be installed for read-only
access - see <a class="reference internal" href="#publicaccess"><span class="std std-ref">Public Access - No Auth Files</span></a> - via the GUI or monitor.</p>
</div>
<p>The suite contact file (see <a class="reference internal" href="#the-suite-contact-file"><span class="std std-ref">The Suite Contact File</span></a>) is not needed if
you have read-access to the remote suite run directory via the local
filesystem or non-interactive ssh to the suite host account - client commands
will automatically read it. If you do install the contact file in your auth
directory note that the port number will need to be updated if the suite gets
restarted on a different port. Otherwise use <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">scan</span></code> to determine
the suite port number and use the <code class="docutils literal notranslate"><span class="pre">--port</span></code> client command option.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Possession of a suite passphrase gives full control over the
target suite, including edit run functionality - which lets you run
arbitrary scripting on job hosts as the suite owner. Further,
non-interactive ssh gives full access to the target user account, so we
recommended that this is only used to interact with suites running on
accounts to which you already have full access.</p>
</div>
</div>
<div class="section" id="scan-and-gscan">
<span id="id8"></span><h3>13.12. Scan And Gscan<a class="headerlink" href="#scan-and-gscan" title="Permalink to this headline">¶</a></h3>
<p>Both <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">scan</span></code> and the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">gscan</span></code> GUI can display
suites owned by other users on other hosts, including task state totals if the
public access level permits that (see <a class="reference internal" href="#publicaccess"><span class="std std-ref">Public Access - No Auth Files</span></a>). Clicking on a
remote suite in <code class="docutils literal notranslate"><span class="pre">gscan</span></code> will open a <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">gui</span></code> to connect to that
suite. This will give you full control, if you have the suite auth files
installed; or it will display full read only information if the public access
level allows that.</p>
</div>
<div class="section" id="task-states-explained">
<h3>13.13. Task States Explained<a class="headerlink" href="#task-states-explained" title="Permalink to this headline">¶</a></h3>
<p>As a suite runs, its task proxies may pass through the following states:</p>
<ul class="simple">
<li><strong>waiting</strong> - still waiting for prerequisites (e.g. dependence on
other tasks, and clock triggers) to be satisfied.</li>
<li><strong>held</strong> - will not be submitted to run even if all prerequisites
are satisfied, until released/un-held.</li>
<li><strong>queued</strong> - ready to run (prerequisites satisfied) but
temporarily held back by an <em>internal cylc queue</em>
(see <a class="reference internal" href="#internalqueues"><span class="std std-ref">Limiting Activity With Internal Queues</span></a>).</li>
<li><strong>ready</strong> - ready to run (prerequisites satisfied) and
handed to cylc’s job submission sub-system.</li>
<li><strong>submitted</strong> - submitted to run, but not executing yet
(could be waiting in an external batch scheduler queue).</li>
<li><strong>submit-failed</strong> - job submission failed <em>or</em>
submitted job killed (cancelled) before commencing execution.</li>
<li><strong>submit-retrying</strong> - job submission failed, but a submission retry
was configured. Will only enter the <em>submit-failed</em> state if all
configured submission retries are exhausted.</li>
<li><strong>running</strong> - currently executing (a <em>task started</em>
message was received, or the task polled as running).</li>
<li><strong>succeeded</strong> - finished executing successfully (a <em>task
succeeded</em> message was received, or the task polled as succeeded).</li>
<li><strong>failed</strong> - aborted execution due to some error condition (a
<em>task failed</em> message was received, or the task polled as failed).</li>
<li><strong>retrying</strong> - job execution failed, but an execution retry
was configured. Will only enter the <em>failed</em> state if all configured
execution retries are exhausted.</li>
<li><strong>runahead</strong> - will not have prerequisites checked (and so
automatically held, in effect) until the rest of the suite catches up
sufficiently.  The amount of runahead allowed is configurable - see
<a class="reference internal" href="#runaheadlimit"><span class="std std-ref">Runahead Limiting</span></a>.</li>
<li><strong>expired</strong> - will not be submitted to run, due to falling too far
behind the wall-clock relative to its cycle point -
see <a class="reference internal" href="index.html#clockexpiretasks"><span class="std std-ref">Clock-Expire Triggers</span></a>.</li>
</ul>
</div>
<div class="section" id="what-the-suite-control-gui-shows">
<h3>13.14. What The Suite Control GUI Shows<a class="headerlink" href="#what-the-suite-control-gui-shows" title="Permalink to this headline">¶</a></h3>
<p>The GUI Text-tree and Dot Views display the state of every task proxy present
in the task pool. Once a task has succeeded and Cylc has determined that it can
no longer be needed to satisfy the prerequisites of other tasks, its proxy will
be cleaned up (removed from the pool) and it will disappear from the GUI. To
rerun a task that has disappeared from the pool, you need to re-insert its task
proxy and then re-trigger it.</p>
<p>The Graph View is slightly different: it displays the complete dependency graph
over the range of cycle points currently present in the task pool. This often
includes some greyed-out <em>base</em> or <em>ghost nodes</em> that are empty - i.e.
there are no corresponding task proxies currently present in the pool. Base
nodes just flesh out the graph structure. Groups of them may be cut out and
replaced by single <em>scissor nodes</em> in sections of the graph that are
currently inactive.</p>
</div>
<div class="section" id="network-connection-timeouts">
<h3>13.15. Network Connection Timeouts<a class="headerlink" href="#network-connection-timeouts" title="Permalink to this headline">¶</a></h3>
<p>A connection timeout can be set in site and user global config files
(see <a class="reference internal" href="index.html#siteanduserconfiguration"><span class="std std-ref">Global (Site, User) Configuration Files</span></a>) so that messaging commands
cannot hang indefinitely if the suite is not responding (this can be
caused by suspending a suite with Ctrl-Z) thereby preventing the task
from completing. The same can be done on the command line for other
suite-connecting user commands, with the <code class="docutils literal notranslate"><span class="pre">--comms-timeout</span></code> option.</p>
</div>
<div class="section" id="runahead-limiting">
<span id="runaheadlimit"></span><h3>13.16. Runahead Limiting<a class="headerlink" href="#runahead-limiting" title="Permalink to this headline">¶</a></h3>
<p>Runahead limiting prevents the fastest tasks in a suite from getting too far
ahead of the slowest ones. Newly spawned tasks are released to the task pool
only when they fall below the runahead limit. A low runhead limit can prevent
cylc from interleaving cycles, but it will not stall a suite unless it fails to
extend out past a future trigger (see <a class="reference internal" href="index.html#intercyclepointtriggers"><span class="std std-ref">Inter-Cycle Triggers</span></a>).
A high runahead limit may allow fast tasks that are not constrained by
dependencies or clock-triggers to spawn far ahead of the pack, which could have
performance implications for the suite server program when running very large
suites.  Succeeded and failed tasks are ignored when computing the runahead
limit.</p>
<p>The preferred runahead limiting mechanism restricts the number of consecutive
active cycle points. The default value is three active cycle points;
see <a class="reference internal" href="index.html#max-active-cycle-points"><span class="std std-ref">[scheduling] -&gt; max active cycle points</span></a>. Alternatively the interval between the
slowest and fastest tasks can be specified as hard limit;
see <a class="reference internal" href="index.html#runahead-limit"><span class="std std-ref">[scheduling] -&gt; runahead limit</span></a>.</p>
</div>
<div class="section" id="limiting-activity-with-internal-queues">
<span id="internalqueues"></span><h3>13.17. Limiting Activity With Internal Queues<a class="headerlink" href="#limiting-activity-with-internal-queues" title="Permalink to this headline">¶</a></h3>
<p>Large suites can potentially overwhelm task hosts by submitting too many
tasks at once. You can prevent this with <em>internal queues</em>, which
limit the number of tasks that can be active (submitted or running)
at the same time.</p>
<p>Internal queues behave in the first-in-first-out (FIFO) manner, i.e. tasks are
released from a queue in the same order that they were queued.</p>
<p>A queue is defined by a <em>name</em>; a <em>limit</em>, which is the maximum
number of active tasks allowed for the queue; and a list of <em>members</em>,
assigned by task or family name.</p>
<p>Queue configuration is done under the <code class="docutils literal notranslate"><span class="pre">[scheduling]</span></code> section of the suite.rc
file (like dependencies, internal queues constrain <em>when</em> a task runs).</p>
<p>By default every task is assigned to the <em>default</em> queue, which by default
has a zero limit (interpreted by cylc as no limit). To use a single queue for
the whole suite just set the default queue limit:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[ queues]]</span>
        <span class="c1"># limit the entire suite to 5 active tasks at once</span>
        <span class="nt">[[[default]]]</span>
            <span class="nv">limit </span><span class="o">=</span><span class="s"> 5</span>
</pre></div>
</div>
<p>To use additional queues just name each one, set their limits, and assign
members:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[ queues]]</span>
        <span class="nt">[[[q_foo]]]</span>
            <span class="nv">limit </span><span class="o">=</span><span class="s"> 5</span>
            <span class="nv">members </span><span class="o">=</span><span class="s"> foo, bar, baz</span>
</pre></div>
</div>
<p>Any tasks not assigned to a particular queue will remain in the default
queue. The <em>queues</em> example suite illustrates how queues work by
running two task trees side by side (as seen in the graph GUI) each
limited to 2 and 3 tasks respectively:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> demonstrates internal queueing</span>
    <span class="nv">description </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Two trees of tasks: the first uses the default queue set to a limit of</span>
<span class="s2">two active tasks at once; the second uses another queue limited to three</span>
<span class="s2">active tasks at once. Run via the graph control GUI for a clear view.</span>
<span class="s2">              &quot;&quot;&quot;</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[queues]]</span>
        <span class="nt">[[[default]]]</span>
            <span class="nv">limit </span><span class="o">=</span><span class="s"> 2</span>
        <span class="nt">[[[foo]]]</span>
            <span class="nv">limit </span><span class="o">=</span><span class="s"> 3</span>
            <span class="nv">members </span><span class="o">=</span><span class="s"> n, o, p, FAM2, u, v, w, x, y, z</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
            <span class="kd">a</span> <span class="o">=&gt;</span> <span class="kd">b</span> <span class="o">&amp;</span> <span class="kd">c</span> <span class="o">=&gt;</span> <span class="kd">FAM1</span>
            <span class="kd">n</span> <span class="o">=&gt;</span> <span class="kd">o</span> <span class="o">&amp;</span> <span class="kd">p</span> <span class="o">=&gt;</span> <span class="kd">FAM2</span>
            <span class="kd">FAM1</span><span class="c">:</span><span class="kd">succeed</span><span class="c">-</span><span class="kd">all</span> <span class="o">=&gt;</span> <span class="kd">h</span> <span class="o">&amp;</span> <span class="kd">i</span> <span class="o">&amp;</span> <span class="kd">j</span> <span class="o">&amp;</span> <span class="kd">k</span> <span class="o">&amp;</span> <span class="kd">l</span> <span class="o">&amp;</span> <span class="kd">m</span>
            <span class="kd">FAM2</span><span class="c">:</span><span class="kd">succeed</span><span class="c">-</span><span class="kd">all</span> <span class="o">=&gt;</span> <span class="kd">u</span> <span class="o">&amp;</span> <span class="kd">v</span> <span class="o">&amp;</span> <span class="kd">w</span> <span class="o">&amp;</span> <span class="kd">x</span> <span class="o">&amp;</span> <span class="kd">y</span> <span class="o">&amp;</span> <span class="kd">z</span>
                <span class="s2">&quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[FAM1, FAM2]]</span>
    <span class="nt">[[d,e,f,g]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> FAM1</span>
    <span class="nt">[[q,r,s,t]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> FAM2</span>
</pre></div>
</div>
</div>
<div class="section" id="automatic-task-retry-on-failure">
<span id="taskretries"></span><h3>13.18. Automatic Task Retry On Failure<a class="headerlink" href="#automatic-task-retry-on-failure" title="Permalink to this headline">¶</a></h3>
<p>See also <a class="reference internal" href="index.html#refretries"><span class="std std-ref">[runtime] -&gt; [[__NAME__]] -&gt; [[[job]]] -&gt; execution retry delays</span></a>.</p>
<p>Tasks can be configured with a list of “retry delay” intervals, as
ISO 8601 durations. If the task job fails it will go into the <em>retrying</em>
state and resubmit after the next configured delay interval. An example is
shown in the suite listed below under <a class="reference internal" href="#eventhandling"><span class="std std-ref">Task Event Handling</span></a>.</p>
<p>If a task with configured retries is <em>killed</em> (by <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">kill</span></code> or
via the GUI) it goes to the <em>held</em> state so that the operator can decide
whether to release it and continue the retry sequence or to abort the retry
sequence by manually resetting it to the <em>failed</em> state.</p>
</div>
<div class="section" id="task-event-handling">
<span id="eventhandling"></span><h3>13.19. Task Event Handling<a class="headerlink" href="#task-event-handling" title="Permalink to this headline">¶</a></h3>
<p>See also <a class="reference internal" href="index.html#suiteeventhandling"><span class="std std-ref">[cylc] -&gt; [[events]]</span></a> and <a class="reference internal" href="index.html#taskeventhandling"><span class="std std-ref">[runtime] -&gt; [[__NAME__]] -&gt; [[[events]]]</span></a>.</p>
<p>Cylc can call nominated event handlers - to do whatever you like - when certain
suite or task events occur. This facilitates centralized alerting and automated
handling of critical events. Event handlers can be used to send a message, call
a pager, or whatever; they can even intervene in the operation of their own
suite using cylc commands.</p>
<p>To send an email, use the built-in setting <code class="docutils literal notranslate"><span class="pre">[[[events]]]mail</span> <span class="pre">events</span></code>
to specify a list of events for which notifications should be sent. (The
name of a registered task output can also be used as an event name in
this case.) E.g. to send an email on (submission) failed and retry:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nv">script </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            test ${CYLC_TASK_TRY_NUMBER} -eq 3</span>
<span class="s2">            cylc message -- &quot;${CYLC_SUITE_NAME}&quot; &quot;${CYLC_TASK_JOB}&quot; &#39;oopsy daisy&#39;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="nt">[[[events]]]</span>
            <span class="nv">mail events </span><span class="o">=</span><span class="s"> submission failed, submission retry, failed, retry, oops</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">execution retry delays </span><span class="o">=</span><span class="s"> PT0S, PT30S</span>
        <span class="nt">[[[outputs]]]</span>
            <span class="nv">oops </span><span class="o">=</span><span class="s"> oopsy daisy</span>
</pre></div>
</div>
<p>By default, the emails will be sent to the current user with:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">to:</span></code> set as <code class="docutils literal notranslate"><span class="pre">$USER</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">from:</span></code> set as <code class="docutils literal notranslate"><span class="pre">notifications&#64;$(hostname)</span></code></li>
<li>SMTP server at <code class="docutils literal notranslate"><span class="pre">localhost:25</span></code></li>
</ul>
<p>These can be configured using the settings:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">[[[events]]]mail</span> <span class="pre">to</span></code> (list of email addresses),</li>
<li><code class="docutils literal notranslate"><span class="pre">[[[events]]]mail</span> <span class="pre">from</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">[[[events]]]mail</span> <span class="pre">smtp</span></code>.</li>
</ul>
<p>By default, a cylc suite will send you no more than one task event email every
5 minutes - this is to prevent your inbox from being flooded by emails should a
large group of tasks all fail at similar time.
See <a class="reference internal" href="index.html#task-event-mail-interval"><span class="std std-ref">[cylc] -&gt; task event mail interval</span></a> for details.</p>
<p>Event handlers can be located in the suite <code class="docutils literal notranslate"><span class="pre">bin/</span></code> directory;
otherwise it is up to you to ensure their location is in <code class="docutils literal notranslate"><span class="pre">$PATH</span></code> (in
the shell in which the suite server program runs). They should require little
resource and return quickly - see <a class="reference internal" href="#managing-external-command-execution"><span class="std std-ref">Managing External Command Execution</span></a>.</p>
<p>Task event handlers can be specified using the
<code class="docutils literal notranslate"><span class="pre">[[[events]]]&lt;event&gt;</span> <span class="pre">handler</span></code> settings, where
<code class="docutils literal notranslate"><span class="pre">&lt;event&gt;</span></code> is one of:</p>
<ul class="simple">
<li>‘submitted’ - the job submit command was successful</li>
<li>‘submission failed’ - the job submit command failed</li>
<li>‘submission timeout’ - task job submission timed out</li>
<li>‘submission retry’ - task job submission failed, but will retry after
a configured delay</li>
<li>‘started’ - the task reported commencement of execution</li>
<li>‘succeeded’ - the task reported successful completion</li>
<li>‘warning’ - the task reported a WARNING severity message</li>
<li>‘critical’ - the task reported a CRITICAL severity message</li>
<li>‘custom’ - the task reported a CUSTOM severity message</li>
<li>‘late’ - the task is never active and is late</li>
<li>‘failed’ - the task failed</li>
<li>‘retry’ - the task failed but will retry after a configured delay</li>
<li>‘execution timeout’ - task execution timed out</li>
</ul>
<p>The value of each setting should be a list of command lines or command line
templates (see below).</p>
<p>Alternatively you can use <code class="docutils literal notranslate"><span class="pre">[[[events]]]handlers</span></code> and
<code class="docutils literal notranslate"><span class="pre">[[[events]]]handler</span> <span class="pre">events</span></code>, where the former is a list of command
lines or command line templates (see below) and the latter is a list of events
for which these commands should be invoked. (The name of a registered task
output can also be used as an event name in this case.)</p>
<p>Event handler arguments can be constructed from various templates
representing suite name; task ID, name, cycle point, message, and submit
number name; and any suite or task <code class="docutils literal notranslate"><span class="pre">[meta]</span></code> item.
See <a class="reference internal" href="index.html#suiteeventhandling"><span class="std std-ref">[cylc] -&gt; [[events]]</span></a> and <a class="reference internal" href="index.html#taskeventhandling"><span class="std std-ref">[runtime] -&gt; [[__NAME__]] -&gt; [[[events]]]</span></a> for options.</p>
<p>If no template arguments are supplied the following default command line
will be used:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;task-event-handler&gt; %(event)s %(suite)s %(id)s %(message)s
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Substitution patterns should not be quoted in the template strings.
This is done automatically where required.</p>
</div>
<p>For an explanation of the substitution syntax, see
<a class="reference external" href="https://docs.python.org/2/library/stdtypes.html#string-formatting">String Formatting Operations</a>
in the Python documentation.</p>
<p>The retry event occurs if a task fails and has any remaining retries
configured (see <a class="reference internal" href="#taskretries"><span class="std std-ref">Automatic Task Retry On Failure</span></a>).
The event handler will be called as soon as the task fails, not after
the retry delay period when it is resubmitted.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Event handlers are called by the suite server program, not by
task jobs. If you wish to pass additional information to them use
<code class="docutils literal notranslate"><span class="pre">[cylc]</span> <span class="pre">-&gt;</span> <span class="pre">[[environment]]</span></code>, not task runtime environment.</p>
</div>
<p>The following two <code class="docutils literal notranslate"><span class="pre">suite.rc</span></code> snippets are examples on how to specify
event handlers using the alternate methods:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> test ${CYLC_TASK_TRY_NUMBER} -eq 2</span>
        <span class="nt">[[[events]]]</span>
            <span class="nv">retry handler </span><span class="o">=</span><span class="s"> &quot;echo &#39;!!!!!EVENT!!!!!&#39; &quot;</span>
            <span class="nv">failed handler </span><span class="o">=</span><span class="s"> &quot;echo &#39;!!!!!EVENT!!!!!&#39; &quot;</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">execution retry delays </span><span class="o">=</span><span class="s"> PT0S, PT30S</span>
</pre></div>
</div>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nv">script </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            test ${CYLC_TASK_TRY_NUMBER} -eq 2</span>
<span class="s2">            cylc message -- &quot;${CYLC_SUITE_NAME}&quot; &quot;${CYLC_TASK_JOB}&quot; &#39;oopsy daisy&#39;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="nt">[[[events]]]</span>
            <span class="nv">handlers </span><span class="o">=</span><span class="s"> &quot;echo &#39;!!!!!EVENT!!!!!&#39; &quot;</span>
            <span class="c1"># Note: task output name can be used as an event in this method</span>
            <span class="nv">handler events </span><span class="o">=</span><span class="s"> retry, failed, oops</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">execution retry delays </span><span class="o">=</span><span class="s"> PT0S, PT30S</span>
        <span class="nt">[[[outputs]]]</span>
            <span class="nv">oops </span><span class="o">=</span><span class="s"> oopsy daisy</span>
</pre></div>
</div>
<p>The handler command here - specified with no arguments - is called with the
default arguments, like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s1">&#39;!!!!!EVENT!!!!!&#39;</span> %<span class="o">(</span>event<span class="o">)</span>s %<span class="o">(</span>suite<span class="o">)</span>s %<span class="o">(</span>id<span class="o">)</span>s %<span class="o">(</span>message<span class="o">)</span>s
</pre></div>
</div>
<div class="section" id="late-events">
<span id="id9"></span><h4>13.19.1. Late Events<a class="headerlink" href="#late-events" title="Permalink to this headline">¶</a></h4>
<p>You may want to be notified when certain tasks are running late in a real time
production system - i.e. when they have not triggered by <em>the usual time</em>.
Tasks of primary interest are not normally clock-triggered however, so their
trigger times are mostly a function of how the suite runs in its environment,
and even external factors such as contention with other suites <a class="footnote-reference" href="#id17" id="id10">[3]</a> .</p>
<p>But if your system is reasonably stable from one cycle to the next such that a
given task has consistently triggered by some interval beyond its cycle point,
you can configure Cylc to emit a <em>late event</em> if it has not triggered by
that time. For example, if a task <code class="docutils literal notranslate"><span class="pre">forecast</span></code> normally triggers by 30
minutes after its cycle point, configure late notification for it like this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
   <span class="nt">[[forecast]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> run-model.sh</span>
        <span class="nt">[[[events]]]</span>
            <span class="nv">late offset </span><span class="o">=</span><span class="s"> PT30M</span>
            <span class="nv">late handler </span><span class="o">=</span><span class="s"> my-handler %(message)s</span>
</pre></div>
</div>
<p><em>Late offset intervals are not computed automatically so be careful
to update them after any change that affects triggering times.</em></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Cylc can only check for lateness in tasks that it is currently aware
of. If a suite gets delayed over many cycles the next tasks coming up
can be identified as late immediately, and subsequent tasks can be
identified as late as the suite progresses to subsequent cycle points,
until it catches up to the clock.</p>
</div>
</div>
</div>
<div class="section" id="managing-external-command-execution">
<span id="id11"></span><h3>13.20. Managing External Command Execution<a class="headerlink" href="#managing-external-command-execution" title="Permalink to this headline">¶</a></h3>
<p>Job submission commands, event handlers, and job poll and kill commands, are
executed by the suite server program in a “pool” of asynchronous
subprocesses, in order to avoid holding the suite up. The process pool is
actively managed to limit it to a configurable size (<a class="reference internal" href="index.html#process-pool-size"><span class="std std-ref">process pool size</span></a>).
Custom event handlers should be light-weight and quick-running because they
will tie up a process pool member until they complete, and the suite will
appear to stall if the pool is saturated with long-running processes. Processes
are killed after a configurable timeout (<a class="reference internal" href="index.html#process-pool-timeout"><span class="std std-ref">process pool timeout</span></a>) however,
to guard against rogue commands that hang indefinitely. All process kills are
logged by the suite server program. For killed job submissions the associated
tasks also go to the <em>submit-failed</em> state.</p>
</div>
<div class="section" id="handling-job-preemption">
<span id="preemptionhpc"></span><h3>13.21. Handling Job Preemption<a class="headerlink" href="#handling-job-preemption" title="Permalink to this headline">¶</a></h3>
<p>Some HPC facilities allow job preemption: the resource manager can kill
or suspend running low priority jobs in order to make way for high
priority jobs. The preempted jobs may then be automatically restarted
by the resource manager, from the same point (if suspended) or requeued
to run again from the start (if killed).</p>
<p>Suspended jobs will poll as still running (their job status file says they
started running, and they still appear in the resource manager queue).
Loadleveler jobs that are preempted by kill-and-requeue (“job vacation”) are
automatically returned to the submitted state by Cylc.  This is possible
because Loadleveler sends the SIGUSR1 signal before SIGKILL for preemption.
Other batch schedulers just send SIGTERM before SIGKILL as normal, so Cylc
cannot distinguish a preemption job kill from a normal job kill. After this the
job will poll as failed (correctly, because it was killed, and the job status
file records that). To handle this kind of preemption automatically you could
use a task failed or retry event handler that queries the batch scheduler queue
(after an appropriate delay if necessary) and then, if the job has been
requeued, uses <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">reset</span></code> to reset the task to the submitted state.</p>
</div>
<div class="section" id="manual-task-triggering-and-edit-run">
<h3>13.22. Manual Task Triggering and Edit-Run<a class="headerlink" href="#manual-task-triggering-and-edit-run" title="Permalink to this headline">¶</a></h3>
<p>Any task proxy currently present in the suite can be manually triggered at any
time using the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">trigger</span></code> command, or from the right-click task
menu in gcylc. If the task belongs to a limited internal queue
(see <a class="reference internal" href="#internalqueues"><span class="std std-ref">Limiting Activity With Internal Queues</span></a>), this will queue it; if not, or if it is already
queued, it will submit immediately.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">trigger</span> <span class="pre">--edit</span></code> (also in the gcylc right-click task menu)
you can edit the generated task job script to make one-off changes before the
task submits.</p>
</div>
<div class="section" id="cylc-broadcast">
<span id="id12"></span><h3>13.23. Cylc Broadcast<a class="headerlink" href="#cylc-broadcast" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">broadcast</span></code> command overrides <code class="docutils literal notranslate"><span class="pre">[runtime]</span></code>
settings in a running suite. This can
be used to communicate information to downstream tasks by broadcasting
environment variables (communication of information from one task to
another normally takes place via the filesystem, i.e. the input/output
file relationships embodied in inter-task dependencies). Variables (and
any other runtime settings) may be broadcast to all subsequent tasks,
or targeted specifically at a specific task, all subsequent tasks with a
given name, or all tasks with a given cycle point; see broadcast command help
for details.</p>
<p>Broadcast settings targeted at a specific task ID or cycle point expire and
are forgotten as the suite moves on. Un-targeted variables and those
targeted at a task name persist throughout the suite run, even across
restarts, unless manually cleared using the broadcast command - and so
should be used sparingly.</p>
</div>
<div class="section" id="the-meaning-and-use-of-initial-cycle-point">
<h3>13.24. The Meaning And Use Of Initial Cycle Point<a class="headerlink" href="#the-meaning-and-use-of-initial-cycle-point" title="Permalink to this headline">¶</a></h3>
<p>When a suite is started with the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">run</span></code> command (cold or
warm start) the cycle point at which it starts can be given on the command
line or hardwired into the suite.rc file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cylc run foo 20120808T06Z
</pre></div>
</div>
<p>or:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20100808T06Z</span>
</pre></div>
</div>
<p>An initial cycle given on the command line will override one in the
suite.rc file.</p>
<div class="section" id="the-environment-variable-cylc-suite-initial-cycle-point">
<h4>13.24.1. The Environment Variable CYLC_SUITE_INITIAL_CYCLE_POINT<a class="headerlink" href="#the-environment-variable-cylc-suite-initial-cycle-point" title="Permalink to this headline">¶</a></h4>
<p>In the case of a <em>cold start only</em> the initial cycle point is passed
through to task execution environments as
<code class="docutils literal notranslate"><span class="pre">$CYLC_SUITE_INITIAL_CYCLE_POINT</span></code>. The value is then stored in
suite database files and persists across restarts, but it does get wiped out
(set to <code class="docutils literal notranslate"><span class="pre">None</span></code>) after a warm start, because a warm start is really an
implicit restart in which all state information is lost (except that the
previous cycle is assumed to have completed).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">$CYLC_SUITE_INITIAL_CYCLE_POINT</span></code> variable allows tasks to
determine if they are running in the initial cold-start cycle point, when
different behaviour may be required, or in a normal mid-run cycle point.
Note however that an initial <code class="docutils literal notranslate"><span class="pre">R1</span></code> graph section is now the preferred
way to get different behaviour at suite start-up.</p>
</div>
</div>
<div class="section" id="simulating-suite-behaviour">
<span id="simulationmode"></span><h3>13.25. Simulating Suite Behaviour<a class="headerlink" href="#simulating-suite-behaviour" title="Permalink to this headline">¶</a></h3>
<p>Several suite run modes allow you to simulate suite behaviour quickly without
running the suite’s real jobs - which may be long-running and resource-hungry:</p>
<ul class="simple">
<li><em>dummy mode</em> - runs dummy tasks as background jobs on configured
job hosts.<ul>
<li>simulates scheduling, job host connectivity, and
generates all job files on suite and job hosts.</li>
</ul>
</li>
<li><em>dummy-local mode</em> - runs real dummy tasks as background jobs on
the suite host, which allows dummy-running suites from other sites.<ul>
<li>simulates scheduling and generates all job files on the
suite host.</li>
</ul>
</li>
<li><em>simulation mode</em> - does not run any real tasks.<ul>
<li>simulates scheduling without generating any job files.</li>
</ul>
</li>
</ul>
<p>Set the run mode (default <em>live</em>) in the GUI suite start dialog box, or on
the command line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cylc run --mode<span class="o">=</span>dummy SUITE
$ cylc restart --mode<span class="o">=</span>dummy SUITE
</pre></div>
</div>
<p>You can get specified tasks to fail in these modes, for more flexible suite
testing. See <a class="reference internal" href="index.html#suiterc-sim-config"><span class="std std-ref">[runtime] -&gt; [[__NAME__]] -&gt; [[[simulation]]]</span></a> for simulation configuration.</p>
<div class="section" id="proportional-simulated-run-length">
<h4>13.25.1. Proportional Simulated Run Length<a class="headerlink" href="#proportional-simulated-run-length" title="Permalink to this headline">¶</a></h4>
<p>If task <code class="docutils literal notranslate"><span class="pre">[job]execution</span> <span class="pre">time</span> <span class="pre">limit</span></code> is set, Cylc divides it by
<code class="docutils literal notranslate"><span class="pre">[simulation]speedup</span> <span class="pre">factor</span></code> (default <code class="docutils literal notranslate"><span class="pre">10.0</span></code>) to compute
simulated task run lengths (default 10 seconds).</p>
</div>
<div class="section" id="limitations-of-suite-simulation">
<h4>13.25.2. Limitations Of Suite Simulation<a class="headerlink" href="#limitations-of-suite-simulation" title="Permalink to this headline">¶</a></h4>
<p>Dummy mode ignores batch scheduler settings because Cylc does not know which
job resource directives (requested memory, number of compute nodes, etc.) would
need to be changed for the dummy jobs.  If you need to dummy-run jobs on a
batch scheduler manually comment out <code class="docutils literal notranslate"><span class="pre">script</span></code> items and modify
directives in your live suite, or else use a custom live mode test suite.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The dummy modes ignore all configured task <code class="docutils literal notranslate"><span class="pre">script</span></code> items
including <code class="docutils literal notranslate"><span class="pre">init-script</span></code>. If your <code class="docutils literal notranslate"><span class="pre">init-script</span></code> is required
to run even dummy tasks on a job host, note that host environment
setup should be done
elsewhere - see <a class="reference internal" href="index.html#configure-site-environment-on-job-hosts"><span class="std std-ref">Configure Site Environment on Job Hosts</span></a>.</p>
</div>
</div>
<div class="section" id="restarting-suites-with-a-different-run-mode">
<h4>13.25.3. Restarting Suites With A Different Run Mode?<a class="headerlink" href="#restarting-suites-with-a-different-run-mode" title="Permalink to this headline">¶</a></h4>
<p>The run mode is recorded in the suite run database files. Cylc will not let
you <em>restart</em> a non-live mode suite in live mode, or vice versa. To
test a live suite in simulation mode just take a quick copy of it and run the
the copy in simulation mode.</p>
</div>
</div>
<div class="section" id="automated-reference-test-suites">
<span id="autoreftests"></span><h3>13.26. Automated Reference Test Suites<a class="headerlink" href="#automated-reference-test-suites" title="Permalink to this headline">¶</a></h3>
<p>Reference tests are finite-duration suite runs that abort with non-zero
exit status if any of the following conditions occur (by default):</p>
<ul class="simple">
<li>cylc fails</li>
<li>any task fails</li>
<li>the suite times out (e.g. a task dies without reporting failure)</li>
<li>a nominated shutdown event handler exits with error status</li>
</ul>
<p>The default shutdown event handler for reference tests is
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">hook</span> <span class="pre">check-triggering</span></code> which compares task triggering
information (what triggers off what at run time) in the test run suite
log to that from an earlier reference run, disregarding the timing and
order of events - which can vary according to the external queueing
conditions, runahead limit, and so on.</p>
<p>To prepare a reference log for a suite, run it with the
<code class="docutils literal notranslate"><span class="pre">--reference-log</span></code> option, and manually verify the
correctness of the reference run.</p>
<p>To reference test a suite, just run it (in dummy mode for the most
comprehensive test without running real tasks) with the
<code class="docutils literal notranslate"><span class="pre">--reference-test</span></code> option.</p>
<p>A battery of automated reference tests is used to test cylc before
posting a new release version. Reference tests can also be used to check that
a cylc upgrade will not break your own complex
suites - the triggering check will catch any bug that causes a task to
run when it shouldn’t, for instance; even in a dummy mode reference
test the full task job script (sans <code class="docutils literal notranslate"><span class="pre">script</span></code> items) executes on the
proper task host by the proper batch system.</p>
<p>Reference tests can be configured with the following settings:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[reference test]]</span>
        <span class="nv">suite shutdown event handler </span><span class="o">=</span><span class="s"> cylc check-triggering</span>
        <span class="nv">required run mode </span><span class="o">=</span><span class="s"> dummy</span>
        <span class="nv">allow task failures </span><span class="o">=</span><span class="s"> False</span>
        <span class="nv">live mode suite timeout </span><span class="o">=</span><span class="s"> PT5M</span>
        <span class="nv">dummy mode suite timeout </span><span class="o">=</span><span class="s"> PT2M</span>
        <span class="nv">simulation mode suite timeout </span><span class="o">=</span><span class="s"> PT2M</span>
</pre></div>
</div>
<div class="section" id="roll-your-own-reference-tests">
<h4>13.26.1. Roll-your-own Reference Tests<a class="headerlink" href="#roll-your-own-reference-tests" title="Permalink to this headline">¶</a></h4>
<p>If the default reference test is not sufficient for your needs, firstly
note that you can override the default shutdown event handler, and
secondly that the <code class="docutils literal notranslate"><span class="pre">--reference-test</span></code> option is merely a short
cut to the following suite.rc settings which can also be set manually if
you wish:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nv">abort if any task fails </span><span class="o">=</span><span class="s"> True</span>
    <span class="nt">[[events]]</span>
        <span class="nv">shutdown handler </span><span class="o">=</span><span class="s"> cylc check-triggering</span>
        <span class="nv">timeout </span><span class="o">=</span><span class="s"> PT5M</span>
        <span class="nv">abort if shutdown handler fails </span><span class="o">=</span><span class="s"> True</span>
        <span class="nv">abort on timeout </span><span class="o">=</span><span class="s"> True</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="triggering-off-of-tasks-in-other-suites">
<span id="suitestatepolling"></span><h3>13.27. Triggering Off Of Tasks In Other Suites<a class="headerlink" href="#triggering-off-of-tasks-in-other-suites" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please read <a class="reference internal" href="index.html#external-triggers"><span class="std std-ref">External Triggers</span></a> before using
the older inter-suite triggering mechanism described in this section.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">suite-state</span></code> command interrogates suite run databases. It
has a polling mode that waits for a given task in the target suite to achieve a
given state, or receive a given message. This can be used to make task
scripting wait for a remote task to succeed (for example).</p>
<p>Automatic suite-state polling tasks can be defined with in the graph. They get
automatically-generated task scripting that uses <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">suite-state</span></code>
appropriately (it is an error to give your own <code class="docutils literal notranslate"><span class="pre">script</span></code> item for these
tasks).</p>
<p>Here’s how to trigger a task <code class="docutils literal notranslate"><span class="pre">bar</span></code> off a task <code class="docutils literal notranslate"><span class="pre">foo</span></code> in
a remote suite called <code class="docutils literal notranslate"><span class="pre">other.suite</span></code>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[T00, T12]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">my</span><span class="c">-</span><span class="kd">foo</span>&lt;<span class="bp">other.suite</span>::<span class="nb">foo</span>&gt; <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>Local task <code class="docutils literal notranslate"><span class="pre">my-foo</span></code> will poll for the success of <code class="docutils literal notranslate"><span class="pre">foo</span></code>
in suite <code class="docutils literal notranslate"><span class="pre">other.suite</span></code>, at the same cycle point, succeeding only when
or if it succeeds. Other task states can also be polled:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">my</span><span class="c">-</span><span class="kd">foo</span>&lt;<span class="bp">other.suite</span>::<span class="nb">foo:fail</span>&gt; <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>The default polling parameters (e.g. maximum number of polls and the interval
between them) are printed by <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">suite-state</span> <span class="pre">--help</span></code> and can be
configured if necessary under the local polling task runtime section:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[ dependencies]]</span>
        <span class="nt">[[[T00,T12]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">my</span><span class="c">-</span><span class="kd">foo</span>&lt;<span class="bp">other.suite</span>::<span class="nb">foo</span>&gt; <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[my-foo]]</span>
        <span class="nt">[[[suite state polling]]]</span>
            <span class="nv">max-polls </span><span class="o">=</span><span class="s"> 100</span>
            <span class="nv">interval </span><span class="o">=</span><span class="s"> PT10S</span>
</pre></div>
</div>
<p>To poll for the target task to receive a message rather than achieve a state,
give the message in the runtime configuration (in which case the task status
inferred from the graph syntax will be ignored):</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[my-foo]]</span>
        <span class="nt">[[[suite state polling]]]</span>
            <span class="nv">message </span><span class="o">=</span><span class="s"> &quot;the quick brown fox&quot;</span>
</pre></div>
</div>
<p>For suites owned by others, or those with run databases in non-standard
locations, use the <code class="docutils literal notranslate"><span class="pre">--run-dir</span></code> option, or in-suite:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[my-foo]]</span>
        <span class="nt">[[[suite state polling]]]</span>
            <span class="nv">run-dir </span><span class="o">=</span><span class="s"> /path/to/top/level/cylc/run-directory</span>
</pre></div>
</div>
<p>If the remote task has a different cycling sequence, just arrange for the
local polling task to be on the same sequence as the remote task that it
represents. For instance, if local task <code class="docutils literal notranslate"><span class="pre">cat</span></code> cycles 6-hourly at
<code class="docutils literal notranslate"><span class="pre">0,6,12,18</span></code> but needs to trigger off a remote task <code class="docutils literal notranslate"><span class="pre">dog</span></code>
at <code class="docutils literal notranslate"><span class="pre">3,9,15,21</span></code>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[T03,T09,T15,T21]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">my</span><span class="c">-</span><span class="kd">dog</span>&lt;<span class="bp">other.suite</span>::<span class="nb">dog</span>&gt;<span class="c">&quot;</span>
        <span class="nt">[[[T00,T06,T12,T18]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">my</span><span class="c">-</span><span class="kd">dog</span>[<span class="nb">-PT3H</span>] <span class="o">=&gt;</span> <span class="kd">cat</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>For suite-state polling, the cycle point is automatically converted to the
cycle point format of the target suite.</p>
<p>The remote suite does not have to be running when polling commences because the
command interrogates the suite run database, not the suite server program.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The graph syntax for suite polling tasks cannot be combined with
cycle point offsets, family triggers, or parameterized task notation.
This does not present a problem because suite polling tasks can be put on
the same cycling sequence as the remote-suite target task (as recommended
above), and there is no point in having multiple tasks (family members or
parameterized tasks) performing the same polling operation. Task state
triggers can be used with suite polling, e.g. to trigger another task if
polling fails after 10 tries at 10 second intervals:</p>
<div class="last highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">poller</span>&lt;<span class="bp">other-suite</span>::<span class="nb">foo:succeed</span>&gt;<span class="c">:</span><span class="kd">fail</span> <span class="o">=&gt;</span> <span class="kd">another</span><span class="c">-</span><span class="kd">task</span><span class="c">&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[my-foo]]</span>
        <span class="nt">[[[suite state polling]]]</span>
            <span class="nv">max-polls </span><span class="o">=</span><span class="s"> 10</span>
            <span class="nv">interval </span><span class="o">=</span><span class="s"> PT10S</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="suite-server-logs">
<span id="id13"></span><h3>13.28. Suite Server Logs<a class="headerlink" href="#suite-server-logs" title="Permalink to this headline">¶</a></h3>
<p>Each suite maintains its own log of time-stamped events under the <em>suite
server log directory</em>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$HOME</span>/cylc-run/SUITE-NAME/log/suite/
</pre></div>
</div>
<p>By way of example, we will show the complete server log generated (at
cylc-7.2.0) by a small suite that runs two 30-second dummy tasks
<code class="docutils literal notranslate"><span class="pre">foo</span></code> and <code class="docutils literal notranslate"><span class="pre">bar</span></code> for a single cycle point
<code class="docutils literal notranslate"><span class="pre">2017-01-01T00Z</span></code> before shutting down:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nv">cycle point format </span><span class="o">=</span><span class="s"> %Y-%m-%dT%HZ</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2017-01-01T00Z</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> 2017-01-01T00Z</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">bar</span><span class="c">&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> sleep 30; /bin/false</span>
    <span class="nt">[[bar]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> sleep 30; /bin/true</span>
</pre></div>
</div>
<p>By the task scripting defined above, this suite will stall when <code class="docutils literal notranslate"><span class="pre">foo</span></code>
fails. Then, the suite owner <em>vagrant&#64;cylon</em> manually resets the failed
task’s state to <em>succeeded</em>, allowing <code class="docutils literal notranslate"><span class="pre">bar</span></code> to trigger and the
suite to finish and shut down.  Here’s the complete suite log for this run:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cylc cat-log SUITE-NAME
2017-03-30T09:46:10Z INFO - Suite starting: server=localhost:43086 pid=3483
2017-03-30T09:46:10Z INFO - Run mode: live
2017-03-30T09:46:10Z INFO - Initial point: 2017-01-01T00Z
2017-03-30T09:46:10Z INFO - Final point: 2017-01-01T00Z
2017-03-30T09:46:10Z INFO - Cold Start 2017-01-01T00Z
2017-03-30T09:46:11Z INFO - [foo.2017-01-01T00Z] -submit_method_id=3507
2017-03-30T09:46:11Z INFO - [foo.2017-01-01T00Z] -submission succeeded
2017-03-30T09:46:11Z INFO - [foo.2017-01-01T00Z] status=submitted: (received)started at 2017-03-30T09:46:10Z for job(01)
2017-03-30T09:46:41Z CRITICAL - [foo.2017-01-01T00Z] status=running: (received)failed/EXIT at 2017-03-30T09:46:40Z for job(01)
2017-03-30T09:46:42Z WARNING - suite stalled
2017-03-30T09:46:42Z WARNING - Unmet prerequisites for bar.2017-01-01T00Z:
2017-03-30T09:46:42Z WARNING -  * foo.2017-01-01T00Z succeeded
2017-03-30T09:47:58Z INFO - [client-command] reset_task_states vagrant@cylon:cylc-reset 1e0d8e9f-2833-4dc9-a0c8-9cf263c4c8c3
2017-03-30T09:47:58Z INFO - [foo.2017-01-01T00Z] -resetting state to succeeded
2017-03-30T09:47:58Z INFO - Command succeeded: reset_task_states([u&#39;foo.2017&#39;], state=succeeded)
2017-03-30T09:47:59Z INFO - [bar.2017-01-01T00Z] -submit_method_id=3565
2017-03-30T09:47:59Z INFO - [bar.2017-01-01T00Z] -submission succeeded
2017-03-30T09:47:59Z INFO - [bar.2017-01-01T00Z] status=submitted: (received)started at 2017-03-30T09:47:58Z for job(01)
2017-03-30T09:48:29Z INFO - [bar.2017-01-01T00Z] status=running: (received)succeeded at 2017-03-30T09:48:28Z for job(01)
2017-03-30T09:48:30Z INFO - Waiting for the command process pool to empty for shutdown
2017-03-30T09:48:30Z INFO - Suite shutting down - AUTOMATIC
</pre></div>
</div>
<p>The information logged here includes:</p>
<ul class="simple">
<li>event timestamps, at the start of each line</li>
<li>suite server host, port and process ID</li>
<li>suite initial and final cycle points</li>
<li>suite start type (cold start in this case)</li>
<li>task events (task started, succeeded, failed, etc.)</li>
<li>suite stalled warning (in this suite nothing else can run when
<code class="docutils literal notranslate"><span class="pre">foo</span></code> fails)</li>
<li>the client command issued by <em>vagrant&#64;cylon</em> to reset
<code class="docutils literal notranslate"><span class="pre">foo</span></code> to {em succeeded}</li>
<li>job IDs  - in this case process IDs for background jobs (or PBS job IDs
etc.)</li>
<li>state changes due to incoming task progress message  (“started at …”
etc.) suite shutdown time and reasons (AUTOMATIC means “all tasks finished
and nothing else to do”)</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Suite log files are primarily intended for human eyes. If you need
to have an external system to monitor suite events automatically,
interrogate the sqlite <em>suite run database</em>
(see <a class="reference internal" href="#suite-run-databases"><span class="std std-ref">Suite Run Databases</span></a>) rather than parse the log files.</p>
</div>
</div>
<div class="section" id="suite-run-databases">
<span id="id14"></span><h3>13.29. Suite Run Databases<a class="headerlink" href="#suite-run-databases" title="Permalink to this headline">¶</a></h3>
<p>Suite server programs maintain two <code class="docutils literal notranslate"><span class="pre">sqlite</span></code> databases to record
restart checkpoints and various other aspects of run history:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$HOME</span>/cylc-run/SUITE-NAME/log/db  <span class="c1"># public suite DB</span>
<span class="nv">$HOME</span>/cylc-run/SUITE-NAME/.service/db  <span class="c1"># private suite DB</span>
</pre></div>
</div>
<p>The private DB is for use only by the suite server program. The identical
public DB is provided for use by external commands such as
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">suite-state</span></code>, <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">ls-checkpoints</span></code>, and
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">report-timings</span></code>. If the public DB gets locked for too long by
an external reader, the suite server program will eventually delete it and
replace it with a new copy of the private DB, to ensure that both correctly
reflect the suite state.</p>
<p>You can interrogate the public DB with the <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> command line tool,
the <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> module in the Python standard library, or any other
sqlite interface.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sqlite3 ~/cylc-run/foo/log/db <span class="s">&lt;&lt; _END_</span>
<span class="s">&gt; .headers on</span>
<span class="s">&gt; select * from task_events where name is &quot;foo&quot;;</span>
<span class="s">&gt; _END_</span>
name<span class="p">|</span>cycle<span class="p">|</span>time<span class="p">|</span>submit_num<span class="p">|</span>event<span class="p">|</span>message
foo<span class="p">|</span><span class="m">1</span><span class="p">|</span><span class="m">2017</span>-03-12T11:06:09Z<span class="p">|</span><span class="m">1</span><span class="p">|</span>submitted<span class="p">|</span>
foo<span class="p">|</span><span class="m">1</span><span class="p">|</span><span class="m">2017</span>-03-12T11:06:09Z<span class="p">|</span><span class="m">1</span><span class="p">|</span>output completed<span class="p">|</span>started
foo<span class="p">|</span><span class="m">1</span><span class="p">|</span><span class="m">2017</span>-03-12T11:06:09Z<span class="p">|</span><span class="m">1</span><span class="p">|</span>started<span class="p">|</span>
foo<span class="p">|</span><span class="m">1</span><span class="p">|</span><span class="m">2017</span>-03-12T11:06:19Z<span class="p">|</span><span class="m">1</span><span class="p">|</span>output completed<span class="p">|</span>succeeded
foo<span class="p">|</span><span class="m">1</span><span class="p">|</span><span class="m">2017</span>-03-12T11:06:19Z<span class="p">|</span><span class="m">1</span><span class="p">|</span>succeeded<span class="p">|</span>
</pre></div>
</div>
</div>
<div class="section" id="disaster-recovery">
<span id="id15"></span><h3>13.30. Disaster Recovery<a class="headerlink" href="#disaster-recovery" title="Permalink to this headline">¶</a></h3>
<p>If a suite run directory gets deleted or corrupted, the options for recovery
are:</p>
<ul class="simple">
<li>restore the run directory from back-up, and restart the suite</li>
<li>re-install from source, and warm start from the beginning of the
current cycle point</li>
</ul>
<p>A warm start (see <a class="reference internal" href="#warm-start"><span class="std std-ref">Warm Start</span></a>) does not need a suite state
checkpoint, but it wipes out prior run history, and it could re-run
a significant number of tasks that had already completed.</p>
<p>To restart the suite, the critical Cylc files that must be restored are:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># On the suite host:</span>
~/cylc-run/SUITE-NAME/
    suite.rc   <span class="c1"># live suite configuration (located here in Rose suites)</span>
    log/db  <span class="c1"># public suite DB (can just be a copy of the private DB)</span>
    log/rose-suite-run.conf  <span class="c1"># (needed to restart a Rose suite)</span>
    .service/db  <span class="c1"># private suite DB</span>
    .service/source -&gt; PATH-TO-SUITE-DIR  <span class="c1"># symlink to live suite directory</span>

<span class="c1"># On job hosts (if no shared filesystem):</span>
~/cylc-run/SUITE-NAME/
    log/job/CYCLE-POINT/TASK-NAME/SUBMIT-NUM/job.status
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This discussion does not address restoration of files generated and
consumed by task jobs at run time. How suite data is stored and recovered
in your environment is a matter of suite and system design.</p>
</div>
<p>In short, you can simply restore the suite service directory, the log
directory, and the suite.rc file that is the target of the symlink in the
service directory. The service and log directories will come with extra files
that aren’t strictly needed for a restart, but that doesn’t matter - although
depending on your log housekeeping the <code class="docutils literal notranslate"><span class="pre">log/job</span></code> directory could be
huge, so you might want to be selective about that.  (Also in a Rose suite, the
<code class="docutils literal notranslate"><span class="pre">suite.rc</span></code> file does not need to be restored if you restart with
<code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">suite-run</span></code> - which re-installs suite source files to the run
directory).</p>
<p>The public DB is not strictly required for a restart - the suite server program
will recreate it if need be - but it is required by
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">ls-checkpoints</span></code> if you need to identify the right restart
checkpoint.</p>
<p>The job status files are only needed if the restart suite state checkpoint
contains active tasks that need to be polled to determine what happened to them
while the suite was down.  Without them, polling will fail and those tasks will
need to be manually set to the correct state.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It is not safe to copy or rsync a potentially-active sqlite DB - the copy
might end up corrupted. It is best to stop the suite before copying
a DB, or else write a back-up utility using the
<a class="reference external" href="http://www.sqlite.org/backup.html">official sqlite backup API</a>.</p>
</div>
</div>
<div class="section" id="auto-stop-restart">
<span id="id16"></span><h3>13.31. Auto Stop-Restart<a class="headerlink" href="#auto-stop-restart" title="Permalink to this headline">¶</a></h3>
<p>Cylc has the ability to automatically stop suites running on a particular host
and optionally, restart them on a different host.
This is useful if a host needs to be taken off-line e.g. for
scheduled maintenance.</p>
<p>This functionality is configured via the following site configuration settings:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">[run</span> <span class="pre">hosts][suite</span> <span class="pre">servers]auto</span> <span class="pre">restart</span> <span class="pre">delay</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">[run</span> <span class="pre">hosts][suite</span> <span class="pre">servers]condemned</span> <span class="pre">hosts</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">[run</span> <span class="pre">hosts][suite</span> <span class="pre">servers]run</span> <span class="pre">hosts</span></code></li>
</ul>
<p>The auto stop-restart feature has two modes:</p>
<ul class="simple">
<li>[Normal Mode]<ul>
<li>When a host is added to the <code class="docutils literal notranslate"><span class="pre">condemned</span> <span class="pre">hosts</span></code> list, any suites
running on that host will automatically shutdown then restart selecting a
new host from <code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">hosts</span></code>.</li>
<li>For safety, before attempting to stop the suite cylc will first wait
for any jobs running locally (under background or at) to complete.</li>
<li><em>In order for Cylc to be able to successfully restart suites the
``run hosts`` must all be on a shared filesystem.</em></li>
</ul>
</li>
<li>[Force Mode]<ul>
<li>If a host is suffixed with an exclamation mark then Cylc will not attempt
to automatically restart the suite and any local jobs (running under
background or at) will be left running.</li>
</ul>
</li>
</ul>
<p>For example in the following configuration any suites running on
<code class="docutils literal notranslate"><span class="pre">foo</span></code> will attempt to restart on <code class="docutils literal notranslate"><span class="pre">pub</span></code> whereas any suites
running on <code class="docutils literal notranslate"><span class="pre">bar</span></code> will stop immediately, making no attempt to restart.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[suite servers]</span>
    <span class="nv">run hosts </span><span class="o">=</span><span class="s"> pub</span>
    <span class="nv">condemned hosts </span><span class="o">=</span><span class="s"> foo, bar!</span>
</pre></div>
</div>
<p>To prevent large numbers of suites attempting to restart simultaneously the
<code class="docutils literal notranslate"><span class="pre">auto</span> <span class="pre">restart</span> <span class="pre">delay</span></code> setting defines a period of time in seconds.
Suites will wait for a random period of time between zero and
<code class="docutils literal notranslate"><span class="pre">auto</span> <span class="pre">restart</span> <span class="pre">delay</span></code> seconds before attempting to stop and restart.</p>
<p>Suites that are started up in no-detach mode cannot be auto stop-restart on a
different host - as it will still end up attached to the condemned hosts.
Therefore, a suite in no-detach mode running on a condemned host will abort with
a non-zero return code. The parent process should manually handle the restart of
the suite if desired.</p>
<p>See the <code class="docutils literal notranslate"><span class="pre">[suite</span> <span class="pre">servers]</span></code> configuration section
(<a class="reference internal" href="index.html#global-suite-servers"><span class="std std-ref">[suite servers]</span></a>) for more details.</p>
<table class="docutils footnote" frame="void" id="id17" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id10">[3]</a></td><td>Late notification of clock-triggered tasks is not very useful in
any case because they typically do not depend on other tasks, and as
such they can often trigger on time even if the suite is delayed to
the point that downstream tasks are late due to their dependence on
previous-cycle tasks that are delayed.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="alternate-suite-run-directories">
<span id="id18"></span><h3>13.32. Alternate Suite Run Directories<a class="headerlink" href="#alternate-suite-run-directories" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">register</span></code> command normally creates a suite run directory at
the standard location <code class="docutils literal notranslate"><span class="pre">~/cylc-run/&lt;SUITE-NAME&gt;/</span></code>. With the <code class="docutils literal notranslate"><span class="pre">--run-dir</span></code>
option it can create the run directory at some other location, with a symlink
from <code class="docutils literal notranslate"><span class="pre">~/cylc-run/&lt;SUITE-NAME&gt;</span></code> to allow access via the standard file path.</p>
<p>This may be useful for quick-running <a class="reference internal" href="#sub-suites"><span class="std std-ref">Sub-Suites</span></a> that generate large
numbers of files - you could put their run directories on fast local disk or
RAM disk, for performance and housekeeping reasons.</p>
</div>
<div class="section" id="sub-suites">
<span id="id19"></span><h3>13.33. Sub-Suites<a class="headerlink" href="#sub-suites" title="Permalink to this headline">¶</a></h3>
<p>A single Cylc suite can configure multiple cycling sequences in the graph, but
cycles can’t be nested. If you need <em>cycles within cycles</em> - e.g. to iterate
over many files generated by each run of a cycling task - current options are:</p>
<ul class="simple">
<li>parameterize the sub-cycles<ul>
<li>this is easy but it makes more tasks-per-cycle, which is the primary
determinant of suite size and server program efficiency</li>
</ul>
</li>
<li>run a separate cycling suite over the sub-cycle, inside a main-suite task,
for each main-suite cycle point - i.e. use <strong>sub-suites</strong><ul>
<li>this is very efficient, but monitoring and run-directory housekeeping may
be more difficult because it creates multiple suites and run directories</li>
</ul>
</li>
</ul>
<p>Sub-suites must be started with <code class="docutils literal notranslate"><span class="pre">--no-detach</span></code> so that the containing task
does not finish until the sub-suite does, and they should be non-cycling
or have a <code class="docutils literal notranslate"><span class="pre">final</span> <span class="pre">cycle</span> <span class="pre">point</span></code> so they don’t keep on running indefinitely.</p>
<p>Sub-suite names should normally incorporate the main-suite cycle point (use
<code class="docutils literal notranslate"><span class="pre">$CYLC_TASK_CYCLE_POINT</span></code> in the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">run</span></code> command line to start the
sub-suite), so that successive sub-suites can run concurrently if necessary and
do not compete for the same run directory. This will generate a new sub-suite
run directory for every main-suite cycle point, so you may want to put
housekeeping tasks in the main suite to extract the useful products from each
sub-suite run and then delete the sub-suite run directory.</p>
<p>For quick-running sub-suites that generate large numbers of files, consider
using <a class="reference internal" href="#alternate-suite-run-directories"><span class="std std-ref">Alternate Suite Run Directories</span></a> for better performance and easier
housekeeping.</p>
</div>
</div>
<span id="document-suite-storage-etc"></span><div class="section" id="suite-storage-discovery-revision-control-and-deployment">
<span id="suitestorageetc"></span><h2>14. Suite Storage, Discovery, Revision Control, and Deployment<a class="headerlink" href="#suite-storage-discovery-revision-control-and-deployment" title="Permalink to this headline">¶</a></h2>
<p>Small groups of cylc users can of course share suites by manual copying,
and generic revision control tools can be used on cylc suites as for any
collection of files. Beyond this cylc does not have a built-in solution
for suite storage and discovery, revision control, and deployment, on a
network. That is not cylc’s core purpose, and large sites may have
preferred revision control systems and suite meta-data requirements that
are difficult to anticipate. We can, however, recommend the use of
<em>Rose</em> to do all of this very easily and elegantly with cylc suites.</p>
<div class="section" id="rose">
<span id="id1"></span><h3>14.1. Rose<a class="headerlink" href="#rose" title="Permalink to this headline">¶</a></h3>
<p><strong>Rose</strong> is <em>a framework for managing and running suites of
scientific applications</em>, developed at the Met Office for use with
cylc. It is available under the open source GPL license.</p>
<ul class="simple">
<li><a class="reference external" href="http://metomi.github.io/rose/doc/rose.html">Rose documentation</a></li>
<li><a class="reference external" href="https://github.com/metomi/rose">Rose source repository</a></li>
</ul>
</div>
</div>
<span id="document-appendices/appendices-master"></span><div class="section" id="appendices">
<h2>15. Appendices<a class="headerlink" href="#appendices" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-appendices/suiterc-config-ref"></span><div class="section" id="suite-rc-reference">
<span id="suitercreference"></span><h3>15.1. Suite.rc Reference<a class="headerlink" href="#suite-rc-reference" title="Permalink to this headline">¶</a></h3>
<p>This appendix defines all legal suite configuration items.
Embedded Jinja2 code (see <a class="reference internal" href="index.html#jinja"><span class="std std-ref">Jinja2</span></a>) must process to a valid
raw suite.rc file. See also <a class="reference internal" href="index.html#suitercfile"><span class="std std-ref">Suite.rc File Overview</span></a> for a descriptive
overview of suite.rc files, including syntax (<a class="reference internal" href="index.html#syntax"><span class="std std-ref">Syntax</span></a>).</p>
<div class="section" id="top-level-items">
<h4>15.1.1. Top Level Items<a class="headerlink" href="#top-level-items" title="Permalink to this headline">¶</a></h4>
<p>The only top level configuration items at present are the suite title
and description.</p>
</div>
<div class="section" id="meta">
<h4>15.1.2. [meta]<a class="headerlink" href="#meta" title="Permalink to this headline">¶</a></h4>
<p>Section containing metadata items for this suite. Several items
(title, description, URL) are pre-defined and are used by the GUI. Others
can be user-defined and passed to suite event handlers to be interpreted
according to your needs. For example, the value of a “suite-priority” item
could determine how an event handler responds to failure events.</p>
<div class="section" id="meta-title">
<h5>15.1.2.1. [meta] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> title<a class="headerlink" href="#meta-title" title="Permalink to this headline">¶</a></h5>
<p>A single line description of the suite. It is displayed in the GUI
“Open Another Suite” window and can be retrieved at run time with the
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">show</span></code> command.</p>
<ul class="simple">
<li><em>type</em>: single line string</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
<div class="section" id="meta-description">
<h5>15.1.2.2. [meta] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> description<a class="headerlink" href="#meta-description" title="Permalink to this headline">¶</a></h5>
<p>A multi-line description of the suite. It can be retrieved at run time
with the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">show</span></code> command.</p>
<ul class="simple">
<li><em>type</em>: multi-line string</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
<div class="section" id="meta-url">
<span id="suiteurl"></span><h5>15.1.2.3. [meta] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> URL<a class="headerlink" href="#meta-url" title="Permalink to this headline">¶</a></h5>
<p>A web URL to suite documentation.  If present it can be browsed with the
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">doc</span></code> command, or from the gcylc Suite menu. The string
template <code class="docutils literal notranslate"><span class="pre">%(suite_name)s</span></code> will be replaced with the actual suite
name. See also <a class="reference internal" href="#taskurl"><span class="std std-ref">[runtime] -&gt; [[__NAME__]] -&gt; [[[meta]]] -&gt; URL</span></a>.</p>
<ul class="simple">
<li><em>type</em>: string (URL)</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">http://my-site.com/suites/%(suite_name)s/index.html</span></code></li>
</ul>
</div>
<div class="section" id="meta-group">
<h5>15.1.2.4. [meta] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> group<a class="headerlink" href="#meta-group" title="Permalink to this headline">¶</a></h5>
<p>A group name for a suite. In the gscan GUI, suites with the same group name can
be collapsed into a single state summary when the “group” column is displayed.</p>
<ul class="simple">
<li><em>type</em>: single line string</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
<div class="section" id="meta-many">
<h5>15.1.2.5. [meta] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> __MANY__<a class="headerlink" href="#meta-many" title="Permalink to this headline">¶</a></h5>
<p>Replace <code class="docutils literal notranslate"><span class="pre">__MANY__</span></code> with any user-defined metadata item. These, like
title, URL, etc. can be passed to suite event handlers to be interpreted
according to your needs. For example, “suite-priority”.</p>
<ul>
<li><p class="first"><em>type</em>: String or integer</p>
</li>
<li><p class="first"><em>default</em>: (none)</p>
</li>
<li><p class="first"><em>example</em>:</p>
<blockquote>
<div><div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[meta]</span>
    <span class="nv">suite-priority </span><span class="o">=</span><span class="s"> high</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="cylc">
<h4>15.1.3. [cylc]<a class="headerlink" href="#cylc" title="Permalink to this headline">¶</a></h4>
<p>This section is for configuration that is not specifically task-related.</p>
<div class="section" id="cylc-required-run-mode">
<h5>15.1.3.1. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> required run mode<a class="headerlink" href="#cylc-required-run-mode" title="Permalink to this headline">¶</a></h5>
<p>If this item is set cylc will abort if the suite is not started in the
specified mode. This can be used for demo suites that have to be
run in simulation mode, for example, because they have been taken out of
their normal operational context; or to prevent accidental submission of
expensive real tasks during suite development.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>legal values</em>: live, dummy, dummy-local, simulation</li>
<li><em>default</em>: None</li>
</ul>
</div>
<div class="section" id="cylc-utc-mode">
<span id="utc-mode"></span><h5>15.1.3.2. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> UTC mode<a class="headerlink" href="#cylc-utc-mode" title="Permalink to this headline">¶</a></h5>
<p>Cylc runs off the suite host’s system clock by default. This item allows
you to run the suite in UTC even if the system clock is set to local time.
Clock-trigger tasks will trigger when the current UTC time is equal to
their cycle point date-time plus offset; other time values used, reported, or
logged by the suite server program will usually also be in UTC. The default for
this can be set at the site level (see <a class="reference internal" href="index.html#siteutcmode"><span class="std std-ref">[cylc] -&gt; UTC mode</span></a>).</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>default</em>: False, unless overridden at site level.</li>
</ul>
</div>
<div class="section" id="cylc-cycle-point-format">
<span id="cycle-point-format"></span><h5>15.1.3.3. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> cycle point format<a class="headerlink" href="#cylc-cycle-point-format" title="Permalink to this headline">¶</a></h5>
<p>To just alter the timezone used in the date-time cycle point format, see
<a class="reference internal" href="#cycle-point-time-zone"><span class="std std-ref">[cylc] -&gt; cycle point time zone</span></a>. To just alter the number of expanded year digits
(for years below 0 or above 9999), see
<a class="reference internal" href="#cycle-point-num-expanded-year-digits"><span class="std std-ref">[cylc] -&gt; cycle point num expanded year digits</span></a>.</p>
<p>Cylc usually uses a <code class="docutils literal notranslate"><span class="pre">CCYYMMDDThhmmZ</span></code> (<code class="docutils literal notranslate"><span class="pre">Z</span></code> in the special
case of UTC) or <code class="docutils literal notranslate"><span class="pre">CCYYMMDDThhmm+hhmm</span></code> format (<code class="docutils literal notranslate"><span class="pre">+</span></code> standing
for <code class="docutils literal notranslate"><span class="pre">+</span></code> or <code class="docutils literal notranslate"><span class="pre">-</span></code> here) for writing down date-time cycle
points, which follows one of the basic formats outlined in the ISO 8601
standard. For example, a cycle point on the 3rd of February 2001 at 4:50 in
the morning, UTC (+0000 timezone), would be written
<code class="docutils literal notranslate"><span class="pre">20010203T0450Z</span></code>. Similarly, for the 3rd of February 2001 at
4:50 in the morning, +1300 timezone, cylc would write
<code class="docutils literal notranslate"><span class="pre">20010203T0450+1300</span></code>.</p>
<p>You may use the isodatetime library’s syntax to write dates and times in ISO
8601 formats - <code class="docutils literal notranslate"><span class="pre">CC</span></code> for century, <code class="docutils literal notranslate"><span class="pre">YY</span></code> for decade and
decadal year, <code class="docutils literal notranslate"><span class="pre">+X</span></code> for expanded year digits and their positive or
negative sign, thereafter following the ISO 8601 standard example notation
except for fractional digits, which are represented as <code class="docutils literal notranslate"><span class="pre">,ii</span></code> for
<code class="docutils literal notranslate"><span class="pre">hh</span></code>, <code class="docutils literal notranslate"><span class="pre">,nn</span></code> for <code class="docutils literal notranslate"><span class="pre">mm</span></code>, etc. For example, to write
date-times as week dates with fractional hours, set cycle point format to
<code class="docutils literal notranslate"><span class="pre">CCYYWwwDThh,iiZ</span></code> e.g.  <code class="docutils literal notranslate"><span class="pre">1987W041T08,5Z</span></code> for 08:30 UTC on
Monday on the fourth ISO week of 1987.</p>
<p>You can also use a subset of the strptime/strftime POSIX standard - supported
tokens are <code class="docutils literal notranslate"><span class="pre">%F</span></code>, <code class="docutils literal notranslate"><span class="pre">%H</span></code>, <code class="docutils literal notranslate"><span class="pre">%M</span></code>, <code class="docutils literal notranslate"><span class="pre">%S</span></code>,
<code class="docutils literal notranslate"><span class="pre">%Y</span></code>, <code class="docutils literal notranslate"><span class="pre">%d</span></code>, <code class="docutils literal notranslate"><span class="pre">%j</span></code>, <code class="docutils literal notranslate"><span class="pre">%m</span></code>, <code class="docutils literal notranslate"><span class="pre">%s</span></code>, <code class="docutils literal notranslate"><span class="pre">%z</span></code>.</p>
<p>The ISO8601 extended date-time format can be used
(<code class="docutils literal notranslate"><span class="pre">%Y-%m-%dT%H:%M</span></code>) but
note that the “-” and “:” characters end up in job log directory paths.</p>
<p>The pre cylc-6 legacy 10-digit date-time format YYYYMMDDHH is not ISO8601
compliant and can no longer be used as the cycle point format. For job
scripts that still require the old format, use the
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">cyclepoint</span></code> utility to translate the ISO8601 cycle point
inside job scripts, e.g.:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">CYCLE_TIME </span><span class="o">=</span><span class="s"> $(cylc cyclepoint --template=%Y%m%d%H)</span>
</pre></div>
</div>
</div>
<div class="section" id="cylc-cycle-point-num-expanded-year-digits">
<span id="cycle-point-num-expanded-year-digits"></span><h5>15.1.3.4. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> cycle point num expanded year digits<a class="headerlink" href="#cylc-cycle-point-num-expanded-year-digits" title="Permalink to this headline">¶</a></h5>
<p>For years below 0 or above 9999, the ISO 8601 standard specifies that an
extra number of year digits and a sign should be used. This extra number needs
to be written down somewhere (here).</p>
<p>For example, if this extra number is set to 2, 00Z on the 1st of January in
the year 10040 will be represented as <code class="docutils literal notranslate"><span class="pre">+0100400101T0000Z</span></code> (2 extra
year digits used). With this number set to 3, 06Z on the 4th of May 1985 would
be written as <code class="docutils literal notranslate"><span class="pre">+00019850504T0600Z</span></code>.</p>
<p>This number defaults to 0 (no sign or extra digits used).</p>
</div>
<div class="section" id="cylc-cycle-point-time-zone">
<span id="cycle-point-time-zone"></span><h5>15.1.3.5. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> cycle point time zone<a class="headerlink" href="#cylc-cycle-point-time-zone" title="Permalink to this headline">¶</a></h5>
<p>If you set UTC mode to True (<a class="reference internal" href="#utc-mode"><span class="std std-ref">[cylc] -&gt; UTC mode</span></a>) then this will default to
<code class="docutils literal notranslate"><span class="pre">Z</span></code>. If you use a custom cycle point format
(<a class="reference internal" href="#cycle-point-format"><span class="std std-ref">[cylc] -&gt; cycle point format</span></a>), you should specify the timezone choice (or null
timezone choice) here as well.</p>
<p>You may set your own time zone choice here, which will be used for all
date-time cycle point dumping. Time zones should be expressed as ISO 8601 time
zone offsets from UTC, such as <code class="docutils literal notranslate"><span class="pre">+13</span></code>, <code class="docutils literal notranslate"><span class="pre">+1300</span></code>,
<code class="docutils literal notranslate"><span class="pre">-0500</span></code> or <code class="docutils literal notranslate"><span class="pre">+0645</span></code>, with <code class="docutils literal notranslate"><span class="pre">Z</span></code> representing the
special <code class="docutils literal notranslate"><span class="pre">+0000</span></code> case. Cycle points will be converted to the time
zone you give and will be represented with this string at the end.</p>
<p>Cycle points that are input without time zones (e.g. as an initial cycle
point
setting) will use this time zone if set. If this isn’t set (and UTC mode is
also not set), then they will default to the current local time zone.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The ISO standard also allows writing the hour and minute separated
by a “:” (e.g. <code class="docutils literal notranslate"><span class="pre">+13:00</span></code>) - however, this is not recommended, given
that the time zone is used as part of task output filenames.</p>
</div>
</div>
<div class="section" id="cylc-abort-if-any-task-fails">
<h5>15.1.3.6. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> abort if any task fails<a class="headerlink" href="#cylc-abort-if-any-task-fails" title="Permalink to this headline">¶</a></h5>
<p>Cylc does not normally abort if tasks fail, but if this item is turned
on it will abort with exit status 1 if any task fails.</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>default</em>: False</li>
</ul>
</div>
<div class="section" id="cylc-health-check-interval">
<span id="health-check-interval"></span><h5>15.1.3.7. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> health check interval<a class="headerlink" href="#cylc-health-check-interval" title="Permalink to this headline">¶</a></h5>
<p>Specify the time interval on which a running cylc suite will check that its run
directory exists and that its contact file contains the expected information.
If not, the suite will shut itself down automatically.</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 duration/interval representation (e.g.
<code class="docutils literal notranslate"><span class="pre">PT5M</span></code>, 5 minutes (note: by contrast, <code class="docutils literal notranslate"><span class="pre">P5M</span></code> means 5
months, so remember the <code class="docutils literal notranslate"><span class="pre">T</span></code>!)).</li>
<li><em>default</em>: PT10M</li>
</ul>
</div>
<div class="section" id="cylc-task-event-mail-interval">
<span id="task-event-mail-interval"></span><h5>15.1.3.8. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> task event mail interval<a class="headerlink" href="#cylc-task-event-mail-interval" title="Permalink to this headline">¶</a></h5>
<p>Group together all the task event mail notifications into a single email within
a given interval. This is useful to prevent flooding users’ mail boxes when
many task events occur within a short period of time.</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 duration/interval representation (e.g.
<code class="docutils literal notranslate"><span class="pre">PT10S</span></code>, 10 seconds, or <code class="docutils literal notranslate"><span class="pre">PT1M</span></code>, 1 minute).</li>
<li><em>default</em>: PT5M</li>
</ul>
</div>
<div class="section" id="cylc-disable-automatic-shutdown">
<h5>15.1.3.9. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> disable automatic shutdown<a class="headerlink" href="#cylc-disable-automatic-shutdown" title="Permalink to this headline">¶</a></h5>
<p>This has the same effect as the <code class="docutils literal notranslate"><span class="pre">--no-auto-shutdown</span></code> flag for
the suite run commands: it prevents the suite server program from shutting down
normally when all tasks have finished (a suite timeout can still be used to
stop the daemon after a period of inactivity, however).  This option can
make it easier to re-trigger tasks manually near the end of a suite run,
during suite development and debugging.</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>default</em>: False</li>
</ul>
</div>
<div class="section" id="cylc-log-resolved-dependencies">
<h5>15.1.3.10. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> log resolved dependencies<a class="headerlink" href="#cylc-log-resolved-dependencies" title="Permalink to this headline">¶</a></h5>
<p>If this is turned on cylc will write the resolved dependencies of each
task to the suite log as it becomes ready to run (a list of the IDs of
the tasks that actually satisfied its prerequisites at run time). Mainly
used for cylc testing and development.</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>default</em>: False</li>
</ul>
</div>
<div class="section" id="cylc-parameters">
<h5>15.1.3.11. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[parameters]]<a class="headerlink" href="#cylc-parameters" title="Permalink to this headline">¶</a></h5>
<p>Define parameter values here for use in expanding <em>parameterized tasks</em> -
see <a class="reference internal" href="index.html#parameterized-tasks-label"><span class="std std-ref">Parameterized Tasks</span></a>.</p>
<ul class="simple">
<li><em>type</em>: list of strings, or an integer range
<code class="docutils literal notranslate"><span class="pre">LOWER..UPPER..STEP</span></code> (two dots, inclusive bounds, “STEP” optional)</li>
<li><em>default</em>: (none)</li>
<li><em>examples</em>:
- <code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">=</span> <span class="pre">control,</span> <span class="pre">test1,</span> <span class="pre">test2</span></code>
- <code class="docutils literal notranslate"><span class="pre">mem</span> <span class="pre">=</span> <span class="pre">1..5</span></code>  (equivalent to <code class="docutils literal notranslate"><span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">4,</span> <span class="pre">5</span></code>).
- <code class="docutils literal notranslate"><span class="pre">mem</span> <span class="pre">=</span> <span class="pre">-11..-7..2</span></code>  (equivalent to <code class="docutils literal notranslate"><span class="pre">-11,</span> <span class="pre">-9,</span> <span class="pre">-7</span></code>).</li>
</ul>
</div>
<div class="section" id="cylc-parameter-templates">
<span id="refparametertemplates"></span><h5>15.1.3.12. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[parameter templates]]<a class="headerlink" href="#cylc-parameter-templates" title="Permalink to this headline">¶</a></h5>
<p>Parameterized task names (see previous item, and
<a class="reference internal" href="index.html#parameterized-tasks-label"><span class="std std-ref">Parameterized Tasks</span></a>) are expanded, for each parameter value,
using string templates.  You can assign templates to parameter names here,
to override the default templates.</p>
<ul class="simple">
<li><em>type</em>: a Python-style string template</li>
<li><em>default} for integer parameters</em> <code class="docutils literal notranslate"><span class="pre">p</span></code>:
<code class="docutils literal notranslate"><span class="pre">_p%(p)0Nd</span></code>
where <code class="docutils literal notranslate"><span class="pre">N</span></code> is the number of digits of the maximum integer value,
e.g. <code class="docutils literal notranslate"><span class="pre">foo&lt;run&gt;</span></code> becomes <code class="docutils literal notranslate"><span class="pre">foo_run3</span></code> for <code class="docutils literal notranslate"><span class="pre">run</span></code> value <code class="docutils literal notranslate"><span class="pre">3</span></code>.</li>
<li><em>default for non-integer parameters</em> <code class="docutils literal notranslate"><span class="pre">p</span></code>:
<code class="docutils literal notranslate"><span class="pre">_%(p)s</span></code> e.g. <code class="docutils literal notranslate"><span class="pre">foo&lt;run&gt;</span></code> becomes <code class="docutils literal notranslate"><span class="pre">foo_top</span></code> for
<code class="docutils literal notranslate"><span class="pre">run</span></code> value <code class="docutils literal notranslate"><span class="pre">top</span></code>.</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">=</span> <span class="pre">-R%(run)s</span></code> e.g. <code class="docutils literal notranslate"><span class="pre">foo&lt;run&gt;</span></code> becomes <code class="docutils literal notranslate"><span class="pre">foo-R3</span></code> for
<code class="docutils literal notranslate"><span class="pre">run</span></code> value <code class="docutils literal notranslate"><span class="pre">3</span></code>.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The values of a parameter named <code class="docutils literal notranslate"><span class="pre">p</span></code> are substituted for <code class="docutils literal notranslate"><span class="pre">%(p)s</span></code>.
In <code class="docutils literal notranslate"><span class="pre">_run%(run)s</span></code> the first “run” is a string literal, and the second
gets substituted with each value of the parameter.</p>
</div>
</div>
<div class="section" id="cylc-events">
<span id="suiteeventhandling"></span><h5>15.1.3.13. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]]<a class="headerlink" href="#cylc-events" title="Permalink to this headline">¶</a></h5>
<p>Cylc has internal “hooks” to which you can attach handlers that are
called by the suite server program whenever certain events occur. This section
configures suite event hooks; see <a class="reference internal" href="#taskeventhandling"><span class="std std-ref">[runtime] -&gt; [[__NAME__]] -&gt; [[[events]]]</span></a> for
task event hooks.</p>
<p>Event handler commands can send an email or an SMS, call a pager, intervene in
the operation of their own suite, or whatever.
They can be held in the suite bin directory, otherwise it is up to you
to ensure their location is in <code class="docutils literal notranslate"><span class="pre">$PATH</span></code> (in the shell in which
cylc runs, on the suite host). The commands should require
very little resource to run and should return quickly.</p>
<p>Each event handler can be specified as a list of command lines or command
line templates.</p>
<p>A command line template may have any or all of these patterns which will be
substituted with actual values:</p>
<ul class="simple">
<li>%(event)s: event name (see below)</li>
<li>%(suite)s: suite name</li>
<li>%(suite_url)s: suite URL</li>
<li>%(suite_uuid)s: suite UUID string</li>
<li>%(message)s: event message, if any</li>
<li>any suite [meta] item, e.g.:
- %(title)s: suite title
- %(importance)s: example custom suite metadata</li>
</ul>
<p>Otherwise the command line will be called with the following default
arguments:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;suite-event-handler&gt; %(event)s %(suite)s %(message)s
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Substitution patterns should not be quoted in the template strings.
This is done automatically where required.</p>
</div>
<p>Additional information can be passed to event handlers via
[cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[environment]].</p>
<div class="section" id="cylc-events-event-handler">
<h6>15.1.3.13.1. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> EVENT handler<a class="headerlink" href="#cylc-events-event-handler" title="Permalink to this headline">¶</a></h6>
<p>A comma-separated list of one or more event handlers to call when one of the
following EVENTs occurs:</p>
<ul class="simple">
<li><strong>startup</strong>  - the suite has started running</li>
<li><strong>shutdown</strong> - the suite is shutting down</li>
<li><strong>aborted</strong> - the suite is shutting down due to unexpected/unrecoverable error</li>
<li><strong>timeout</strong>  - the suite has timed out</li>
<li><strong>stalled</strong> - the suite has stalled</li>
<li><strong>inactivity</strong> - the suite is inactive</li>
</ul>
<p>Default values for these can be set at the site level via the siterc file
(see <a class="reference internal" href="index.html#sitecylchooks"><span class="std std-ref">[cylc] -&gt; [[events]]</span></a>).</p>
<p>Item details:</p>
<ul class="simple">
<li><em>type</em>: string (event handler script name)</li>
<li><em>default</em>: None, unless defined at the site level.</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">startup</span> <span class="pre">handler</span> <span class="pre">=</span> <span class="pre">my-handler.sh</span></code></li>
</ul>
</div>
<div class="section" id="cylc-events-handlers">
<h6>15.1.3.13.2. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[events]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> handlers<a class="headerlink" href="#cylc-events-handlers" title="Permalink to this headline">¶</a></h6>
<p>Specify the general event handlers as a list of command lines or command line
templates.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of strings (event handler command line or
command line templates).</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">handlers</span> <span class="pre">=</span> <span class="pre">my-handler.sh</span></code></li>
</ul>
</div>
<div class="section" id="cylc-events-handler-events">
<h6>15.1.3.13.3. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> handler events<a class="headerlink" href="#cylc-events-handler-events" title="Permalink to this headline">¶</a></h6>
<p>Specify the events for which the general event handlers should be invoked.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of events</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">handler</span> <span class="pre">events</span> <span class="pre">=</span> <span class="pre">timeout,</span> <span class="pre">shutdown</span></code></li>
</ul>
</div>
<div class="section" id="cylc-events-mail-events">
<h6>15.1.3.13.4. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> mail events<a class="headerlink" href="#cylc-events-mail-events" title="Permalink to this headline">¶</a></h6>
<p>Specify the suite events for which notification emails should be sent.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of events</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">mail</span> <span class="pre">events</span> <span class="pre">=</span> <span class="pre">startup,</span> <span class="pre">shutdown,</span> <span class="pre">timeout</span></code></li>
</ul>
</div>
<div class="section" id="cylc-events-mail-footer">
<h6>15.1.3.13.5. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> mail footer<a class="headerlink" href="#cylc-events-mail-footer" title="Permalink to this headline">¶</a></h6>
<p>Specify a string or string template to insert to footers of notification emails
for both suite events and task events.</p>
<p>A template string may have any or all of these patterns which will be
substituted with actual values:</p>
<ul class="simple">
<li>%(host)s: suite host name</li>
<li>%(port)s: suite port number</li>
<li>%(owner)s: suite owner name</li>
<li>%(suite)s: suite name</li>
<li><em>type</em>:</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>:
<code class="docutils literal notranslate"><span class="pre">mail</span> <span class="pre">footer</span> <span class="pre">=</span> <span class="pre">see:</span> <span class="pre">http://localhost/%(owner)s/notes-on/%(suite)s/</span></code></li>
</ul>
</div>
<div class="section" id="cylc-events-mail-from">
<h6>15.1.3.13.6. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> mail from<a class="headerlink" href="#cylc-events-mail-from" title="Permalink to this headline">¶</a></h6>
<p>Specify an alternate <code class="docutils literal notranslate"><span class="pre">from:</span></code> email address for suite event notifications.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: None, (<a class="reference external" href="mailto:notifications&#37;&#52;&#48;HOSTNAME">notifications<span>&#64;</span>HOSTNAME</a>)</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">mail</span> <span class="pre">from</span> <span class="pre">=</span> <span class="pre">no-reply&#64;your-org</span></code></li>
</ul>
</div>
<div class="section" id="cylc-events-mail-smtp">
<h6>15.1.3.13.7. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> mail smtp<a class="headerlink" href="#cylc-events-mail-smtp" title="Permalink to this headline">¶</a></h6>
<p>Specify the SMTP server for sending suite event email notifications.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: None, (localhost:25)</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">mail</span> <span class="pre">smtp</span> <span class="pre">=</span> <span class="pre">smtp.yourorg</span></code></li>
</ul>
</div>
<div class="section" id="cylc-events-mail-to">
<h6>15.1.3.13.8. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> mail to<a class="headerlink" href="#cylc-events-mail-to" title="Permalink to this headline">¶</a></h6>
<p>A list of email addresses to send suite event notifications. The list can be
anything accepted by the <code class="docutils literal notranslate"><span class="pre">mail</span></code> command.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: None, (<a class="reference external" href="mailto:USER&#37;&#52;&#48;HOSTNAME">USER<span>&#64;</span>HOSTNAME</a>)</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">mail</span> <span class="pre">to</span> <span class="pre">=</span> <span class="pre">your.colleague</span></code></li>
</ul>
</div>
<div class="section" id="cylc-events-timeout">
<h6>15.1.3.13.9. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> timeout<a class="headerlink" href="#cylc-events-timeout" title="Permalink to this headline">¶</a></h6>
<p>If a timeout is set and the timeout event is handled, the timeout event
handler(s) will be called if the suite stays in a stalled state for some period
of time. The timer is set initially at suite start up. It is possible to set a
default for this at the site level (see <a class="reference internal" href="index.html#sitecylchooks"><span class="std std-ref">[cylc] -&gt; [[events]]</span></a>).</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 duration/interval representation (e.g.
<code class="docutils literal notranslate"><span class="pre">PT5S</span></code>, 5 seconds, <code class="docutils literal notranslate"><span class="pre">PT1S</span></code>, 1 second) - minimum 0 seconds.</li>
<li><em>default</em>: (none), unless set at the site level.</li>
</ul>
</div>
<div class="section" id="cylc-events-inactivity">
<h6>15.1.3.13.10. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> inactivity<a class="headerlink" href="#cylc-events-inactivity" title="Permalink to this headline">¶</a></h6>
<p>If inactivity is set and the inactivity event is handled, the inactivity event
handler(s) will be called if there is no activity in the suite for some period
of time. The timer is set initially at suite start up. It is possible to set a
default for this at the site level (see <a class="reference internal" href="index.html#sitecylchooks"><span class="std std-ref">[cylc] -&gt; [[events]]</span></a>).</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 duration/interval representation (e.g.
<code class="docutils literal notranslate"><span class="pre">PT5S</span></code>, 5 seconds, <code class="docutils literal notranslate"><span class="pre">PT1S</span></code>, 1 second) - minimum 0 seconds.</li>
<li><em>default</em>: (none), unless set at the site level.</li>
</ul>
</div>
<div class="section" id="cylc-events-abort-on-stalled">
<h6>15.1.3.13.11. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> abort on stalled<a class="headerlink" href="#cylc-events-abort-on-stalled" title="Permalink to this headline">¶</a></h6>
<p>If this is set to True it will cause the suite to abort with error status
if it stalls. A suite is considered “stalled” if there are no active,
queued or submitting tasks or tasks waiting for clock triggers to be met. It is
possible to set a default for this at the site level
(see <a class="reference internal" href="index.html#sitecylchooks"><span class="std std-ref">[cylc] -&gt; [[events]]</span></a>).</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>default</em>: False, unless set at the site level.</li>
</ul>
</div>
<div class="section" id="cylc-events-abort-on-timeout">
<h6>15.1.3.13.12. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> abort on timeout<a class="headerlink" href="#cylc-events-abort-on-timeout" title="Permalink to this headline">¶</a></h6>
<p>If a suite timer is set (above) this will cause the suite to abort with
error status if the suite times out while still running. It is possible to set
a default for this at the site level (see <a class="reference internal" href="index.html#sitecylchooks"><span class="std std-ref">[cylc] -&gt; [[events]]</span></a>).</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>default</em>: False, unless set at the site level.</li>
</ul>
</div>
<div class="section" id="cylc-events-abort-on-inactivity">
<h6>15.1.3.13.13. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> abort on inactivity<a class="headerlink" href="#cylc-events-abort-on-inactivity" title="Permalink to this headline">¶</a></h6>
<p>If a suite inactivity timer is set (above) this will cause the suite to abort
with error status if the suite is inactive for some period while still running.
It is possible to set a default for this at the site level
(see <a class="reference internal" href="index.html#sitecylchooks"><span class="std std-ref">[cylc] -&gt; [[events]]</span></a>).</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>default</em>: False, unless set at the site level.</li>
</ul>
</div>
<div class="section" id="cylc-events-abort-if-event-handler-fails">
<h6>15.1.3.13.14. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> abort if EVENT handler fails<a class="headerlink" href="#cylc-events-abort-if-event-handler-fails" title="Permalink to this headline">¶</a></h6>
<p>Cylc does not normally care whether an event handler succeeds or fails,
but if this is turned on the EVENT handler will be executed in the
foreground (which will block the suite while it is running) and the
suite will abort if the handler fails.</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>default</em>: False</li>
</ul>
</div>
<div class="section" id="cylc-environment">
<h6>15.1.3.13.15. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[environment]]<a class="headerlink" href="#cylc-environment" title="Permalink to this headline">¶</a></h6>
<p>Environment variables defined in this section are passed to suite and
task event handlers.</p>
<ul>
<li><p class="first">These variables are not passed to tasks - use task runtime
variables for that. Similarly, task runtime variables are not
available to event handlers - which are executed by the suite server
program, (not by running tasks) in response to task events.</p>
</li>
<li><p class="first">Cylc-defined environment variables such as
<code class="docutils literal notranslate"><span class="pre">$CYLC_SUITE_RUN_DIR</span></code> are not passed to task event
handlers by default, but you can make them available by
extracting them to the cylc environment like this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[environment]]</span>
        <span class="nv">CYLC_SUITE_RUN_DIR </span><span class="o">=</span><span class="s"> $CYLC_SUITE_RUN_DIR</span>
</pre></div>
</div>
</li>
<li><p class="first">These variables - unlike task execution environment variables
which are written to job scripts and interpreted by the shell at
task run time - are not interpreted by the shell prior to use
so shell variable expansion expressions cannot be used here.</p>
</li>
</ul>
</div>
<div class="section" id="cylc-environment-variable">
<h6>15.1.3.13.16. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[environment]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> __VARIABLE__<a class="headerlink" href="#cylc-environment-variable" title="Permalink to this headline">¶</a></h6>
<p>Replace <code class="docutils literal notranslate"><span class="pre">__VARIABLE__</span></code> with any number of environment variable
assignment expressions.
Values may refer to other local environment variables (order of
definition is preserved) and are not evaluated or manipulated by
cylc, so any variable assignment expression that is legal in the
shell in which cylc is running can be used (but see the warning
above on variable expansions, which will not be evaluated).
White space around the <code class="docutils literal notranslate"><span class="pre">=</span></code> is allowed (as far as cylc’s file
parser is concerned these are just suite configuration items).</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: (none)</li>
<li><em>examples</em>: <code class="docutils literal notranslate"><span class="pre">FOO</span> <span class="pre">=</span> <span class="pre">$HOME/foo</span></code></li>
</ul>
</div>
<div class="section" id="cylc-reference-test">
<span id="referencetestconfig"></span><h6>15.1.3.13.17. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[reference test]]<a class="headerlink" href="#cylc-reference-test" title="Permalink to this headline">¶</a></h6>
<p>Reference tests are finite-duration suite runs that abort with non-zero
exit status if cylc fails, if any task fails, if the suite times
out, or if a shutdown event handler that (by default) compares the test
run with a reference run reports failure. See <a class="reference internal" href="index.html#autoreftests"><span class="std std-ref">Automated Reference Test Suites</span></a>.</p>
</div>
<div class="section" id="cylc-reference-test-suite-shutdown-event-handler">
<h6>15.1.3.13.18. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[reference test]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> suite shutdown event handler<a class="headerlink" href="#cylc-reference-test-suite-shutdown-event-handler" title="Permalink to this headline">¶</a></h6>
<p>A shutdown event handler that should compare the test run with the
reference run, exiting with zero exit status only if the test run
verifies.</p>
<ul class="simple">
<li><em>type</em>: string (event handler command name or path)</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">hook</span> <span class="pre">check-triggering</span></code></li>
</ul>
<p>As for any event handler, the full path can be omitted if the script is
located somewhere in <code class="docutils literal notranslate"><span class="pre">$PATH</span></code> or in the suite bin directory.</p>
</div>
<div class="section" id="cylc-reference-test-required-run-mode">
<h6>15.1.3.13.19. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[reference test]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> required run mode<a class="headerlink" href="#cylc-reference-test-required-run-mode" title="Permalink to this headline">¶</a></h6>
<p>If your reference test is only valid for a particular run mode, this
setting will cause cylc to abort if a reference test is attempted
in another run mode.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>legal values</em>: live, dummy, dummy-local, simulation</li>
<li><em>default</em>: None</li>
</ul>
</div>
<div class="section" id="cylc-reference-test-allow-task-failures">
<h6>15.1.3.13.20. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[reference test]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> allow task failures<a class="headerlink" href="#cylc-reference-test-allow-task-failures" title="Permalink to this headline">¶</a></h6>
<p>A reference test run will abort immediately if any task fails, unless
this item is set, or a list of <em>expected task failures</em> is provided
(below).</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>default</em>: False</li>
</ul>
</div>
<div class="section" id="cylc-reference-test-expected-task-failures">
<h6>15.1.3.13.21. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[reference test]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> expected task failures<a class="headerlink" href="#cylc-reference-test-expected-task-failures" title="Permalink to this headline">¶</a></h6>
<p>A reference test run will abort immediately if any task fails, unless
<em>allow task failures</em> is set (above) or the failed task is found
in a list IDs of tasks that are expected to fail.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of strings (task IDs: <code class="docutils literal notranslate"><span class="pre">name.cycle_point</span></code>).</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">foo.20120808,</span> <span class="pre">bar.20120908</span></code></li>
</ul>
</div>
<div class="section" id="cylc-reference-test-live-mode-suite-timeout">
<h6>15.1.3.13.22. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[reference test]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> live mode suite timeout<a class="headerlink" href="#cylc-reference-test-live-mode-suite-timeout" title="Permalink to this headline">¶</a></h6>
<p>The timeout value, expressed as an ISO 8601 duration/interval, after which the
test run should be aborted if it has not finished, in live mode. Test runs
cannot be done in live mode unless you define a value for this item, because
it is not possible to arrive at a sensible default for all suites.</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 duration/interval representation, e.g.
<code class="docutils literal notranslate"><span class="pre">PT5M</span></code> is 5 minutes (note: by contrast <code class="docutils literal notranslate"><span class="pre">P5M</span></code> means 5
months, so remember the <code class="docutils literal notranslate"><span class="pre">T</span></code>!).</li>
<li><em>default</em>: PT1M (1 minute)</li>
</ul>
</div>
<div class="section" id="cylc-reference-test-simulation-mode-suite-timeout">
<h6>15.1.3.13.23. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[reference test]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> simulation mode suite timeout<a class="headerlink" href="#cylc-reference-test-simulation-mode-suite-timeout" title="Permalink to this headline">¶</a></h6>
<p>The timeout value in minutes after which the test run should be aborted
if it has not finished, in simulation mode. Test runs cannot be done in
simulation mode unless you define a value for this item, because it is
not possible to arrive at a sensible default for all suites.</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 duration/interval representation (e.g.
<code class="docutils literal notranslate"><span class="pre">PT5M</span></code>, 5 minutes (note: by contrast, <code class="docutils literal notranslate"><span class="pre">P5M</span></code> means 5
months, so remember the <code class="docutils literal notranslate"><span class="pre">T</span></code>!)).</li>
<li><em>default</em>: PT1M (1 minute)</li>
</ul>
</div>
<div class="section" id="cylc-reference-test-dummy-mode-suite-timeout">
<h6>15.1.3.13.24. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[reference test]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> dummy mode suite timeout<a class="headerlink" href="#cylc-reference-test-dummy-mode-suite-timeout" title="Permalink to this headline">¶</a></h6>
<p>The timeout value, expressed as an ISO 8601 duration/interval, after which the
test run should be aborted if it has not finished, in dummy mode.  Test runs
cannot be done in dummy mode unless you define a value for this item, because
it is not possible to arrive at a sensible default for all suites.</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 duration/interval representation (e.g.
<code class="docutils literal notranslate"><span class="pre">PT5M</span></code>, 5 minutes (note: by contrast, <code class="docutils literal notranslate"><span class="pre">P5M</span></code> means 5
months, so remember the <code class="docutils literal notranslate"><span class="pre">T</span></code>!)).</li>
<li><em>default</em>: PT1M (1 minute)</li>
</ul>
</div>
</div>
<div class="section" id="cylc-authentication">
<span id="suiteauth"></span><h5>15.1.3.14. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[authentication]]<a class="headerlink" href="#cylc-authentication" title="Permalink to this headline">¶</a></h5>
<p>Authentication of client programs with suite server programs can be set in the
global site/user config files and overridden here if necessary.
See <a class="reference internal" href="index.html#globalauth"><span class="std std-ref">[authentication]</span></a> for more information.</p>
<div class="section" id="cylc-authentication-public">
<h6>15.1.3.14.1. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[authentication]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> public<a class="headerlink" href="#cylc-authentication-public" title="Permalink to this headline">¶</a></h6>
<p>The client privilege level granted for public access - i.e. no suite passphrase
required.  See <a class="reference internal" href="index.html#globalauth"><span class="std std-ref">[authentication]</span></a> for legal values.</p>
</div>
</div>
<div class="section" id="cylc-simulation">
<h5>15.1.3.15. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[simulation]]<a class="headerlink" href="#cylc-simulation" title="Permalink to this headline">¶</a></h5>
<p>Suite-level configuration for the <em>simulation</em> and <em>dummy</em> run modes
described in <a class="reference internal" href="index.html#simulationmode"><span class="std std-ref">Simulating Suite Behaviour</span></a>.</p>
<div class="section" id="cylc-simulation-disable-suite-event-handlers">
<h6>15.1.3.15.1. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[simulation]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> disable suite event handlers<a class="headerlink" href="#cylc-simulation-disable-suite-event-handlers" title="Permalink to this headline">¶</a></h6>
<p>If this is set to <code class="docutils literal notranslate"><span class="pre">True</span></code> configured suite event handlers will not be
called in simulation or dummy modes.</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">True</span></code></li>
</ul>
</div>
</div>
</div>
<div class="section" id="scheduling">
<h4>15.1.4. [scheduling]<a class="headerlink" href="#scheduling" title="Permalink to this headline">¶</a></h4>
<p>This section allows cylc to determine when tasks are ready to run.</p>
<div class="section" id="scheduling-cycling-mode">
<span id="cycling-mode"></span><h5>15.1.4.1. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> cycling mode<a class="headerlink" href="#scheduling-cycling-mode" title="Permalink to this headline">¶</a></h5>
<p>Cylc runs using the proleptic Gregorian calendar by default. This item allows
you to either run the suite using the 360 day calendar (12 months of 30 days
in a year) or using integer cycling. It also supports use of the 365 (never a
leap year) and 366 (always a leap year) calendars.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>legal values</em>: gregorian, 360day, 365day, 366day, integer</li>
<li><em>default</em>: gregorian</li>
</ul>
</div>
<div class="section" id="scheduling-initial-cycle-point">
<span id="initial-cycle-point"></span><h5>15.1.4.2. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> initial cycle point<a class="headerlink" href="#scheduling-initial-cycle-point" title="Permalink to this headline">¶</a></h5>
<p>In a cold start each cycling task (unless specifically excluded under
<code class="docutils literal notranslate"><span class="pre">[special</span> <span class="pre">tasks]</span></code>) will be loaded into the suite with this cycle point,
or with the closest subsequent valid cycle point for the task.  This item can
be overridden on the command line or in the gcylc suite start panel.</p>
<p>In date-time cycling, if you do not provide time zone information for this,
it will be assumed to be local time, or in UTC if <a class="reference internal" href="#utc-mode"><span class="std std-ref">[cylc] -&gt; UTC mode</span></a> is set, or in
the time zone determined by <a class="reference internal" href="#cycle-point-time-zone"><span class="std std-ref">[cylc] -&gt; cycle point time zone</span></a> if that is set.</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 date-time point representation (e.g.
<code class="docutils literal notranslate"><span class="pre">CCYYMMDDThhmm</span></code>, 19951231T0630) or “now”.</li>
<li><em>default</em>: (none)</li>
</ul>
<p>The string “now” converts to the current date-time on the suite host (adjusted
to UTC if the suite is in UTC mode but the host is not) to minute resolution.
Minutes (or hours, etc.) may be ignored depending on your cycle point format
(<a class="reference internal" href="#cycle-point-format"><span class="std std-ref">[cylc] -&gt; cycle point format</span></a>).</p>
</div>
<div class="section" id="scheduling-initial-cycle-point-initial-cycle-point-relative-to-current-time">
<h5>15.1.4.3. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[initial cycle point]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> initial cycle point relative to current time<a class="headerlink" href="#scheduling-initial-cycle-point-initial-cycle-point-relative-to-current-time" title="Permalink to this headline">¶</a></h5>
<p>This can be used to set the initial cycle point time relative to the
current time.</p>
<p>Two additional commands, <code class="docutils literal notranslate"><span class="pre">next</span></code> and <code class="docutils literal notranslate"><span class="pre">previous</span></code>, can be used when setting
the initial cycle point.</p>
<p>The syntax uses truncated ISO8601 time representations, and is of the style:
<code class="docutils literal notranslate"><span class="pre">next(Thh:mmZ)</span></code>, <code class="docutils literal notranslate"><span class="pre">previous(T-mm)</span></code>; e.g.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">initial</span> <span class="pre">cycle</span> <span class="pre">point</span> <span class="pre">=</span> <span class="pre">next(T15:00Z)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">initial</span> <span class="pre">cycle</span> <span class="pre">point</span> <span class="pre">=</span> <span class="pre">previous(T09:00)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">initial</span> <span class="pre">cycle</span> <span class="pre">point</span> <span class="pre">=</span> <span class="pre">next(T12)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">initial</span> <span class="pre">cycle</span> <span class="pre">point</span> <span class="pre">=</span> <span class="pre">previous(T-20)</span></code></li>
</ul>
<p>Examples of interpretation are given in
<a class="reference internal" href="#fig-relative-initial-cycle-point-time-syntax-interpretation"><span class="std std-numref">Table 1</span></a>.</p>
<p>A list of times, separated by semicolons, can be provided, e.g.
<code class="docutils literal notranslate"><span class="pre">next(T-00;T-15;T-30;T-45)</span></code>. At least one time is required within the
brackets, and if more than one is given, the major time unit in each (hours
or minutes) should all be of the same type.</p>
<p>If an offset from the specified date or time is required, this should be
used in the form: <code class="docutils literal notranslate"><span class="pre">previous(Thh:mm)</span> <span class="pre">+/-</span> <span class="pre">PxTy</span></code> in the same way as is used
for determining cycle periods, e.g.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">initial</span> <span class="pre">cycle</span> <span class="pre">point</span> <span class="pre">=</span> <span class="pre">previous(T06)</span> <span class="pre">+P1D</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">initial</span> <span class="pre">cycle</span> <span class="pre">point</span> <span class="pre">=</span> <span class="pre">next(T-30)</span> <span class="pre">-PT1H</span></code></li>
</ul>
<p>The section in the bracket attached to the next/previous command is
interpreted first, and then the offset is applied.</p>
<p>The offset can also be used independently without a <code class="docutils literal notranslate"><span class="pre">next</span></code> or <code class="docutils literal notranslate"><span class="pre">previous</span></code>
command, and will be interpreted as an offset from “now”.</p>
<span id="fig-relative-initial-cycle-point-time-syntax-interpretation"></span><table border="1" class="docutils" id="id1">
<caption><span class="caption-number">Table 1 </span><span class="caption-text">Examples of setting relative initial cycle point for times and offsets using <code class="docutils literal notranslate"><span class="pre">now</span> <span class="pre">=</span> <span class="pre">2018-03-14T15:12Z</span></code> (and UTC mode)</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="67%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Syntax</th>
<th class="head">Interpretation</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">next(T-00)</span></code></td>
<td>2018-03-14T16:00Z</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">previous(T-00)</span></code></td>
<td>2018-03-14T15:00Z</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">next(T-00;</span> <span class="pre">T-15;</span> <span class="pre">T-30;</span> <span class="pre">T-45)</span></code></td>
<td>2018-03-14T15:15Z</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">previous(T-00;</span> <span class="pre">T-15;</span> <span class="pre">T-30;</span> <span class="pre">T-45)</span></code></td>
<td>2018-03-14T15:00Z</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">next(T00)</span></code></td>
<td>2018-03-15T00:00Z</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">previous(T00)</span></code></td>
<td>2018-03-14T00:00Z</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">next(T06:30Z)</span></code></td>
<td>2018-03-15T06:30Z</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">previous(T06:30)</span> <span class="pre">-P1D</span></code></td>
<td>2018-03-13T06:30Z</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">next(T00;</span> <span class="pre">T06;</span> <span class="pre">T12;</span> <span class="pre">T18)</span></code></td>
<td>2018-03-14T18:00Z</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">previous(T00;</span> <span class="pre">T06;</span> <span class="pre">T12;</span> <span class="pre">T18)</span></code></td>
<td>2018-03-14T12:00Z</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">next(T00;</span> <span class="pre">T06;</span> <span class="pre">T12;</span> <span class="pre">T18)</span> <span class="pre">+P1W</span></code></td>
<td>2018-03-21T18:00Z</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">PT1H</span></code></td>
<td>2018-03-14T16:12Z</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">-P1M</span></code></td>
<td>2018-02-14T15:12Z</td>
</tr>
</tbody>
</table>
<p>The relative initial cycle point also works with truncated dates, including
weeks and ordinal date, using ISO8601 truncated date representations.
Note that day-of-week should always be specified when using weeks. If a time
is not included, the calculation of the next or previous corresponding
point will be done from midnight of the current day.
Examples of interpretation are given in
<a class="reference internal" href="#fig-relative-initial-cycle-point-date-syntax-interpretation"><span class="std std-numref">Table 2</span></a>.</p>
<span id="fig-relative-initial-cycle-point-date-syntax-interpretation"></span><table border="1" class="docutils" id="id2">
<caption><span class="caption-number">Table 2 </span><span class="caption-text">Examples of setting relative initial cycle point for dates using <code class="docutils literal notranslate"><span class="pre">now</span> <span class="pre">=</span> <span class="pre">2018-03-14T15:12Z</span></code> (and UTC mode)</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="67%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Syntax</th>
<th class="head">Interpretation</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">next(-00)</span></code></td>
<td>2100-01-01T00:00Z</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">previous(--01)</span></code></td>
<td>2018-01-01T00:00Z</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">next(---01)</span></code></td>
<td>2018-04-01T00:00Z</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">previous(--1225)</span></code></td>
<td>2017-12-25T00:00Z</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">next(-2006)</span></code></td>
<td>2020-06-01T00:00Z</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">previous(-W101)</span></code></td>
<td>2018-03-05T00:00Z</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">next(-W-1;</span> <span class="pre">-W-3;</span> <span class="pre">-W-5)</span></code></td>
<td>2018-03-14T00:00Z</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">next(-001;</span> <span class="pre">-091;</span> <span class="pre">-181;</span> <span class="pre">-271)</span></code></td>
<td>2018-04-01T00:00Z</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">previous(-365T12Z)</span></code></td>
<td>2017-12-31T12:00Z</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="scheduling-final-cycle-point">
<h5>15.1.4.4. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> final cycle point<a class="headerlink" href="#scheduling-final-cycle-point" title="Permalink to this headline">¶</a></h5>
<p>Cycling tasks are held once they pass the final cycle point, if one is
specified. Once all tasks have achieved this state the suite will shut
down. If this item is provided you can override it on the command line
or in the gcylc suite start panel.</p>
<p>In date-time cycling, if you do not provide time zone information for this,
it will be assumed to be local time, or in UTC if <a class="reference internal" href="#utc-mode"><span class="std std-ref">[cylc] -&gt; UTC mode</span></a> is set, or in
the <a class="reference internal" href="#cycle-point-time-zone"><span class="std std-ref">[cylc] -&gt; cycle point time zone</span></a> if that is set.</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 date-time point representation (e.g.
<code class="docutils literal notranslate"><span class="pre">CCYYMMDDThhmm</span></code>, 19951231T1230) or ISO 8601 date-time offset
(e.g.  +P1D+PT6H)</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
<div class="section" id="scheduling-initial-cycle-point-constraints">
<span id="initial-cycle-point-constraints"></span><h5>15.1.4.5. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> initial cycle point constraints<a class="headerlink" href="#scheduling-initial-cycle-point-constraints" title="Permalink to this headline">¶</a></h5>
<p>In a cycling suite it is possible to restrict the initial cycle point by
defining a list of truncated time points under the initial cycle point
constraints.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of ISO 8601 truncated time point
representations (e.g.  T00, T06, T-30).</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
<div class="section" id="scheduling-final-cycle-point-constraints">
<span id="final-cycle-point-constraints"></span><h5>15.1.4.6. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> final cycle point constraints<a class="headerlink" href="#scheduling-final-cycle-point-constraints" title="Permalink to this headline">¶</a></h5>
<p>In a cycling suite it is possible to restrict the final cycle point by
defining a list of truncated time points under the final cycle point
constraints.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of ISO 8601 truncated time point
representations (e.g. T00, T06, T-30).</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
<div class="section" id="scheduling-hold-after-point">
<h5>15.1.4.7. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> hold after point<a class="headerlink" href="#scheduling-hold-after-point" title="Permalink to this headline">¶</a></h5>
<p>Cycling tasks are held once they pass the hold after cycle point, if one is
specified. Unlike the final cycle point suite will not shut down once all tasks
have passed this point. If this item is provided you can override it on the
command line or in the gcylc suite start panel.</p>
</div>
<div class="section" id="scheduling-runahead-limit">
<span id="runahead-limit"></span><h5>15.1.4.8. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> runahead limit<a class="headerlink" href="#scheduling-runahead-limit" title="Permalink to this headline">¶</a></h5>
<p>Runahead limiting prevents the fastest tasks in a suite from getting too far
ahead of the slowest ones, as documented in <a class="reference internal" href="index.html#runaheadlimit"><span class="std std-ref">Runahead Limiting</span></a>.</p>
<p>This config item specifies a hard limit as a cycle interval between the
slowest and fastest tasks. It is deprecated in favour of the newer default
limiting by <code class="docutils literal notranslate"><span class="pre">max</span> <span class="pre">active</span> <span class="pre">cycle</span> <span class="pre">points</span></code> (<a class="reference internal" href="#max-active-cycle-points"><span class="std std-ref">[scheduling] -&gt; max active cycle points</span></a>).</p>
<ul class="simple">
<li><em>type</em>: Cycle interval string e.g. <code class="docutils literal notranslate"><span class="pre">PT12H</span></code>
for a 12 hour limit under ISO 8601 cycling.</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
<div class="section" id="scheduling-max-active-cycle-points">
<span id="max-active-cycle-points"></span><h5>15.1.4.9. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> max active cycle points<a class="headerlink" href="#scheduling-max-active-cycle-points" title="Permalink to this headline">¶</a></h5>
<p>Runahead limiting prevents the fastest tasks in a suite from getting too far
ahead of the slowest ones, as documented in <a class="reference internal" href="index.html#runaheadlimit"><span class="std std-ref">Runahead Limiting</span></a>.</p>
<p>This config item supersedes the deprecated hard <code class="docutils literal notranslate"><span class="pre">runahead</span> <span class="pre">limit</span></code>
(<a class="reference internal" href="#runahead-limit"><span class="std std-ref">[scheduling] -&gt; runahead limit</span></a>). It allows up to <code class="docutils literal notranslate"><span class="pre">N</span></code> (default 3) consecutive
cycle points to be active at any time, adjusted up if necessary for
any future triggering.</p>
<ul class="simple">
<li><em>type</em>: integer</li>
<li><em>default</em>: 3</li>
</ul>
</div>
<div class="section" id="scheduling-spawn-to-max-active-cycle-points">
<span id="spawn-to-max-active-cycle-points"></span><h5>15.1.4.10. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> spawn to max active cycle points<a class="headerlink" href="#scheduling-spawn-to-max-active-cycle-points" title="Permalink to this headline">¶</a></h5>
<p>Allows tasks to spawn out to <code class="docutils literal notranslate"><span class="pre">max</span> <span class="pre">active</span> <span class="pre">cycle</span> <span class="pre">points</span></code>
(<a class="reference internal" href="#max-active-cycle-points"><span class="std std-ref">[scheduling] -&gt; max active cycle points</span></a>), removing restriction that a task has to have
submitted before its successor can be spawned.</p>
<p><em>Important</em>: This should be used with care given the potential impact of
additional task proxies both in terms of memory and cpu for the cylc daemon as
well as overheads in rendering all the additional tasks in gcylc. Also, use
of the setting may highlight any issues with suite design relying on the
default behaviour where downstream tasks would otherwise be waiting on ones
upstream submitting and the suite would have stalled e.g. a housekeeping task
at a later cycle deleting an earlier cycle’s data before that cycle has had
chance to run where previously the task would not have been spawned until its
predecessor had been submitted.</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>default</em>: False</li>
</ul>
</div>
<div class="section" id="scheduling-queues">
<h5>15.1.4.11. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[queues]]<a class="headerlink" href="#scheduling-queues" title="Permalink to this headline">¶</a></h5>
<p>Configuration of internal queues, by which the number of simultaneously
active tasks (submitted or running) can be limited, per queue. By
default a single queue called <em>default</em> is defined, with all tasks
assigned to it and no limit. To use a single queue for the whole suite
just set the limit on the <em>default</em> queue as required.
See also <a class="reference internal" href="index.html#internalqueues"><span class="std std-ref">Limiting Activity With Internal Queues</span></a>.</p>
<div class="section" id="scheduling-queues-queue">
<h6>15.1.4.11.1. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[queues]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[__QUEUE__]]]<a class="headerlink" href="#scheduling-queues-queue" title="Permalink to this headline">¶</a></h6>
<p>Section heading for configuration of a single queue. Replace
<code class="docutils literal notranslate"><span class="pre">__QUEUE__</span></code> with a queue name, and repeat the section as required.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: “default”</li>
</ul>
<div class="section" id="scheduling-queues-queue-limit">
<h7>15.1.4.11.1.1. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[queues]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[__QUEUE__]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> limit<a class="headerlink" href="#scheduling-queues-queue-limit" title="Permalink to this headline">¶</a></h7>
<p>The maximum number of active tasks allowed at any one time, for this queue.</p>
<ul class="simple">
<li><em>type</em>: integer</li>
<li><em>default</em>: 0 (i.e. no limit)</li>
</ul>
</div>
<div class="section" id="scheduling-queues-queue-members">
<h7>15.1.4.11.1.2. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[queues]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[__QUEUE__]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> members<a class="headerlink" href="#scheduling-queues-queue-members" title="Permalink to this headline">¶</a></h7>
<p>A list of member tasks, or task family names, to assign to this queue
(assigned tasks will automatically be removed from the default queue).</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of strings (task or family names).</li>
<li><em>default</em>: none for user-defined queues; all tasks for the “default” queue</li>
</ul>
</div>
</div>
</div>
<div class="section" id="scheduling-xtriggers">
<h5>15.1.4.12. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[xtriggers]]<a class="headerlink" href="#scheduling-xtriggers" title="Permalink to this headline">¶</a></h5>
<p>This section is for <em>External Trigger</em> function declarations -
see <a class="reference internal" href="index.html#external-triggers"><span class="std std-ref">External Triggers</span></a>.</p>
<div class="section" id="scheduling-xtriggers-many">
<h6>15.1.4.12.1. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[xtriggers]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> __MANY__<a class="headerlink" href="#scheduling-xtriggers-many" title="Permalink to this headline">¶</a></h6>
<p>Replace <code class="docutils literal notranslate"><span class="pre">__MANY__</span></code> with any user-defined event trigger function
declarations and corresponding labels for use in the graph:</p>
<ul class="simple">
<li><em>type</em>: string: function signature followed by optional call interval</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">trig_1</span> <span class="pre">=</span> <span class="pre">my_trigger(arg1,</span> <span class="pre">arg2,</span> <span class="pre">kwarg1,</span> <span class="pre">kwarg2):PT10S</span></code></li>
</ul>
<p>(See <a class="reference internal" href="index.html#external-triggers"><span class="std std-ref">External Triggers</span></a> for details).</p>
</div>
</div>
<div class="section" id="scheduling-special-tasks">
<h5>15.1.4.13. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[special tasks]]<a class="headerlink" href="#scheduling-special-tasks" title="Permalink to this headline">¶</a></h5>
<p>This section is used to identify tasks with special behaviour. Family names can
be used in special task lists as shorthand for listing all member tasks.</p>
<div class="section" id="scheduling-special-tasks-clock-trigger">
<h6>15.1.4.13.1. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[special tasks]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> clock-trigger<a class="headerlink" href="#scheduling-special-tasks-clock-trigger" title="Permalink to this headline">¶</a></h6>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please read <a class="reference internal" href="index.html#external-triggers"><span class="std std-ref">External Triggers</span></a> before
using the older clock triggers described in this section.</p>
</div>
<p>Clock-trigger tasks (see <a class="reference internal" href="index.html#clocktriggertasks"><span class="std std-ref">Clock Triggers</span></a>) wait on a wall clock time
specified as an offset from their own cycle point.</p>
<ul>
<li><p class="first"><em>type</em>: Comma-separated list of task or family names with
associated date-time offsets expressed as ISO8601 interval strings,
positive or negative, e.g. <code class="docutils literal notranslate"><span class="pre">PT1H</span></code> for 1 hour.  The offset
specification may be omitted to trigger right on the cycle point.</p>
</li>
<li><p class="first"><em>default</em>: (none)</p>
</li>
<li><p class="first"><em>example</em>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">clock-trigger </span><span class="o">=</span><span class="s"> foo(PT1H30M), bar(PT1.5H), baz</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="scheduling-special-tasks-clock-expire">
<span id="clockexpireref"></span><h6>15.1.4.13.2. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[special tasks]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> clock-expire<a class="headerlink" href="#scheduling-special-tasks-clock-expire" title="Permalink to this headline">¶</a></h6>
<p>Clock-expire tasks enter the <code class="docutils literal notranslate"><span class="pre">expired</span></code> state and skip job submission if too
far behind the wall clock when they become ready to run.  The expiry time is
specified as an offset from wall-clock time; typically it should be negative -
see <a class="reference internal" href="index.html#clockexpiretasks"><span class="std std-ref">Clock-Expire Triggers</span></a>.</p>
<ul>
<li><p class="first"><em>type</em>: Comma-separated list of task or family names with
associated date-time offsets expressed as ISO8601 interval strings,
positive or negative, e.g. <code class="docutils literal notranslate"><span class="pre">PT1H</span></code> for 1 hour.  The offset
may be omitted if it is zero.</p>
</li>
<li><p class="first"><em>default</em>: (none)</p>
</li>
<li><p class="first"><em>example</em>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">clock-expire </span><span class="o">=</span><span class="s"> foo(-P1D)</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="scheduling-special-tasks-external-trigger">
<h6>15.1.4.13.3. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[special tasks]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> external-trigger<a class="headerlink" href="#scheduling-special-tasks-external-trigger" title="Permalink to this headline">¶</a></h6>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please read <a class="reference internal" href="index.html#external-triggers"><span class="std std-ref">External Triggers</span></a> before
using the older mechanism described in this section.</p>
</div>
<p>Externally triggered tasks (see <a class="reference internal" href="index.html#old-style-external-triggers"><span class="std std-ref">Old-Style External Triggers (Deprecated)</span></a>) wait on
external events reported via the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">ext-trigger</span></code> command. To
constrain triggers to a specific cycle point, include
<code class="docutils literal notranslate"><span class="pre">$CYLC_TASK_CYCLE_POINT</span></code> in the trigger message string and pass the
cycle point to the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">ext-trigger</span></code> command.</p>
<ul>
<li><p class="first"><em>type</em>: Comma-separated list of task names with associated
external trigger message strings.</p>
</li>
<li><p class="first"><em>default</em>: (none)</p>
</li>
<li><p class="first"><em>example</em>: (note the comma and line-continuation character)</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>external-trigger = get-satx(&quot;new sat-X data ready&quot;),
                   get-saty(&quot;new sat-Y data ready for $CYLC_TASK_CYCLE_POINT&quot;)
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="scheduling-special-tasks-sequential">
<h6>15.1.4.13.4. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[special tasks]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> sequential<a class="headerlink" href="#scheduling-special-tasks-sequential" title="Permalink to this headline">¶</a></h6>
<p>Sequential tasks automatically depend on their own previous-cycle instance.
This declaration is deprecated in favour of explicit inter-cycle triggers -
see <a class="reference internal" href="index.html#sequentialtasks"><span class="std std-ref">Special Sequential Tasks</span></a>.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of task or family names.</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">sequential</span> <span class="pre">=</span> <span class="pre">foo,</span> <span class="pre">bar</span></code></li>
</ul>
</div>
<div class="section" id="scheduling-special-tasks-exclude-at-start-up">
<span id="easu"></span><h6>15.1.4.13.5. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[special tasks]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> exclude at start-up<a class="headerlink" href="#scheduling-special-tasks-exclude-at-start-up" title="Permalink to this headline">¶</a></h6>
<p>Any task listed here will be excluded from the initial task pool (this
goes for suite restarts too). If an <em>inclusion</em> list is also
specified, the initial pool will contain only included tasks that have
not been excluded. Excluded tasks can still be inserted at run time.
Other tasks may still depend on excluded tasks if they have not been
removed from the suite dependency graph, in which case some manual
triggering, or insertion of excluded tasks, may be required.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of task or family names.</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
<div class="section" id="scheduling-special-tasks-include-at-start-up">
<span id="iasu"></span><h6>15.1.4.13.6. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[special tasks]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> include at start-up<a class="headerlink" href="#scheduling-special-tasks-include-at-start-up" title="Permalink to this headline">¶</a></h6>
<p>If this list is not empty, any task <em>not</em> listed in it will be
excluded from the initial task pool (this goes for suite restarts too).
If an <em>exclusion</em> list is also specified, the initial pool will
contain only included tasks that have not been excluded. Excluded tasks
can still be inserted at run time. Other tasks may still depend on
excluded tasks if they have not been removed from the suite dependency
graph, in which case some manual triggering, or insertion of excluded
tasks, may be required.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of task or family names.</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
</div>
<div class="section" id="scheduling-dependencies">
<h5>15.1.4.14. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[dependencies]]<a class="headerlink" href="#scheduling-dependencies" title="Permalink to this headline">¶</a></h5>
<p>The suite dependency graph is defined under this section.  You can plot
the dependency graph as you work on it, with <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">graph</span></code> or
by right clicking on the suite in the db viewer.  See
also <a class="reference internal" href="index.html#configuringscheduling"><span class="std std-ref">Scheduling - Dependency Graphs</span></a>.</p>
<div class="section" id="scheduling-dependencies-graph">
<h6>15.1.4.14.1. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[dependencies]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> graph<a class="headerlink" href="#scheduling-dependencies-graph" title="Permalink to this headline">¶</a></h6>
<p>The dependency graph for a completely non-cycling suites can go here.
See also <a class="reference internal" href="#graphdescrip"><span class="std std-ref">[scheduling] -&gt; [[dependencies]] -&gt; [[[__RECURRENCE__]]] -&gt; graph</span></a> below and <a class="reference internal" href="index.html#configuringscheduling"><span class="std std-ref">Scheduling - Dependency Graphs</span></a>, for graph
string syntax.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>example</em>: (see <a class="reference internal" href="#graphdescrip"><span class="std std-ref">[scheduling] -&gt; [[dependencies]] -&gt; [[[__RECURRENCE__]]] -&gt; graph</span></a> below)</li>
</ul>
</div>
<div class="section" id="scheduling-dependencies-recurrence">
<h6>15.1.4.14.2. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[dependencies]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[__RECURRENCE__]]]<a class="headerlink" href="#scheduling-dependencies-recurrence" title="Permalink to this headline">¶</a></h6>
<p><code class="docutils literal notranslate"><span class="pre">__RECURRENCE__</span></code> section headings define the sequence of cycle points for
which the subsequent graph section is valid. These should be specified in
our ISO 8601 derived sequence syntax, or similar for integer cycling:</p>
<ul class="simple">
<li><em>examples</em>:
- date-time cycling: <code class="docutils literal notranslate"><span class="pre">[[[T00,T06,T12,T18]]]</span></code> or <code class="docutils literal notranslate"><span class="pre">[[[PT6H]]]</span></code>
- integer cycling (stepped by 2): <code class="docutils literal notranslate"><span class="pre">[[[P2]]]</span></code></li>
<li><em>default</em>: (none)</li>
</ul>
<p>See <a class="reference internal" href="index.html#graphtypes"><span class="std std-ref">Graph Types</span></a> for more on recurrence expressions, and how multiple
graph sections combine.</p>
<div class="section" id="scheduling-dependencies-recurrence-graph">
<span id="graphdescrip"></span><h7>15.1.4.14.2.1. [scheduling] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[dependencies]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[__RECURRENCE__]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> graph<a class="headerlink" href="#scheduling-dependencies-recurrence-graph" title="Permalink to this headline">¶</a></h7>
<p>The dependency graph for a given recurrence section goes here. Syntax examples
follow; see also <a class="reference internal" href="index.html#configuringscheduling"><span class="std std-ref">Scheduling - Dependency Graphs</span></a> and <a class="reference internal" href="index.html#triggertypes"><span class="std std-ref">Task Triggering</span></a>.</p>
<ul>
<li><p class="first"><em>type</em>: string</p>
</li>
<li><p class="first"><em>examples</em>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
    <span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">bar</span> <span class="o">=&gt;</span> <span class="kd">baz</span> <span class="o">&amp;</span> <span class="kd">waz</span>     <span class="c1"># baz and waz both trigger off bar</span>
    <span class="kd">foo</span>[<span class="nb">-P1D-PT6H</span>] <span class="o">=&gt;</span> <span class="kd">bar</span>       <span class="c1"># bar triggers off foo[-P1D-PT6H]</span>
    <span class="kd">baz</span><span class="c">:</span><span class="kd">out1</span> <span class="o">=&gt;</span> <span class="kd">faz</span>             <span class="c1"># faz triggers off a message output of baz</span>
    <span class="kd">X</span><span class="c">:</span><span class="kd">start</span> <span class="o">=&gt;</span> <span class="kd">Y</span>                <span class="c1"># Y triggers if X starts executing</span>
    <span class="kd">X</span><span class="c">:</span><span class="kd">fail</span> <span class="o">=&gt;</span> <span class="kd">Y</span>                 <span class="c1"># Y triggers if X fails</span>
    <span class="kd">foo</span>[<span class="nb">-PT6H</span>]<span class="c">:</span><span class="kd">fail</span> <span class="o">=&gt;</span> <span class="kd">bar</span>      <span class="c1"># bar triggers if foo[-PT6H] fails</span>
    <span class="kd">X</span> <span class="o">=&gt;</span> <span class="x">!Y</span>                     <span class="c1"># Y suicides if X succeeds</span>
    <span class="kd">X</span> <span class="o">|</span> <span class="kd">X</span><span class="c">:</span><span class="kd">fail</span> <span class="o">=&gt;</span> <span class="kd">Z</span>             <span class="c1"># Z triggers if X succeeds or fails</span>
    <span class="kd">X</span><span class="c">:</span><span class="kd">finish</span> <span class="o">=&gt;</span> <span class="kd">Z</span>               <span class="c1"># Z triggers if X succeeds or fails</span>
    <span class="p">(</span><span class="kd">A</span> <span class="o">|</span> <span class="kd">B</span> <span class="o">&amp;</span> <span class="kd">C</span> <span class="p">)</span> <span class="o">|</span> <span class="kd">D</span> <span class="o">=&gt;</span> <span class="kd">foo</span>     <span class="c1"># general conditional triggers</span>
    <span class="kd">foo</span><span class="c">:</span><span class="kd">submit</span> <span class="o">=&gt;</span> <span class="kd">bar</span>           <span class="c1"># bar triggers if foo is successfully submitted</span>
    <span class="kd">foo</span><span class="c">:</span><span class="kd">submit</span><span class="c">-</span><span class="kd">fail</span> <span class="o">=&gt;</span> <span class="kd">bar</span>      <span class="c1"># bar triggers if submission of foo fails</span>
    <span class="c1"># comment</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first"><em>default</em>: (none)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="section" id="runtime">
<h4>15.1.5. [runtime]<a class="headerlink" href="#runtime" title="Permalink to this headline">¶</a></h4>
<p>This section is used to specify how, where, and what to execute when
tasks are ready to run. Common
configuration can be factored out in a multiple-inheritance hierarchy of
runtime namespaces that culminates in the tasks of the suite. Order of
precedence is determined by the C3 linearization algorithm as used to
find the <em>method resolution order</em> in Python language class
hierarchies. For details and examples see <a class="reference internal" href="index.html#niorp"><span class="std std-ref">Runtime - Task Configuration</span></a>.</p>
<div class="section" id="runtime-name">
<h5>15.1.5.1. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]]<a class="headerlink" href="#runtime-name" title="Permalink to this headline">¶</a></h5>
<p>Replace <code class="docutils literal notranslate"><span class="pre">__NAME__</span></code> with a namespace name, or a comma-separated list of
names, and repeat as needed to define all tasks in the suite. Names must
be valid according to the restrictions outlined in <a class="reference internal" href="index.html#tasknames"><span class="std std-ref">Task and Namespace Names</span></a>.</p>
<p>A namespace represents a group or family of tasks if other namespaces
inherit from it, or a task if no others inherit from it.</p>
<ul class="simple">
<li><em>legal values</em>:
- <code class="docutils literal notranslate"><span class="pre">[[foo]]</span></code>
- <code class="docutils literal notranslate"><span class="pre">[[foo,</span> <span class="pre">bar,</span> <span class="pre">baz]]</span></code></li>
</ul>
<p>If multiple names are listed the subsequent settings apply to each.</p>
<p>All namespaces inherit initially from <em>root</em>, which can be
explicitly configured to provide or override default settings
for all tasks in the suite.</p>
<div class="section" id="runtime-name-extra-log-files">
<h6>15.1.5.1.1. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> extra log files<a class="headerlink" href="#runtime-name-extra-log-files" title="Permalink to this headline">¶</a></h6>
<p>A list of user-defined log files associated with a task. Files defined here
will appear alongside the default log files in the cylc GUI. Log files
must reside in the job log directory <code class="docutils literal notranslate"><span class="pre">$CYLC_TASK_LOG_DIR</span></code> and ideally
should be named using the <code class="docutils literal notranslate"><span class="pre">$CYLC_TASK_LOG_ROOT</span></code> prefix
(see <a class="reference internal" href="index.html#task-job-script-variables"><span class="std std-ref">Task Job Script Variables</span></a>).</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of strings (log file names).</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>: (job.custom-log-name)</li>
</ul>
</div>
<div class="section" id="runtime-name-inherit">
<h6>15.1.5.1.2. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> inherit<a class="headerlink" href="#runtime-name-inherit" title="Permalink to this headline">¶</a></h6>
<p>A list of the immediate parent(s) this namespace inherits from. If no
parents are listed <code class="docutils literal notranslate"><span class="pre">root</span></code> is assumed.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of strings (parent namespace names).</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">root</span></code></li>
</ul>
</div>
<div class="section" id="runtime-name-init-script">
<h6>15.1.5.1.3. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> init-script<a class="headerlink" href="#runtime-name-init-script" title="Permalink to this headline">¶</a></h6>
<p>Custom script invoked by the task job script before the task execution
environment is configured - so it does not have access to any suite or task
environment variables. It can be an external command or script, or inlined
scripting. The original intention for this item was to allow remote tasks to
source login scripts to configure their access to cylc, but this should no
longer be necessary (see <a class="reference internal" href="index.html#howtasksgetaccesstocylc"><span class="std std-ref">Task Job Access To Cylc</span></a>). See also
<code class="docutils literal notranslate"><span class="pre">env-script</span></code>, <code class="docutils literal notranslate"><span class="pre">pre-script</span></code>, <code class="docutils literal notranslate"><span class="pre">script</span></code>,
<code class="docutils literal notranslate"><span class="pre">post-script</span></code>, <code class="docutils literal notranslate"><span class="pre">err-script</span></code>, <code class="docutils literal notranslate"><span class="pre">exit-script</span></code>.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">init-script</span> <span class="pre">=</span> <span class="pre">&quot;echo</span> <span class="pre">Hello</span> <span class="pre">World&quot;</span></code></li>
</ul>
</div>
<div class="section" id="runtime-name-env-script">
<h6>15.1.5.1.4. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> env-script<a class="headerlink" href="#runtime-name-env-script" title="Permalink to this headline">¶</a></h6>
<p>Custom script invoked by the task job script between the cylc-defined environment
(suite and task identity, etc.) and the user-defined task runtime environment -
so it has access to the cylc environment (and the task environment has
access to variables defined by this scripting). It can be an external command
or script, or inlined scripting. See also <code class="docutils literal notranslate"><span class="pre">init-script</span></code>,
<code class="docutils literal notranslate"><span class="pre">pre-script</span></code>, <code class="docutils literal notranslate"><span class="pre">script</span></code>, <code class="docutils literal notranslate"><span class="pre">post-script</span></code>,
<code class="docutils literal notranslate"><span class="pre">err-script</span></code>, and <code class="docutils literal notranslate"><span class="pre">exit-script</span></code>.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">env-script</span> <span class="pre">=</span> <span class="pre">&quot;echo</span> <span class="pre">Hello</span> <span class="pre">World&quot;</span></code></li>
</ul>
</div>
<div class="section" id="runtime-name-pre-script">
<h6>15.1.5.1.5. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> pre-script<a class="headerlink" href="#runtime-name-pre-script" title="Permalink to this headline">¶</a></h6>
<p>Custom script invoked by the task job script immediately before the <code class="docutils literal notranslate"><span class="pre">script</span></code>
item (just below). It can be an external command or script, or inlined scripting.
See also <code class="docutils literal notranslate"><span class="pre">init-script</span></code>, <code class="docutils literal notranslate"><span class="pre">env-script</span></code>,
<code class="docutils literal notranslate"><span class="pre">script</span></code>, <code class="docutils literal notranslate"><span class="pre">post-script</span></code>, <code class="docutils literal notranslate"><span class="pre">err-script</span></code>, and
<code class="docutils literal notranslate"><span class="pre">exit-script</span></code>.</p>
<ul>
<li><p class="first"><em>type</em>: string</p>
</li>
<li><p class="first"><em>default</em>: (none)</p>
</li>
<li><p class="first"><em>example</em>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">pre-script </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  . $HOME/.profile</span>
<span class="s2">  echo Hello from suite ${CYLC_SUITE_NAME}!&quot;&quot;&quot;</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="runtime-name-script">
<h6>15.1.5.1.6. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> script<a class="headerlink" href="#runtime-name-script" title="Permalink to this headline">¶</a></h6>
<p>The main custom script invoked from the task job script. It can be an
external command or script, or inlined scripting. See also
<code class="docutils literal notranslate"><span class="pre">init-script</span></code>, <code class="docutils literal notranslate"><span class="pre">env-script</span></code>, <code class="docutils literal notranslate"><span class="pre">pre-script</span></code>,
<code class="docutils literal notranslate"><span class="pre">post-script</span></code>, <code class="docutils literal notranslate"><span class="pre">err-script</span></code>, and <code class="docutils literal notranslate"><span class="pre">exit-script</span></code>.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>root default</em>: (none)</li>
</ul>
</div>
<div class="section" id="runtime-name-post-script">
<h6>15.1.5.1.7. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> post-script<a class="headerlink" href="#runtime-name-post-script" title="Permalink to this headline">¶</a></h6>
<p>Custom script invoked by the task job script immediately after the
<code class="docutils literal notranslate"><span class="pre">script</span></code> item (just above). It can be an external command or script,
or inlined scripting.  See also
<code class="docutils literal notranslate"><span class="pre">init-script</span></code>, <code class="docutils literal notranslate"><span class="pre">env-script</span></code>, <code class="docutils literal notranslate"><span class="pre">pre-script</span></code>,
<code class="docutils literal notranslate"><span class="pre">script</span></code>, <code class="docutils literal notranslate"><span class="pre">err-script</span></code>, and <code class="docutils literal notranslate"><span class="pre">exit-script</span></code>.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
<div class="section" id="runtime-name-err-script">
<h6>15.1.5.1.8. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> err-script<a class="headerlink" href="#runtime-name-err-script" title="Permalink to this headline">¶</a></h6>
<p>Custom script to be invoked at the end of the error trap, which is triggered
due to failure of a command in the task job script or trappable job kill. The
output of this will always be sent to STDERR and <code class="docutils literal notranslate"><span class="pre">$1</span></code> is set to the
name of the signal caught by the error trap. The script should be fast and use
very little system resource to ensure that the error trap can return quickly.
Companion of <code class="docutils literal notranslate"><span class="pre">exit-script</span></code>, which is executed on job success.
It can be an external command or script, or inlined scripting. See also
<code class="docutils literal notranslate"><span class="pre">init-script</span></code>, <code class="docutils literal notranslate"><span class="pre">env-script</span></code>, <code class="docutils literal notranslate"><span class="pre">pre-script</span></code>,
<code class="docutils literal notranslate"><span class="pre">script</span></code>, <code class="docutils literal notranslate"><span class="pre">post-script</span></code>, and <code class="docutils literal notranslate"><span class="pre">exit-script</span></code>.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">err-script</span> <span class="pre">=</span> <span class="pre">&quot;printenv</span> <span class="pre">FOO&quot;</span></code></li>
</ul>
</div>
<div class="section" id="runtime-name-exit-script">
<h6>15.1.5.1.9. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> exit-script<a class="headerlink" href="#runtime-name-exit-script" title="Permalink to this headline">¶</a></h6>
<p>Custom script invoked at the very end of <em>successful</em> job execution, just
before the job script exits. It should execute very quickly. Companion of
<code class="docutils literal notranslate"><span class="pre">err-script</span></code>, which is executed on job failure. It can be an external
command or script, or inlined scripting. See also <code class="docutils literal notranslate"><span class="pre">init-script</span></code>,
<code class="docutils literal notranslate"><span class="pre">env-script</span></code>, <code class="docutils literal notranslate"><span class="pre">pre-script</span></code>, <code class="docutils literal notranslate"><span class="pre">script</span></code>,
<code class="docutils literal notranslate"><span class="pre">post-script</span></code>, and <code class="docutils literal notranslate"><span class="pre">err-script</span></code>.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">exit-script</span> <span class="pre">=</span> <span class="pre">&quot;rm</span> <span class="pre">-f</span> <span class="pre">$TMP_FILES&quot;</span></code></li>
</ul>
</div>
<div class="section" id="runtime-name-work-sub-directory">
<span id="worksubdirectory"></span><h6>15.1.5.1.10. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> work sub-directory<a class="headerlink" href="#runtime-name-work-sub-directory" title="Permalink to this headline">¶</a></h6>
<p>Task job scripts are executed from within <em>work directories</em> created
automatically under the suite run directory. A task can get its own work
directory from <code class="docutils literal notranslate"><span class="pre">$CYLC_TASK_WORK_DIR</span></code> (or simply <code class="docutils literal notranslate"><span class="pre">$PWD</span></code> if
it does not <code class="docutils literal notranslate"><span class="pre">cd</span></code> elsewhere at runtime). The default directory
path contains task name and cycle point, to provide a unique workspace for
every instance of every task. If several tasks need to exchange files and
simply read and write from their from current working directory, this item
can be used to override the default to make them all use the same workspace.</p>
<p>The top level share and work directory location can be changed (e.g. to a
large data area) by a global config setting (see <a class="reference internal" href="index.html#workdirectory"><span class="std std-ref">[hosts] -&gt; [[HOST]] -&gt; work directory</span></a>).</p>
<ul class="simple">
<li><em>type</em>: string (directory path, can contain environment variables)</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">$CYLC_TASK_CYCLE_POINT/$CYLC_TASK_NAME</span></code></li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">$CYLC_TASK_CYCLE_POINT/shared/</span></code></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you omit cycle point from the work sub-directory path successive
instances of the task will share the same workspace. Consider the effect
on cycle point offset housekeeping of work directories before doing this.</p>
</div>
</div>
<div class="section" id="runtime-name-meta">
<h6>15.1.5.1.11. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[meta]]]<a class="headerlink" href="#runtime-name-meta" title="Permalink to this headline">¶</a></h6>
<p>Section containing metadata items for this task or family namespace.
Several items (title, description, URL) are pre-defined and are used by
the GUI. Others can be user-defined and passed to task event handlers to be
interpreted according to your needs. For example, the value of an
“importance” item could determine how an event handler responds to task
failure events.</p>
<p>Any suite meta item can now be passed to task event handlers by prefixing the
string template item name with “suite_”, for example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nt">[[[events]]]</span>
            <span class="nv">failed handler </span><span class="o">=</span><span class="s"> send-help.sh %(suite_title)s %(suite_importance)s %(title)s</span>
</pre></div>
</div>
<div class="section" id="runtime-name-meta-title">
<h7>15.1.5.1.11.1. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[meta]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> title<a class="headerlink" href="#runtime-name-meta-title" title="Permalink to this headline">¶</a></h7>
<p>A single line description of this namespace. It is displayed by the
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">list</span></code> command and can be retrieved from running tasks
with the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">show</span></code> command.</p>
<ul class="simple">
<li><em>type</em>: single line string</li>
<li><em>root default</em>: (none)</li>
</ul>
</div>
<div class="section" id="runtime-name-meta-description">
<h7>15.1.5.1.11.2. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[meta]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> description<a class="headerlink" href="#runtime-name-meta-description" title="Permalink to this headline">¶</a></h7>
<p>A multi-line description of this namespace, retrievable from running tasks with the
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">show</span></code> command.</p>
<ul class="simple">
<li><em>type</em>: multi-line string</li>
<li><em>root default</em>: (none)</li>
</ul>
</div>
<div class="section" id="runtime-name-meta-url">
<span id="taskurl"></span><h7>15.1.5.1.11.3. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[meta]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> URL<a class="headerlink" href="#runtime-name-meta-url" title="Permalink to this headline">¶</a></h7>
<p>A web URL to task documentation for this suite.  If present it can be browsed
with the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">doc</span></code> command, or by right-clicking on the task in
gcylc. The string templates <code class="docutils literal notranslate"><span class="pre">%(suite_name)s</span></code> and
<code class="docutils literal notranslate"><span class="pre">%(task_name)s</span></code> will be replaced with the actual suite and task names.
See also <a class="reference internal" href="#suiteurl"><span class="std std-ref">[meta] -&gt; URL</span></a>.</p>
<ul>
<li><p class="first"><em>type</em>: string (URL)</p>
</li>
<li><p class="first"><em>default</em>: (none)</p>
</li>
<li><p class="first"><em>example</em>: you can set URLs to all tasks in a suite by putting
something like the following in the root namespace:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nt">[[[meta]]]</span>
            <span class="nv">URL </span><span class="o">=</span><span class="s"> http://my-site.com/suites/%(suite_name)s/%(task_name)s.html</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">URLs containing the comment delimiter <code class="docutils literal notranslate"><span class="pre">#</span></code> must be protected by quotes.</p>
</div>
</div>
<div class="section" id="runtime-name-meta-many">
<h7>15.1.5.1.11.4. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[meta]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> __MANY__<a class="headerlink" href="#runtime-name-meta-many" title="Permalink to this headline">¶</a></h7>
<p>Replace <code class="docutils literal notranslate"><span class="pre">__MANY__</span></code> with any user-defined metadata item. These, like title,
URL, etc. can be passed to task event handlers to be interpreted according to your
needs. For example, the value of an “importance” item could determine how an event
handler responds to task failure events.</p>
<ul>
<li><p class="first"><em>type</em>: String or integer</p>
</li>
<li><p class="first"><em>default</em>: (none)</p>
</li>
<li><p class="first"><em>example</em>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nt">[[[meta]]]</span>
            <span class="nv">importance </span><span class="o">=</span><span class="s"> high</span>
            <span class="nv">color </span><span class="o">=</span><span class="s"> red</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="runtime-name-job">
<h6>15.1.5.1.12. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[job]]]<a class="headerlink" href="#runtime-name-job" title="Permalink to this headline">¶</a></h6>
<p>This section configures the means by which cylc submits task job scripts
to run.</p>
<div class="section" id="runtime-name-job-batch-system">
<span id="runtimejobsubmethods"></span><h7>15.1.5.1.12.1. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[job]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> batch system<a class="headerlink" href="#runtime-name-job-batch-system" title="Permalink to this headline">¶</a></h7>
<p>See <a class="reference internal" href="index.html#taskjobsubmission"><span class="std std-ref">Task Job Submission and Management</span></a> for how job submission works, and how to define
new handlers for different batch systems. Cylc has a number of built in batch
system handlers:</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>legal values</em>:<ul>
<li><code class="docutils literal notranslate"><span class="pre">background</span></code> - invoke a child process</li>
<li><code class="docutils literal notranslate"><span class="pre">at</span></code> - the rudimentary Unix <code class="docutils literal notranslate"><span class="pre">at</span></code> scheduler</li>
<li><code class="docutils literal notranslate"><span class="pre">loadleveler</span></code> - IBM LoadLeveler <code class="docutils literal notranslate"><span class="pre">llsubmit</span></code>, with directives
defined in the suite.rc file</li>
<li><code class="docutils literal notranslate"><span class="pre">lsf</span></code> - IBM Platform LSF <code class="docutils literal notranslate"><span class="pre">bsub</span></code>, with directives defined in the
suite.rc file</li>
<li><code class="docutils literal notranslate"><span class="pre">pbs</span></code> - PBS <code class="docutils literal notranslate"><span class="pre">qsub</span></code>, with directives defined in the suite.rc file</li>
<li><code class="docutils literal notranslate"><span class="pre">sge</span></code> - Sun Grid Engine <code class="docutils literal notranslate"><span class="pre">qsub</span></code>, with directives defined in the
suite.rc file</li>
<li><code class="docutils literal notranslate"><span class="pre">slurm</span></code> - Simple Linux Utility for Resource Management <code class="docutils literal notranslate"><span class="pre">sbatch</span></code>, with
directives defined in the suite.rc file</li>
<li><code class="docutils literal notranslate"><span class="pre">moab</span></code> - Moab workload manager <code class="docutils literal notranslate"><span class="pre">msub</span></code>, with directives defined in the
suite.rc file</li>
</ul>
</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">background</span></code></li>
</ul>
</div>
<div class="section" id="runtime-name-job-execution-time-limit">
<h7>15.1.5.1.12.2. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[job]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> execution time limit<a class="headerlink" href="#runtime-name-job-execution-time-limit" title="Permalink to this headline">¶</a></h7>
<p>Specify the execution wall clock limit for a job of the task.
For <code class="docutils literal notranslate"><span class="pre">background</span></code> and <code class="docutils literal notranslate"><span class="pre">at</span></code>, the job script will be invoked using the <code class="docutils literal notranslate"><span class="pre">timeout</span></code>
command. For other batch systems, the specified time will be automatically
translated into the equivalent directive for wall clock limit.</p>
<p>Tasks are polled multiple times, where necessary, when they exceed their
execution time limits. (See <a class="reference internal" href="index.html#executiontimelimitpollingintervals"><span class="std std-ref">[hosts] -&gt; [[HOST]] -&gt; [[[batch systems]]] -&gt; [[[[SYSTEM]]]] -&gt; execution time limit polling intervals</span></a> for
how to configure the polling intervals).</p>
<blockquote>
<div><ul class="simple">
<li><em>type</em>: ISO 8601 duration/interval representation</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">PT5M</span></code>, 5 minutes, <code class="docutils literal notranslate"><span class="pre">PT1H</span></code>, 1 hour</li>
<li><em>default</em>: (none)</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="runtime-name-job-batch-submit-command-template">
<h7>15.1.5.1.12.3. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[job]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> batch submit command template<a class="headerlink" href="#runtime-name-job-batch-submit-command-template" title="Permalink to this headline">¶</a></h7>
<p>This allows you to override the actual command used by the chosen batch
system. The template’s <code class="docutils literal notranslate"><span class="pre">\%(job)s</span></code> will be substituted by the
job file path.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>legal values</em>: a string template</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">llsubmit</span> <span class="pre">\%(job)s</span></code></li>
</ul>
</div>
<div class="section" id="runtime-name-job-shell">
<span id="jobsubshell"></span><h7>15.1.5.1.12.4. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[job]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> shell<a class="headerlink" href="#runtime-name-job-shell" title="Permalink to this headline">¶</a></h7>
<p>Location of the command used to interpret the job script submitted by the suite
server program when a task is ready to run. This can be set to the location of
<code class="docutils literal notranslate"><span class="pre">bash</span></code> in the job host if the shell is not installed in the standard
location.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It has no bearing on any sub-shells that may be called by the job script.</p>
</div>
<p>Setting this to the path of a ksh93 interpreter is deprecated. Support of which
will be withdrawn in a future cylc release. Setting this to any other shell is
not supported.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>root default</em>: <code class="docutils literal notranslate"><span class="pre">/bin/bash</span></code></li>
</ul>
</div>
<div class="section" id="runtime-name-job-submission-retry-delays">
<span id="jobsubrefretries"></span><h7>15.1.5.1.12.5. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[job]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> submission retry delays<a class="headerlink" href="#runtime-name-job-submission-retry-delays" title="Permalink to this headline">¶</a></h7>
<p>A list of duration (in ISO 8601 syntax), after which to resubmit if job
submission fails.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of ISO 8601 duration/interval
representations, optionally <em>preceded</em> by multipliers.</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">PT1M,3*PT1H,</span> <span class="pre">P1D</span></code> is equivalent to
<code class="docutils literal notranslate"><span class="pre">PT1M,</span> <span class="pre">PT1H,</span> <span class="pre">PT1H,</span> <span class="pre">PT1H,</span> <span class="pre">P1D</span></code> - 1 minute, 1 hour, 1 hour, 1
hour, 1 day.</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
<div class="section" id="runtime-name-job-execution-retry-delays">
<span id="refretries"></span><h7>15.1.5.1.12.6. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[job]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> execution retry delays<a class="headerlink" href="#runtime-name-job-execution-retry-delays" title="Permalink to this headline">¶</a></h7>
<p>See also <a class="reference internal" href="index.html#taskretries"><span class="std std-ref">Automatic Task Retry On Failure</span></a>.</p>
<p>A list of ISO 8601 time duration/intervals after which to resubmit the task
if it fails. The variable <code class="docutils literal notranslate"><span class="pre">$CYLC_TASK_TRY_NUMBER</span></code> in the task
execution environment is incremented each time, starting from 1 for the
first try - this can be used to vary task behaviour by try number.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of ISO 8601 duration/interval representations,
optionally <em>preceded</em> by multipliers.</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">PT1.5M,3*PT10M</span></code> is equivalent to
<code class="docutils literal notranslate"><span class="pre">PT1.5M,</span> <span class="pre">PT10M,</span> <span class="pre">PT10M,</span> <span class="pre">PT10M</span></code> - 1.5 minutes, 10 minutes, 10 minutes, 10 minutes.</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
<div class="section" id="runtime-name-job-submission-polling-intervals">
<span id="submissionpollingintervals"></span><h7>15.1.5.1.12.7. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[job]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> submission polling intervals<a class="headerlink" href="#runtime-name-job-submission-polling-intervals" title="Permalink to this headline">¶</a></h7>
<p>A list of intervals, expressed as ISO 8601 duration/intervals, with optional
multipliers, after which cylc will poll for status while the task is in the
submitted state.</p>
<p>For the polling task communication method this overrides the default
submission polling interval in the site/user config files
(<a class="reference internal" href="index.html#siteanduserconfiguration"><span class="std std-ref">Global (Site, User) Configuration Files</span></a>). For default and ssh task communications,
polling is not done by default but it can still be configured here as a
regular check on the health of submitted tasks.</p>
<p>Each list value is used in turn until the last, which is used repeatedly
until finished.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of ISO 8601 duration/interval
representations, optionally <em>preceded</em> by multipliers.</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">PT1M,3*PT1H,</span> <span class="pre">PT1M</span></code> is equivalent to
<code class="docutils literal notranslate"><span class="pre">PT1M,</span> <span class="pre">PT1H,</span> <span class="pre">PT1H,</span> <span class="pre">PT1H,</span> <span class="pre">PT1M</span></code> - 1 minute, 1 hour, 1 hour, 1
hour, 1 minute.</li>
<li><em>default</em>: (none)</li>
</ul>
<p>A single interval value is probably appropriate for submission polling.</p>
</div>
<div class="section" id="runtime-name-job-execution-polling-intervals">
<span id="executionpollingintervals"></span><h7>15.1.5.1.12.8. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[job]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> execution polling intervals<a class="headerlink" href="#runtime-name-job-execution-polling-intervals" title="Permalink to this headline">¶</a></h7>
<p>A list of intervals, expressed as ISO 8601 duration/intervals, with optional
multipliers, after which cylc will poll for status while the task is in the
running state.</p>
<p>For the polling task communication method this overrides the default
execution polling interval in the site/user config files
(<a class="reference internal" href="index.html#siteanduserconfiguration"><span class="std std-ref">Global (Site, User) Configuration Files</span></a>). For default and ssh task communications,
polling is not done by default but it can still be configured here as a
regular check on the health of submitted tasks.</p>
<p>Each list value is used in turn until the last, which is used repeatedly
until finished.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of ISO 8601 duration/interval
representations, optionally <em>preceded</em> by multipliers.</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">PT1M,3*PT1H,</span> <span class="pre">PT1M</span></code> is equivalent to
<code class="docutils literal notranslate"><span class="pre">PT1M,</span> <span class="pre">PT1H,</span> <span class="pre">PT1H,</span> <span class="pre">PT1H,</span> <span class="pre">PT1M</span></code> - 1 minute, 1 hour, 1 hour, 1
hour, 1 minute.</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
</div>
<div class="section" id="runtime-name-remote">
<h6>15.1.5.1.13. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[remote]]]<a class="headerlink" href="#runtime-name-remote" title="Permalink to this headline">¶</a></h6>
<p>Configure host and username, for tasks that do not run on the suite host
account. Non-interactive ssh is used to submit the task by the configured
batch system, so you must distribute your ssh key to allow
this. Cylc must be installed on task remote accounts, but no external
software dependencies are required there.</p>
<div class="section" id="runtime-name-remote-host">
<span id="dynamichostselection"></span><h7>15.1.5.1.13.1. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[remote]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> host<a class="headerlink" href="#runtime-name-remote-host" title="Permalink to this headline">¶</a></h7>
<p>The remote host for this namespace. This can be a static hostname, an
environment variable that holds a hostname, or a command that prints a
hostname to stdout. Host selection commands are executed just prior to
job submission. The host (static or dynamic) may have an entry in the
cylc site or user config file to specify parameters such as the location
of cylc on the remote machine; if not, the corresponding local settings
(on the suite host) will be assumed to apply on the remote host.</p>
<ul class="simple">
<li><em>type</em>: string (a valid hostname on the network)</li>
<li><em>default</em>: (none)</li>
<li><em>examples</em>:<ul>
<li>static host name: <code class="docutils literal notranslate"><span class="pre">host</span> <span class="pre">=</span> <span class="pre">foo</span></code></li>
<li>fully qualified: <code class="docutils literal notranslate"><span class="pre">host</span> <span class="pre">=</span> <span class="pre">foo.bar.baz</span></code></li>
<li>dynamic host selection:<ul>
<li>shell command (1): <code class="docutils literal notranslate"><span class="pre">host</span> <span class="pre">=</span> <span class="pre">$(host-selector.sh)</span></code></li>
<li>shell command (2): <code class="docutils literal notranslate"><span class="pre">host</span> <span class="pre">=</span> <span class="pre">\`host-selector.sh\`</span></code></li>
<li>environment variable: <code class="docutils literal notranslate"><span class="pre">host</span> <span class="pre">=</span> <span class="pre">$MY_HOST</span></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="runtime-name-remote-owner">
<h7>15.1.5.1.13.2. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[remote]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> owner<a class="headerlink" href="#runtime-name-remote-owner" title="Permalink to this headline">¶</a></h7>
<p>The username of the task host account. This is (only) used in the
non-interactive ssh command invoked by the suite server program to submit the
remote task (consequently it may be defined using local environment variables
(i.e. the shell in which cylc runs, and <code class="docutils literal notranslate"><span class="pre">[cylc]</span> <span class="pre">-&gt;</span> <span class="pre">[[environment]]</span></code>).</p>
<p>If you use dynamic host selection and have different usernames on
the different selectable hosts, you can configure your
<code class="docutils literal notranslate"><span class="pre">$HOME/.ssh/config</span></code> to handle username translation.</p>
<ul class="simple">
<li><em>type</em>: string (a valid username on the remote host)</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
<div class="section" id="runtime-name-remote-retrieve-job-logs">
<span id="runtime-remote-retrieve-job-logs"></span><h7>15.1.5.1.13.3. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[remote]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> retrieve job logs<a class="headerlink" href="#runtime-name-remote-retrieve-job-logs" title="Permalink to this headline">¶</a></h7>
<p>Remote task job logs are saved to the suite run directory on the task host, not
on the suite host. If you want the job logs pulled back to the suite host
automatically, you can set this item to <code class="docutils literal notranslate"><span class="pre">True</span></code>. The suite will
then attempt to <code class="docutils literal notranslate"><span class="pre">rsync</span></code> the job logs once from the remote host each
time a task job completes. E.g. if the job file is
<code class="docutils literal notranslate"><span class="pre">~/cylc-run/tut.oneoff.remote/log/job/1/hello/01/job</span></code>, anything under
<code class="docutils literal notranslate"><span class="pre">~/cylc-run/tut.oneoff.remote/log/job/1/hello/01/</span></code> will be retrieved.</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>default</em>: False</li>
</ul>
</div>
<div class="section" id="runtime-name-remote-retrieve-job-logs-max-size">
<span id="runtime-remote-retrieve-job-logs-max-size"></span><h7>15.1.5.1.13.4. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[remote]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> retrieve job logs max size<a class="headerlink" href="#runtime-name-remote-retrieve-job-logs-max-size" title="Permalink to this headline">¶</a></h7>
<p>If the disk space of the suite host is limited, you may want to set the maximum
sizes of the job log files to retrieve. The value can be anything that is
accepted by the <code class="docutils literal notranslate"><span class="pre">--max-size=SIZE</span></code> option of the <code class="docutils literal notranslate"><span class="pre">rsync</span></code> command.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: None</li>
</ul>
</div>
<div class="section" id="runtime-name-remote-retrieve-job-logs-retry-delays">
<span id="runtime-remote-retrieve-job-logs-retry-delays"></span><h7>15.1.5.1.13.5. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[remote]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> retrieve job logs retry delays<a class="headerlink" href="#runtime-name-remote-retrieve-job-logs-retry-delays" title="Permalink to this headline">¶</a></h7>
<p>Some batch systems have considerable delays between the time when the job
completes and when it writes the job logs in its normal location. If this is
the case, you can configure an initial delay and some retry delays between
subsequent attempts. The default behaviour is to attempt once without any delay.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of ISO 8601 duration/interval representations, optionally
<em>preceded</em> by multipliers.</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">retrieve</span> <span class="pre">job</span> <span class="pre">logs</span> <span class="pre">retry</span> <span class="pre">delays</span> <span class="pre">=</span> <span class="pre">PT10S,</span> <span class="pre">PT1M,</span> <span class="pre">PT5M</span></code></li>
</ul>
</div>
<div class="section" id="runtime-name-remote-suite-definition-directory">
<h7>15.1.5.1.13.6. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[remote]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code>  suite definition directory<a class="headerlink" href="#runtime-name-remote-suite-definition-directory" title="Permalink to this headline">¶</a></h7>
<p>The path to the suite configuration directory on the remote account, needed if
remote tasks require access to files stored there (via
<code class="docutils literal notranslate"><span class="pre">$CYLC_SUITE_DEF_PATH</span></code>) or in the suite bin directory (via
<code class="docutils literal notranslate"><span class="pre">$PATH</span></code>).  If this item is not defined, the local suite
configuration directory path will be assumed, with the suite owner’s home
directory, if present, replaced by <code class="docutils literal notranslate"><span class="pre">'$HOME'</span></code> for
interpretation on the remote account.</p>
<ul class="simple">
<li><em>type</em>: string (a valid directory path on the remote account)</li>
<li><em>default</em>: (local suite configuration path with <code class="docutils literal notranslate"><span class="pre">$HOME</span></code> replaced)</li>
</ul>
</div>
</div>
<div class="section" id="runtime-name-events">
<span id="taskeventhandling"></span><h6>15.1.5.1.14. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[events]]]<a class="headerlink" href="#runtime-name-events" title="Permalink to this headline">¶</a></h6>
<p>Cylc can call nominated event handlers when certain task events occur. This
section configures specific task event handlers; see <a class="reference internal" href="#suiteeventhandling"><span class="std std-ref">[cylc] -&gt; [[events]]</span></a>
for suite events.</p>
<p>Event handlers can be located in the suite <code class="docutils literal notranslate"><span class="pre">bin/</span></code> directory,
otherwise it is up to you to ensure their location is in <code class="docutils literal notranslate"><span class="pre">$PATH</span></code> (in
the shell in which the suite server program runs). They should require little
resource to run and return quickly.</p>
<p>Each task event handler can be specified as a list of command lines or command
line templates. They can contain any or all of the following patterns, which
will be substituted with actual values:</p>
<ul class="simple">
<li>%(event)s: event name</li>
<li>%(suite)s: suite name</li>
<li>%(suite_uuid)s: suite UUID string</li>
<li>%(point)s: cycle point</li>
<li>%(name)s: task name</li>
<li>%(submit_num)s: submit number</li>
<li>%(try_num)s: try number</li>
<li>%(id)s: task ID (i.e. %(name)s.%(point)s)</li>
<li>%(batch_sys_name)s: batch system name</li>
<li>%(batch_sys_job_id)s: batch system job ID</li>
<li>%(message)s: event message, if any</li>
<li>any task [meta] item, e.g.:
- %(title)s: task title
- %(URL)s: task URL
- %(importance)s - example custom task metadata</li>
<li>any suite [meta] item, prefixed with “suite_”, e.g.:
- %(suite_title)s: suite title
- %(suite_URL)s: suite URL
- %(suite_rating)s - example custom suite metadata</li>
</ul>
<p>Otherwise, the command line will be called with the following default
arguments:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;task-event-handler&gt; %(event)s %(suite)s %(id)s %(message)s
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Substitution patterns should not be quoted in the template strings.
This is done automatically where required.</p>
</div>
<p>For an explanation of the substitution syntax, see
<a class="reference external" href="https://docs.python.org/2/library/stdtypes.html#string-formatting">String Formatting Operations in the Python
documentation</a>.</p>
<p>Additional information can be passed to event handlers via the
<code class="docutils literal notranslate"><span class="pre">[cylc]</span> <span class="pre">-&gt;</span> <span class="pre">[[environment]]</span></code> (but not via task
runtime environments - event handlers are not called by tasks).</p>
<div class="section" id="runtime-name-events-event-handler">
<h7>15.1.5.1.14.1. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[events]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> EVENT handler<a class="headerlink" href="#runtime-name-events-event-handler" title="Permalink to this headline">¶</a></h7>
<p>A list of one or more event handlers to call when one of the following EVENTs occurs:</p>
<ul class="simple">
<li><strong>submitted</strong> - the job submit command was successful</li>
<li><strong>submission failed</strong> - the job submit command failed, or the
submitted job was killed before it started executing</li>
<li><strong>submission retry</strong> - job submit failed, but cylc will resubmit it
after a configured delay</li>
<li><strong>submission timeout</strong> - the submitted job timed out without commencing execution</li>
<li><strong>started</strong> - the task reported commencement of execution</li>
<li><strong>succeeded</strong> - the task reported that it completed successfully</li>
<li><strong>failed</strong> - the task reported that if tailed to complete successfully</li>
<li><strong>retry</strong> - the task failed, but cylc will resubmit it
after a configured delay</li>
<li><strong>execution timeout</strong> - the task timed out after execution commenced</li>
<li><strong>warning</strong> - the task reported a WARNING severity message</li>
<li><strong>critical</strong> - the task reported a CRITICAL severity message</li>
<li><strong>custom</strong> - the task reported a CUSTOM severity message</li>
<li><strong>late</strong> - the task is never active and is late</li>
</ul>
<p>Item details:
- <em>type</em>: Comma-separated list of strings (event handler scripts).
- <em>default</em>: None
- <em>example</em>: <code class="docutils literal notranslate"><span class="pre">failed</span> <span class="pre">handler</span> <span class="pre">=</span> <span class="pre">my-failed-handler.sh</span></code></p>
</div>
<div class="section" id="runtime-name-events-submission-timeout">
<span id="runtime-event-hooks-submission-timeout"></span><h7>15.1.5.1.14.2. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[events]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> submission timeout<a class="headerlink" href="#runtime-name-events-submission-timeout" title="Permalink to this headline">¶</a></h7>
<p>If a task has not started after the specified ISO 8601 duration/interval, the
<em>submission timeout</em> event handler(s) will be called.</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 duration/interval representation (e.g.
<code class="docutils literal notranslate"><span class="pre">PT30M</span></code>, 30 minutes or <code class="docutils literal notranslate"><span class="pre">P1D</span></code>, 1 day).</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
<div class="section" id="runtime-name-events-execution-timeout">
<span id="runtime-event-hooks-execution-timeout"></span><h7>15.1.5.1.14.3. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[events]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> execution timeout<a class="headerlink" href="#runtime-name-events-execution-timeout" title="Permalink to this headline">¶</a></h7>
<p>If a task has not finished after the specified ISO 8601 duration/interval, the
<em>execution timeout</em> event handler(s) will be called.</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 duration/interval representation (e.g.
<code class="docutils literal notranslate"><span class="pre">PT4H</span></code>, 4 hours or <code class="docutils literal notranslate"><span class="pre">P1D</span></code>, 1 day).</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
<div class="section" id="runtime-name-events-handlers">
<h7>15.1.5.1.14.4. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[events]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> handlers<a class="headerlink" href="#runtime-name-events-handlers" title="Permalink to this headline">¶</a></h7>
<p>Specify a list of command lines or command line templates as task event handlers.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of strings (event handler command line or command
line templates).</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">handlers</span> <span class="pre">=</span> <span class="pre">my-handler.sh</span></code></li>
</ul>
</div>
<div class="section" id="runtime-name-events-handler-events">
<h7>15.1.5.1.14.5. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[events]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> handler events<a class="headerlink" href="#runtime-name-events-handler-events" title="Permalink to this headline">¶</a></h7>
<p>Specify the events for which the general task event handlers should be invoked.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of events</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">handler</span> <span class="pre">events</span> <span class="pre">=</span> <span class="pre">submission</span> <span class="pre">failed,</span> <span class="pre">failed</span></code></li>
</ul>
</div>
<div class="section" id="runtime-name-events-handler-retry-delays">
<span id="runtime-events-handler-retry-delays"></span><h7>15.1.5.1.14.6. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[events]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> handler retry delays<a class="headerlink" href="#runtime-name-events-handler-retry-delays" title="Permalink to this headline">¶</a></h7>
<p>Specify an initial delay before running an event handler command and any retry
delays in case the command returns a non-zero code. The default behaviour is to
run an event handler command once without any delay.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of ISO 8601 duration/interval representations,
optionally <em>preceded</em> by multipliers.</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">handler</span> <span class="pre">retry</span> <span class="pre">delays</span> <span class="pre">=</span> <span class="pre">PT10S,</span> <span class="pre">PT1M,</span> <span class="pre">PT5M</span></code></li>
</ul>
</div>
<div class="section" id="runtime-name-events-mail-events">
<h7>15.1.5.1.14.7. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[events]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> mail events<a class="headerlink" href="#runtime-name-events-mail-events" title="Permalink to this headline">¶</a></h7>
<p>Specify the events for which notification emails should be sent.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of events</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">mail</span> <span class="pre">events</span> <span class="pre">=</span> <span class="pre">submission</span> <span class="pre">failed,</span> <span class="pre">failed</span></code></li>
</ul>
</div>
<div class="section" id="runtime-name-events-mail-from">
<h7>15.1.5.1.14.8. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[events]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> mail from<a class="headerlink" href="#runtime-name-events-mail-from" title="Permalink to this headline">¶</a></h7>
<p>Specify an alternate <code class="docutils literal notranslate"><span class="pre">from:</span></code> email address for event notifications.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: None, (<a class="reference external" href="mailto:notifications&#37;&#52;&#48;HOSTNAME">notifications<span>&#64;</span>HOSTNAME</a>)</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">mail</span> <span class="pre">from</span> <span class="pre">=</span> <span class="pre">no-reply&#64;your-org</span></code></li>
</ul>
</div>
<div class="section" id="runtime-name-events-mail-retry-delays">
<h7>15.1.5.1.14.9. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[events]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> mail retry delays<a class="headerlink" href="#runtime-name-events-mail-retry-delays" title="Permalink to this headline">¶</a></h7>
<p>Specify an initial delay before running the mail notification command and any
retry delays in case the command returns a non-zero code. The default behaviour
is to run the mail notification command once without any delay.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of ISO 8601 duration/interval representations,
optionally <em>preceded</em> by multipliers.</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">mail</span> <span class="pre">retry</span> <span class="pre">delays</span> <span class="pre">=</span> <span class="pre">PT10S,</span> <span class="pre">PT1M,</span> <span class="pre">PT5M</span></code></li>
</ul>
</div>
<div class="section" id="runtime-name-events-mail-smtp">
<h7>15.1.5.1.14.10. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[events]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> mail smtp<a class="headerlink" href="#runtime-name-events-mail-smtp" title="Permalink to this headline">¶</a></h7>
<p>Specify the SMTP server for sending email notifications.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: None, (localhost:25)</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">mail</span> <span class="pre">smtp</span> <span class="pre">=</span> <span class="pre">smtp.yourorg</span></code></li>
</ul>
</div>
<div class="section" id="runtime-name-events-mail-to">
<h7>15.1.5.1.14.11. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[events]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> mail to<a class="headerlink" href="#runtime-name-events-mail-to" title="Permalink to this headline">¶</a></h7>
<p>A list of email addresses to send task event notifications. The list can be
anything accepted by the <code class="docutils literal notranslate"><span class="pre">mail</span></code> command.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: None, (<a class="reference external" href="mailto:USER&#37;&#52;&#48;HOSTNAME">USER<span>&#64;</span>HOSTNAME</a>)</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">mail</span> <span class="pre">to</span> <span class="pre">=</span> <span class="pre">your.colleague</span></code></li>
</ul>
</div>
</div>
<div class="section" id="runtime-name-environment">
<h6>15.1.5.1.15. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[environment]]]<a class="headerlink" href="#runtime-name-environment" title="Permalink to this headline">¶</a></h6>
<p>The user defined task execution environment. Variables defined here can
refer to cylc suite and task identity variables, which are exported
earlier in the task job script, and variable assignment expressions can
use cylc utility commands because access to cylc is also configured
earlier in the script.  See also <a class="reference internal" href="index.html#taskexecutionenvironment"><span class="std std-ref">Task Execution Environment</span></a>.</p>
<p>You can also specify job environment templates here for <em>parameterized tasks</em>
(see <a class="reference internal" href="index.html#parameterized-tasks-label"><span class="std std-ref">Parameterized Tasks</span></a>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Prior to Cylc 7.8.7 (or prior to 7.9.2 if using the 7.9.x releases),
parameter environment templates were in a separate section. However, this
was changed to allow users to control the order of definition of the
variables.</p>
</div>
<div class="section" id="runtime-name-environment-variable">
<span id="appendixtaskexecutionenvironment"></span><h7>15.1.5.1.15.1. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[environment]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> __VARIABLE__<a class="headerlink" href="#runtime-name-environment-variable" title="Permalink to this headline">¶</a></h7>
<p>Replace <code class="docutils literal notranslate"><span class="pre">__VARIABLE__</span></code> with any number of environment variable
assignment expressions. Order of definition is preserved so values can
refer to previously defined variables. Values are passed through to the task
job script without evaluation or manipulation by Cylc (with the exception of
valid Python string templates that match parameterized tasks - see below), so
any variable assignment expression that is legal in the job submission shell
can be used. White space around the <code class="docutils literal notranslate"><span class="pre">=</span></code> is allowed (as far as cylc’s suite.rc
parser is concerned these are just normal configuration items).</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: (none)</li>
<li><em>legal values</em>: depends to some extent on the task job
submission shell (<a class="reference internal" href="#jobsubshell"><span class="std std-ref">[runtime] -&gt; [[__NAME__]] -&gt; [[[job]]] -&gt; shell</span></a>).</li>
<li><em>examples</em>, for the bash shell:<ul>
<li><code class="docutils literal notranslate"><span class="pre">FOO</span> <span class="pre">=</span> <span class="pre">$HOME/bar/baz</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">BAR</span> <span class="pre">=</span> <span class="pre">${FOO}$GLOBALVAR</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">BAZ</span> <span class="pre">=</span> <span class="pre">$(</span> <span class="pre">echo</span> <span class="pre">&quot;hello</span> <span class="pre">world&quot;</span> <span class="pre">)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">WAZ</span> <span class="pre">=</span> <span class="pre">${FOO%.jpg}.png</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">NEXT_CYCLE</span> <span class="pre">=</span> <span class="pre">$(</span> <span class="pre">cylc</span> <span class="pre">cycle-point</span> <span class="pre">--offset=PT6H</span> <span class="pre">)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">PREV_CYCLE</span> <span class="pre">=</span> <span class="pre">\`cylc</span> <span class="pre">cycle-point</span> <span class="pre">--offset=-PT6H`</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ZAZ</span> <span class="pre">=</span> <span class="pre">&quot;${FOO#bar}&quot;</span> <span class="pre">#</span> <span class="pre">&lt;--</span> <span class="pre">QUOTED</span> <span class="pre">to</span> <span class="pre">escape</span> <span class="pre">the</span> <span class="pre">suite.rc</span> <span class="pre">comment</span> <span class="pre">character</span></code></li>
</ul>
</li>
</ul>
<p>To use parameter environment templates, replace <code class="docutils literal notranslate"><span class="pre">__VARIABLE__</span></code> with pairs of
environment variable name and Python string template for parameter
substitution. This is only relevant for <em>parameterized tasks</em> - see
<a class="reference internal" href="index.html#parameterized-tasks-label"><span class="std std-ref">Parameterized Tasks</span></a>.</p>
<p>If specified, the job script will export the named variables specified
here (in addition to the standard <code class="docutils literal notranslate"><span class="pre">CYLC_TASK_PARAM_&lt;key&gt;</span></code>
variables), with the template strings substituted with the parameter values.</p>
<ul class="simple">
<li><em>examples</em>, for the bash shell:<ul>
<li><code class="docutils literal notranslate"><span class="pre">MYNUM</span> <span class="pre">=</span> <span class="pre">%(i)d</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">MYITEM</span> <span class="pre">=</span> <span class="pre">%(item)s</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">MYFILE</span> <span class="pre">=</span> <span class="pre">/path/to/%(i)03d/%(item)s</span></code></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="runtime-name-environment-filter">
<span id="environmentfilter"></span><h6>15.1.5.1.16. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[environment filter]]]<a class="headerlink" href="#runtime-name-environment-filter" title="Permalink to this headline">¶</a></h6>
<p>This section contains environment variable inclusion and exclusion
lists that can be used to filter the inherited environment. <em>This is
not intended as an alternative to a well-designed inheritance hierarchy
that provides each task with just the variables it needs.</em> Filters can,
however, improve suites with tasks that inherit a lot of environment
they don’t need, by making it clear which tasks use which variables.
They can optionally be used routinely as explicit “task environment
interfaces” too, at some cost to brevity, because they guarantee that
variables filtered out of the inherited task environment are not used.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Environment filtering is done after inheritance is completely
worked out, not at each level on the way, so filter lists in higher-level
namespaces only have an effect if they are not overridden by descendants.</p>
</div>
<div class="section" id="runtime-name-environment-filter-include">
<h7>15.1.5.1.16.1. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[environment filter]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> include<a class="headerlink" href="#runtime-name-environment-filter-include" title="Permalink to this headline">¶</a></h7>
<p>If given, only variables named in this list will be included from the
inherited environment, others will be filtered out. Variables may also
be explicitly excluded by an <code class="docutils literal notranslate"><span class="pre">exclude</span></code> list.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of strings (variable names).</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
<div class="section" id="runtime-name-environment-filter-exclude">
<h7>15.1.5.1.16.2. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[environment filter]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> exclude<a class="headerlink" href="#runtime-name-environment-filter-exclude" title="Permalink to this headline">¶</a></h7>
<p>Variables named in this list will be filtered out of the inherited
environment.  Variables may also be implicitly excluded by
omission from an <code class="docutils literal notranslate"><span class="pre">include</span></code> list.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of strings (variable names).</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
</div>
<div class="section" id="runtime-name-directives">
<h6>15.1.5.1.17. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[directives]]]<a class="headerlink" href="#runtime-name-directives" title="Permalink to this headline">¶</a></h6>
<p>Batch queue scheduler directives.  Whether or not these are used depends
on the batch system. For the built-in methods that support directives
(<code class="docutils literal notranslate"><span class="pre">loadleveler</span></code>, <code class="docutils literal notranslate"><span class="pre">lsf</span></code>, <code class="docutils literal notranslate"><span class="pre">pbs</span></code>, <code class="docutils literal notranslate"><span class="pre">sge</span></code>,
<code class="docutils literal notranslate"><span class="pre">slurm</span></code>, <code class="docutils literal notranslate"><span class="pre">moab</span></code>), directives are written to the top of the
task job script in the correct format for the method. Specifying directives
individually like this allows use of default directives that can be
individually overridden at lower levels of the runtime namespace hierarchy.</p>
<div class="section" id="runtime-name-directives-directive">
<h7>15.1.5.1.17.1. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[directives]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> __DIRECTIVE__<a class="headerlink" href="#runtime-name-directives-directive" title="Permalink to this headline">¶</a></h7>
<p>Replace <code class="docutils literal notranslate"><span class="pre">__DIRECTIVE__</span></code> with each directive assignment, e.g.
<code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">=</span> <span class="pre">parallel</span></code>.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: (none)</li>
</ul>
<p>Example directives for the built-in batch system handlers are shown
in <a class="reference internal" href="index.html#availablemethods"><span class="std std-ref">Supported Job Submission Methods</span></a>.</p>
</div>
</div>
<div class="section" id="runtime-name-outputs">
<h6>15.1.5.1.18. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[outputs]]]<a class="headerlink" href="#runtime-name-outputs" title="Permalink to this headline">¶</a></h6>
<p>Register custom task outputs for use in message triggering in this section
(<a class="reference internal" href="index.html#messagetriggers"><span class="std std-ref">Message Triggers</span></a>)</p>
<div class="section" id="runtime-name-outputs-output">
<h7>15.1.5.1.18.1. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[outputs]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> __OUTPUT__<a class="headerlink" href="#runtime-name-outputs-output" title="Permalink to this headline">¶</a></h7>
<p>Replace <code class="docutils literal notranslate"><span class="pre">__OUTPUT__</span></code> with one or more custom task output messages
(<a class="reference internal" href="index.html#messagetriggers"><span class="std std-ref">Message Triggers</span></a>).  The item name is used to select the custom output
message in graph trigger notation.</p>
<ul>
<li><p class="first"><em>type</em>: string</p>
</li>
<li><p class="first"><em>default</em>: (none)</p>
</li>
<li><p class="first"><em>examples</em>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">out1 </span><span class="o">=</span><span class="s"> &quot;sea state products ready&quot;</span>
<span class="nv">out2 </span><span class="o">=</span><span class="s"> &quot;NWP restart files completed&quot;</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="runtime-name-suite-state-polling">
<h6>15.1.5.1.19. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[suite state polling]]]<a class="headerlink" href="#runtime-name-suite-state-polling" title="Permalink to this headline">¶</a></h6>
<p>Configure automatic suite polling tasks as described
in <a class="reference internal" href="index.html#suitestatepolling"><span class="std std-ref">Triggering Off Of Tasks In Other Suites</span></a>. The
items in this section reflect the options and defaults of the
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">suite-state</span></code> command, except that the target suite name and the
<code class="docutils literal notranslate"><span class="pre">--task</span></code>, <code class="docutils literal notranslate"><span class="pre">--cycle</span></code>, and <code class="docutils literal notranslate"><span class="pre">--status</span></code> options are
taken from the graph notation.</p>
<div class="section" id="runtime-name-suite-state-polling-run-dir">
<h7>15.1.5.1.19.1. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[suite state polling]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> run-dir<a class="headerlink" href="#runtime-name-suite-state-polling-run-dir" title="Permalink to this headline">¶</a></h7>
<p>For your own suites the run database location is determined by your
site/user config. For other suites, e.g. those owned by others, or
mirrored suite databases, use this item to specify the location
of the top level cylc run directory (the database should be a
suite-name sub-directory of this location).</p>
<ul class="simple">
<li><em>type</em>: string (a directory path on the target suite host)</li>
<li><em>default</em>: as configured by site/user config (for your own suites)</li>
</ul>
</div>
<div class="section" id="runtime-name-suite-state-polling-interval">
<h7>15.1.5.1.19.2. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[suite state polling]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> interval<a class="headerlink" href="#runtime-name-suite-state-polling-interval" title="Permalink to this headline">¶</a></h7>
<p>Polling interval expressed as an ISO 8601 duration/interval.</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 duration/interval representation (e.g.
<code class="docutils literal notranslate"><span class="pre">PT10S</span></code>, 10 seconds, or <code class="docutils literal notranslate"><span class="pre">PT1M</span></code>, 1 minute).</li>
<li><em>default</em>: PT1M</li>
</ul>
</div>
<div class="section" id="runtime-name-suite-state-polling-max-polls">
<h7>15.1.5.1.19.3. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[suite state polling]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> max-polls<a class="headerlink" href="#runtime-name-suite-state-polling-max-polls" title="Permalink to this headline">¶</a></h7>
<p>The maximum number of polls before timing out and entering the “failed” state.</p>
<ul class="simple">
<li><em>type</em>: integer</li>
<li><em>default</em>: 10</li>
</ul>
</div>
<div class="section" id="runtime-name-suite-state-polling-user">
<h7>15.1.5.1.19.4. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[suite state polling]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> user<a class="headerlink" href="#runtime-name-suite-state-polling-user" title="Permalink to this headline">¶</a></h7>
<p>Username of an account on the suite host to which you have access. The
polling <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">suite-state</span></code> command will be invoked
on the remote account.</p>
<ul class="simple">
<li><em>type</em>: string (username)</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
<div class="section" id="runtime-name-suite-state-polling-host">
<h7>15.1.5.1.19.5. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[suite state polling]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> host<a class="headerlink" href="#runtime-name-suite-state-polling-host" title="Permalink to this headline">¶</a></h7>
<p>The hostname of the target suite. The polling <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">suite-state</span></code> command
will be invoked on the remote account.</p>
<ul class="simple">
<li><em>type</em>: string (hostname)</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
<div class="section" id="runtime-name-suite-state-polling-message">
<h7>15.1.5.1.19.6. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[suite state polling]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> message<a class="headerlink" href="#runtime-name-suite-state-polling-message" title="Permalink to this headline">¶</a></h7>
<p>Wait for the target task in the target suite to receive a specified message
rather than achieve a state.</p>
<ul class="simple">
<li><em>type</em>: string (the message)</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
<div class="section" id="runtime-name-suite-state-polling-verbose">
<h7>15.1.5.1.19.7. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[suite state polling]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> verbose<a class="headerlink" href="#runtime-name-suite-state-polling-verbose" title="Permalink to this headline">¶</a></h7>
<p>Run the polling <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">suite-state</span></code> command in verbose output mode.</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>default</em>: False</li>
</ul>
</div>
</div>
<div class="section" id="runtime-name-simulation">
<span id="suiterc-sim-config"></span><h6>15.1.5.1.20. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[simulation]]]<a class="headerlink" href="#runtime-name-simulation" title="Permalink to this headline">¶</a></h6>
<p>Task configuration for the suite <em>simulation</em> and <em>dummy</em> run modes
described in <a class="reference internal" href="index.html#simulationmode"><span class="std std-ref">Simulating Suite Behaviour</span></a>.</p>
<div class="section" id="runtime-name-simulation-default-run-length">
<h7>15.1.5.1.20.1. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[simulation]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> default run length<a class="headerlink" href="#runtime-name-simulation-default-run-length" title="Permalink to this headline">¶</a></h7>
<p>The default simulated job run length, if <code class="docutils literal notranslate"><span class="pre">[job]execution</span> <span class="pre">time</span> <span class="pre">limit</span></code>
and <code class="docutils literal notranslate"><span class="pre">[simulation]speedup</span> <span class="pre">factor</span></code> are not set.</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 duration/interval representation (e.g.
<code class="docutils literal notranslate"><span class="pre">PT10S</span></code>, 10 seconds, or <code class="docutils literal notranslate"><span class="pre">PT1M</span></code>, 1 minute).</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">PT10S</span></code></li>
</ul>
</div>
<div class="section" id="runtime-name-simulation-speedup-factor">
<h7>15.1.5.1.20.2. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[simulation]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> speedup factor<a class="headerlink" href="#runtime-name-simulation-speedup-factor" title="Permalink to this headline">¶</a></h7>
<p>If <code class="docutils literal notranslate"><span class="pre">[job]execution</span> <span class="pre">time</span> <span class="pre">limit</span></code> is set, the task simulated run length
is computed by dividing it by this factor.</p>
<ul class="simple">
<li><em>type</em>: float</li>
<li><em>default</em>: (none) - i.e. do not use proportional run length</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">10.0</span></code></li>
</ul>
</div>
<div class="section" id="runtime-name-simulation-time-limit-buffer">
<h7>15.1.5.1.20.3. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[simulation]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> time limit buffer<a class="headerlink" href="#runtime-name-simulation-time-limit-buffer" title="Permalink to this headline">¶</a></h7>
<p>For dummy jobs, a new <code class="docutils literal notranslate"><span class="pre">[job]execution</span> <span class="pre">time</span> <span class="pre">limit</span></code> is set to the
simulated task run length plus this buffer interval, to avoid job kill due to
exceeding the time limit.</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 duration/interval representation (e.g.
<code class="docutils literal notranslate"><span class="pre">PT10S</span></code>, 10 seconds, or <code class="docutils literal notranslate"><span class="pre">PT1M</span></code>, 1 minute).</li>
<li><em>default</em>: PT10S</li>
</ul>
</div>
<div class="section" id="runtime-name-simulation-fail-cycle-points">
<h7>15.1.5.1.20.4. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[simulation]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> fail cycle points<a class="headerlink" href="#runtime-name-simulation-fail-cycle-points" title="Permalink to this headline">¶</a></h7>
<p>Configure simulated or dummy jobs to fail at certain cycle points.</p>
<ul class="simple">
<li><em>type</em>: list of strings (cycle points), or <em>all</em></li>
<li><em>default</em>: (none) - no instances of the task will fail</li>
<li><em>examples</em>:
- <code class="docutils literal notranslate"><span class="pre">all</span></code> - all instance of the task will fail
- <code class="docutils literal notranslate"><span class="pre">2017-08-12T06,</span> <span class="pre">2017-08-12T18</span></code> - these instances of the task will fail</li>
</ul>
</div>
<div class="section" id="runtime-name-simulation-fail-try-1-only">
<h7>15.1.5.1.20.5. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[simulation]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> fail try 1 only<a class="headerlink" href="#runtime-name-simulation-fail-try-1-only" title="Permalink to this headline">¶</a></h7>
<p>If this is set to <code class="docutils literal notranslate"><span class="pre">True</span></code> only the first run of the task instance will
fail, otherwise retries will fail too.</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">True</span></code></li>
</ul>
</div>
<div class="section" id="runtime-name-simulation-disable-task-event-handlers">
<h7>15.1.5.1.20.6. [runtime] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[__NAME__]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[simulation]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> disable task event handlers<a class="headerlink" href="#runtime-name-simulation-disable-task-event-handlers" title="Permalink to this headline">¶</a></h7>
<p>If this is set to <code class="docutils literal notranslate"><span class="pre">True</span></code> configured task event handlers will not be called
in simulation or dummy modes.</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">True</span></code></li>
</ul>
</div>
</div>
</div>
</div>
<div class="section" id="visualization">
<h4>15.1.6. [visualization]<a class="headerlink" href="#visualization" title="Permalink to this headline">¶</a></h4>
<p>Configuration of suite graphing for the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">graph</span></code> command (graph
extent, styling, and initial family-collapsed state) and the gcylc graph view
(initial family-collapsed state). See the
<a class="reference external" href="http://www.graphviz.org/documentation/">Graphviz documentation of node shapes</a>.</p>
<div class="section" id="visualization-initial-cycle-point">
<h5>15.1.6.1. [visualization] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> initial cycle point<a class="headerlink" href="#visualization-initial-cycle-point" title="Permalink to this headline">¶</a></h5>
<p>The initial cycle point for graph plotting.</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 date-time representation (e.g. CCYYMMDDThhmm)</li>
<li><em>default</em>: the suite initial cycle point</li>
</ul>
<p>The visualization initial cycle point gets adjusted up if necessary to the
suite initial cycling point.</p>
</div>
<div class="section" id="visualization-final-cycle-point">
<h5>15.1.6.2. [visualization] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> final cycle point<a class="headerlink" href="#visualization-final-cycle-point" title="Permalink to this headline">¶</a></h5>
<p>An explicit final cycle point for graph plotting. If used, this overrides the
preferred <em>number of cycle points</em> (below).</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 date-time representation (e.g. CCYYMMDDThhmm)</li>
<li><em>default</em>: (none)</li>
</ul>
<p>The visualization final cycle point gets adjusted down if necessary to the
suite final cycle point.</p>
</div>
<div class="section" id="visualization-number-of-cycle-points">
<h5>15.1.6.3. [visualization] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> number of cycle points<a class="headerlink" href="#visualization-number-of-cycle-points" title="Permalink to this headline">¶</a></h5>
<p>The number of cycle points to graph starting from the visualization initial
cycle point. This is the preferred way of defining the graph end point, but
it can be overridden by an explicit <em>final cycle point</em> (above).</p>
<ul class="simple">
<li><em>type</em>: integer</li>
<li><em>default</em>: 3</li>
</ul>
</div>
<div class="section" id="visualization-collapsed-families">
<h5>15.1.6.4. [visualization] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> collapsed families<a class="headerlink" href="#visualization-collapsed-families" title="Permalink to this headline">¶</a></h5>
<p>A list of family (namespace) names to be shown in the collapsed state
(i.e. the family members will be replaced by a single family node) when
the suite is first plotted in the graph viewer or the gcylc graph view.
If this item is not set, the default is to collapse all families at first.
Interactive GUI controls can then be used to group and ungroup family
nodes at will.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of family names.</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
<div class="section" id="visualization-use-node-color-for-edges">
<h5>15.1.6.5. [visualization] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> use node color for edges<a class="headerlink" href="#visualization-use-node-color-for-edges" title="Permalink to this headline">¶</a></h5>
<p>Plot graph edges (dependency arrows) with the same color as the upstream
node, otherwise default to black.</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>default</em>: False</li>
</ul>
</div>
<div class="section" id="visualization-use-node-fillcolor-for-edges">
<h5>15.1.6.6. [visualization] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> use node fillcolor for edges<a class="headerlink" href="#visualization-use-node-fillcolor-for-edges" title="Permalink to this headline">¶</a></h5>
<p>Plot graph edges (i.e. dependency arrows) with the same fillcolor as the
upstream node, if it is filled, otherwise default to black.</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>default</em>: False</li>
</ul>
</div>
<div class="section" id="visualization-node-penwidth">
<h5>15.1.6.7. [visualization] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> node penwidth<a class="headerlink" href="#visualization-node-penwidth" title="Permalink to this headline">¶</a></h5>
<p>Line width of node shape borders.</p>
<ul class="simple">
<li><em>type</em>: integer</li>
<li><em>default</em>: 2</li>
</ul>
</div>
<div class="section" id="visualization-edge-penwidth">
<h5>15.1.6.8. [visualization] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> edge penwidth<a class="headerlink" href="#visualization-edge-penwidth" title="Permalink to this headline">¶</a></h5>
<p>Line width of graph edges (dependency arrows).</p>
<ul class="simple">
<li><em>type</em>: integer</li>
<li><em>default</em>: 2</li>
</ul>
</div>
<div class="section" id="visualization-use-node-color-for-labels">
<h5>15.1.6.9. [visualization] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> use node color for labels<a class="headerlink" href="#visualization-use-node-color-for-labels" title="Permalink to this headline">¶</a></h5>
<p>Graph node labels can be printed in the same color as the node outline.</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>default</em>: False</li>
</ul>
</div>
<div class="section" id="visualization-default-node-attributes">
<h5>15.1.6.10. [visualization] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> default node attributes<a class="headerlink" href="#visualization-default-node-attributes" title="Permalink to this headline">¶</a></h5>
<p>Set the default attributes (color and style etc.) of graph nodes (tasks and families).
Attribute pairs must be quoted to hide the internal <code class="docutils literal notranslate"><span class="pre">=</span></code> character.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of quoted <code class="docutils literal notranslate"><span class="pre">'attribute=value'</span></code> pairs.</li>
<li><em>legal values</em>: see graphviz or pygraphviz documentation</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">'style=filled',</span> <span class="pre">'fillcolor=yellow',</span> <span class="pre">'shape=box'</span></code></li>
</ul>
</div>
<div class="section" id="visualization-default-edge-attributes">
<h5>15.1.6.11. [visualization] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> default edge attributes<a class="headerlink" href="#visualization-default-edge-attributes" title="Permalink to this headline">¶</a></h5>
<p>Set the default attributes (color and style etc.) of graph edges
(dependency arrows).  Attribute pairs must be quoted to hide the
internal <code class="docutils literal notranslate"><span class="pre">=</span></code> character.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of quoted <code class="docutils literal notranslate"><span class="pre">'attribute=value'</span></code> pairs.</li>
<li><em>legal values</em>: see graphviz or pygraphviz documentation</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">'color=black'</span></code></li>
</ul>
</div>
<div class="section" id="visualization-node-groups">
<h5>15.1.6.12. [visualization] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[node groups]]<a class="headerlink" href="#visualization-node-groups" title="Permalink to this headline">¶</a></h5>
<p>Define named groups of graph nodes (tasks and families) which can styled
en masse, by name, in <code class="docutils literal notranslate"><span class="pre">[visualization]</span> <span class="pre">-&gt;</span> <span class="pre">[[node</span> <span class="pre">attributes]]</span></code>.
Node groups are automatically defined for all task families, including
root, so you can style family and member nodes at once by family name.</p>
<div class="section" id="visualization-node-groups-group">
<h6>15.1.6.12.1. [visualization] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[node groups]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> __GROUP__<a class="headerlink" href="#visualization-node-groups-group" title="Permalink to this headline">¶</a></h6>
<p>Replace <code class="docutils literal notranslate"><span class="pre">__GROUP__</span></code> with each named group of tasks or families.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of task or family names.</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>:<ul>
<li>PreProc = foo, bar</li>
<li>PostProc = baz, waz</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="visualization-node-attributes">
<h5>15.1.6.13. [visualization] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[node attributes]]<a class="headerlink" href="#visualization-node-attributes" title="Permalink to this headline">¶</a></h5>
<p>Here you can assign graph node attributes to specific nodes, or to all
members of named groups defined in <code class="docutils literal notranslate"><span class="pre">[visualization]</span> <span class="pre">-&gt;</span> <span class="pre">[[node</span> <span class="pre">groups]]</span></code>.
Task families are automatically node groups. Styling of a
family node applies to all member nodes (tasks and sub-families), but
precedence is determined by ordering in the suite configuration.  For
example, if you style a family red and then one of its members green,
cylc will plot a red family with one green member; but if you style one
member green and then the family red, the red family styling will
override the earlier green styling of the member.</p>
<div class="section" id="visualization-node-attributes-name">
<h6>15.1.6.13.1. [visualization] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[node attributes]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> __NAME__<a class="headerlink" href="#visualization-node-attributes-name" title="Permalink to this headline">¶</a></h6>
<p>Replace <code class="docutils literal notranslate"><span class="pre">__NAME__</span></code> with each node or node group for style attribute
assignment.</p>
<ul class="simple">
<li><em>type</em>: Comma-separated list of quoted <code class="docutils literal notranslate"><span class="pre">'attribute=value'</span></code> pairs.</li>
<li><em>legal values</em>: see the Graphviz or PyGraphviz documentation</li>
<li><em>default</em>: (none)</li>
<li><em>example</em> (with reference to the node groups defined above):<ul>
<li>PreProc = ‘style=filled’, ‘fillcolor=orange’</li>
<li>PostProc = ‘color=red’</li>
<li>foo = ‘style=filled’</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
<span id="document-appendices/site-user-config-ref"></span><div class="section" id="global-site-user-config-file-reference">
<span id="sitercreference"></span><h3>15.2. Global (Site, User) Config File Reference<a class="headerlink" href="#global-site-user-config-file-reference" title="Permalink to this headline">¶</a></h3>
<p>This section defines all legal items and values for cylc site and
user config files. See <a class="reference internal" href="index.html#siteanduserconfiguration"><span class="std std-ref">Global (Site, User) Configuration Files</span></a> for file locations,
intended usage, and how to generate the files using the
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">get-site-config</span></code> command.</p>
<p><em>As for suite configurations, Jinja2 expressions can be embedded in
site and user config files to generate the final result parsed by cylc.</em>
Use of Jinja2 in suite configurations is documented in <a class="reference internal" href="index.html#jinja"><span class="std std-ref">Jinja2</span></a>.</p>
<div class="section" id="top-level-items">
<h4>15.2.1. Top Level Items<a class="headerlink" href="#top-level-items" title="Permalink to this headline">¶</a></h4>
<div class="section" id="temporary-directory">
<h5>15.2.1.1. temporary directory<a class="headerlink" href="#temporary-directory" title="Permalink to this headline">¶</a></h5>
<p>A temporary directory is needed by a few cylc commands, and is cleaned
automatically on exit. Leave unset for the default (usually <code class="docutils literal notranslate"><span class="pre">$TMPDIR</span></code>).</p>
<ul class="simple">
<li><em>type</em>: string (directory path)</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">temporary</span> <span class="pre">directory</span> <span class="pre">=</span> <span class="pre">/tmp/$USER/cylc</span></code></li>
</ul>
</div>
<div class="section" id="process-pool-size">
<span id="id1"></span><h5>15.2.1.2. process pool size<a class="headerlink" href="#process-pool-size" title="Permalink to this headline">¶</a></h5>
<p>Maximum number of concurrent processes used to execute external job
submission, event handlers, and job poll and kill commands - see
<a class="reference internal" href="index.html#managing-external-command-execution"><span class="std std-ref">Managing External Command Execution</span></a>.</p>
<ul class="simple">
<li><em>type</em>: integer</li>
<li><em>default</em>: 4</li>
</ul>
</div>
<div class="section" id="process-pool-timeout">
<span id="id2"></span><h5>15.2.1.3. process pool timeout<a class="headerlink" href="#process-pool-timeout" title="Permalink to this headline">¶</a></h5>
<p>Interval after which long-running commands in the process pool will be killed -
see <a class="reference internal" href="index.html#managing-external-command-execution"><span class="std std-ref">Managing External Command Execution</span></a>.</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 duration/interval representation (e.g.
<code class="docutils literal notranslate"><span class="pre">PT10S</span></code>, 10 seconds, or <code class="docutils literal notranslate"><span class="pre">PT1M</span></code>, 1 minute).</li>
<li><em>default</em>: PT10M -  note this is set quite high to avoid killing
important processes when the system is under load.</li>
</ul>
</div>
<div class="section" id="disable-interactive-command-prompts">
<h5>15.2.1.4. disable interactive command prompts<a class="headerlink" href="#disable-interactive-command-prompts" title="Permalink to this headline">¶</a></h5>
<p>Commands that intervene in running suites can be made to ask for
confirmation before acting. Some find this annoying and ineffective as a
safety measure, however, so command prompts are disabled by default.</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>default</em>: True</li>
</ul>
</div>
<div class="section" id="task-host-select-command-timeout">
<h5>15.2.1.5. task host select command timeout<a class="headerlink" href="#task-host-select-command-timeout" title="Permalink to this headline">¶</a></h5>
<p>When a task host in a suite is a shell command string, cylc calls the shell to
determine the task host. This call is invoked by the main process, and may
cause the suite to hang while waiting for the command to finish. This setting
sets a timeout for such a command to ensure that the suite can continue.</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 duration/interval representation (e.g.
<code class="docutils literal notranslate"><span class="pre">PT10S</span></code>, 10 seconds, or <code class="docutils literal notranslate"><span class="pre">PT1M</span></code>, 1 minute).</li>
<li><em>default</em>: PT10S</li>
</ul>
</div>
</div>
<div class="section" id="task-messaging">
<h4>15.2.2. [task messaging]<a class="headerlink" href="#task-messaging" title="Permalink to this headline">¶</a></h4>
<p>This section contains configuration items that affect task-to-suite
communications.</p>
<div class="section" id="retry-interval-task-messaging-retry-interval">
<h5>15.2.2.1. [retry interval][task messaging] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> retry interval<a class="headerlink" href="#retry-interval-task-messaging-retry-interval" title="Permalink to this headline">¶</a></h5>
<p>If a send fails, the messaging code will retry after a configured
delay interval.</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 duration/interval representation (e.g.
<code class="docutils literal notranslate"><span class="pre">PT10S</span></code>, 10 seconds, or <code class="docutils literal notranslate"><span class="pre">PT1M</span></code>, 1 minute).</li>
<li><em>default</em>: PT5S</li>
</ul>
</div>
<div class="section" id="maximum-number-of-tries-task-messaging-maximum-number-of-tries">
<h5>15.2.2.2. [maximum number of tries][task messaging] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> maximum number of tries<a class="headerlink" href="#maximum-number-of-tries-task-messaging-maximum-number-of-tries" title="Permalink to this headline">¶</a></h5>
<p>If successive sends fail, the messaging code will give up after a
configured number of tries.</p>
<ul class="simple">
<li><em>type</em>: integer</li>
<li><em>minimum</em>: 1</li>
<li><em>default</em>: 7</li>
</ul>
</div>
<div class="section" id="connection-timeout-task-messaging-connection-timeout">
<h5>15.2.2.3. [connection timeout][task messaging] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> connection timeout<a class="headerlink" href="#connection-timeout-task-messaging-connection-timeout" title="Permalink to this headline">¶</a></h5>
<p>This is the same as the <code class="docutils literal notranslate"><span class="pre">--comms-timeout</span></code> option in cylc
commands. Without a timeout remote connections to unresponsive
suites can hang indefinitely (suites suspended with Ctrl-Z for instance).</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 duration/interval representation (e.g.
<code class="docutils literal notranslate"><span class="pre">PT10S</span></code>, 10 seconds, or <code class="docutils literal notranslate"><span class="pre">PT1M</span></code>, 1 minute).</li>
<li><em>default</em>: PT30S</li>
</ul>
</div>
</div>
<div class="section" id="suite-logging">
<h4>15.2.3. [suite logging]<a class="headerlink" href="#suite-logging" title="Permalink to this headline">¶</a></h4>
<p>The suite event log, held under the suite run directory, is maintained
as a rolling archive. Logs are rolled over (backed up and started anew)
when they reach a configurable limit size.</p>
<div class="section" id="rolling-archive-length-suite-logging-rolling-archive-length">
<h5>15.2.3.1. [rolling archive length][suite logging] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> rolling archive length<a class="headerlink" href="#rolling-archive-length-suite-logging-rolling-archive-length" title="Permalink to this headline">¶</a></h5>
<p>How many rolled logs to retain in the archive.</p>
<ul class="simple">
<li><em>type</em>: integer</li>
<li><em>minimum</em>: 1</li>
<li><em>default</em>: 5</li>
</ul>
</div>
<div class="section" id="maximum-size-in-bytes-suite-logging-maximum-size-in-bytes">
<h5>15.2.3.2. maximum size in bytes][suite logging] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> maximum size in bytes<a class="headerlink" href="#maximum-size-in-bytes-suite-logging-maximum-size-in-bytes" title="Permalink to this headline">¶</a></h5>
<p>Suite event logs are rolled over when they reach this file size.</p>
<ul class="simple">
<li><em>type</em>: integer</li>
<li><em>default</em>: 1000000</li>
</ul>
</div>
</div>
<div class="section" id="documentation">
<h4>15.2.4. [documentation]<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h4>
<p>Documentation locations for the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">doc</span></code> command and gcylc
Help menus.</p>
<div class="section" id="documentation-files">
<h5>15.2.4.1. [documentation] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[files]]<a class="headerlink" href="#documentation-files" title="Permalink to this headline">¶</a></h5>
<p>File locations of documentation held locally on the cylc host server.</p>
<div class="section" id="documentation-files-html-index">
<h6>15.2.4.1.1. [documentation] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[files]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> html index<a class="headerlink" href="#documentation-files-html-index" title="Permalink to this headline">¶</a></h6>
<p>File location of the main cylc documentation index.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">&lt;cylc-dir&gt;/doc/index.html</span></code></li>
</ul>
</div>
<div class="section" id="documentation-files-pdf-user-guide">
<h6>15.2.4.1.2. [documentation] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[files]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> pdf user guide<a class="headerlink" href="#documentation-files-pdf-user-guide" title="Permalink to this headline">¶</a></h6>
<p>File location of the cylc User Guide, PDF version.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">&lt;cylc-dir&gt;/doc/cug-pdf.pdf</span></code></li>
</ul>
</div>
<div class="section" id="documentation-files-multi-page-html-user-guide">
<h6>15.2.4.1.3. [documentation] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[files]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> multi-page html user guide<a class="headerlink" href="#documentation-files-multi-page-html-user-guide" title="Permalink to this headline">¶</a></h6>
<p>File location of the cylc User Guide, multi-page HTML version.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">&lt;cylc-dir&gt;/doc/html/multi/cug-html.html</span></code></li>
</ul>
</div>
<div class="section" id="documentation-files-single-page-html-user-guide">
<h6>15.2.4.1.4. [documentation] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[files]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> single-page html user guide<a class="headerlink" href="#documentation-files-single-page-html-user-guide" title="Permalink to this headline">¶</a></h6>
<p>File location of the cylc User Guide, single-page HTML version.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">&lt;cylc-dir&gt;/doc/html/single/cug-html.html</span></code></li>
</ul>
</div>
</div>
<div class="section" id="documentation-urls">
<h5>15.2.4.2. [documentation] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[urls]]<a class="headerlink" href="#documentation-urls" title="Permalink to this headline">¶</a></h5>
<p>Online documentation URLs.</p>
<div class="section" id="documentation-urls-internet-homepage">
<h6>15.2.4.2.1. [documentation] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[urls]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> internet homepage<a class="headerlink" href="#documentation-urls-internet-homepage" title="Permalink to this headline">¶</a></h6>
<p>URL of the cylc internet homepage, with links to documentation for the
latest official release.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: <a class="reference external" href="http://cylc.github.com/cylc/">http://cylc.github.com/cylc/</a></li>
</ul>
</div>
<div class="section" id="documentation-urls-local-index">
<h6>15.2.4.2.2. [documentation] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[urls]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> local index<a class="headerlink" href="#documentation-urls-local-index" title="Permalink to this headline">¶</a></h6>
<p>Local intranet URL of the main cylc documentation index.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
</div>
</div>
<div class="section" id="document-viewers">
<h4>15.2.5. [document viewers]<a class="headerlink" href="#document-viewers" title="Permalink to this headline">¶</a></h4>
<p>PDF and HTML viewers can be launched by cylc to view the documentation.</p>
<div class="section" id="document-viewers-pdf">
<h5>15.2.5.1. [document viewers] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> pdf<a class="headerlink" href="#document-viewers-pdf" title="Permalink to this headline">¶</a></h5>
<p>Your preferred PDF viewer program.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: evince</li>
</ul>
</div>
<div class="section" id="document-viewers-html">
<h5>15.2.5.2. [document viewers] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> html<a class="headerlink" href="#document-viewers-html" title="Permalink to this headline">¶</a></h5>
<p>Your preferred web browser.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: firefox</li>
</ul>
</div>
</div>
<div class="section" id="editors">
<h4>15.2.6. [editors]<a class="headerlink" href="#editors" title="Permalink to this headline">¶</a></h4>
<p>Choose your favourite text editor for editing suite configurations.</p>
<div class="section" id="editors-terminal">
<h5>15.2.6.1. [editors] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> terminal<a class="headerlink" href="#editors-terminal" title="Permalink to this headline">¶</a></h5>
<p>The editor to be invoked by the cylc command line interface.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">vim</span></code></li>
<li><em>examples</em>:
- <code class="docutils literal notranslate"><span class="pre">terminal</span> <span class="pre">=</span> <span class="pre">emacs</span> <span class="pre">-nw</span></code> (emacs non-GUI)
- <code class="docutils literal notranslate"><span class="pre">terminal</span> <span class="pre">=</span> <span class="pre">emacs</span></code> (emacs GUI)
- <code class="docutils literal notranslate"><span class="pre">terminal</span> <span class="pre">=</span> <span class="pre">gvim</span> <span class="pre">-f</span></code> (vim GUI)</li>
</ul>
</div>
<div class="section" id="editors-gui">
<h5>15.2.6.2. [editors] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> gui<a class="headerlink" href="#editors-gui" title="Permalink to this headline">¶</a></h5>
<p>The editor to be invoked by the cylc GUI.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">gvim</span> <span class="pre">-f</span></code></li>
<li><em>examples</em>:
- <code class="docutils literal notranslate"><span class="pre">gui</span> <span class="pre">=</span> <span class="pre">emacs</span></code>
- <code class="docutils literal notranslate"><span class="pre">gui</span> <span class="pre">=</span> <span class="pre">xterm</span> <span class="pre">-e</span> <span class="pre">vim</span></code></li>
</ul>
</div>
</div>
<div class="section" id="communication">
<h4>15.2.7. [communication]<a class="headerlink" href="#communication" title="Permalink to this headline">¶</a></h4>
<p>This section covers options for network communication between cylc
clients (suite-connecting commands and guis) servers (running suites).
Each suite listens on a dedicated network port, binding on the first
available starting at the configured base port.</p>
<p>By default, the communication method is HTTPS secured with HTTP Digest
Authentication. If the system does not support SSL, you should configure
this section to use HTTP. Cylc will not automatically fall back to HTTP
if HTTPS is not available.</p>
<div class="section" id="communication-method">
<h5>15.2.7.1. [communication] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> method<a class="headerlink" href="#communication-method" title="Permalink to this headline">¶</a></h5>
<p>The choice of client-server communication method - currently only HTTPS
and HTTP are supported, although others could be developed and plugged in.
Cylc defaults to HTTPS if this setting is not explicitly configured.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>options</em>:
- <strong>https</strong>
- <strong>http</strong></li>
<li><em>default</em>: https</li>
</ul>
</div>
<div class="section" id="communication-base-port">
<h5>15.2.7.2. [communication] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> base port<a class="headerlink" href="#communication-base-port" title="Permalink to this headline">¶</a></h5>
<p>The first port that Cylc is allowed to use. This item (and
<code class="docutils literal notranslate"><span class="pre">maximum</span> <span class="pre">number</span> <span class="pre">of</span> <span class="pre">ports</span></code>) is deprecated; please use
<code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">ports</span></code> under <code class="docutils literal notranslate"><span class="pre">[suite</span> <span class="pre">servers]</span></code> instead.</p>
<ul class="simple">
<li><em>type</em>: integer</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">43001</span></code></li>
</ul>
</div>
<div class="section" id="communication-maximum-number-of-ports">
<h5>15.2.7.3. [communication] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> maximum number of ports<a class="headerlink" href="#communication-maximum-number-of-ports" title="Permalink to this headline">¶</a></h5>
<p>This setting (and <code class="docutils literal notranslate"><span class="pre">base</span> <span class="pre">port</span></code>) is deprecated; please use
<code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">ports</span></code> under <code class="docutils literal notranslate"><span class="pre">[suite</span> <span class="pre">servers]</span></code> instead.</p>
<ul class="simple">
<li><em>type</em>: integer</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">100</span></code></li>
</ul>
</div>
<div class="section" id="communication-proxies-on">
<h5>15.2.7.4. [communication] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> proxies on<a class="headerlink" href="#communication-proxies-on" title="Permalink to this headline">¶</a></h5>
<p>Enable or disable proxy servers for HTTPS - disabled by default.</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>localhost default</em>: False</li>
</ul>
</div>
<div class="section" id="communication-options">
<h5>15.2.7.5. [communication] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> options<a class="headerlink" href="#communication-options" title="Permalink to this headline">¶</a></h5>
<p>Option flags for the communication method. Currently only ‘SHA1’ is
supported for HTTPS, which alters HTTP Digest Auth to use the SHA1 hash
algorithm rather than the standard MD5. This is more secure but is also
less well supported by third party web clients including web browsers.
You may need to add the ‘SHA1’ option if you are running on platforms
where MD5 is discouraged (e.g. under FIPS).</p>
<ul class="simple">
<li><em>type</em>: string_list</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">[]</span></code></li>
<li><em>options</em>:
- <strong>SHA1</strong></li>
</ul>
</div>
</div>
<div class="section" id="monitor">
<h4>15.2.8. [monitor]<a class="headerlink" href="#monitor" title="Permalink to this headline">¶</a></h4>
<p>Configurable settings for the command line <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">monitor</span></code> tool.</p>
<div class="section" id="monitor-sort-order">
<h5>15.2.8.1. [monitor] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> sort order<a class="headerlink" href="#monitor-sort-order" title="Permalink to this headline">¶</a></h5>
<p>The sort order for tasks in the monitor view.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>options</em>:<ul>
<li><strong>alphanumeric</strong></li>
<li><strong>definition</strong> -  the order that tasks appear under
<code class="docutils literal notranslate"><span class="pre">[runtime]</span></code> in the suite configuration.</li>
</ul>
</li>
<li><em>default</em>: definition</li>
</ul>
</div>
</div>
<div class="section" id="hosts">
<h4>15.2.9. [hosts]<a class="headerlink" href="#hosts" title="Permalink to this headline">¶</a></h4>
<p>The [hosts] section configures some important host-specific settings for
the suite host (“localhost”) and remote task hosts.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Remote task behaviour is determined by the site/user config on the
suite host, not on the task host.</p>
</div>
<p>Suites can specify task hosts that
are not listed here, in which case local settings will be assumed,
with the local home directory path, if present, replaced by
<code class="docutils literal notranslate"><span class="pre">$HOME</span></code> in items that configure directory locations.</p>
<div class="section" id="hosts-host">
<h5>15.2.9.1. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]]<a class="headerlink" href="#hosts-host" title="Permalink to this headline">¶</a></h5>
<p>The default task host is the suite host, <strong>localhost</strong>, with default
values as listed below. Use an explicit <code class="docutils literal notranslate"><span class="pre">[hosts][[localhost]]</span></code>
section if you need to override the defaults. Localhost settings are
then also used as defaults for other hosts, with the local home
directory path replaced as described above. This applies to items
omitted from an explicit host section, and to hosts that are not listed
at all in the site and user config files.  Explicit host sections are only
needed if the automatically modified local defaults are not sufficient.</p>
<p>Host section headings can also be <em>regular expressions</em> to match
multiple hostnames.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The general regular expression wildcard
is <code class="docutils literal notranslate"><span class="pre">'.*'</span></code> (zero or more of any character), not <code class="docutils literal notranslate"><span class="pre">'*'</span></code>.
Hostname matching regular expressions are used as-is in the Python
<code class="docutils literal notranslate"><span class="pre">re.match()</span></code> function.</p>
</div>
<p>As such they match from the beginning
of the hostname string (as specified in the suite configuration) and they
do not have to match through to the end of the string (use the
string-end matching character <code class="docutils literal notranslate"><span class="pre">'$'</span></code> in the expression to force this).</p>
<p>A hierarchy of host match expressions from specific to general can be
used because config items are processed in the order specified in the
file.</p>
<ul class="simple">
<li><em>type</em>: string (hostname or regular expression)</li>
<li><em>examples</em>:
- <code class="docutils literal notranslate"><span class="pre">server1.niwa.co.nz</span></code> - explicit host name
- <code class="docutils literal notranslate"><span class="pre">server\d.niwa.co.nz</span></code> - regular expression</li>
</ul>
<div class="section" id="hosts-host-run-directory">
<h6>15.2.9.1.1. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> run directory<a class="headerlink" href="#hosts-host-run-directory" title="Permalink to this headline">¶</a></h6>
<p>The top level for suite logs and service files, etc. Can contain
<code class="docutils literal notranslate"><span class="pre">$HOME</span></code> or <code class="docutils literal notranslate"><span class="pre">$USER</span></code> but not other environment variables (the
item cannot actually be evaluated by the shell on HOST before use, but the
remote home directory is where <code class="docutils literal notranslate"><span class="pre">rsync</span></code> and <code class="docutils literal notranslate"><span class="pre">ssh</span></code> naturally
land, and the remote username is known by the suite server program).</p>
<ul class="simple">
<li><em>type</em>: string (directory path)</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">$HOME/cylc-run</span></code></li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">/nfs/data/$USER/cylc-run</span></code></li>
</ul>
</div>
<div class="section" id="hosts-host-work-directory">
<span id="workdirectory"></span><h6>15.2.9.1.2. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> work directory<a class="headerlink" href="#hosts-host-work-directory" title="Permalink to this headline">¶</a></h6>
<p>The top level for suite work and share directories. Can contain
<code class="docutils literal notranslate"><span class="pre">$HOME</span></code> or <code class="docutils literal notranslate"><span class="pre">$USER</span></code> but not other environment variables
(the item cannot actually be evaluated by the shell on HOST before use, but the
remote home directory is where <code class="docutils literal notranslate"><span class="pre">rsync</span></code> and <code class="docutils literal notranslate"><span class="pre">ssh</span></code> naturally
land, and the remote username is known by the suite server program).</p>
<ul class="simple">
<li><em>type</em>: string (directory path)</li>
<li><em>localhost default</em>: <code class="docutils literal notranslate"><span class="pre">$HOME/cylc-run</span></code></li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">/nfs/data/$USER/cylc-run</span></code></li>
</ul>
</div>
<div class="section" id="hosts-host-task-communication-method">
<span id="task-comms-method"></span><h6>15.2.9.1.3. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> task communication method<a class="headerlink" href="#hosts-host-task-communication-method" title="Permalink to this headline">¶</a></h6>
<p>The means by which task progress messages are reported back to the running suite.
See above for default polling intervals for the poll method.</p>
<ul class="simple">
<li><em>type</em>: string (must be one of the following three options)</li>
<li><em>options</em>:
- <strong>default</strong> - direct client-server communication via network ports
- <strong>ssh</strong> - use ssh to re-invoke the messaging commands on the suite server
- <strong>poll</strong> - the suite polls for the status of tasks (no task messaging)</li>
<li><em>localhost default</em>: default</li>
</ul>
</div>
<div class="section" id="hosts-host-execution-polling-intervals">
<span id="execution-polling"></span><h6>15.2.9.1.4. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> execution polling intervals<a class="headerlink" href="#hosts-host-execution-polling-intervals" title="Permalink to this headline">¶</a></h6>
<p>Cylc can poll running jobs to catch problems that prevent task messages
from being sent back to the suite, such as hard job kills, network
outages, or unplanned task host shutdown. Routine polling is done only
for the polling <em>task communication method</em> (below) unless
suite-specific polling is configured in the suite configuration.
A list of interval values can be specified, with the last value used
repeatedly until the task is finished - this allows more frequent
polling near the beginning and end of the anticipated task run time.
Multipliers can be used as shorthand as in the example below.</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 duration/interval representation (e.g.
<code class="docutils literal notranslate"><span class="pre">PT10S</span></code>, 10 seconds, or <code class="docutils literal notranslate"><span class="pre">PT1M</span></code>, 1 minute).</li>
<li><em>default</em>:</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">execution</span> <span class="pre">polling</span> <span class="pre">intervals</span> <span class="pre">=</span> <span class="pre">5*PT1M,</span> <span class="pre">10*PT5M,</span> <span class="pre">5*PT1M</span></code></li>
</ul>
</div>
<div class="section" id="hosts-host-submission-polling-intervals">
<span id="submission-polling"></span><h6>15.2.9.1.5. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> submission polling intervals<a class="headerlink" href="#hosts-host-submission-polling-intervals" title="Permalink to this headline">¶</a></h6>
<p>Cylc can also poll submitted jobs to catch problems that prevent the
submitted job from executing at all, such as deletion from an external
batch scheduler queue. Routine polling is done only for the polling
<em>task communication method</em> (above) unless suite-specific polling
is configured in the suite configuration. A list of interval
values can be specified as for execution polling (above) but a single
value is probably sufficient for job submission polling.</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 duration/interval representation (e.g.
<code class="docutils literal notranslate"><span class="pre">PT10S</span></code>, 10 seconds, or <code class="docutils literal notranslate"><span class="pre">PT1M</span></code>, 1 minute).</li>
<li><em>default</em>:</li>
<li><em>example</em>: (see the execution polling example above)</li>
</ul>
</div>
<div class="section" id="hosts-host-scp-command">
<h6>15.2.9.1.6. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> scp command<a class="headerlink" href="#hosts-host-scp-command" title="Permalink to this headline">¶</a></h6>
<p>A string for the command used to copy files to a remote host. This is not used
on the suite host unless you run local tasks under another user account. The
value is assumed to be <code class="docutils literal notranslate"><span class="pre">scp</span></code> with some initial options or a command
that implements a similar interface to <code class="docutils literal notranslate"><span class="pre">scp</span></code>.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>localhost default</em>: <code class="docutils literal notranslate"><span class="pre">scp</span> <span class="pre">-oBatchMode=yes</span> <span class="pre">-oConnectTimeout=10</span></code></li>
</ul>
</div>
<div class="section" id="hosts-host-ssh-command">
<h6>15.2.9.1.7. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> ssh command<a class="headerlink" href="#hosts-host-ssh-command" title="Permalink to this headline">¶</a></h6>
<p>A string for the command used to invoke commands on this host. This is not
used on the suite host unless you run local tasks under another user account.
The value is assumed to be <code class="docutils literal notranslate"><span class="pre">ssh</span></code> with some initial options or a
command that implements a similar interface to <code class="docutils literal notranslate"><span class="pre">ssh</span></code>.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>localhost default</em>: <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">-oBatchMode=yes</span> <span class="pre">-oConnectTimeout=10</span></code></li>
</ul>
</div>
<div class="section" id="hosts-host-use-login-shell">
<h6>15.2.9.1.8. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> use login shell<a class="headerlink" href="#hosts-host-use-login-shell" title="Permalink to this headline">¶</a></h6>
<p>Whether to use a login shell or not for remote command invocation. By
default cylc runs remote ssh commands using a login shell:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh user@host <span class="s1">&#39;bash --login cylc ...&#39;</span>
</pre></div>
</div>
<p>which will source <code class="docutils literal notranslate"><span class="pre">/etc/profile</span></code> and
<code class="docutils literal notranslate"><span class="pre">~/.profile</span></code> to set up the user environment.  However, for
security reasons some institutions do not allow unattended commands to
start login shells, so you can turn off this behaviour to get:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh user@host <span class="s1">&#39;cylc ...&#39;</span>
</pre></div>
</div>
<p>which will use the default shell on the remote machine,
sourcing <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code> (or <code class="docutils literal notranslate"><span class="pre">~/.cshrc</span></code>) to set up the
environment.</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>localhost default</em>: True</li>
</ul>
</div>
<div class="section" id="hosts-host-cylc-executable">
<h6>15.2.9.1.9. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> cylc executable<a class="headerlink" href="#hosts-host-cylc-executable" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">cylc</span></code> executable on a remote host.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This should normally point to the cylc multi-version wrapper
(see <a class="reference internal" href="index.html#cui"><span class="std std-ref">User Interfaces</span></a>) on the host, not <code class="docutils literal notranslate"><span class="pre">bin/cylc</span></code> for a specific
installed version.</p>
</div>
<p>Specify a full path if <code class="docutils literal notranslate"><span class="pre">cylc</span></code> is not in <code class="docutils literal notranslate"><span class="pre">\$PATH</span></code> when it is
invoked via <code class="docutils literal notranslate"><span class="pre">ssh</span></code> on this host.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>localhost default</em>: <code class="docutils literal notranslate"><span class="pre">cylc</span></code></li>
</ul>
</div>
<div class="section" id="hosts-host-global-init-script">
<span id="globalinitscript"></span><h6>15.2.9.1.10. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> global init-script<a class="headerlink" href="#hosts-host-global-init-script" title="Permalink to this headline">¶</a></h6>
<p>If specified, the value of this setting will be inserted to just before the
<code class="docutils literal notranslate"><span class="pre">init-script</span></code> section of all job scripts that are to be
submitted to the specified remote host.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>localhost default</em>: <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code></li>
</ul>
</div>
<div class="section" id="hosts-host-copyable-environment-variables">
<h6>15.2.9.1.11. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> copyable environment variables<a class="headerlink" href="#hosts-host-copyable-environment-variables" title="Permalink to this headline">¶</a></h6>
<p>A list containing the names of the environment variables that can and/or need
to be copied from the suite server program to a job.</p>
<ul class="simple">
<li><em>type</em>: string_list</li>
<li><em>localhost default</em>: <code class="docutils literal notranslate"><span class="pre">[]</span></code></li>
</ul>
</div>
<div class="section" id="hosts-host-retrieve-job-logs">
<h6>15.2.9.1.12. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> retrieve job logs<a class="headerlink" href="#hosts-host-retrieve-job-logs" title="Permalink to this headline">¶</a></h6>
<p>Global default for the <a class="reference internal" href="index.html#runtime-remote-retrieve-job-logs"><span class="std std-ref">[runtime] -&gt; [[__NAME__]] -&gt; [[[remote]]] -&gt; retrieve job logs</span></a> setting for
the specified host.</p>
</div>
<div class="section" id="hosts-host-retrieve-job-logs-command">
<h6>15.2.9.1.13. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> retrieve job logs command<a class="headerlink" href="#hosts-host-retrieve-job-logs-command" title="Permalink to this headline">¶</a></h6>
<p>If <code class="docutils literal notranslate"><span class="pre">rsync</span> <span class="pre">-a</span></code> is unavailable or insufficient to retrieve job logs
from a remote host, you can use this setting to specify a suitable command.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: rsync -a</li>
</ul>
</div>
<div class="section" id="hosts-host-retrieve-job-logs-max-size">
<h6>15.2.9.1.14. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> retrieve job logs max size<a class="headerlink" href="#hosts-host-retrieve-job-logs-max-size" title="Permalink to this headline">¶</a></h6>
<p>Global default for the <a class="reference internal" href="index.html#runtime-remote-retrieve-job-logs-max-size"><span class="std std-ref">[runtime] -&gt; [[__NAME__]] -&gt; [[[remote]]] -&gt; retrieve job logs max size</span></a>
setting for the specified host.</p>
</div>
<div class="section" id="hosts-host-retrieve-job-logs-retry-delays">
<h6>15.2.9.1.15. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> retrieve job logs retry delays<a class="headerlink" href="#hosts-host-retrieve-job-logs-retry-delays" title="Permalink to this headline">¶</a></h6>
<p>Global default for the <a class="reference internal" href="index.html#runtime-remote-retrieve-job-logs-retry-delays"><span class="std std-ref">[runtime] -&gt; [[__NAME__]] -&gt; [[[remote]]] -&gt; retrieve job logs retry delays</span></a>
setting for the specified host.</p>
</div>
<div class="section" id="hosts-host-task-event-handler-retry-delays">
<h6>15.2.9.1.16. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> task event handler retry delays<a class="headerlink" href="#hosts-host-task-event-handler-retry-delays" title="Permalink to this headline">¶</a></h6>
<p>Host specific default for the <a class="reference internal" href="index.html#runtime-events-handler-retry-delays"><span class="std std-ref">[runtime] -&gt; [[__NAME__]] -&gt; [[[events]]] -&gt; handler retry delays</span></a>
setting.</p>
</div>
<div class="section" id="hosts-host-tail-command-template">
<span id="tail-command-template"></span><h6>15.2.9.1.17. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> tail command template<a class="headerlink" href="#hosts-host-tail-command-template" title="Permalink to this headline">¶</a></h6>
<p>A command template (with <code class="docutils literal notranslate"><span class="pre">%(filename)s</span></code> substitution) to tail-follow
job logs on HOST, by the GUI log viewer and <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">cat-log</span></code>. You are
unlikely to need to override this.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">tail</span> <span class="pre">-n</span> <span class="pre">+1</span> <span class="pre">-F</span> <span class="pre">%(filename)s</span></code></li>
</ul>
</div>
<div class="section" id="hosts-host-batch-systems">
<h6>15.2.9.1.18. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[batch systems]]]<a class="headerlink" href="#hosts-host-batch-systems" title="Permalink to this headline">¶</a></h6>
<p>Settings for particular batch systems on HOST. In the subsections below, SYSTEM
should be replaced with the cylc batch system handler name that represents the
batch system (see <a class="reference internal" href="index.html#runtimejobsubmethods"><span class="std std-ref">[runtime] -&gt; [[__NAME__]] -&gt; [[[job]]] -&gt; batch system</span></a>).</p>
<div class="section" id="hosts-host-batch-systems-system-err-tailer">
<span id="err-tailer"></span><h7>15.2.9.1.18.1. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[batch systems]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[[SYSTEM]]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> err tailer<a class="headerlink" href="#hosts-host-batch-systems-system-err-tailer" title="Permalink to this headline">¶</a></h7>
<p>A command template (with <code class="docutils literal notranslate"><span class="pre">%(job_id)s</span></code> substitution) that can be used
to tail-follow the stderr stream of a running job if SYSTEM does
not use the normal log file location while the job is running.  This setting
overrides <a class="reference internal" href="#tail-command-template"><span class="std std-ref">[hosts] -&gt; [[HOST]] -&gt; tail command template</span></a> above.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>: For PBS:</li>
</ul>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[hosts]</span>
    <span class="nt">[[ myhpc*]]</span>
        <span class="nt">[[[batch systems]]]</span>
            <span class="nt">[[[[pbs]]]]</span>
                <span class="nv">err tailer </span><span class="o">=</span><span class="s"> qcat -f -e %(job_id)s</span>
                <span class="nv">out tailer </span><span class="o">=</span><span class="s"> qcat -f -o %(job_id)s</span>
                <span class="nv">err viewer </span><span class="o">=</span><span class="s"> qcat -e %(job_id)s</span>
                <span class="nv">out viewer </span><span class="o">=</span><span class="s"> qcat -o %(job_id)s</span>
</pre></div>
</div>
</div>
<div class="section" id="hosts-host-batch-systems-system-out-tailer">
<span id="out-tailer"></span><h7>15.2.9.1.18.2. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[batch systems]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[[SYSTEM]]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> out tailer<a class="headerlink" href="#hosts-host-batch-systems-system-out-tailer" title="Permalink to this headline">¶</a></h7>
<p>A command template (with <code class="docutils literal notranslate"><span class="pre">%(job_id)s</span></code> substitution) that can be used
to tail-follow the stdout stream of a running job if SYSTEM does
not use the normal log file location while the job is running.  This setting
overrides <a class="reference internal" href="#tail-command-template"><span class="std std-ref">[hosts] -&gt; [[HOST]] -&gt; tail command template</span></a> above.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>: see <a class="reference internal" href="#err-tailer"><span class="std std-ref">[hosts] -&gt; [[HOST]] -&gt; [[[batch systems]]] -&gt; [[[[SYSTEM]]]] -&gt; err tailer</span></a></li>
</ul>
</div>
<div class="section" id="hosts-host-batch-systems-system-err-viewer">
<h7>15.2.9.1.18.3. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[batch systems]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[[SYSTEM]]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> err viewer<a class="headerlink" href="#hosts-host-batch-systems-system-err-viewer" title="Permalink to this headline">¶</a></h7>
<p>A command template (with <code class="docutils literal notranslate"><span class="pre">%(job_id)s</span></code> substitution) that can be used
to view the stderr stream of a running job if SYSTEM does
not use the normal log file location while the job is running.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>: see <a class="reference internal" href="#err-tailer"><span class="std std-ref">[hosts] -&gt; [[HOST]] -&gt; [[[batch systems]]] -&gt; [[[[SYSTEM]]]] -&gt; err tailer</span></a></li>
</ul>
</div>
<div class="section" id="hosts-host-batch-systems-system-out-viewer">
<h7>15.2.9.1.18.4. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[batch systems]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[[SYSTEM]]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> out viewer<a class="headerlink" href="#hosts-host-batch-systems-system-out-viewer" title="Permalink to this headline">¶</a></h7>
<p>A command template (with <code class="docutils literal notranslate"><span class="pre">%(job_id)s</span></code> substitution) that can be used
to view the stdout stream of a running job if SYSTEM does
not use the normal log file location while the job is running.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>: see <a class="reference internal" href="#err-tailer"><span class="std std-ref">[hosts] -&gt; [[HOST]] -&gt; [[[batch systems]]] -&gt; [[[[SYSTEM]]]] -&gt; err tailer</span></a></li>
</ul>
</div>
<div class="section" id="hosts-host-batch-systems-system-job-name-length-maximum">
<span id="jobnamelengthmaximum"></span><h7>15.2.9.1.18.5. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[batch systems]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[[SYSTEM]]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> job name length maximum<a class="headerlink" href="#hosts-host-batch-systems-system-job-name-length-maximum" title="Permalink to this headline">¶</a></h7>
<p>The maximum length for job name acceptable by a batch system on a given host.
Currently, this setting is only meaningful for PBS jobs. For example, PBS 12
or older will fail a job submit if the job name has more than 15 characters,
which is the default setting. If you have PBS 13 or above, you may want to
modify this setting to a larger value.</p>
<ul class="simple">
<li><em>type</em>: integer</li>
<li><em>default</em>: (none)</li>
<li><em>example</em>:  For PBS:</li>
</ul>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[hosts]</span>
    <span class="nt">[[myhpc*]]</span>
        <span class="nt">[[[batch systems]]]</span>
            <span class="nt">[[[[pbs]]]]</span>
                <span class="c1"># PBS 13</span>
                <span class="nv">job name length maximum </span><span class="o">=</span><span class="s"> 236</span>
</pre></div>
</div>
</div>
<div class="section" id="hosts-host-batch-systems-system-execution-time-limit-polling-intervals">
<span id="executiontimelimitpollingintervals"></span><h7>15.2.9.1.18.6. [hosts] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[HOST]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[batch systems]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[[SYSTEM]]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> execution time limit polling intervals<a class="headerlink" href="#hosts-host-batch-systems-system-execution-time-limit-polling-intervals" title="Permalink to this headline">¶</a></h7>
<p>The intervals between polling after a task job (submitted to the relevant batch
system on the relevant host) exceeds its execution time limit. The default
setting is PT1M, PT2M, PT7M. The accumulated times (in minutes) for these
intervals will be roughly 1, 1 + 2 = 3 and 1 + 2 + 7 = 10 after a task job
exceeds its execution time limit.</p>
<blockquote>
<div><ul class="simple">
<li><em>type</em>: Comma-separated list of ISO 8601 duration/interval
representations, optionally <em>preceded</em> by multipliers.</li>
<li><em>default</em>: PT1M, PT2M, PT7M</li>
<li><em>example</em>:</li>
</ul>
</div></blockquote>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[hosts]</span>
    <span class="nt">[[myhpc*]]</span>
        <span class="nt">[[[batch systems]]]</span>
            <span class="nt">[[[[pbs]]]]</span>
                <span class="nv">execution time limit polling intervals </span><span class="o">=</span><span class="s"> 5*PT2M</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="suite-servers">
<span id="global-suite-servers"></span><h4>15.2.10. [suite servers]<a class="headerlink" href="#suite-servers" title="Permalink to this headline">¶</a></h4>
<p>Configure allowed suite hosts and ports for starting up (running or
restarting) suites and enabling them to be detected whilst running via
utilities such as <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">gscan</span></code>. Additionally configure host
selection settings specifying how to determine the most suitable run host at
any given time from those configured.</p>
<div class="section" id="suite-servers-auto-restart-delay">
<h5>15.2.10.1. [suite servers] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> auto restart delay<a class="headerlink" href="#suite-servers-auto-restart-delay" title="Permalink to this headline">¶</a></h5>
<p>Relates to Cylc’s auto stop-restart mechanism (see <a class="reference internal" href="index.html#auto-stop-restart"><span class="std std-ref">Auto Stop-Restart</span></a>).
When a host is set to automatically shutdown/restart it will first wait a
random period of time between zero and <code class="docutils literal notranslate"><span class="pre">auto</span> <span class="pre">restart</span> <span class="pre">delay</span></code>
seconds before beginning the process. This is to prevent large numbers
of suites from restarting simultaneously.</p>
<ul class="simple">
<li><em>type</em>: integer</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">0</span></code></li>
</ul>
</div>
<div class="section" id="suite-servers-condemned-hosts">
<h5>15.2.10.2. [suite servers] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> condemned hosts<a class="headerlink" href="#suite-servers-condemned-hosts" title="Permalink to this headline">¶</a></h5>
<p>Hosts specified in <code class="docutils literal notranslate"><span class="pre">condemned</span> <span class="pre">hosts</span></code> will not be considered as suite
run hosts. If suites are already running on <code class="docutils literal notranslate"><span class="pre">condemned</span> <span class="pre">hosts</span></code> they
will be automatically shutdown and restarted (see <a class="reference internal" href="index.html#auto-stop-restart"><span class="std std-ref">Auto Stop-Restart</span></a>).</p>
<ul class="simple">
<li><em>type</em>: comma-separated list of host names and/or IP addresses.</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
<div class="section" id="suite-servers-run-hosts">
<h5>15.2.10.3. [suite servers] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> run hosts<a class="headerlink" href="#suite-servers-run-hosts" title="Permalink to this headline">¶</a></h5>
<p>A list of allowed suite run hosts. One of these hosts will be appointed for
a suite to start up on if an explicit host is not provided as an option to
a <code class="docutils literal notranslate"><span class="pre">run</span></code> or <code class="docutils literal notranslate"><span class="pre">restart</span></code> command.</p>
<ul class="simple">
<li><em>type</em>: comma-separated list of host names and/or IP addresses.</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">localhost</span></code></li>
</ul>
</div>
<div class="section" id="suite-servers-scan-hosts">
<h5>15.2.10.4. [suite servers] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> scan hosts<a class="headerlink" href="#suite-servers-scan-hosts" title="Permalink to this headline">¶</a></h5>
<p>A list of hosts to scan for running suites.</p>
<ul class="simple">
<li><em>type</em>: comma-separated list of host names and/or IP addresses.</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">localhost</span></code></li>
</ul>
</div>
<div class="section" id="suite-servers-run-ports">
<h5>15.2.10.5. [suite servers] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> run ports<a class="headerlink" href="#suite-servers-run-ports" title="Permalink to this headline">¶</a></h5>
<p>A list of allowed ports for Cylc to use to run suites.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only one suite can run per port for a given host, so the length
of this list determines the maximum number of suites that can run
at once per suite host.</p>
</div>
<p>This config item supersedes the deprecated settings <code class="docutils literal notranslate"><span class="pre">base</span> <span class="pre">port</span></code>
and <code class="docutils literal notranslate"><span class="pre">maximum</span> <span class="pre">number</span> <span class="pre">of</span> <span class="pre">ports</span></code>, where the base port is equivalent to
the first port, and the maximum number of ports to the length, of this list.</p>
<ul class="simple">
<li><em>type</em>: string in the format <code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">..</span> <span class="pre">Y</span></code> for
<code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">&lt;=</span> <span class="pre">Y</span></code> where <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">Y</span></code> are integers.</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">43001</span> <span class="pre">..</span> <span class="pre">43100</span></code> (equivalent to the list
<code class="docutils literal notranslate"><span class="pre">43001,</span> <span class="pre">43002,</span> <span class="pre">...</span> <span class="pre">,</span> <span class="pre">43099,</span> <span class="pre">43100</span></code>)</li>
</ul>
</div>
<div class="section" id="suite-servers-scan-ports">
<h5>15.2.10.6. [suite servers] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> scan ports<a class="headerlink" href="#suite-servers-scan-ports" title="Permalink to this headline">¶</a></h5>
<p>A list of ports to scan for running suites on each host set in scan hosts.</p>
<ul class="simple">
<li><em>type</em>: string in the format <code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">..</span> <span class="pre">Y</span></code> for
<code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">&lt;=</span> <span class="pre">Y</span></code> where <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">Y</span></code> are integers.</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">43001</span> <span class="pre">..</span> <span class="pre">43100</span></code> (equivalent to the list
<code class="docutils literal notranslate"><span class="pre">43001,</span> <span class="pre">43002,</span> <span class="pre">...</span> <span class="pre">,</span> <span class="pre">43099,</span> <span class="pre">43100</span></code>)</li>
</ul>
</div>
<div class="section" id="suite-servers-run-host-select">
<h5>15.2.10.7. [suite servers] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[run host select]]<a class="headerlink" href="#suite-servers-run-host-select" title="Permalink to this headline">¶</a></h5>
<p>Configure thresholds for excluding insufficient hosts and a method for
ranking the remaining hosts to be applied in selection of the most suitable
<code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">host</span></code>, from those configured, at start-up whenever a set host
is not specified on the command line via the <code class="docutils literal notranslate"><span class="pre">--host=</span></code> option.</p>
<div class="section" id="suite-servers-run-host-select-rank">
<h6>15.2.10.7.1. [suite servers] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[run host select]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> rank<a class="headerlink" href="#suite-servers-run-host-select-rank" title="Permalink to this headline">¶</a></h6>
<p>The method to use to rank the <code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">host</span></code> list in order of
suitability.</p>
<ul class="simple">
<li><em>type</em>: string (which must be one of the options outlined below)</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">random</span></code></li>
<li><em>options</em>:<ul>
<li><strong>random</strong> - shuffle the hosts to select a host at random</li>
<li><strong>load:1</strong> - rank and select for the lowest load average over
1 minute (as given by the <code class="docutils literal notranslate"><span class="pre">uptime</span></code> command)</li>
<li><strong>load:5</strong> - as for <code class="docutils literal notranslate"><span class="pre">load:1</span></code> above, but over 5 minutes</li>
<li><strong>load:15</strong> - as for <code class="docutils literal notranslate"><span class="pre">load:1</span></code> above, but over 15 minutes</li>
<li><dl class="first docutils">
<dt><strong>memory</strong> - rank and select for the highest usable memory i.e.</dt>
<dd>free memory plus memory in the buffer cache (‘buffers’) and in the
page cache (‘cache’), as specified under <code class="docutils literal notranslate"><span class="pre">/proc/meminfo</span></code></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>disk-space:PATH</strong> - rank and select for the highest free disk</dt>
<dd>space for a given mount directory path <code class="docutils literal notranslate"><span class="pre">PATH</span></code> as given by
the <code class="docutils literal notranslate"><span class="pre">df</span></code> command, where multiple paths may be specified
individually i.e. via <code class="docutils literal notranslate"><span class="pre">disk-space:PATH_1</span></code> and
<code class="docutils literal notranslate"><span class="pre">disk-space:PATH_2</span></code>, etc.</dd>
</dl>
</li>
</ul>
</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
<div class="section" id="suite-servers-run-host-select-thresholds">
<h6>15.2.10.7.2. [suite servers] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[run host select]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> thresholds<a class="headerlink" href="#suite-servers-run-host-select-thresholds" title="Permalink to this headline">¶</a></h6>
<p>A list of thresholds i.e. cutoff values which run hosts must meet in order
to be considered as a possible run host. Each threshold is a minimum or a
maximum requirement depending on the context of the measure; usable
memory (<code class="docutils literal notranslate"><span class="pre">memory</span></code>) and free disk space
(<code class="docutils literal notranslate"><span class="pre">disk-space:PATH</span></code>) threshold values set a <em>minimum</em> value,
which must be exceeded, whereas load average (<code class="docutils literal notranslate"><span class="pre">load:1</span></code>,
<code class="docutils literal notranslate"><span class="pre">load:5</span></code> and <code class="docutils literal notranslate"><span class="pre">load:15</span></code>) threshold values set a
<em>maximum</em>, which must not be. Failure to meet a threshold results in
exclusion from the list of hosts that undergo ranking to
determine the best host which becomes the run host.</p>
<ul class="simple">
<li><em>type</em>: string in format <code class="docutils literal notranslate"><span class="pre">MEASURE_1</span> <span class="pre">CUTOFF_1;</span> <span class="pre">...</span> <span class="pre">;MEASURE_n</span> <span class="pre">CUTOFF_n</span></code>
(etc), where each <code class="docutils literal notranslate"><span class="pre">MEASURE_N</span></code> is one of the options below (note
these correspond to all the rank methods accepted under the rank setting
except for <code class="docutils literal notranslate"><span class="pre">random</span></code> which does not make sense as a threshold
measure). Spaces delimit corresponding measures and their values, while
semi-colons (optionally with subsequent spaces) delimit each measure-value
pair.</li>
<li><em>options</em>:<ul>
<li><strong>load:1</strong> - load average over 1 minute (as given by
the <code class="docutils literal notranslate"><span class="pre">uptime</span></code> command)</li>
<li><strong>load:5</strong> - as for <code class="docutils literal notranslate"><span class="pre">load:1</span></code> above, but over 5 minutes</li>
<li><strong>load:15</strong> - as for <code class="docutils literal notranslate"><span class="pre">load:1</span></code> above, but over 15 minutes</li>
<li><strong>memory</strong> - usable memory i.e. free memory plus memory in the
buffer cache (‘buffers’) and in the page cache (‘cache’), in KB, as
specified under <code class="docutils literal notranslate"><span class="pre">/proc/meminfo</span></code></li>
<li><strong>disk-space:PATH</strong> - free disk space for a given mount
directory path <code class="docutils literal notranslate"><span class="pre">PATH</span></code>, in KB, as given by the <code class="docutils literal notranslate"><span class="pre">df</span></code>
command, where multiple paths may be specified individually i.e. via
<code class="docutils literal notranslate"><span class="pre">disk-space:PATH_1</span></code> and <code class="docutils literal notranslate"><span class="pre">disk-space:PATH_2</span></code>, etc.</li>
</ul>
</li>
<li><em>default</em>: (none)</li>
<li><em>examples</em>:<ul>
<li><code class="docutils literal notranslate"><span class="pre">thresholds</span> <span class="pre">=</span> <span class="pre">memory</span> <span class="pre">2000</span></code> (set a minimum of 2000 KB in usable
memory for possible run hosts)</li>
<li><code class="docutils literal notranslate"><span class="pre">thresholds</span> <span class="pre">=</span> <span class="pre">load:5</span> <span class="pre">0.5;</span> <span class="pre">load:15</span> <span class="pre">1.0;</span> <span class="pre">disk-space:/</span> <span class="pre">5000</span></code> (set a maximum
of 0.5 and 1.0 for load averages over 5
and 15 minutes respectively and a minimum of 5000 KB of free disk-space on
the <code class="docutils literal notranslate"><span class="pre">/</span></code> mount directory. If any of these thresholds are not met
by a host, it will be excluded for running a suite on.)</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="section" id="suite-host-self-identification">
<h4>15.2.11. [suite host self-identification]<a class="headerlink" href="#suite-host-self-identification" title="Permalink to this headline">¶</a></h4>
<p>The suite host’s identity must be determined locally by cylc and passed
to running tasks (via <code class="docutils literal notranslate"><span class="pre">$CYLC_SUITE_HOST</span></code>) so that task messages
can target the right suite on the right host.</p>
<div class="section" id="suite-host-self-identification-method">
<h5>15.2.11.1. [suite host self-identification] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> method<a class="headerlink" href="#suite-host-self-identification-method" title="Permalink to this headline">¶</a></h5>
<p>This item determines how cylc finds the identity of the suite host. For
the default <em>name</em> method cylc asks the suite host for its host
name. This should resolve on remote task hosts to the IP address of the
suite host; if it doesn’t, adjust network settings or use one of the
other methods. For the <em>address</em> method, cylc attempts to use a
special external “target address” to determine the IP address of the
suite host as seen by remote task hosts (in-source documentation in
<code class="docutils literal notranslate"><span class="pre">&lt;cylc-dir&gt;/lib/cylc/hostuserutil.py</span></code> explains how this works).
And finally, as a last resort, you can choose the <em>hardwired</em> method
and manually specify the host name or IP address of the suite host.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>options</em>:<ul>
<li>name - self-identified host name</li>
<li>address - automatically determined IP address (requires <em>target</em>,
below)</li>
<li>hardwired - manually specified host name or IP address (requires
<em>host</em>, below)</li>
</ul>
</li>
<li><em>default</em>: name</li>
</ul>
</div>
<div class="section" id="suite-host-self-identification-target">
<h5>15.2.11.2. [suite host self-identification] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> target<a class="headerlink" href="#suite-host-self-identification-target" title="Permalink to this headline">¶</a></h5>
<p>This item is required for the <em>address</em> self-identification method.
If your suite host sees the internet, a common address such as
<code class="docutils literal notranslate"><span class="pre">google.com</span></code> will do; otherwise choose a host visible on your
intranet.</p>
<ul class="simple">
<li><em>type</em>: string (an inter- or intranet URL visible from the suite host)</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">google.com</span></code></li>
</ul>
</div>
<div class="section" id="suite-host-self-identification-host">
<h5>15.2.11.3. [suite host self-identification] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> host<a class="headerlink" href="#suite-host-self-identification-host" title="Permalink to this headline">¶</a></h5>
<p>Use this item to explicitly set the name or IP address of the suite host
if you have to use the <em>hardwired</em> self-identification method.</p>
<ul class="simple">
<li><em>type</em>: string (host name or IP address)</li>
<li><em>default</em>: (none)</li>
</ul>
</div>
</div>
<div class="section" id="task-events">
<h4>15.2.12. [task events]<a class="headerlink" href="#task-events" title="Permalink to this headline">¶</a></h4>
<p>Global site/user defaults for <a class="reference internal" href="index.html#taskeventhandling"><span class="std std-ref">[runtime] -&gt; [[__NAME__]] -&gt; [[[events]]]</span></a>.</p>
</div>
<div class="section" id="test-battery">
<h4>15.2.13. [test battery]<a class="headerlink" href="#test-battery" title="Permalink to this headline">¶</a></h4>
<p>Settings for the automated development tests.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The test battery reads
<code class="docutils literal notranslate"><span class="pre">&lt;cylc-dir&gt;/etc/global-tests.rc</span></code> instead of the normal site/user
global config files.</p>
</div>
<div class="section" id="test-battery-remote-host-with-shared-fs">
<h5>15.2.13.1. [test battery] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> remote host with shared fs<a class="headerlink" href="#test-battery-remote-host-with-shared-fs" title="Permalink to this headline">¶</a></h5>
<p>The name of a remote host that sees the same HOME file system as the host
running the test battery.</p>
</div>
<div class="section" id="test-battery-remote-host">
<h5>15.2.13.2. [test battery] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> remote host<a class="headerlink" href="#test-battery-remote-host" title="Permalink to this headline">¶</a></h5>
<p>Host name of a remote account that does not see the same home directory as
the account running the test battery - see also “remote owner” below).</p>
</div>
<div class="section" id="test-battery-remote-owner">
<h5>15.2.13.3. [test battery] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> remote owner<a class="headerlink" href="#test-battery-remote-owner" title="Permalink to this headline">¶</a></h5>
<p>User name of a remote account that does not see the same home directory as the
account running the test battery - see also “remote host” above).</p>
</div>
<div class="section" id="test-battery-batch-systems">
<h5>15.2.13.4. [test battery] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[batch systems]]<a class="headerlink" href="#test-battery-batch-systems" title="Permalink to this headline">¶</a></h5>
<p>Settings for testing supported batch systems (job submission methods). The
tests for a batch system are only performed if the batch system is available on
the test host or a remote host accessible via SSH from the test host.</p>
<div class="section" id="test-battery-batch-systems-system">
<h6>15.2.13.4.1. [test battery] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[batch systems]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[SYSTEM]]]<a class="headerlink" href="#test-battery-batch-systems-system" title="Permalink to this headline">¶</a></h6>
<p>SYSTEM is the name of a supported batch system with automated tests.
This can currently be “loadleveler”, “lsf”, “pbs”, “sge” and/or “slurm”.</p>
<div class="section" id="test-battery-batch-systems-system-host">
<h7>15.2.13.4.1.1. [test battery] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[batch systems]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[SYSTEM]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> host<a class="headerlink" href="#test-battery-batch-systems-system-host" title="Permalink to this headline">¶</a></h7>
<p>The name of a host where commands for this batch system is available. Use
“localhost” if the batch system is available on the host running the test
battery. Any specified remote host should be accessible via SSH from the host
running the test battery.</p>
</div>
<div class="section" id="test-battery-batch-systems-system-err-viewer">
<h7>15.2.13.4.1.2. [test battery] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[batch systems]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[SYSTEM]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> err viewer<a class="headerlink" href="#test-battery-batch-systems-system-err-viewer" title="Permalink to this headline">¶</a></h7>
<p>The command template (with <code class="docutils literal notranslate"><span class="pre">\%(job_id)s</span></code> substitution) for testing
the run time stderr viewer functionality for this batch system.</p>
</div>
<div class="section" id="test-battery-batch-systems-system-out-viewer">
<h7>15.2.13.4.1.3. [test battery] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[batch systems]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[SYSTEM]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> out viewer<a class="headerlink" href="#test-battery-batch-systems-system-out-viewer" title="Permalink to this headline">¶</a></h7>
<p>The command template (with <code class="docutils literal notranslate"><span class="pre">\%(job_id)s</span></code> substitution) for testing
the run time stdout viewer functionality for this batch system.</p>
</div>
<div class="section" id="test-battery-batch-systems-system-directives">
<h7>15.2.13.4.1.4. [test battery] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[batch systems]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[SYSTEM]]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[[[directives]]]]<a class="headerlink" href="#test-battery-batch-systems-system-directives" title="Permalink to this headline">¶</a></h7>
<p>The minimum set of directives that must be supplied to the batch system on the
site to initiate jobs for the tests.</p>
</div>
</div>
</div>
</div>
<div class="section" id="cylc">
<h4>15.2.14. [cylc]<a class="headerlink" href="#cylc" title="Permalink to this headline">¶</a></h4>
<p>Default values for entries in the suite.rc <code class="docutils literal notranslate"><span class="pre">[cylc]</span></code> section.</p>
<div class="section" id="cylc-utc-mode">
<span id="siteutcmode"></span><h5>15.2.14.1. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> UTC mode<a class="headerlink" href="#cylc-utc-mode" title="Permalink to this headline">¶</a></h5>
<p>Allows you to set a default value for UTC mode in a suite at the site level.
See <a class="reference internal" href="index.html#utc-mode"><span class="std std-ref">[cylc] -&gt; UTC mode</span></a> for details.</p>
</div>
<div class="section" id="cylc-health-check-interval">
<h5>15.2.14.2. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> health check interval<a class="headerlink" href="#cylc-health-check-interval" title="Permalink to this headline">¶</a></h5>
<p>Site default suite health check interval.
See <a class="reference internal" href="index.html#health-check-interval"><span class="std std-ref">[cylc] -&gt; health check interval</span></a> for details.</p>
</div>
<div class="section" id="cylc-task-event-mail-interval">
<h5>15.2.14.3. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> task event mail interval<a class="headerlink" href="#cylc-task-event-mail-interval" title="Permalink to this headline">¶</a></h5>
<p>Site default task event mail interval.
See <a class="reference internal" href="index.html#task-event-mail-interval"><span class="std std-ref">[cylc] -&gt; task event mail interval</span></a> for details.</p>
</div>
<div class="section" id="cylc-events">
<span id="sitecylchooks"></span><h5>15.2.14.4. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]]<a class="headerlink" href="#cylc-events" title="Permalink to this headline">¶</a></h5>
<p>You can define site defaults for each of the following options, details
of which can be found under <a class="reference internal" href="index.html#suiteeventhandling"><span class="std std-ref">[cylc] -&gt; [[events]]</span></a>:</p>
<div class="section" id="cylc-events-handlers">
<h6>15.2.14.4.1. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> handlers<a class="headerlink" href="#cylc-events-handlers" title="Permalink to this headline">¶</a></h6>
</div>
<div class="section" id="cylc-events-handler-events">
<h6>15.2.14.4.2. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> handler events<a class="headerlink" href="#cylc-events-handler-events" title="Permalink to this headline">¶</a></h6>
</div>
<div class="section" id="cylc-events-startup-handler">
<h6>15.2.14.4.3. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> startup handler<a class="headerlink" href="#cylc-events-startup-handler" title="Permalink to this headline">¶</a></h6>
</div>
<div class="section" id="cylc-events-shutdown-handler">
<h6>15.2.14.4.4. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> shutdown handler<a class="headerlink" href="#cylc-events-shutdown-handler" title="Permalink to this headline">¶</a></h6>
</div>
<div class="section" id="cylc-events-aborted-handler">
<h6>15.2.14.4.5. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> aborted handler<a class="headerlink" href="#cylc-events-aborted-handler" title="Permalink to this headline">¶</a></h6>
</div>
<div class="section" id="cylc-events-mail-events">
<h6>15.2.14.4.6. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> mail events<a class="headerlink" href="#cylc-events-mail-events" title="Permalink to this headline">¶</a></h6>
</div>
<div class="section" id="cylc-events-mail-footer">
<h6>15.2.14.4.7. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> mail footer<a class="headerlink" href="#cylc-events-mail-footer" title="Permalink to this headline">¶</a></h6>
</div>
<div class="section" id="cylc-events-mail-from">
<h6>15.2.14.4.8. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> mail from<a class="headerlink" href="#cylc-events-mail-from" title="Permalink to this headline">¶</a></h6>
</div>
<div class="section" id="cylc-events-mail-smtp">
<h6>15.2.14.4.9. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> mail smtp<a class="headerlink" href="#cylc-events-mail-smtp" title="Permalink to this headline">¶</a></h6>
</div>
<div class="section" id="cylc-events-mail-to">
<h6>15.2.14.4.10. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> mail to<a class="headerlink" href="#cylc-events-mail-to" title="Permalink to this headline">¶</a></h6>
</div>
<div class="section" id="cylc-events-timeout-handler">
<h6>15.2.14.4.11. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> timeout handler<a class="headerlink" href="#cylc-events-timeout-handler" title="Permalink to this headline">¶</a></h6>
</div>
<div class="section" id="cylc-events-timeout">
<h6>15.2.14.4.12. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> timeout<a class="headerlink" href="#cylc-events-timeout" title="Permalink to this headline">¶</a></h6>
</div>
<div class="section" id="cylc-events-abort-on-timeout">
<h6>15.2.14.4.13. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> abort on timeout<a class="headerlink" href="#cylc-events-abort-on-timeout" title="Permalink to this headline">¶</a></h6>
</div>
<div class="section" id="cylc-events-stalled-handler">
<h6>15.2.14.4.14. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> stalled handler<a class="headerlink" href="#cylc-events-stalled-handler" title="Permalink to this headline">¶</a></h6>
</div>
<div class="section" id="cylc-events-abort-on-stalled">
<h6>15.2.14.4.15. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> abort on stalled<a class="headerlink" href="#cylc-events-abort-on-stalled" title="Permalink to this headline">¶</a></h6>
</div>
<div class="section" id="cylc-events-inactivity-handler">
<h6>15.2.14.4.16. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> inactivity handler<a class="headerlink" href="#cylc-events-inactivity-handler" title="Permalink to this headline">¶</a></h6>
</div>
<div class="section" id="cylc-events-inactivity">
<h6>15.2.14.4.17. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> inactivity<a class="headerlink" href="#cylc-events-inactivity" title="Permalink to this headline">¶</a></h6>
</div>
<div class="section" id="cylc-events-abort-on-inactivity">
<h6>15.2.14.4.18. [cylc] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[events]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> abort on inactivity<a class="headerlink" href="#cylc-events-abort-on-inactivity" title="Permalink to this headline">¶</a></h6>
</div>
</div>
</div>
<div class="section" id="authentication">
<span id="globalauth"></span><h4>15.2.15. [authentication]<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h4>
<p>Authentication of client programs with suite server programs can be configured
here, and overridden in suites if necessary (see <a class="reference internal" href="index.html#suiteauth"><span class="std std-ref">[cylc] -&gt; [[authentication]]</span></a>).</p>
<p>The suite-specific passphrase must be installed on a user’s account to
authorize full control privileges (see <a class="reference internal" href="index.html#tutpassphrases"><span class="std std-ref">Suite Passphrases</span></a>
and <a class="reference internal" href="index.html#connectionauthentication"><span class="std std-ref">Client-Server Interaction</span></a>). In the future we plan to move to a more
traditional user account model so that each authorized user can have their own
password.</p>
<div class="section" id="authentication-public">
<h5>15.2.15.1. [authentication] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> public<a class="headerlink" href="#authentication-public" title="Permalink to this headline">¶</a></h5>
<p>This sets the client privilege level for public access - i.e. no
suite passphrase required.</p>
<ul class="simple">
<li><em>type</em>: string (must be one of the following options)</li>
<li><em>options</em>:<ul>
<li><em>identity</em> - only suite and owner names revealed</li>
<li><em>description</em> - identity plus suite title and description</li>
<li><em>state-totals</em> - identity, description, and task state totals</li>
<li><em>full-read</em> - full read-only access for monitor and GUI</li>
<li><em>shutdown</em> - full read access plus shutdown, but no other
control.</li>
</ul>
</li>
<li><em>default</em>: state-totals</li>
</ul>
</div>
</div>
</div>
<span id="document-appendices/gcylc-config-ref"></span><div class="section" id="gcylc-gui-cylc-gui-config-file-reference">
<span id="gcylcrcreference"></span><h3>15.3. Gcylc GUI (cylc gui) Config File Reference<a class="headerlink" href="#gcylc-gui-cylc-gui-config-file-reference" title="Permalink to this headline">¶</a></h3>
<p>This section defines all legal items and values for the gcylc user config file,
which should be located in <code class="docutils literal notranslate"><span class="pre">$HOME/.cylc/gcylc.rc</span></code>. Current settings
can be printed with the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">get-gui-config</span></code> command.</p>
<div class="section" id="top-level-items">
<h4>15.3.1. Top Level Items<a class="headerlink" href="#top-level-items" title="Permalink to this headline">¶</a></h4>
<div class="section" id="dot-icon-size">
<h5>15.3.1.1. dot icon size<a class="headerlink" href="#dot-icon-size" title="Permalink to this headline">¶</a></h5>
<p>Set the size of the task state dot icons displayed in the text and dot
views.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>legal values</em>: <code class="docutils literal notranslate"><span class="pre">small</span></code> (10px), <code class="docutils literal notranslate"><span class="pre">medium</span></code> (14px), <code class="docutils literal notranslate"><span class="pre">large</span></code> (20px),
<code class="docutils literal notranslate"><span class="pre">extra</span> <span class="pre">large</span></code> (30px)</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">medium</span></code></li>
</ul>
</div>
<div class="section" id="initial-side-by-side-views">
<h5>15.3.1.2. initial side-by-side views<a class="headerlink" href="#initial-side-by-side-views" title="Permalink to this headline">¶</a></h5>
<p>Set the suite view panels initial orientation when the GUI starts.
This can be changed later using the “View” menu “Toggle views side-by-side”
option.</p>
<ul class="simple">
<li><em>type</em>: boolean (False or True)</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">False</span></code></li>
</ul>
</div>
<div class="section" id="initial-views">
<h5>15.3.1.3. initial views<a class="headerlink" href="#initial-views" title="Permalink to this headline">¶</a></h5>
<p>Set the suite view panel(s) displayed initially, when the GUI starts.
This can be changed later using the tool bar.</p>
<ul class="simple">
<li><em>type</em>: string (a list of one or two view names)</li>
<li><em>legal values</em>: <code class="docutils literal notranslate"><span class="pre">text</span></code>, <code class="docutils literal notranslate"><span class="pre">dot</span></code>,  <code class="docutils literal notranslate"><span class="pre">graph</span></code></li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">text</span></code></li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">initial</span> <span class="pre">views</span> <span class="pre">=</span> <span class="pre">graph,</span> <span class="pre">dot</span></code></li>
</ul>
</div>
<div class="section" id="maximum-update-interval">
<h5>15.3.1.4. maximum update interval<a class="headerlink" href="#maximum-update-interval" title="Permalink to this headline">¶</a></h5>
<p>Set the maximum (longest) time interval between calls to the suite for data
update.</p>
<p>The update frequency of the GUI is variable. It is determined by considering
the time of last update and the mean duration of the last 10 main loops of the
suite.</p>
<p>In general, the GUI will use an update frequency that matches the mean duration
of the suite’s main loop. In quiet time (or if the suite is not contactable),
it will gradually increase the update interval (i.e. reduce the update
frequency) to a maximum determined by this setting.</p>
<p>Increasing this setting will reduce the network traffic and hits on the suite
process.  However, if a quiet suite starts to pick up activity, the GUI may
initially appear out of sync with what is happening in the suite for the
duration of this interval.</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 duration/interval representation (e.g.
<code class="docutils literal notranslate"><span class="pre">PT10S</span></code>, 10 seconds, or <code class="docutils literal notranslate"><span class="pre">PT1M</span></code>, 1 minute).</li>
<li><em>default</em>: PT15S</li>
</ul>
</div>
<div class="section" id="sort-by-definition-order">
<h5>15.3.1.5. sort by definition order<a class="headerlink" href="#sort-by-definition-order" title="Permalink to this headline">¶</a></h5>
<p>If this is not turned off the default sort order for task names and
families in the dot and text views will the order they appear in the
suite definition. Clicking on the task name column in the treeview will
toggle to alphanumeric sort, and a View menu item does the same for the
dot view.  If turned off, the default sort order is alphanumeric and
definition order is not available at all.</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">True</span></code></li>
</ul>
</div>
<div class="section" id="sort-column">
<h5>15.3.1.6. sort column<a class="headerlink" href="#sort-column" title="Permalink to this headline">¶</a></h5>
<p>If <code class="docutils literal notranslate"><span class="pre">text</span></code> is in <code class="docutils literal notranslate"><span class="pre">initial</span> <span class="pre">views</span></code> then <code class="docutils literal notranslate"><span class="pre">sort</span> <span class="pre">column</span></code> sets
the column that will be sorted initially when the GUI launches. Sorting can be
changed later by clicking on the column headers.</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>legal values</em>: <code class="docutils literal notranslate"><span class="pre">task</span></code>, <code class="docutils literal notranslate"><span class="pre">state</span></code>, <code class="docutils literal notranslate"><span class="pre">host</span></code>, <code class="docutils literal notranslate"><span class="pre">job</span> <span class="pre">system</span></code>,
<code class="docutils literal notranslate"><span class="pre">job</span> <span class="pre">ID</span></code>, <code class="docutils literal notranslate"><span class="pre">T-submit</span></code>, <code class="docutils literal notranslate"><span class="pre">T-start</span></code>, <code class="docutils literal notranslate"><span class="pre">T-finish</span></code>, <code class="docutils literal notranslate"><span class="pre">dT-mean</span></code>,
<code class="docutils literal notranslate"><span class="pre">latest</span> <span class="pre">message</span></code>, <code class="docutils literal notranslate"><span class="pre">none</span></code></li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">none</span></code></li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">sort</span> <span class="pre">column</span> <span class="pre">=</span> <span class="pre">T-start</span></code></li>
</ul>
</div>
<div class="section" id="sort-column-ascending">
<h5>15.3.1.7. sort column ascending<a class="headerlink" href="#sort-column-ascending" title="Permalink to this headline">¶</a></h5>
<p>For use in combination with <code class="docutils literal notranslate"><span class="pre">sort</span> <span class="pre">column</span></code>, sets whether the column will
be sorted using ascending or descending order.</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">True</span></code></li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">sort</span> <span class="pre">column</span> <span class="pre">ascending</span> <span class="pre">=</span> <span class="pre">False</span></code></li>
</ul>
</div>
<div class="section" id="sub-graphs-on">
<h5>15.3.1.8. sub-graphs on<a class="headerlink" href="#sub-graphs-on" title="Permalink to this headline">¶</a></h5>
<p>Set the sub-graphs view to be enabled by default.
This can be changed later using the toggle options for the graph view.</p>
<ul class="simple">
<li><em>type</em>: boolean (False or True)</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">False</span></code></li>
</ul>
</div>
<div class="section" id="task-filter-highlight-color">
<h5>15.3.1.9. task filter highlight color<a class="headerlink" href="#task-filter-highlight-color" title="Permalink to this headline">¶</a></h5>
<p>The color used to highlight active task filters in gcylc. It must be a name
from the X11 <code class="docutils literal notranslate"><span class="pre">rgb.txt</span></code> file, e.g. <code class="docutils literal notranslate"><span class="pre">SteelBlue</span></code>; or a
<em>quoted</em> hexadecimal color code, e.g. <code class="docutils literal notranslate"><span class="pre">&quot;#ff0000&quot;</span></code> for red (quotes
are required to prevent the hex code being interpreted as a comment).</p>
<ul class="simple">
<li><em>type</em>: string</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">PowderBlue</span></code></li>
</ul>
</div>
<div class="section" id="task-states-to-filter-out">
<h5>15.3.1.10. task states to filter out<a class="headerlink" href="#task-states-to-filter-out" title="Permalink to this headline">¶</a></h5>
<p>Set the initial filtering options when the GUI starts. Later this can be
changed by using the “View” menu “Task Filtering” option.</p>
<ul class="simple">
<li><em>type</em>: string list</li>
<li><em>legal values</em>: waiting, held, queued, ready, expired, submitted,
submit-failed, submit-retrying, running, succeeded, failed, retrying,
runahead</li>
<li><em>default</em>: runahead</li>
</ul>
</div>
<div class="section" id="transpose-dot">
<h5>15.3.1.11. transpose dot<a class="headerlink" href="#transpose-dot" title="Permalink to this headline">¶</a></h5>
<p>Transposes the content in dot view so that it displays from left to right
rather than from top to bottom. Can be changed later using the options
submenu available via the view menu.</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">False</span></code></li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">transpose</span> <span class="pre">dot</span> <span class="pre">=</span> <span class="pre">True</span></code></li>
</ul>
</div>
<div class="section" id="transpose-graph">
<h5>15.3.1.12. transpose graph<a class="headerlink" href="#transpose-graph" title="Permalink to this headline">¶</a></h5>
<p>Transposes the content in graph view so that it displays from left to right
rather than from top to bottom. Can be changed later using the options submenu
via the view menu.</p>
<ul class="simple">
<li><em>type</em>: boolean</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">False</span></code></li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">transpose</span> <span class="pre">graph</span> <span class="pre">=</span> <span class="pre">True</span></code></li>
</ul>
</div>
<div class="section" id="ungrouped-views">
<h5>15.3.1.13. ungrouped views<a class="headerlink" href="#ungrouped-views" title="Permalink to this headline">¶</a></h5>
<p>List suite views, if any, that should be displayed initially in an
ungrouped state. Namespace family grouping can be changed later
using the tool bar.</p>
<ul class="simple">
<li><em>type</em>: string (a list of zero or more view names)</li>
<li><em>legal values</em>: <code class="docutils literal notranslate"><span class="pre">text</span></code>, <code class="docutils literal notranslate"><span class="pre">dot</span></code>,  <code class="docutils literal notranslate"><span class="pre">graph</span></code></li>
<li><em>default</em>: (none)</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">ungrouped</span> <span class="pre">views</span> <span class="pre">=</span> <span class="pre">text,</span> <span class="pre">dot</span></code></li>
</ul>
</div>
<div class="section" id="use-theme">
<h5>15.3.1.14. use theme<a class="headerlink" href="#use-theme" title="Permalink to this headline">¶</a></h5>
<p>Set the task state color theme, common to all views, to use initially. The
color theme can be changed later using the tool bar.  See
<code class="docutils literal notranslate"><span class="pre">etc/gcylc.rc.eg</span></code> and <code class="docutils literal notranslate"><span class="pre">etc/gcylc-themes.rc</span></code> in the Cylc
installation directory for how to modify existing themes or define your own.
Use <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">get-gui-config</span></code> to list available themes.</p>
<ul class="simple">
<li><em>type</em>: string (theme name)</li>
<li><em>legal values</em>: <code class="docutils literal notranslate"><span class="pre">default</span></code>, <code class="docutils literal notranslate"><span class="pre">solid</span></code>, <code class="docutils literal notranslate"><span class="pre">high-contrast</span></code>,
<code class="docutils literal notranslate"><span class="pre">color-blind</span></code>, and any custom or user-modified themes.</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">default</span></code></li>
</ul>
</div>
<div class="section" id="window-size">
<h5>15.3.1.15. window size<a class="headerlink" href="#window-size" title="Permalink to this headline">¶</a></h5>
<p>Sets the size (in pixels) of the cylc GUI at startup.</p>
<ul class="simple">
<li><em>type</em>: integer list: x, y</li>
<li><em>legal values</em>: positive integers</li>
<li><em>default</em>: 800, 500</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">window</span> <span class="pre">size</span> <span class="pre">=</span> <span class="pre">1000,</span> <span class="pre">700</span></code></li>
</ul>
</div>
</div>
<div class="section" id="themes">
<h4>15.3.2. [themes]<a class="headerlink" href="#themes" title="Permalink to this headline">¶</a></h4>
<p>This section may contain task state color theme definitions.</p>
<div class="section" id="themes-theme">
<h5>15.3.2.1. [themes] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[THEME]]<a class="headerlink" href="#themes-theme" title="Permalink to this headline">¶</a></h5>
<p>The name of the task state color-theme to be defined in this section.</p>
<ul class="simple">
<li><em>type</em>: string</li>
</ul>
<div class="section" id="themes-theme-inherit">
<h6>15.3.2.1.1. [themes] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[THEME]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> inherit<a class="headerlink" href="#themes-theme-inherit" title="Permalink to this headline">¶</a></h6>
<p>You can inherit from another theme in order to avoid defining all states.</p>
<ul class="simple">
<li><em>type</em>: string (parent theme name)</li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">default</span></code></li>
</ul>
</div>
<div class="section" id="themes-theme-defaults">
<h6>15.3.2.1.2. [themes] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[THEME]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> defaults<a class="headerlink" href="#themes-theme-defaults" title="Permalink to this headline">¶</a></h6>
<p>Set default icon attributes for all state icons in this theme.</p>
<ul class="simple">
<li><em>type</em>: string list (icon attributes)</li>
<li><em>legal values</em>: <code class="docutils literal notranslate"><span class="pre">&quot;color=COLOR&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;style=STYLE&quot;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&quot;fontcolor=FONTCOLOR&quot;</span></code></li>
<li><em>default</em>: (none)</li>
</ul>
<p>For the attribute values, <code class="docutils literal notranslate"><span class="pre">COLOR</span></code> and <code class="docutils literal notranslate"><span class="pre">FONTCOLOR</span></code> can be color names from
the X11 <code class="docutils literal notranslate"><span class="pre">rgb.txt</span></code> file, e.g. <code class="docutils literal notranslate"><span class="pre">SteelBlue</span></code>; or hexadecimal color codes, e.g.
<code class="docutils literal notranslate"><span class="pre">#ff0000</span></code> for red; and <code class="docutils literal notranslate"><span class="pre">STYLE</span></code> can be <code class="docutils literal notranslate"><span class="pre">filled</span></code> or <code class="docutils literal notranslate"><span class="pre">unfilled</span></code>.
See <code class="docutils literal notranslate"><span class="pre">etc/gcylc.rc.eg</span></code> and <code class="docutils literal notranslate"><span class="pre">etc/gcylc-themes.rc</span></code> in
the Cylc installation directory for examples.</p>
</div>
<div class="section" id="themes-theme-state">
<h6>15.3.2.1.3. [themes] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> [[THEME]] <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> STATE<a class="headerlink" href="#themes-theme-state" title="Permalink to this headline">¶</a></h6>
<p>Set icon attributes for all task states in <code class="docutils literal notranslate"><span class="pre">THEME</span></code>, or for a subset of them
if you have used theme inheritance and/or defaults. Legal values of <code class="docutils literal notranslate"><span class="pre">STATE</span></code>
are any of the cylc task proxy states: <em>waiting, runahead, held, queued,
ready, submitted, submit-failed, running, succeeded, failed, retrying,
submit-retrying</em>.</p>
<ul class="simple">
<li><em>type</em>: string list (icon attributes)</li>
<li><em>legal values</em>: <code class="docutils literal notranslate"><span class="pre">&quot;color=COLOR&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;style=STYLE&quot;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&quot;fontcolor=FONTCOLOR&quot;</span></code></li>
<li><em>default:</em> (none)</li>
</ul>
<p>For the attribute values, <code class="docutils literal notranslate"><span class="pre">COLOR</span></code> and <code class="docutils literal notranslate"><span class="pre">FONTCOLOR</span></code> can be color names from
the X11 <code class="docutils literal notranslate"><span class="pre">rgb.txt</span></code> file, e.g. <code class="docutils literal notranslate"><span class="pre">SteelBlue</span></code>; or hexadecimal color codes, e.g.
<code class="docutils literal notranslate"><span class="pre">#ff0000</span></code> for red; and <code class="docutils literal notranslate"><span class="pre">STYLE</span></code> can be <code class="docutils literal notranslate"><span class="pre">filled</span></code> or <code class="docutils literal notranslate"><span class="pre">unfilled</span></code>.
See <code class="docutils literal notranslate"><span class="pre">etc/gcylc.rc.eg</span></code> and <code class="docutils literal notranslate"><span class="pre">etc/gcylc-themes.rc</span></code> in
the Cylc installation directory for examples.</p>
</div>
</div>
</div>
</div>
<span id="document-appendices/gscan-config-ref"></span><div class="section" id="gscan-gui-cylc-gscan-config-file-reference">
<span id="gscanrcreference"></span><h3>15.4. Gscan GUI (cylc gscan) Config File Reference<a class="headerlink" href="#gscan-gui-cylc-gscan-config-file-reference" title="Permalink to this headline">¶</a></h3>
<p>This section defines all legal items and values for the gscan config
file which should be located in <code class="docutils literal notranslate"><span class="pre">$HOME/.cylc/gscan.rc</span></code>. Some items
also affect the gpanel panel app.</p>
<p>The main menubar can be hidden to maximise the display area. Its visibility
can be toggled via the mouse right-click menu, or by typing <code class="docutils literal notranslate"><span class="pre">Alt-m</span></code>. When
visible, the main View menu allows you to change properties such as the columns
that are displayed, which hosts to scan for running suites, and the task state
icon theme.</p>
<p>At startup, the task state icon theme and icon size are taken from the gcylc
config file <code class="docutils literal notranslate"><span class="pre">$HOME/.cylc/gcylc.rc</span></code>.</p>
<div class="section" id="top-level-items">
<h4>15.4.1. Top Level Items<a class="headerlink" href="#top-level-items" title="Permalink to this headline">¶</a></h4>
<div class="section" id="activate-on-startup">
<h5>15.4.1.1. activate on startup<a class="headerlink" href="#activate-on-startup" title="Permalink to this headline">¶</a></h5>
<p>Set whether <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">gpanel</span></code> will activate automatically when the GUI is
loaded or not.</p>
<ul class="simple">
<li><em>type</em>: boolean (True or False)</li>
<li><em>legal values</em>: <code class="docutils literal notranslate"><span class="pre">True</span></code>, <code class="docutils literal notranslate"><span class="pre">False</span></code></li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">False</span></code></li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">activate</span> <span class="pre">on</span> <span class="pre">startup</span> <span class="pre">=</span> <span class="pre">True</span></code></li>
</ul>
</div>
<div class="section" id="columns">
<h5>15.4.1.2. columns<a class="headerlink" href="#columns" title="Permalink to this headline">¶</a></h5>
<p>Set the columns to display when the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">gscan</span></code> GUI starts. This can
be changed later with the View menu.  The order in which the columns are
specified here does not affect the display order.</p>
<ul class="simple">
<li><em>type</em>: string (a list of one or more view names)</li>
<li><em>legal values</em>: <code class="docutils literal notranslate"><span class="pre">host</span></code>, <code class="docutils literal notranslate"><span class="pre">owner</span></code>, <code class="docutils literal notranslate"><span class="pre">status</span></code>, <code class="docutils literal notranslate"><span class="pre">suite</span></code>,
<code class="docutils literal notranslate"><span class="pre">title</span></code>, <code class="docutils literal notranslate"><span class="pre">updated</span></code></li>
<li><em>default</em>: <code class="docutils literal notranslate"><span class="pre">status</span></code>, <code class="docutils literal notranslate"><span class="pre">suite</span></code></li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">columns</span> <span class="pre">=</span> <span class="pre">suite,</span> <span class="pre">title,</span> <span class="pre">status</span></code></li>
</ul>
</div>
<div class="section" id="suite-listing-update-interval">
<h5>15.4.1.3. suite listing update interval<a class="headerlink" href="#suite-listing-update-interval" title="Permalink to this headline">¶</a></h5>
<p>Set the time interval between refreshing the suite listing (by file system or
port range scan).</p>
<p>Increasing this setting will reduce the frequency of gscan looking for running
suites. Scanning for suites by port range scan can be a hit on the network and
the running suite processes, while scanning for suites by walking the file
system can hit the file system (especially if the file system is a network file
system). Therefore, this is normally set with a lower frequency than the status
update interval. Increasing this setting will make gscan friendlier to the
network and/or the file system, but gscan may appear out of sync if there are
many start up or shut down of suites between the intervals.</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 duration/interval representation (e.g. <code class="docutils literal notranslate"><span class="pre">PT10S</span></code>,
10 seconds, or <code class="docutils literal notranslate"><span class="pre">PT1M</span></code>, 1 minute).</li>
<li><em>default</em>: PT1M</li>
</ul>
</div>
<div class="section" id="suite-status-update-interval">
<h5>15.4.1.4. suite status update interval<a class="headerlink" href="#suite-status-update-interval" title="Permalink to this headline">¶</a></h5>
<p>Set the time interval between calls to known running suites (suites that are
known via the latest suite listing) for data updates.</p>
<p>Increasing this setting will reduce the network traffic and hits on the suite
processes. However, gscan may appear out of sync with what may be happening
in very busy suites.</p>
<ul class="simple">
<li><em>type</em>: ISO 8601 duration/interval representation (e.g. <code class="docutils literal notranslate"><span class="pre">PT10S</span></code>,
10 seconds, or <code class="docutils literal notranslate"><span class="pre">PT1M</span></code>, 1 minute).</li>
<li><em>default</em>: PT15S</li>
</ul>
</div>
<div class="section" id="window-size">
<h5>15.4.1.5. window size<a class="headerlink" href="#window-size" title="Permalink to this headline">¶</a></h5>
<p>Sets the size in pixels of the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">gscan</span></code> GUI window at startup.</p>
<ul class="simple">
<li><em>type</em>: integer list: x, y</li>
<li><em>legal values</em>: positive integers</li>
<li><em>default</em>: 300, 200</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">window</span> <span class="pre">size</span> <span class="pre">=</span> <span class="pre">1000,</span> <span class="pre">700</span></code></li>
</ul>
</div>
<div class="section" id="hide-main-menubar">
<h5>15.4.1.6. hide main menubar<a class="headerlink" href="#hide-main-menubar" title="Permalink to this headline">¶</a></h5>
<p>Hide the main menubar of the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">gscan</span></code> GUI window at startup. By
default, the menubar is not hidden. Either way, you can toggle its
visibility with <code class="docutils literal notranslate"><span class="pre">Alt-m</span></code> or via the right-click menu.</p>
<ul class="simple">
<li><em>type</em>: boolean (True or False)</li>
<li><em>default</em>: False</li>
<li><em>example</em>: <code class="docutils literal notranslate"><span class="pre">hide</span> <span class="pre">main</span> <span class="pre">menubar</span> <span class="pre">=</span> <span class="pre">True</span></code></li>
</ul>
</div>
</div>
</div>
<span id="document-appendices/remote-job-management"></span><div class="section" id="remote-job-management">
<h3>15.5. Remote Job Management<a class="headerlink" href="#remote-job-management" title="Permalink to this headline">¶</a></h3>
<p>Managing tasks in a workflow requires more than just job execution: Cylc
performs additional actions with <code class="docutils literal notranslate"><span class="pre">rsync</span></code> for file transfer, and
direct execution of <code class="docutils literal notranslate"><span class="pre">cylc</span></code> sub-commands over non-interactive
SSH <a class="footnote-reference" href="#id5" id="id1">[4]</a>.</p>
<div class="section" id="ssh-free-job-management">
<h4>15.5.1. SSH-free Job Management?<a class="headerlink" href="#ssh-free-job-management" title="Permalink to this headline">¶</a></h4>
<p>Some sites may want to restrict access to job hosts by whitelisting SSH
connections to allow only <code class="docutils literal notranslate"><span class="pre">rsync</span></code> for file transfer, and allowing job
execution only via a local batch system that sees the job hosts <a class="footnote-reference" href="#id6" id="id2">[5]</a> .
We are investigating the feasibility of SSH-free job management when a local
batch system is available, but this is not yet possible unless your suite
and job hosts also share a filesystem, which allows Cylc to treat jobs as
entirely local <a class="footnote-reference" href="#id7" id="id3">[6]</a> .</p>
</div>
<div class="section" id="ssh-based-job-management">
<h4>15.5.2. SSH-based Job Management<a class="headerlink" href="#ssh-based-job-management" title="Permalink to this headline">¶</a></h4>
<p>Cylc does not have persistent agent processes running on job hosts to act on
instructions received over the network <a class="footnote-reference" href="#id8" id="id4">[7]</a> so instead we execute job
management commands directly on job hosts over SSH. Reasons for this include:</p>
<ul class="simple">
<li>it works equally for batch system and background jobs</li>
<li>SSH is <em>required</em> for background jobs, and for batch jobs if the
batch system is not available on the suite host</li>
<li><em>querying the batch system alone is not sufficient for full job
polling functionality</em> because jobs can complete (and then be forgotten by
the batch system) while the network, suite host, or suite server program is
down (e.g. between suite shutdown and restart)<ul>
<li>to handle this we get the automatic job wrapper code to write
job messages and exit status to <em>job status files</em> that are
interrogated by suite server programs during job polling operations</li>
<li>job status files reside on the job host, so the interrogation
is done over SSH</li>
</ul>
</li>
<li>job status files also hold batch system name and job ID; this is
written by the job submit command, and read by job poll and kill commands
(all over SSH)</li>
</ul>
</div>
<div class="section" id="a-concrete-example">
<h4>15.5.3. A Concrete Example<a class="headerlink" href="#a-concrete-example" title="Permalink to this headline">¶</a></h4>
<p>The following suite, registered as <code class="docutils literal notranslate"><span class="pre">suitex</span></code>, is used to illustrate
our current SSH-based remote job management. It submits two jobs to a remote,
and a local task views a remote job log then polls and kills the remote jobs.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># suite.rc</span>
<span class="nt">[scheduling]</span>
   <span class="nt">[[dependencies]]</span>
          <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">delayer</span> <span class="o">=&gt;</span> <span class="kd">master</span> <span class="o">&amp;</span> <span class="kd">REMOTES</span><span class="c">&quot;</span>
<span class="nt">[runtime]</span>
   <span class="nt">[[REMOTES]]</span>
      <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;sleep 30&quot;</span>
       <span class="nt">[[[remote]]]</span>
           <span class="nv">host </span><span class="o">=</span><span class="s"> wizard</span>
           <span class="nv">owner </span><span class="o">=</span><span class="s"> hobo</span>
   <span class="nt">[[remote-a, remote-b]]</span>
       <span class="nv">inherit </span><span class="o">=</span><span class="s"> REMOTES</span>
   <span class="nt">[[delayer]]</span>
      <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;sleep 10&quot;</span>
   <span class="nt">[[master]]</span>
       <span class="nv">script </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2"> sleep 5</span>
<span class="s2"> cylc cat-log -m c -f o $CYLC_SUITE_NAME remote-a.1</span>
<span class="s2"> sleep 2</span>
<span class="s2"> cylc poll $CYLC_SUITE_NAME REMOTES.1</span>
<span class="s2"> sleep 2</span>
<span class="s2"> cylc kill $CYLC_SUITE_NAME REMOTES.1</span>
<span class="s2"> sleep 2</span>
<span class="s2"> cylc remove $CYLC_SUITE_NAME REMOTES.1&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>The <em>delayer</em> task just separates suite start-up from remote job
submission, for clarity when watching the job host (e.g. with
<code class="docutils literal notranslate"><span class="pre">watch</span> <span class="pre">-n</span> <span class="pre">1</span> <span class="pre">find</span> <span class="pre">~/cylc-run/suitex</span></code>).</p>
<p>Global config specifies the path to the remote Cylc executable, says
to retrieve job logs, and not to use a remote login shell:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># global.rc</span>
<span class="nt">[hosts]</span>
   <span class="nt">[[wizard]]</span>
       <span class="nv">cylc executable </span><span class="o">=</span><span class="s"> /opt/bin/cylc</span>
       <span class="nv">retrieve job logs </span><span class="o">=</span><span class="s"> True</span>
       <span class="nv">use login shell </span><span class="o">=</span><span class="s"> False</span>
</pre></div>
</div>
<p>On running the suite, remote job host actions were captured in the transcripts
below by wrapping the <code class="docutils literal notranslate"><span class="pre">ssh</span></code>, <code class="docutils literal notranslate"><span class="pre">scp</span></code>, and <code class="docutils literal notranslate"><span class="pre">rsync</span></code>
executables in scripts that log their command lines before taking action.</p>
<div class="section" id="create-suite-run-directory-and-install-source-files">
<h5>15.5.3.1. Create suite run directory and install source files<a class="headerlink" href="#create-suite-run-directory-and-install-source-files" title="Permalink to this headline">¶</a></h5>
<p>Done by <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">suite-run</span></code> before suite start-up (the command will be
migrated to Cylc soon though).</p>
<ul class="simple">
<li>with <code class="docutils literal notranslate"><span class="pre">--new</span></code> it invokes bash over SSH and a raw shell
expression, to delete previous-run files</li>
<li>it invokes itself over SSH to create top level suite directories
and install source files<ul>
<li>skips installation if server UUID file is found on the job host
(indicates a shared filesystem)</li>
</ul>
</li>
<li>uses <code class="docutils literal notranslate"><span class="pre">rsync</span></code> for suite source file installation</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The same directory structure is used on suite and job hosts, for
consistency and simplicity, and because the suite host can also be a job
host.</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># rose suite-run --new only: initial clean-out</span>
ssh -oBatchMode<span class="o">=</span>yes -oConnectTimeout<span class="o">=</span><span class="m">10</span> hobo@wizard bash -l -O extglob -c <span class="s1">&#39;cd; echo &#39;</span><span class="s2">&quot;&#39;&quot;</span><span class="s1">&#39;673d7a0d-7816-42a4-8132-4b1ab394349c&#39;</span><span class="s2">&quot;&#39;&quot;</span><span class="s1">&#39;; ls -d -r cylc-run/suitex/work cylc-run/suitex/share/cycle cylc-run/suitex/share cylc-run/suitex; rm -fr cylc-run/suitex/work cylc-run/suitex/share/cycle cylc-run/suitex/share cylc-run/suitex; (cd ; rmdir -p cylc-run/suitex/work cylc-run/suitex/share/cycle cylc-run/suitex/share cylc-run 2&gt;/dev/null || true)&#39;</span>

<span class="c1"># rose suite-run: test for shared filesystem and create share/cycle directories</span>
ssh -oBatchMode<span class="o">=</span>yes -oConnectTimeout<span class="o">=</span><span class="m">10</span> -n hobo@wizard env <span class="nv">ROSE_VERSION</span><span class="o">=</span><span class="m">2018</span>.02.0 <span class="nv">CYLC_VERSION</span><span class="o">=</span><span class="m">7</span>.6.x bash -l -c <span class="s1">&#39;&quot;$0&quot; &quot;$@&quot;&#39;</span> rose suite-run -vv -n suitex --run<span class="o">=</span>run --remote<span class="o">=</span><span class="nv">uuid</span><span class="o">=</span>231cd6a1-6d61-476d-96e1-4325ef9216fc,now-str<span class="o">=</span>20180416T042319Z

<span class="c1"># rose suite-run: install suite source directory to job host</span>
rsync -a --exclude<span class="o">=</span>.* --timeout<span class="o">=</span><span class="m">1800</span> --rsh<span class="o">=</span>ssh -oBatchMode<span class="o">=</span>yes -oConnectTimeout<span class="o">=</span><span class="m">10</span> --exclude<span class="o">=</span>231cd6a1-6d61-476d-96e1-4325ef9216fc --exclude<span class="o">=</span>log/231cd6a1-6d61-476d-96e1-4325ef9216fc --exclude<span class="o">=</span>share/231cd6a1-6d61-476d-96e1-4325ef9216fc --exclude<span class="o">=</span>share/cycle/231cd6a1-6d61-476d-96e1-4325ef9216fc --exclude<span class="o">=</span>work/231cd6a1-6d61-476d-96e1-4325ef9216fc --exclude<span class="o">=</span>/.* --exclude<span class="o">=</span>/cylc-suite.db --exclude<span class="o">=</span>/log --exclude<span class="o">=</span>/log.* --exclude<span class="o">=</span>/state --exclude<span class="o">=</span>/share --exclude<span class="o">=</span>/work ./ hobo@wizard:cylc-run/suitex
   <span class="c1"># (internal rsync)</span>
   ssh -oBatchMode<span class="o">=</span>yes -oConnectTimeout<span class="o">=</span><span class="m">10</span> -l hobo wizard rsync --server -logDtpre.iLsfx --timeout<span class="o">=</span><span class="m">1800</span> . cylc-run/suitex
   <span class="c1"># (internal rsync, back from hobo@wizard)</span>
   rsync --server -logDtpre.iLsfx --timeout<span class="o">=</span><span class="m">1800</span> . cylc-run/suitex
</pre></div>
</div>
<p>Result:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span> ~/cylc-run/suitex
<span class="p">|</span>__log-&gt;log.20180418T025047Z  <span class="c1"># LOG DIRECTORIES</span>
<span class="p">|</span>__log.20180418T025047Z  <span class="c1"># log directory for current suite run</span>
<span class="p">|</span>__suiter.rc
<span class="p">|</span>__xxx  <span class="c1"># any suite source sub-dirs or file</span>
<span class="p">|</span>__work  <span class="c1"># JOB WORK DIRECTORIES</span>
<span class="p">|</span>__share  <span class="c1">#  SUITE SHARE DIRECTORY</span>
   <span class="p">|</span>__cycle
</pre></div>
</div>
</div>
<div class="section" id="server-installs-service-directory">
<h5>15.5.3.2. Server installs service directory<a class="headerlink" href="#server-installs-service-directory" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>server address and credentials, so that clients such as
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">message</span></code> executed by jobs can connect</li>
<li>done just before the first job is submitted to a remote, and at
suite restart for the remotes of jobs running when the suite went
down (server host, port, etc. may change at restart)</li>
<li>uses SSH to invoke <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">remote-init</span></code> on job hosts. If the remote command
does not find a server-side UUID file (which would indicate a shared
filesystem) it reads a tar archive of the service directory from stdin, and
unpacks it to install.</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># cylc remote-init: install suite service directory</span>
ssh -oBatchMode<span class="o">=</span>yes -oConnectTimeout<span class="o">=</span><span class="m">10</span> hobo@wizard env <span class="nv">CYLC_VERSION</span><span class="o">=</span><span class="m">7</span>.6.x /opt/bin/cylc remote-init <span class="s1">&#39;066592b1-4525-48b5-b86e-da06eb2380d9&#39;</span> <span class="s1">&#39;$HOME/cylc-run/suitex&#39;</span>
</pre></div>
</div>
<p>Result:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span> ~/cylc-run/suitex
<span class="p">|</span>__.service  <span class="c1"># SUITE SERVICE DIRECTORY</span>
<span class="p">|</span>  <span class="p">|</span>__contact  <span class="c1"># server address information</span>
<span class="p">|</span>  <span class="p">|</span>__passphrase  <span class="c1"># suite passphrase</span>
<span class="p">|</span>  <span class="p">|</span>__ssl.cert  <span class="c1"># suite SSL certificate</span>
<span class="p">|</span>__log-&gt;log.20180418T025047Z  <span class="c1"># LOG DIRECTORIES</span>
<span class="p">|</span>__log.20180418T025047Z  <span class="c1"># log directory for current suite run</span>
<span class="p">|</span>__suiter.rc
<span class="p">|</span>__xxx  <span class="c1"># any suite source sub-dirs or file</span>
<span class="p">|</span>__work  <span class="c1"># JOB WORK DIRECTORIES</span>
<span class="p">|</span>__share  <span class="c1">#  SUITE SHARE DIRECTORY</span>
   <span class="p">|</span>__cycle
</pre></div>
</div>
</div>
<div class="section" id="server-submits-jobs">
<h5>15.5.3.3. Server submits jobs<a class="headerlink" href="#server-submits-jobs" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>done when tasks are ready to run, for multiple jobs at once</li>
<li>uses SSH to invoke <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">jobs-submit</span></code> on the remote - to read job
scripts from stdin, write them to disk, and submit them to run</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># cylc jobs-submit: submit two jobs</span>
ssh -oBatchMode<span class="o">=</span>yes -oConnectTimeout<span class="o">=</span><span class="m">10</span> hobo@wizard env <span class="nv">CYLC_VERSION</span><span class="o">=</span><span class="m">7</span>.6.x /opt/bin/cylc jobs-submit <span class="s1">&#39;--remote-mode&#39;</span> <span class="s1">&#39;--&#39;</span> <span class="s1">&#39;$HOME/cylc-run/suitex/log/job&#39;</span> <span class="s1">&#39;1/remote-a/01&#39;</span> <span class="s1">&#39;1/remote-b/01&#39;</span>
</pre></div>
</div>
<p>Result:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span> ~/cylc-run/suitex
<span class="p">|</span>__.service  <span class="c1"># SUITE SERVICE DIRECTORY</span>
<span class="p">|</span>  <span class="p">|</span>__contact  <span class="c1"># server address information</span>
<span class="p">|</span>  <span class="p">|</span>__passphrase  <span class="c1"># suite passphrase</span>
<span class="p">|</span>  <span class="p">|</span>__ssl.cert  <span class="c1"># suite SSL certificate</span>
<span class="p">|</span>__log-&gt;log.20180418T025047Z  <span class="c1"># LOG DIRECTORIES</span>
<span class="p">|</span>__log.20180418T025047Z  <span class="c1"># log directory for current suite run</span>
<span class="p">|</span>  <span class="p">|</span>__ job  <span class="c1"># job logs (to be distinguished from log/suite/ on the suite host)</span>
<span class="p">|</span>     <span class="p">|</span>__1  <span class="c1"># cycle point</span>
<span class="p">|</span>        <span class="p">|</span>__remote-a  <span class="c1"># task name</span>
<span class="p">|</span>        <span class="p">|</span>  <span class="p">|</span>__01  <span class="c1"># job submit number</span>
<span class="p">|</span>        <span class="p">|</span>  <span class="p">|</span>  <span class="p">|</span>__job  <span class="c1"># job script</span>
<span class="p">|</span>        <span class="p">|</span>  <span class="p">|</span>  <span class="p">|</span>__job.out  <span class="c1"># job stdout</span>
<span class="p">|</span>        <span class="p">|</span>  <span class="p">|</span>  <span class="p">|</span>__job.err  <span class="c1"># job stderr</span>
<span class="p">|</span>        <span class="p">|</span>  <span class="p">|</span>  <span class="p">|</span>__job.status  <span class="c1"># job status</span>
<span class="p">|</span>        <span class="p">|</span>  <span class="p">|</span>__NN-&gt;0l  <span class="c1"># symlink to latest submit number</span>
<span class="p">|</span>        <span class="p">|</span>__remote-b  <span class="c1"># task name</span>
<span class="p">|</span>           <span class="p">|</span>__01  <span class="c1"># job submit number</span>
<span class="p">|</span>           <span class="p">|</span>  <span class="p">|</span>__job  <span class="c1"># job script</span>
<span class="p">|</span>           <span class="p">|</span>  <span class="p">|</span>__job.out  <span class="c1"># job stdout</span>
<span class="p">|</span>           <span class="p">|</span>  <span class="p">|</span>__job.err  <span class="c1"># job stderr</span>
<span class="p">|</span>           <span class="p">|</span>  <span class="p">|</span>__job.status  <span class="c1"># job status</span>
<span class="p">|</span>           <span class="p">|</span>__NN-&gt;0l  <span class="c1"># symlink to latest submit number</span>
<span class="p">|</span>__suiter.rc
<span class="p">|</span>__xxx  <span class="c1"># any suite source sub-dirs or file</span>
<span class="p">|</span>__work  <span class="c1"># JOB WORK DIRECTORIES</span>
<span class="p">|</span>  <span class="p">|</span>__1  <span class="c1"># cycle point</span>
<span class="p">|</span>     <span class="p">|</span>__remote-a  <span class="c1"># task name</span>
<span class="p">|</span>     <span class="p">|</span>  <span class="p">|</span>__xxx  <span class="c1"># (any files written by job to PWD)</span>
<span class="p">|</span>     <span class="p">|</span>__remote-b  <span class="c1"># task name</span>
<span class="p">|</span>        <span class="p">|</span>__xxx  <span class="c1"># (any files written by job to PWD)</span>
<span class="p">|</span>__share  <span class="c1">#  SUITE SHARE DIRECTORY</span>
   <span class="p">|</span>__cycle
   <span class="p">|</span>__xxx  <span class="c1"># (any job-created sub-dirs and files)</span>
</pre></div>
</div>
</div>
<div class="section" id="server-tracks-job-progress">
<h5>15.5.3.4. Server tracks job progress<a class="headerlink" href="#server-tracks-job-progress" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>jobs send messages back to the server program on the suite host<ul>
<li>directly: client-server HTTPS over the network (requires service
files installed - see above)</li>
<li>indirectly: re-invoke clients on the suite host (requires reverse SSH)</li>
</ul>
</li>
<li>OR server polls jobs at intervals (requires job polling - see below)</li>
</ul>
</div>
<div class="section" id="user-views-job-logs">
<h5>15.5.3.5. User views job logs<a class="headerlink" href="#user-views-job-logs" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>command <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">cat-log</span></code> via CLI or GUI, invokes itself over SSH to the
remote</li>
<li>suites will serve job logs in future, but this will still be needed
(e.g. if the suite is down)</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># cylc cat-log: view a job log</span>
ssh -oBatchMode<span class="o">=</span>yes -oConnectTimeout<span class="o">=</span><span class="m">10</span> -n hobo@wizard env <span class="nv">CYLC_VERSION</span><span class="o">=</span><span class="m">7</span>.6.x /opt/bin/cylc cat-log --remote-arg<span class="o">=</span><span class="s1">&#39;$HOME/cylc-run/suitex/log/job/1/remote-a/NN/job.out&#39;</span> --remote-arg<span class="o">=</span>cat --remote-arg<span class="o">=</span><span class="s1">&#39;tail -n +1 -F %(filename)s&#39;</span> suitex
</pre></div>
</div>
</div>
<div class="section" id="server-cancels-or-kills-jobs">
<h5>15.5.3.6. Server cancels or kills jobs<a class="headerlink" href="#server-cancels-or-kills-jobs" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>done automatically or via user command <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">kill</span></code>, for
multiple jobs at once</li>
<li>uses SSH to invoke <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">jobs-kill</span></code> on the
remote, with job log paths on the command line. Reads job ID from the
job status file.</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># cylc jobs-kill: kill two jobs</span>
ssh -oBatchMode<span class="o">=</span>yes -oConnectTimeout<span class="o">=</span><span class="m">10</span> hobo@wizard env <span class="nv">CYLC_VERSION</span><span class="o">=</span><span class="m">7</span>.6.x /opt/bin/cylc jobs-kill <span class="s1">&#39;--&#39;</span> <span class="s1">&#39;$HOME/cylc-run/suitex/log/job&#39;</span> <span class="s1">&#39;1/remote-a/01&#39;</span> <span class="s1">&#39;1/remote-b/01&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="server-polls-jobs">
<h5>15.5.3.7. Server polls jobs<a class="headerlink" href="#server-polls-jobs" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>done automatically or via user command <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">poll</span></code>, for
multiple jobs at once</li>
<li>uses SSH to invoke <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">jobs-poll</span></code> on the
remote, with job log paths on the command line. Reads job ID from the
job status file.</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># cylc jobs-poll: poll two jobs</span>
ssh -oBatchMode<span class="o">=</span>yes -oConnectTimeout<span class="o">=</span><span class="m">10</span> hobo@wizard env <span class="nv">CYLC_VERSION</span><span class="o">=</span><span class="m">7</span>.6.x /opt/bin/cylc jobs-poll <span class="s1">&#39;--&#39;</span> <span class="s1">&#39;$HOME/cylc-run/suitex/log/job&#39;</span> <span class="s1">&#39;1/remote-a/01&#39;</span> <span class="s1">&#39;1/remote-b/01&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="server-retrieves-jobs-logs">
<h5>15.5.3.8. Server retrieves jobs logs<a class="headerlink" href="#server-retrieves-jobs-logs" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>done at job completion, according to global config</li>
<li>uses <code class="docutils literal notranslate"><span class="pre">rsync</span></code></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># rsync: retrieve two job logs</span>
rsync -a --rsh<span class="o">=</span>ssh -oBatchMode<span class="o">=</span>yes -oConnectTimeout<span class="o">=</span><span class="m">10</span> --include<span class="o">=</span>/1 --include<span class="o">=</span>/1/remote-a --include<span class="o">=</span>/1/remote-a/01 --include<span class="o">=</span>/1/remote-a/01/** --include<span class="o">=</span>/1/remote-b --include<span class="o">=</span>/1/remote-b/01 --include<span class="o">=</span>/1/remote-b/01/** --exclude<span class="o">=</span>/** hobo@wizard:<span class="nv">$HOME</span>/cylc-run/suitex/log/job/ /home/vagrant/cylc-run/suitex/log/job/
   <span class="c1"># (internal rsync)</span>
   ssh -oBatchMode<span class="o">=</span>yes -oConnectTimeout<span class="o">=</span><span class="m">10</span> -l hobo wizard rsync --server --sender -logDtpre.iLsfx . <span class="nv">$HOME</span>/cylc-run/suitex/log/job/
   <span class="c1"># (internal rsync, back from hobo@wizard)</span>
   rsync --server --sender -logDtpre.iLsfx . /home/hobo/cylc-run/suitex/log/job/
</pre></div>
</div>
</div>
<div class="section" id="server-tidies-job-remote-at-shutdown">
<h5>15.5.3.9. Server tidies job remote at shutdown<a class="headerlink" href="#server-tidies-job-remote-at-shutdown" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>removes <code class="docutils literal notranslate"><span class="pre">.service/contact</span></code> so that clients won’t repeatedly
try to connect</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># cylc remote-tidy: remove the remote suite contact file</span>
ssh -oBatchMode<span class="o">=</span>yes -oConnectTimeout<span class="o">=</span><span class="m">10</span> hobo@wizard env <span class="nv">CYLC_VERSION</span><span class="o">=</span><span class="m">7</span>.6.x /opt/bin/cylc remote-tidy <span class="s1">&#39;$HOME/cylc-run/suitex&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="other-use-of-ssh-in-cylc">
<h4>15.5.4. Other Use of SSH in Cylc<a class="headerlink" href="#other-use-of-ssh-in-cylc" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>see if a suite is running on another host with a shared
filesystem - see <code class="docutils literal notranslate"><span class="pre">detect_old_contact_file()</span></code> in
<code class="docutils literal notranslate"><span class="pre">lib/cylc/suite_srv_files_mgr.py</span></code></li>
<li>cat content of a remote service file over SSH, if possible, for
clients on that do not have suite credentials installed - see
<code class="docutils literal notranslate"><span class="pre">_load_remote_item()</span></code> in <code class="docutils literal notranslate"><span class="pre">suite_srv_files_mgr.py</span></code></li>
</ul>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[4]</a></td><td>Cylc used to run bare shell expressions over SSH, which required
a bash shell and made whitelisting difficult.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[5]</a></td><td>A malicious script could be <code class="docutils literal notranslate"><span class="pre">rsync</span></code>’d and run from a batch
job, but batch jobs are considered easier to audit.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[6]</a></td><td>The job ID must also be valid to query and kill the job via the local
batch system. This is not the case for Slurm, unless the <code class="docutils literal notranslate"><span class="pre">--cluster</span></code>
option is explicitly used in job query and kill commands, otherwise
the job ID is not recognized by the local Slurm instance.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[7]</a></td><td>This would be a more complex solution, in terms of implementation,
administration, and security.</td></tr>
</tbody>
</table>
</div>
</div>
<span id="document-appendices/command-ref"></span><div class="section" id="command-reference">
<span id="commandreference"></span><h3>15.6. Command Reference<a class="headerlink" href="#command-reference" title="Permalink to this headline">¶</a></h3>
<div class="section" id="help">
<span id="id1"></span><h4>15.6.1. Help<a class="headerlink" href="#help" title="Permalink to this headline">¶</a></h4>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Cylc (&quot;silk&quot;) is a workflow engine for orchestrating complex
*suites* of inter-dependent distributed cycling (repeating) tasks, as well as
ordinary non-cycling workflows.
For detailed documentation see the Cylc User Guide (cylc doc --help).

Version 7.8.8

The graphical user interface for cylc is &quot;gcylc&quot; (a.k.a. &quot;cylc gui&quot;).

USAGE:
  % cylc -V,--version,version           # print cylc version
  % cylc version --long                 # print cylc version and path
  % cylc help,--help,-h,?               # print this help page

  % cylc help CATEGORY                  # print help by category
  % cylc CATEGORY help                  # (ditto)
  % cylc help [CATEGORY] COMMAND        # print command help
  % cylc [CATEGORY] COMMAND --help      # (ditto)
  % cylc COMMAND --help                 # (ditto)

  % cylc COMMAND [options] SUITE [arguments]
  % cylc COMMAND [options] SUITE TASK [arguments]

Commands can be abbreviated as long as there is no ambiguity in
the abbreviated command:

  % cylc trigger SUITE TASK             # trigger TASK in SUITE
  % cylc trig SUITE TASK                # ditto
  % cylc tr SUITE TASK                  # ditto

  % cylc get                            # Error: ambiguous command

TASK IDENTIFICATION IN CYLC SUITES
  Tasks are identified by NAME.CYCLE_POINT where POINT is either a
  date-time or an integer.
  Date-time cycle points are in an ISO 8601 date-time format, typically
  CCYYMMDDThhmm followed by a time zone - e.g. 20101225T0600Z.
  Integer cycle points (including those for one-off suites) are integers
  - just &#39;1&#39; for one-off suites.

HOW TO DRILL DOWN TO COMMAND USAGE HELP:
  % cylc help           # list all available categories (this page)
  % cylc help prep      # list commands in category &#39;preparation&#39;
  % cylc help prep edit # command usage help for &#39;cylc [prep] edit&#39;

Command CATEGORIES:
  control ....... Suite start up, monitoring, and control.
  information ... Interrogate suite definitions and running suites.
  all ........... The complete command set.
  task .......... The task messaging interface.
  license|GPL ... Software licensing information (GPL v3.0).
  admin ......... Cylc installation, testing, and example suites.
  preparation ... Suite editing, validation, visualization, etc.
  hook .......... Suite and task event hook scripts.
  discovery ..... Detect running suites.
  utility ....... Cycle arithmetic and templating, etc.
</pre></div>
</div>
</div>
<div class="section" id="command-categories">
<h4>15.6.2. Command Categories<a class="headerlink" href="#command-categories" title="Permalink to this headline">¶</a></h4>
<div class="section" id="admin">
<span id="command-cat-admin"></span><h5>15.6.2.1. admin<a class="headerlink" href="#admin" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   CATEGORY: admin - Cylc installation, testing, and example suites.

HELP: cylc [admin] COMMAND help,--help
  You can abbreviate admin and COMMAND.
  The category admin may be omitted.

COMMANDS:
  check-software .... Check required software is installed
  import-examples ... Import example suites your suite run directory
  profile-battery ... Run a battery of profiling tests
  test-battery ...... Run a battery of self-diagnosing test suites
  upgrade-run-dir ... Upgrade a pre-cylc-6 suite run directory
</pre></div>
</div>
</div>
<div class="section" id="all">
<span id="command-cat-all"></span><h5>15.6.2.2. all<a class="headerlink" href="#all" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   CATEGORY: all - The complete command set.

HELP: cylc [all] COMMAND help,--help
  You can abbreviate all and COMMAND.
  The category all may be omitted.

COMMANDS:
  5to6 ........................................ Improve the cylc 6 compatibility of a cylc 5 suite file
  broadcast|bcast ............................. Change suite [runtime] settings on the fly
  cat-log|log ................................. Print various suite and task log files
  cat-state ................................... Print the state of tasks from the state dump
  check-software .............................. Check required software is installed
  check-triggering ............................ A suite shutdown event hook for cylc testing
  check-versions .............................. Compare cylc versions on task host accounts
  checkpoint .................................. Tell suite to checkpoint its current state
  client ...................................... (Internal) Invoke HTTP(S) client, expect JSON input
  conditions .................................. Print the GNU General Public License v3.0
  cycle-point|cyclepoint|datetime|cycletime ... Cycle point arithmetic and filename templating
  diff|compare ................................ Compare two suite definitions and print differences
  documentation|browse ........................ Display cylc documentation (User Guide etc.)
  dump ........................................ Print the state of tasks in a running suite
  edit ........................................ Edit suite definitions, optionally inlined
  email-suite ................................. A suite event hook script that sends email alerts
  email-task .................................. A task event hook script that sends email alerts
  ext-trigger|external-trigger ................ Report an external trigger event to a suite
  function-run ................................ (Internal) Run a function in the process pool
  get-directory ............................... Retrieve suite source directory paths
  get-gui-config .............................. Print gcylc configuration items
  get-host-metrics ............................ Print localhost metric data
  get-site-config|get-global-config ........... Print site/user configuration items
  get-suite-config|get-config ................. Print suite configuration items
  get-suite-contact|get-contact ............... Print contact information of a suite server program
  get-suite-version|get-cylc-version .......... Print cylc version of a suite server program
  gpanel ...................................... Internal interface for GNOME 2 panel applet
  graph ....................................... Plot suite dependency graphs and runtime hierarchies
  graph-diff .................................. Compare two suite dependencies or runtime hierarchies
  gscan|gsummary .............................. Scan GUI for monitoring multiple suites
  gui ......................................... (a.k.a. gcylc) cylc GUI for suite control etc.
  hold ........................................ Hold (pause) suites or individual tasks
  import-examples ............................. Import example suites your suite run directory
  insert ...................................... Insert tasks into a running suite
  jobs-kill ................................... (Internal) Kill task jobs
  jobs-poll ................................... (Internal) Retrieve status for task jobs
  jobs-submit ................................. (Internal) Submit task jobs
  jobscript ................................... Generate a task job script and print it to stdout
  kill ........................................ Kill submitted or running tasks
  list|ls ..................................... List suite tasks and family namespaces
  ls-checkpoints .............................. Display task pool etc at given events
  message|task-message ........................ Report task messages
  monitor ..................................... An in-terminal suite monitor (see also gcylc)
  nudge ....................................... Cause the cylc task processing loop to be invoked
  ping ........................................ Check that a suite is running
  poll ........................................ Poll submitted or running tasks
  print ....................................... Print registered suites
  profile-battery ............................. Run a battery of profiling tests
  ref-graph ................................... Print text-format &quot;reference graphs&quot; without GTK
  register .................................... Register a suite for use
  release|unhold .............................. Release (unpause) suites or individual tasks
  reload ...................................... Reload the suite definition at run time
  remote-init ................................. (Internal) Initialise a task remote
  remote-tidy ................................. (Internal) Tidy a task remote
  remove ...................................... Remove tasks from a running suite
  report-timings .............................. Generate a report on task timing data
  reset ....................................... Force one or more tasks to change state
  restart ..................................... Restart a suite from a previous state
  review ...................................... Start/stop ad-hoc Cylc Review web service server.
  run|start ................................... Start a suite at a given cycle point
  scan ........................................ Scan a host for running suites
  scp-transfer ................................ Scp-based file transfer for cylc suites
  search|grep ................................. Search in suite definitions
  set-verbosity ............................... Change a running suite&#39;s logging verbosity
  show ........................................ Print task state (prerequisites and outputs etc.)
  spawn ....................................... Force one or more tasks to spawn their successors
  stop|shutdown ............................... Shut down running suites
  submit|single ............................... Run a single task just as its parent suite would
  suite-state ................................. Query the task states in a suite
  test-battery ................................ Run a battery of self-diagnosing test suites
  trigger ..................................... Manually trigger or re-trigger a task
  upgrade-run-dir ............................. Upgrade a pre-cylc-6 suite run directory
  validate .................................... Parse and validate suite definitions
  view ........................................ View suite definitions, inlined and Jinja2 processed
  warranty .................................... Print the GPLv3 disclaimer of warranty
</pre></div>
</div>
</div>
<div class="section" id="control">
<span id="command-cat-control"></span><h5>15.6.2.3. control<a class="headerlink" href="#control" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   CATEGORY: control - Suite start up, monitoring, and control.

HELP: cylc [control] COMMAND help,--help
  You can abbreviate control and COMMAND.
  The category control may be omitted.

COMMANDS:
  broadcast|bcast ................ Change suite [runtime] settings on the fly
  checkpoint ..................... Tell suite to checkpoint its current state
  client ......................... (Internal) Invoke HTTP(S) client, expect JSON input
  ext-trigger|external-trigger ... Report an external trigger event to a suite
  gui ............................ (a.k.a. gcylc) cylc GUI for suite control etc.
  hold ........................... Hold (pause) suites or individual tasks
  insert ......................... Insert tasks into a running suite
  kill ........................... Kill submitted or running tasks
  nudge .......................... Cause the cylc task processing loop to be invoked
  poll ........................... Poll submitted or running tasks
  release|unhold ................. Release (unpause) suites or individual tasks
  reload ......................... Reload the suite definition at run time
  remove ......................... Remove tasks from a running suite
  reset .......................... Force one or more tasks to change state
  restart ........................ Restart a suite from a previous state
  run|start ...................... Start a suite at a given cycle point
  set-verbosity .................. Change a running suite&#39;s logging verbosity
  spawn .......................... Force one or more tasks to spawn their successors
  stop|shutdown .................. Shut down running suites
  trigger ........................ Manually trigger or re-trigger a task
</pre></div>
</div>
</div>
<div class="section" id="discovery">
<span id="command-cat-discovery"></span><h5>15.6.2.4. discovery<a class="headerlink" href="#discovery" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   CATEGORY: discovery - Detect running suites.

HELP: cylc [discovery] COMMAND help,--help
  You can abbreviate discovery and COMMAND.
  The category discovery may be omitted.

COMMANDS:
  check-versions ... Compare cylc versions on task host accounts
  ping ............. Check that a suite is running
  scan ............. Scan a host for running suites
</pre></div>
</div>
</div>
<div class="section" id="hook">
<span id="command-cat-hook"></span><h5>15.6.2.5. hook<a class="headerlink" href="#hook" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   CATEGORY: hook - Suite and task event hook scripts.

HELP: cylc [hook] COMMAND help,--help
  You can abbreviate hook and COMMAND.
  The category hook may be omitted.

COMMANDS:
  check-triggering ... A suite shutdown event hook for cylc testing
  email-suite ........ A suite event hook script that sends email alerts
  email-task ......... A task event hook script that sends email alerts
</pre></div>
</div>
</div>
<div class="section" id="information">
<span id="command-cat-information"></span><h5>15.6.2.6. information<a class="headerlink" href="#information" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   CATEGORY: information - Interrogate suite definitions and running suites.

HELP: cylc [information] COMMAND help,--help
  You can abbreviate information and COMMAND.
  The category information may be omitted.

COMMANDS:
  cat-log|log .......................... Print various suite and task log files
  cat-state ............................ Print the state of tasks from the state dump
  documentation|browse ................. Display cylc documentation (User Guide etc.)
  dump ................................. Print the state of tasks in a running suite
  get-gui-config ....................... Print gcylc configuration items
  get-host-metrics ..................... Print localhost metric data
  get-site-config|get-global-config .... Print site/user configuration items
  get-suite-config|get-config .......... Print suite configuration items
  get-suite-contact|get-contact ........ Print contact information of a suite server program
  get-suite-version|get-cylc-version ... Print cylc version of a suite server program
  gpanel ............................... Internal interface for GNOME 2 panel applet
  gscan|gsummary ....................... Scan GUI for monitoring multiple suites
  gui|gcylc ............................ (a.k.a. gcylc) cylc GUI for suite control etc.
  list|ls .............................. List suite tasks and family namespaces
  monitor .............................. An in-terminal suite monitor (see also gcylc)
  review ............................... Start/stop ad-hoc Cylc Review web service server.
  show ................................. Print task state (prerequisites and outputs etc.)
</pre></div>
</div>
</div>
<div class="section" id="license">
<span id="command-cat-license"></span><h5>15.6.2.7. license<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   CATEGORY: license|GPL - Software licensing information (GPL v3.0).

HELP: cylc [license|GPL] COMMAND help,--help
  You can abbreviate license|GPL and COMMAND.
  The category license|GPL may be omitted.

COMMANDS:
  conditions ... Print the GNU General Public License v3.0
  warranty ..... Print the GPLv3 disclaimer of warranty
</pre></div>
</div>
</div>
<div class="section" id="preparation">
<span id="command-cat-preparation"></span><h5>15.6.2.8. preparation<a class="headerlink" href="#preparation" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   CATEGORY: preparation - Suite editing, validation, visualization, etc.

HELP: cylc [preparation] COMMAND help,--help
  You can abbreviate preparation and COMMAND.
  The category preparation may be omitted.

COMMANDS:
  5to6 ............ Improve the cylc 6 compatibility of a cylc 5 suite file
  diff|compare .... Compare two suite definitions and print differences
  edit ............ Edit suite definitions, optionally inlined
  get-directory ... Retrieve suite source directory paths
  graph ........... Plot suite dependency graphs and runtime hierarchies
  graph-diff ...... Compare two suite dependencies or runtime hierarchies
  jobscript ....... Generate a task job script and print it to stdout
  list|ls ......... List suite tasks and family namespaces
  print ........... Print registered suites
  ref-graph ....... Print text-format &quot;reference graphs&quot; without GTK
  register ........ Register a suite for use
  search|grep ..... Search in suite definitions
  validate ........ Parse and validate suite definitions
  view ............ View suite definitions, inlined and Jinja2 processed
</pre></div>
</div>
</div>
<div class="section" id="task">
<span id="command-cat-task"></span><h5>15.6.2.9. task<a class="headerlink" href="#task" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   CATEGORY: task - The task messaging interface.

HELP: cylc [task] COMMAND help,--help
  You can abbreviate task and COMMAND.
  The category task may be omitted.

COMMANDS:
  jobs-kill .............. (Internal) Kill task jobs
  jobs-poll .............. (Internal) Retrieve status for task jobs
  jobs-submit ............ (Internal) Submit task jobs
  message|task-message ... Report task messages
  remote-init ............ (Internal) Initialise a task remote
  remote-tidy ............ (Internal) Tidy a task remote
  submit|single .......... Run a single task just as its parent suite would
</pre></div>
</div>
</div>
<div class="section" id="utility">
<span id="command-cat-utility"></span><h5>15.6.2.10. utility<a class="headerlink" href="#utility" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   CATEGORY: utility - Cycle arithmetic and templating, etc.

HELP: cylc [utility] COMMAND help,--help
  You can abbreviate utility and COMMAND.
  The category utility may be omitted.

COMMANDS:
  cycle-point|cyclepoint|datetime|cycletime ... Cycle point arithmetic and filename templating
  function-run ................................ (Internal) Run a function in the process pool
  ls-checkpoints .............................. Display task pool etc at given events
  report-timings .............................. Generate a report on task timing data
  scp-transfer ................................ Scp-based file transfer for cylc suites
  suite-state ................................. Query the task states in a suite
</pre></div>
</div>
</div>
</div>
<div class="section" id="commands">
<h4>15.6.3. Commands<a class="headerlink" href="#commands" title="Permalink to this headline">¶</a></h4>
<div class="section" id="to6">
<span id="command-5to6"></span><h5>15.6.3.1. 5to6<a class="headerlink" href="#to6" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [prep] 5to6 FILE

Suggest changes to a cylc 5 suite file to make it more cylc 6 compatible.
This may be a suite.rc file, an include file, or a suite.rc.processed file.

By default, print the changed file to stdout. Lines that have been changed
are marked with &#39;# UPGRADE&#39;. These marker comments are purely for your own
information and should not be included in any changes you make. In
particular, they may break continuation lines.

Lines with &#39;# UPGRADE CHANGE&#39; have been altered.
Lines with &#39;# UPGRADE ... INFO&#39; indicate that manual change is needed.

As of cylc 7, &#39;cylc validate&#39; will no longer print out automatic dependency
section translations. At cylc 6 versions of cylc, &#39;cylc validate&#39; will show
start-up/mixed async replacement R1* section(s). The validity of these can
be highly dependent on the initial cycle point choice (e.g. whether it is
T00 or T12).

This command works best for hour-based cycling - it will always convert
e.g. &#39;foo[T-6]&#39; to &#39;foo[-PT6H]&#39;, even where this is in a monthly or yearly
cycling section graph.

This command is an aid, and is not an auto-upgrader or a substitute for
reading the documentation. The suggested changes must be understood and
checked by hand.

Example usage:

# Print out a file path (FILE) with suggested changes to stdout.
cylc 5to6 FILE

# Replace the file with the suggested changes file.
cylc 5to6 FILE &gt; FILE

# Save a copy of the changed file.
cylc 5to6 FILE &gt; FILE.5to6

# Show the diff of the changed file vs the original file.
diff - &lt;(cylc 5to6 FILE) &lt;FILE

Options:
  -h, --help   Print this help message and exit.
</pre></div>
</div>
</div>
<div class="section" id="broadcast">
<span id="command-broadcast"></span><h5>15.6.3.2. broadcast<a class="headerlink" href="#broadcast" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [control] broadcast|bcast [OPTIONS] REG

Override [runtime] config in targeted namespaces in a running suite.

Uses for broadcast include making temporary changes to task behaviour,
and task-to-downstream-task communication via environment variables.

A broadcast can target any [runtime] namespace for all cycles or for a
specific cycle.  If a task is affected by specific-cycle and all-cycle
broadcasts at once, the specific takes precedence. If a task is affected
by broadcasts to multiple ancestor namespaces, the result is determined
by normal [runtime] inheritance. In other words, it follows this order:

all:root -&gt; all:FAM -&gt; all:task -&gt; tag:root -&gt; tag:FAM -&gt; tag:task

Broadcasts persist, even across suite restarts, until they expire when
their target cycle point is older than the oldest current in the suite,
or until they are explicitly cancelled with this command.  All-cycle
broadcasts do not expire.

For each task the final effect of all broadcasts to all namespaces is
computed on the fly just prior to job submission.  The --cancel and
--clear options simply cancel (remove) active broadcasts, they do not
act directly on the final task-level result. Consequently, for example,
you cannot broadcast to &quot;all cycles except Tn&quot; with an all-cycle
broadcast followed by a cancel to Tn (there is no direct broadcast to Tn
to cancel); and you cannot broadcast to &quot;all members of FAMILY except
member_n&quot; with a general broadcast to FAMILY followed by a cancel to
member_n (there is no direct broadcast to member_n to cancel).

To broadcast a variable to all tasks (quote items with internal spaces):
  % cylc broadcast -s &quot;[environment]VERSE = the quick brown fox&quot; REG
To do the same with a file:
  % cat &gt;&#39;broadcast.rc&#39; &lt;&lt;&#39;__RC__&#39;
  % [environment]
  %     VERSE = the quick brown fox
  % __RC__
  % cylc broadcast -F &#39;broadcast.rc&#39; REG
To cancel the same broadcast:
  % cylc broadcast --cancel &quot;[environment]VERSE&quot; REG
If -F FILE was used, the same file can be used to cancel the broadcast:
  % cylc broadcast -G &#39;broadcast.rc&#39; REG

Use -d/--display to see active broadcasts. Multiple --cancel options or
multiple --set and --set-file options can be used on the same command line.
Multiple --set and --set-file options are cumulative.

The --set-file=FILE option can be used when broadcasting multiple values, or
when the value contains newline or other metacharacters. If FILE is &quot;-&quot;, read
from standard input.

Broadcast cannot change [runtime] inheritance.

See also &#39;cylc reload&#39; - reload a modified suite definition at run time.

Arguments:
   REG               Suite name

Options:
  -h, --help            show this help message and exit
  -p CYCLE_POINT, --point=CYCLE_POINT
                        Target cycle point. More than one can be added.
                        Defaults to &#39;*&#39; with --set and --cancel, and nothing
                        with --clear.
  -n NAME, --namespace=NAME
                        Target namespace. Defaults to &#39;root&#39; with --set and
                        --cancel, and nothing with --clear.
  -s [SEC]ITEM=VALUE, --set=[SEC]ITEM=VALUE
                        A [runtime] config item and value to broadcast.
  -F FILE, --set-file=FILE, --file=FILE
                        File with config to broadcast. Can be used multiple
                        times.
  -c [SEC]ITEM, --cancel=[SEC]ITEM
                        An item-specific broadcast to cancel.
  -G FILE, --cancel-file=FILE
                        File with broadcasts to cancel. Can be used multiple
                        times.
  -C, --clear           Cancel all broadcasts, or with -p/--point,
                        -n/--namespace, cancel all broadcasts to targeted
                        namespaces and/or cycle points. Use &quot;-C -p &#39;*&#39;&quot; to
                        cancel all all-cycle broadcasts without canceling all
                        specific-cycle broadcasts.
  -e CYCLE_POINT, --expire=CYCLE_POINT
                        Cancel any broadcasts that target cycle points earlier
                        than, but not inclusive of, CYCLE_POINT.
  -d, --display         Display active broadcasts.
  -k TASKID, --display-task=TASKID
                        Print active broadcasts for a given task
                        (NAME.CYCLE_POINT).
  -b, --box             Use unicode box characters with -d, -k.
  -r, --raw             With -d/--display or -k/--display-task, write out the
                        broadcast config structure in raw Python form.
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --comms-timeout=SEC, --pyro-timeout=SEC
                        Set a timeout for network connections to the running
                        suite. The default is no timeout. For task messaging
                        connections see site/user config file documentation.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
  -f, --force           Do not ask for confirmation before acting. Note that
                        it is not necessary to use this option if interactive
                        command prompts have been disabled in the site/user
                        config files.
</pre></div>
</div>
</div>
<div class="section" id="cat-log">
<span id="command-cat-log"></span><h5>15.6.3.3. cat-log<a class="headerlink" href="#cat-log" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [info] cat-log|log [OPTIONS] REG [TASK-ID]

Print, view-in-editor, or tail-follow content, print path, or list directory,
of local or remote task job and suite server logs. Batch-system view commands
(e.g. &#39;qcat&#39;) are used if defined in global config and the job is running.

For standard log types use the short-cut option argument or full filename (e.g.
for job stdout &quot;-f o&quot; or &quot;-f job.out&quot; will do).

To list the local job log directory of a remote task, choose &quot;-m l&quot; (directory
list mode) and a local file, e.g. &quot;-f a&quot; (job-activity.log).

If remote job logs are retrieved to the suite host on completion (global config
&#39;[JOB-HOST]retrieve job logs = True&#39;) and the job is not currently running, the
local (retrieved) log will be accessed unless &#39;-o/--force-remote&#39; is used.

Custom job logs (written to $CYLC_TASK_LOG_DIR on the job host) are available
from the GUI if listed in &#39;extra log files&#39; in the suite definition. The file
name must be given here, but can be discovered with &#39;--mode=l&#39; (list-dir).

The correct cycle point format of the suite must be for task job logs.

Note the --host/user options are not needed to view remote job logs. They are
the general command reinvocation options for sites using ssh-based task
messaging.

Arguments:
   REG                     Suite name
   [TASK-ID]               Task ID

Options:
  -h, --help            show this help message and exit
  -f LOG, --file=LOG      Job log: a(job-activity.log), e(job.err), d(job-
                        edit.diff), j(job), o(job.out), s(job.status),
                        x(job.xtrace); default o(out).  Or &lt;filename&gt; for
                        custom (and standard) job logs.
  -m MODE, --mode=MODE  Mode: c(cat), e(edit), d(print-dir), l(list-dir),
                        p(print), t(tail). Default c(cat).
  -r INT, --rotation=INT
                        Suite log integer rotation number. 0 for current, 1
                        for next oldest, etc.
  -o, --force-remote    View remote logs remotely even if they have been
                        retrieved to the suite host (default False).
  -s INT, -t INT, --submit-number=INT, --try-number=INT
                        Job submit number (default=NN, i.e. latest).
  -g, --geditor         edit mode: use your configured GUI editor.
  --remote-arg=REMOTE_ARGS
                        (for internal use: continue processing on job host)
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
</pre></div>
</div>
</div>
<div class="section" id="cat-state">
<span id="command-cat-state"></span><h5>15.6.3.4. cat-state<a class="headerlink" href="#cat-state" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [info] cat-state [OPTIONS] REG

Print the suite state in the old state dump file format to stdout.
This command is deprecated; use &quot;cylc ls-checkpoints&quot; instead.

Arguments:
   REG               Suite name

Options:
  -h, --help     show this help message and exit
  -d, --dump     Use the same display format as the &#39;cylc dump&#39; command.
  --user=USER    Other user account name. This results in command reinvocation
                 on the remote account.
  --host=HOST    Other host name. This results in command reinvocation on the
                 remote account.
  -v, --verbose  Verbose output mode.
  --debug        Output developer information and show exception tracebacks.
</pre></div>
</div>
</div>
<div class="section" id="check-software">
<span id="command-check-software"></span><h5>15.6.3.5. check-software<a class="headerlink" href="#check-software" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   cylc [admin] check-software [MODULES]

Check for Cylc external software dependencices, including minimum versions.

With no arguments, prints a table of results for all core &amp; optional external
module requirements, grouped by functionality. With module argument(s),
provides an exit status for the collective result of checks on those modules.

Arguments:
    [MODULES]   Modules to include in the software check, which returns a
                zero (&#39;pass&#39;) or non-zero (&#39;fail&#39;) exit status, where the
                integer is equivalent to the number of modules failing. Run
                the bare check-software command to view the full list of
                valid module arguments (lower-case equivalents accepted).
</pre></div>
</div>
</div>
<div class="section" id="check-triggering">
<span id="command-check-triggering"></span><h5>15.6.3.6. check-triggering<a class="headerlink" href="#check-triggering" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   cylc [hook] check-triggering ARGS

This is a cylc shutdown event handler that compares the newly generated
suite log with a previously generated reference log &quot;reference.log&quot;
stored in the suite definition directory. Currently it just compares
runtime triggering information, disregarding event order and timing, and
fails the suite if there is any difference. This should be sufficient to
verify correct scheduling of any suite that is not affected by different
run-to-run conditional triggering.

1) run your suite with &quot;cylc run --generate-reference-log&quot; to generate
the reference log with resolved triggering information. Check manually
that the reference run was correct.
2) run reference tests with &quot;cylc run --reference-test&quot; - this
automatically sets the shutdown event handler along with a suite timeout
and &quot;abort if shutdown handler fails&quot;, &quot;abort on timeout&quot;, and &quot;abort if
any task fails&quot;.

Reference tests can use any run mode:
 * simulation mode - tests that scheduling is equivalent to the reference
 * dummy mode - also tests that task hosting, job submission, job script
   evaluation, and cylc messaging are not broken.
 * live mode - tests everything (but takes longer with real tasks!)

 If any task fails, or if cylc itself fails, or if triggering is not
 equivalent to the reference run, the test will abort with non-zero exit
 status - so reference tests can be used as automated tests to check
 that changes to cylc have not broken your suites.
</pre></div>
</div>
</div>
<div class="section" id="check-versions">
<span id="command-check-versions"></span><h5>15.6.3.7. check-versions<a class="headerlink" href="#check-versions" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [discovery] check-versions [OPTIONS] SUITE

Check the version of cylc invoked on each of SUITE&#39;s task host accounts when
CYLC_VERSION is set to *the version running this command line tool*.
Different versions are reported but are not considered an error unless the
-e|--error option is specified, because different cylc versions from 6.0.0
onward should at least be backward compatible.

It is recommended that cylc versions be installed in parallel and access
configured via the cylc version wrapper as described in the cylc INSTALL
file and User Guide. This must be done on suite and task hosts. Users then get
the latest installed version by default, or (like tasks) a particular version
if $CYLC_VERSION is defined.

Use -v/--verbose to see the command invoked to determine the remote version
(all remote cylc command invocations will be of the same form, which may be
site dependent -- see cylc global config documentation.

Arguments:
   SUITE               Suite name or path

Options:
  -h, --help            show this help message and exit
  -e, --error           Exit with error status if 7.8.8 is not available on
                        all remote accounts.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --suite-owner=OWNER   Specify suite owner
  -s NAME=VALUE, --set=NAME=VALUE
                        Set the value of a Jinja2 template variable in the
                        suite definition. This option can be used multiple
                        times on the command line. NOTE: these settings
                        persist across suite restarts, but can be set again on
                        the &quot;cylc restart&quot; command line if they need to be
                        overridden.
  --set-file=FILE       Set the value of Jinja2 template variables in the
                        suite definition from a file containing NAME=VALUE
                        pairs (one per line). NOTE: these settings persist
                        across suite restarts, but can be set again on the
                        &quot;cylc restart&quot; command line if they need to be
                        overridden.
</pre></div>
</div>
</div>
<div class="section" id="checkpoint">
<span id="command-checkpoint"></span><h5>15.6.3.8. checkpoint<a class="headerlink" href="#checkpoint" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [control] checkpoint [OPTIONS] REG CHECKPOINT-NAME

Tell suite to checkpoint its current state.


Arguments:
   REG                           Suite name
   CHECKPOINT-NAME               Checkpoint name

Options:
  -h, --help            show this help message and exit
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --comms-timeout=SEC, --pyro-timeout=SEC
                        Set a timeout for network connections to the running
                        suite. The default is no timeout. For task messaging
                        connections see site/user config file documentation.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
  -f, --force           Do not ask for confirmation before acting. Note that
                        it is not necessary to use this option if interactive
                        command prompts have been disabled in the site/user
                        config files.
</pre></div>
</div>
</div>
<div class="section" id="client">
<span id="command-client"></span><h5>15.6.3.9. client<a class="headerlink" href="#client" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc client [OPTIONS] METHOD [REG]

(This command is for internal use.)
Invoke HTTP(S) client, expect JSON from STDIN for keyword arguments.
Use the -n option if client function requires no keyword arguments.


Arguments:
   METHOD               Network API function name
   [REG]                Suite name

Options:
  -h, --help            show this help message and exit
  -n, --no-input        Do not read from STDIN, assume null input
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --comms-timeout=SEC, --pyro-timeout=SEC
                        Set a timeout for network connections to the running
                        suite. The default is no timeout. For task messaging
                        connections see site/user config file documentation.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
  -f, --force           Do not ask for confirmation before acting. Note that
                        it is not necessary to use this option if interactive
                        command prompts have been disabled in the site/user
                        config files.
</pre></div>
</div>
</div>
<div class="section" id="conditions">
<span id="command-conditions"></span><h5>15.6.3.10. conditions<a class="headerlink" href="#conditions" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [license] warranty [--help]
Cylc is release under the GNU General Public License v3.0
This command prints the GPL v3.0 license in full.

Options:
  --help   Print this usage message.
</pre></div>
</div>
</div>
<div class="section" id="cycle-point">
<span id="command-cycle-point"></span><h5>15.6.3.11. cycle-point<a class="headerlink" href="#cycle-point" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [util] cycle-point [OPTIONS] [POINT]

Cycle point date-time offset computation, and filename templating.

Filename templating replaces elements of a template string with corresponding
elements of the current or given cycle point.

Use ISO 8601 or posix date-time format elements:
  % cylc cyclepoint 2010080T00 --template foo-CCYY-MM-DD-Thh.nc
  foo-2010-08-08-T00.nc
  % cylc cyclepoint 2010080T00 --template foo-%Y-%m-%d-T%H.nc
  foo-2010-08-08-T00.nc

Other examples:

1) print offset from an explicit cycle point:
  % cylc [util] cycle-point --offset-hours=6 20100823T1800Z
  20100824T0000Z

2) print offset from $CYLC_TASK_CYCLE_POINT (as in suite tasks):
  % export CYLC_TASK_CYCLE_POINT=20100823T1800Z
  % cylc cycle-point --offset-hours=-6
  20100823T1200Z

3) cycle point filename templating, explicit template:
  % export CYLC_TASK_CYCLE_POINT=2010-08
  % cylc cycle-point --offset-years=2 --template=foo-CCYY-MM.nc
  foo-2012-08.nc

4) cycle point filename templating, template in a variable:
  % export CYLC_TASK_CYCLE_POINT=2010-08
  % export MYTEMPLATE=foo-CCYY-MM.nc
  % cylc cycle-point --offset-years=2 --template=MYTEMPLATE
  foo-2012-08.nc

Arguments:
   [POINT]               ISO8601 date-time, default=$CYLC_TASK_CYCLE_POINT

Options:
  -h, --help            show this help message and exit
  --offset-hours=HOURS  Add N hours to CYCLE (may be negative)
  --offset-days=DAYS    Add N days to CYCLE (N may be negative)
  --offset-months=MONTHS
                        Add N months to CYCLE (N may be negative)
  --offset-years=YEARS  Add N years to CYCLE (N may be negative)
  --offset=ISO_OFFSET   Add an ISO 8601-based interval representation to CYCLE
  --equal=POINT2        Succeed if POINT2 is equal to POINT (format agnostic).
  --template=TEMPLATE   Filename template string or variable
  --time-zone=TEMPLATE  Control the formatting of the result&#39;s timezone e.g.
                        (Z, +13:00, -hh
  --num-expanded-year-digits=NUMBER
                        Specify a number of expanded year digits to print in
                        the result
  --print-year          Print only CCYY of result
  --print-month         Print only MM of result
  --print-day           Print only DD of result
  --print-hour          Print only hh of result
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
</pre></div>
</div>
</div>
<div class="section" id="diff">
<span id="command-diff"></span><h5>15.6.3.12. diff<a class="headerlink" href="#diff" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [prep] diff|compare [OPTIONS] SUITE1 SUITE2

Compare two suite definitions and display any differences.

Differencing is done after parsing the suite.rc files so it takes
account of default values that are not explicitly defined, it disregards
the order of configuration items, and it sees any include-file content
after inlining has occurred.

Files in the suite bin directory and other sub-directories of the
suite definition directory are not currently differenced.

Arguments:
   SUITE1               Suite name or path
   SUITE2               Suite name or path

Options:
  -h, --help            show this help message and exit
  -n, --nested          print suite.rc section headings in nested form.
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --suite-owner=OWNER   Specify suite owner
  -s NAME=VALUE, --set=NAME=VALUE
                        Set the value of a Jinja2 template variable in the
                        suite definition. This option can be used multiple
                        times on the command line. NOTE: these settings
                        persist across suite restarts, but can be set again on
                        the &quot;cylc restart&quot; command line if they need to be
                        overridden.
  --set-file=FILE       Set the value of Jinja2 template variables in the
                        suite definition from a file containing NAME=VALUE
                        pairs (one per line). NOTE: these settings persist
                        across suite restarts, but can be set again on the
                        &quot;cylc restart&quot; command line if they need to be
                        overridden.
  --initial-cycle-point=CYCLE_POINT, --initial-point=CYCLE_POINT, --icp=CYCLE_POINT, --ict=CYCLE_POINT
                        Set the initial cycle point. Required if not defined
                        in suite.rc.
</pre></div>
</div>
</div>
<div class="section" id="documentation">
<span id="command-documentation"></span><h5>15.6.3.13. documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [info] documentation|browse [OPTIONS] [TARGET]

View documentation in the browser, as per Cylc global config.

% cylc doc [OPTIONS]
   View local or internet [--www] Cylc documentation URLs.

% cylc doc [-t TASK] SUITE
    View suite or task documentation, if URLs are specified in the suite. This
    parses the suite definition to extract the requested URL. Note that suite
    server programs also hold suite URLs for access from the Cylc GUI.

Arguments:
   [TARGET]               File or suite name

Options:
  -h, --help            show this help message and exit
  -g, --guides          Open the HTML (User &amp; Suite Design) Guides directly.
  -w, --www             Open the cylc internet homepage
  -t TASK_NAME, --task=TASK_NAME
                        Browse task documentation URLs.
  -s, --stdout          Just print the URL to stdout.
  --debug               Print exception traceback on error.
  --url=URL             URL to view in your configured browser.
  -v, --verbose         Verbose output mode.
</pre></div>
</div>
</div>
<div class="section" id="dump">
<span id="command-dump"></span><h5>15.6.3.14. dump<a class="headerlink" href="#dump" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [info] dump [OPTIONS] REG

Print state information (e.g. the state of each task) from a running
suite. For small suites &#39;watch cylc [info] dump SUITE&#39; is an effective
non-GUI real time monitor (but see also &#39;cylc monitor&#39;).

For more information about a specific task, such as the current state of
its prerequisites and outputs, see &#39;cylc [info] show&#39;.

Examples:
 Display the state of all running tasks, sorted by cycle point:
 % cylc [info] dump --tasks --sort SUITE | grep running

 Display the state of all tasks in a particular cycle point:
 % cylc [info] dump -t SUITE | grep 2010082406

Arguments:
   REG               Suite name

Options:
  -h, --help            show this help message and exit
  -g, --global          Global information only.
  -t, --tasks           Task states only.
  -r, --raw, --raw-format
                        Display raw format.
  -s, --sort            Task states only; sort by cycle point instead of name.
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --comms-timeout=SEC, --pyro-timeout=SEC
                        Set a timeout for network connections to the running
                        suite. The default is no timeout. For task messaging
                        connections see site/user config file documentation.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
</pre></div>
</div>
</div>
<div class="section" id="edit">
<span id="command-edit"></span><h5>15.6.3.15. edit<a class="headerlink" href="#edit" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [prep] edit [OPTIONS] SUITE

Edit suite definitions without having to move to their directory
locations, and with optional reversible inlining of include-files. Note
that Jinja2 suites can only be edited in raw form but the processed
version can be viewed with &#39;cylc [prep] view -p&#39;.

1/cylc [prep] edit SUITE
Change to the suite definition directory and edit the suite.rc file.

2/ cylc [prep] edit -i,--inline SUITE
Edit the suite with include-files inlined between special markers. The
original suite.rc file is temporarily replaced so that the inlined
version is &quot;live&quot; during editing (i.e. you can run suites during
editing and cylc will pick up changes to the suite definition). The
inlined file is then split into its constituent include-files
again when you exit the editor. Include-files can be nested or
multiply-included; in the latter case only the first inclusion is
inlined (this prevents conflicting changes made to the same file).

3/ cylc [prep] edit --cleanup SUITE
Remove backup files left by previous INLINED edit sessions.

INLINED EDITING SAFETY: The suite.rc file and its include-files are
automatically backed up prior to an inlined editing session. If the
editor dies mid-session just invoke &#39;cylc edit -i&#39; again to recover from
the last saved inlined file. On exiting the editor, if any of the
original include-files are found to have changed due to external
intervention during editing you will be warned and the affected files
will be written to new backups instead of overwriting the originals.
Finally, the inlined suite.rc file is also backed up on exiting
the editor, to allow recovery in case of accidental corruption of the
include-file boundary markers in the inlined file.

The edit process is spawned in the foreground as follows:
  % &lt;editor&gt; suite.rc
Where &lt;editor&gt; is defined in the cylc site/user config files.

See also &#39;cylc [prep] view&#39;.

Arguments:
   SUITE               Suite name or path

Options:
  -h, --help           show this help message and exit
  -i, --inline         Edit with include-files inlined as described above.
  --cleanup            Remove backup files left by previous inlined edit
                       sessions.
  -g, --gui            Force use of the configured GUI editor.
  --user=USER          Other user account name. This results in command
                       reinvocation on the remote account.
  --host=HOST          Other host name. This results in command reinvocation
                       on the remote account.
  -v, --verbose        Verbose output mode.
  --debug              Output developer information and show exception
                       tracebacks.
  --suite-owner=OWNER  Specify suite owner
</pre></div>
</div>
</div>
<div class="section" id="email-suite">
<span id="command-email-suite"></span><h5>15.6.3.16. email-suite<a class="headerlink" href="#email-suite" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [hook] email-suite EVENT SUITE MESSAGE

THIS COMMAND IS OBSOLETE - use built-in email event hooks.

This is a simple suite event hook script that sends an email.
The command line arguments are supplied automatically by cylc.

For example, to get an email alert when a suite shuts down:

# SUITE.RC
[cylc]
   [[environment]]
      MAIL_ADDRESS = foo@bar.baz.waz
   [[events]]
      shutdown handler = cylc email-suite

See the Suite.rc Reference (Cylc User Guide) for more information
on suite and task event hooks and event handler scripts.
</pre></div>
</div>
</div>
<div class="section" id="email-task">
<span id="command-email-task"></span><h5>15.6.3.17. email-task<a class="headerlink" href="#email-task" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [hook] email-task EVENT SUITE TASKID MESSAGE

THIS COMMAND IS OBSOLETE - use built-in email event hooks.

A simple task event hook handler script that sends an email.
The command line arguments are supplied automatically by cylc.

For example, to get an email alert whenever any task fails:

# SUITE.RC
[cylc]
   [[environment]]
      MAIL_ADDRESS = foo@bar.baz.waz
[runtime]
   [[root]]
      [[[events]]]
         failed handler = cylc email-task

See the Suite.rc Reference (Cylc User Guide) for more information
on suite and task event hooks and event handler scripts.
</pre></div>
</div>
</div>
<div class="section" id="ext-trigger">
<span id="command-ext-trigger"></span><h5>15.6.3.18. ext-trigger<a class="headerlink" href="#ext-trigger" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [control] ext-trigger [OPTIONS] REG MSG ID

Report an external event message to a suite server program. It is expected that
a task in the suite has registered the same message as an external trigger - a
special prerequisite to be satisifed by an external system, via this command,
rather than by triggering off other tasks.

The ID argument should uniquely distinguish one external trigger event from the
next. When a task&#39;s external trigger is satisfied by an incoming message, the
message ID is broadcast to all downstream tasks in the cycle point as
$CYLC_EXT_TRIGGER_ID so that they can use it - e.g. to identify a new data file
that the external triggering system is responding to.

Use the retry options in case the target suite is down or out of contact.

The suite passphrase must be installed in $HOME/.cylc/&lt;SUITE&gt;/.

Note: to manually trigger a task use &#39;cylc trigger&#39;, not this command.

Arguments:
   REG               Suite name
   MSG               External trigger message
   ID                Unique trigger ID

Options:
  -h, --help            show this help message and exit
  --max-tries=INT       Maximum number of send attempts (default 5).
  --retry-interval=SEC  Delay in seconds before retrying (default 10.0).
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --comms-timeout=SEC, --pyro-timeout=SEC
                        Set a timeout for network connections to the running
                        suite. The default is no timeout. For task messaging
                        connections see site/user config file documentation.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
  -f, --force           Do not ask for confirmation before acting. Note that
                        it is not necessary to use this option if interactive
                        command prompts have been disabled in the site/user
                        config files.
</pre></div>
</div>
</div>
<div class="section" id="function-run">
<span id="command-function-run"></span><h5>15.6.3.19. function-run<a class="headerlink" href="#function-run" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   USAGE: cylc function-run &lt;name&gt; &lt;json-args&gt; &lt;json-kwargs&gt; &lt;src-dir&gt;

INTERNAL USE (asynchronous external trigger function execution)

Run a Python function &quot;&lt;name&gt;(*args, **kwargs)&quot; in the process pool. It must be
defined in a module of the same name. Positional and keyword arguments must be
passed in as JSON strings. &lt;src-dir&gt; is the suite source dir, needed to find
local xtrigger modules.
</pre></div>
</div>
</div>
<div class="section" id="get-directory">
<span id="command-get-directory"></span><h5>15.6.3.20. get-directory<a class="headerlink" href="#get-directory" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [prep] get-directory REG

Retrieve and print the source directory location of suite REG.
Here&#39;s an easy way to move to a suite source directory:
  $ cd $(cylc get-dir REG).

Arguments:
   SUITE               Suite name or path

Options:
  -h, --help           show this help message and exit
  --user=USER          Other user account name. This results in command
                       reinvocation on the remote account.
  --host=HOST          Other host name. This results in command reinvocation
                       on the remote account.
  -v, --verbose        Verbose output mode.
  --debug              Output developer information and show exception
                       tracebacks.
  --suite-owner=OWNER  Specify suite owner
</pre></div>
</div>
</div>
<div class="section" id="get-gui-config">
<span id="command-get-gui-config"></span><h5>15.6.3.21. get-gui-config<a class="headerlink" href="#get-gui-config" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [admin] get-gui-config [OPTIONS]

Print gcylc configuration settings.

By default all settings are printed. For specific sections or items
use -i/--item and wrap parent sections in square brackets:
   cylc get-gui-config --item &#39;[themes][default]succeeded&#39;
Multiple items can be specified at once.

Options:
  -h, --help            show this help message and exit
  -i [SEC...]ITEM, --item=[SEC...]ITEM
                        Item or section to print (multiple use allowed).
  --sparse              Only print items explicitly set in the config files.
  -p, --python          Print native Python format.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
</pre></div>
</div>
</div>
<div class="section" id="get-host-metrics">
<span id="command-get-host-metrics"></span><h5>15.6.3.22. get-host-metrics<a class="headerlink" href="#get-host-metrics" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc get-host-metrics [OPTIONS]

Get metrics for localhost, in the form of a JSON structure with top-level
keys as requested via the OPTIONS:

1. --load
       1, 5 and 15 minute load averages (as keys) from the &#39;uptime&#39; command.
2. --memory
       Total free RAM memory, in kilobytes, from the &#39;free -k&#39; command.
3. --disk-space=PATH / --disk-space=PATH1,PATH2,PATH3 (etc)
       Available disk space from the &#39;df -Pk&#39; command, in kilobytes, for one
       or more valid mount directory PATHs (as listed under &#39;Mounted on&#39;)
       within the filesystem of localhost. Multiple PATH options can be
       specified via a comma-delimited list, each becoming a key under the
       top-level disk space key.

If no options are specified, --load and --memory are invoked by default.


Options:
  -h, --help         show this help message and exit
  -l, --load         1, 5 and 15 minute load averages from the &#39;uptime&#39;
                     command.
  -m, --memory       Total memory not in use by the system, buffer or cache,
                     in KB, from &#39;/proc/meminfo&#39;.
  --disk-space=DISK  Available disk space, in KB, from the &#39;df -Pk&#39; command.
</pre></div>
</div>
</div>
<div class="section" id="get-site-config">
<span id="command-get-site-config"></span><h5>15.6.3.23. get-site-config<a class="headerlink" href="#get-site-config" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [admin] get-site-config [OPTIONS]

Print cylc site/user configuration settings.

By default all settings are printed. For specific sections or items
use -i/--item and wrap parent sections in square brackets:
   cylc get-site-config --item &#39;[editors]terminal&#39;
Multiple items can be specified at once.

Options:
  -h, --help            show this help message and exit
  -i [SEC...]ITEM, --item=[SEC...]ITEM
                        Item or section to print (multiple use allowed).
  --sparse              Only print items explicitly set in the config files.
  -p, --python          Print native Python format.
  --print-run-dir       Print the configured cylc run directory.
  --print-site-dir      Print the cylc site configuration directory location.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
</pre></div>
</div>
</div>
<div class="section" id="get-suite-config">
<span id="command-get-suite-config"></span><h5>15.6.3.24. get-suite-config<a class="headerlink" href="#get-suite-config" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [info] get-suite-config [OPTIONS] SUITE

Print parsed suite configuration items, after runtime inheritance.

By default all settings are printed. For specific sections or items
use -i/--item and wrap sections in square brackets, e.g.:
   cylc get-suite-config --item &#39;[scheduling]initial cycle point&#39;
Multiple items can be retrieved at once.

By default, unset values are printed as an empty string, or (for
historical reasons) as &quot;None&quot; with -o/--one-line. These defaults
can be changed with the -n/--null-value option.

Example:
  |# SUITE.RC
  |[runtime]
  |    [[modelX]]
  |        [[[environment]]]
  |            FOO = foo
  |            BAR = bar

$ cylc get-suite-config --item=[runtime][modelX][environment]FOO SUITE
foo

$ cylc get-suite-config --item=[runtime][modelX][environment] SUITE
FOO = foo
BAR = bar

$ cylc get-suite-config --item=[runtime][modelX] SUITE
...
[[[environment]]]
    FOO = foo
    BAR = bar
...

Arguments:
   SUITE               Suite name or path

Options:
  -h, --help            show this help message and exit
  -i [SEC...]ITEM, --item=[SEC...]ITEM
                        Item or section to print (multiple use allowed).
  -r, --sparse          Only print items explicitly set in the config files.
  -p, --python          Print native Python format.
  -a, --all-tasks       For [runtime] items (e.g. --item=&#39;script&#39;) report
                        values for all tasks prefixed by task name.
  -n STRING, --null-value=STRING
                        The string to print for unset values (default
                        nothing).
  -m, --mark-up         Prefix each line with &#39;!cylc!&#39;.
  -o, --one-line        Print multiple single-value items at once.
  -t, --tasks           Print the suite task list [DEPRECATED: use &#39;cylc list
                        SUITE&#39;].
  -u RUN_MODE, --run-mode=RUN_MODE
                        Get config for suite run mode.
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --suite-owner=OWNER   Specify suite owner
  -s NAME=VALUE, --set=NAME=VALUE
                        Set the value of a Jinja2 template variable in the
                        suite definition. This option can be used multiple
                        times on the command line. NOTE: these settings
                        persist across suite restarts, but can be set again on
                        the &quot;cylc restart&quot; command line if they need to be
                        overridden.
  --set-file=FILE       Set the value of Jinja2 template variables in the
                        suite definition from a file containing NAME=VALUE
                        pairs (one per line). NOTE: these settings persist
                        across suite restarts, but can be set again on the
                        &quot;cylc restart&quot; command line if they need to be
                        overridden.
  --initial-cycle-point=CYCLE_POINT, --initial-point=CYCLE_POINT, --icp=CYCLE_POINT, --ict=CYCLE_POINT
                        Set the initial cycle point. Required if not defined
                        in suite.rc.
</pre></div>
</div>
</div>
<div class="section" id="get-suite-contact">
<span id="command-get-suite-contact"></span><h5>15.6.3.25. get-suite-contact<a class="headerlink" href="#get-suite-contact" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [info] get-suite-contact [OPTIONS] REG

Print contact information of running suite REG.

Arguments:
   REG               Suite name

Options:
  -h, --help     show this help message and exit
  --user=USER    Other user account name. This results in command reinvocation
                 on the remote account.
  --host=HOST    Other host name. This results in command reinvocation on the
                 remote account.
  -v, --verbose  Verbose output mode.
  --debug        Output developer information and show exception tracebacks.
</pre></div>
</div>
</div>
<div class="section" id="get-suite-version">
<span id="command-get-suite-version"></span><h5>15.6.3.26. get-suite-version<a class="headerlink" href="#get-suite-version" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [info] get-suite-version [OPTIONS] REG

Interrogate running suite REG to find what version of cylc is running it.

To find the version you&#39;ve invoked at the command line see &quot;cylc version&quot;.

Arguments:
   REG               Suite name

Options:
  -h, --help            show this help message and exit
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --comms-timeout=SEC, --pyro-timeout=SEC
                        Set a timeout for network connections to the running
                        suite. The default is no timeout. For task messaging
                        connections see site/user config file documentation.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
  -f, --force           Do not ask for confirmation before acting. Note that
                        it is not necessary to use this option if interactive
                        command prompts have been disabled in the site/user
                        config files.
</pre></div>
</div>
</div>
<div class="section" id="gpanel">
<span id="command-gpanel"></span><h5>15.6.3.27. gpanel<a class="headerlink" href="#gpanel" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc gpanel [OPTIONS]

This is a cylc scan panel applet for monitoring running suites on a set of
hosts in GNOME 2.

To install this applet, run &quot;cylc gpanel --install&quot; and follow the instructions
that it gives you.

This applet can be tested using the --test option.

To customize themes, copy $CYLC_DIR/etc/gcylc.rc.eg to $HOME/.cylc/gcylc.rc and
follow the instructions in the file.

To configure default suite hosts, edit &quot;[suite servers]scan hosts&quot; in your
global.rc file.

Options:
  -h, --help  show this help message and exit
  --compact   Switch on compact mode at runtime.
  --install   Install the panel applet.
  --test      Run in a standalone window.
</pre></div>
</div>
</div>
<div class="section" id="graph">
<span id="command-graph"></span><h5>15.6.3.28. graph<a class="headerlink" href="#graph" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: 1/ cylc [prep] graph [OPTIONS] SUITE [START[STOP]]
     Plot the suite.rc dependency graph for SUITE.
       2/ cylc [prep] graph [OPTIONS] -f,--file FILE
     Plot the specified dot-language graph file.
       3/ cylc [prep] graph [OPTIONS] --reference SUITE [START[STOP]]
     Print out a reference format for the dependencies in SUITE.
       4/ cylc [prep] graph [OPTIONS] --output-file FILE SUITE
     Plot SUITE dependencies to a file FILE with a extension-derived format.
     If FILE endswith &quot;.png&quot;, output in PNG format, etc.

Plot suite dependency graphs in an interactive graph viewer, or (with
&quot;--output-file&quot;) directly to image file.

See also &quot;cylc ref-graph&quot; to generate the plain text &quot;reference&quot; graph format
without the need for PyGTK to be installed.

If START is given it overrides &quot;[visualization] initial cycle point&quot; to
determine the start point of the graph, which defaults to the suite initial
cycle point. If STOP is given it overrides &quot;[visualization] final cycle point&quot;
to determine the end point of the graph, which defaults to the graph start
point plus &quot;[visualization] number of cycle points&quot; (which defaults to 3).
The graph start and end points are adjusted up and down to the suite initial
and final cycle points, respectively, if necessary.

The &quot;Save&quot; button generates an image of the current view, of format (e.g. png,
svg, jpg, eps) determined by the filename extension. If the chosen format is
not available a dialog box will show those that are available.

If the optional output filename is specified, the viewer will not open and a
graph will be written directly to the file.

GRAPH VIEWER CONTROLS:
    * Center on a node: left-click.
    * Pan view: left-drag.
    * Zoom: +/- buttons, mouse-wheel, or ctrl-left-drag.
    * Box zoom: shift-left-drag.
    * &quot;Best Fit&quot; and &quot;Normal Size&quot; buttons.
    * Left-to-right graphing mode toggle button.
    * &quot;Ignore suicide triggers&quot; button.
    * &quot;Save&quot; button: save an image of the view.
  Family (namespace) grouping controls:
    Toolbar:
    * &quot;group&quot; - group all families up to root.
    * &quot;ungroup&quot; - recursively ungroup all families.
    Right-click menu:
    * &quot;group&quot; - close this node&#39;s parent family.
    * &quot;ungroup&quot; - open this family node.
    * &quot;recursive ungroup&quot; - ungroup all families below this node.

Arguments:
   [SUITE]               Suite name or path
   [START]               Initial cycle point (default: suite initial point)
   [STOP]                Final cycle point (default: initial + 3 points)

Options:
  -h, --help            show this help message and exit
  -u, --ungrouped       Start with task families ungrouped (the default is
                        grouped).
  -n, --namespaces      Plot the suite namespace inheritance hierarchy (task
                        run time properties).
  -f FILE, --file=FILE  View a specific dot-language graphfile.
  --filter=NODE_NAME_PATTERN
                        Filter out one or many nodes.
  -O FILE, --output-file=FILE
                        Output to a specific file, with a format given by
                        --output-format or extrapolated from the extension.
                        &#39;-&#39; implies stdout in plain format.
  --output-format=FORMAT
                        Specify a format for writing out the graph to
                        --output-file e.g. png, svg, jpg, eps, dot. &#39;ref&#39; is a
                        special sorted plain text format for comparison and
                        reference purposes.
  -r, --reference       Output in a sorted plain text format for comparison
                        purposes. If not given, assume --output-file=-.
  --show-suicide        Show suicide triggers.  They are not shown by default,
                        unless toggled on with the tool bar button.
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --suite-owner=OWNER   Specify suite owner
  -s NAME=VALUE, --set=NAME=VALUE
                        Set the value of a Jinja2 template variable in the
                        suite definition. This option can be used multiple
                        times on the command line. NOTE: these settings
                        persist across suite restarts, but can be set again on
                        the &quot;cylc restart&quot; command line if they need to be
                        overridden.
  --set-file=FILE       Set the value of Jinja2 template variables in the
                        suite definition from a file containing NAME=VALUE
                        pairs (one per line). NOTE: these settings persist
                        across suite restarts, but can be set again on the
                        &quot;cylc restart&quot; command line if they need to be
                        overridden.
</pre></div>
</div>
</div>
<div class="section" id="graph-diff">
<span id="command-graph-diff"></span><h5>15.6.3.29. graph-diff<a class="headerlink" href="#graph-diff" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc graph-diff [OPTIONS] SUITE1 SUITE2 -- [GRAPH_OPTIONS_ARGS]

Difference &#39;cylc graph --reference&#39; output for SUITE1 and SUITE2.

OPTIONS: Use &#39;-g&#39; to launch a graphical diff utility.
         Use &#39;--diff-cmd=MY_DIFF_CMD&#39; to use a custom diff tool.

SUITE1, SUITE2: Suite names to compare.
GRAPH_OPTIONS_ARGS: Options and arguments passed directly to cylc graph.
</pre></div>
</div>
</div>
<div class="section" id="gscan">
<span id="command-gscan"></span><h5>15.6.3.30. gscan<a class="headerlink" href="#gscan" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc gscan [OPTIONS]

This is the cylc scan gui for monitoring running suites on a set of
hosts.

To customize themes copy $CYLC_DIR/etc/gcylc.rc.eg to ~/.cylc/gcylc.rc and
follow the instructions in the file.

Arguments:
   [HOSTS ...]               Hosts to scan instead of the configured hosts.

Options:
  -h, --help            show this help message and exit
  -a, --all             Scan all port ranges in known hosts.
  -n PATTERN, --name=PATTERN
                        List suites with name matching PATTERN (regular
                        expression). Defaults to any name. Can be used
                        multiple times.
  -o PATTERN, --suite-owner=PATTERN
                        List suites with owner matching PATTERN (regular
                        expression). Defaults to just your own suites. Can be
                        used multiple times.
  --comms-timeout=SEC   Set a timeout for network connections to each running
                        suite. The default is 5 seconds.
  --interval=SECONDS    Time interval (in seconds) between full updates
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
</pre></div>
</div>
</div>
<div class="section" id="gui">
<span id="command-gui"></span><h5>15.6.3.31. gui<a class="headerlink" href="#gui" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc gui [OPTIONS] [REG] [USER_AT_HOST]
gcylc [OPTIONS] [REG] [USER_AT_HOST]

This is the cylc Graphical User Interface.

The USER_AT_HOST argument allows suite selection by &#39;cylc scan&#39; output:
  cylc gui $(cylc scan | grep &lt;suite_name&gt;)

Local suites can be opened and switched between from within gcylc. To connect
to running remote suites (whose passphrase you have installed) you must
currently use --host and/or --user on the gcylc command line.

Available task state color themes are shown under the View menu. To customize
themes copy &lt;cylc-dir&gt;/etc/gcylc.rc.eg to ~/.cylc/gcylc.rc and follow the
instructions in the file.

To see current configuration settings use &quot;cylc get-gui-config&quot;.

In the graph view, View -&gt; Options -&gt; &quot;Write Graph Frames&quot; writes .dot graph
files to the suite share directory (locally, for a remote suite). These can
be processed into a movie by $CYLC_DIR/dev/bin/live-graph-movie.sh=.

Arguments:
   [REG]                        Suite name
   [USER_AT_HOST]               user@host:port, shorthand for --user, --host &amp; --port.

Options:
  -h, --help            show this help message and exit
  -r, --restricted      Restrict display to &#39;active&#39; task states: submitted,
                        submit-failed, submit-retrying, running, failed,
                        retrying; and disable the graph view.  This may be
                        needed for very large suites. The state summary icons
                        in the status bar still represent all task proxies.
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --comms-timeout=SEC, --pyro-timeout=SEC
                        Set a timeout for network connections to the running
                        suite. The default is no timeout. For task messaging
                        connections see site/user config file documentation.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
  -s NAME=VALUE, --set=NAME=VALUE
                        Set the value of a Jinja2 template variable in the
                        suite definition. This option can be used multiple
                        times on the command line. NOTE: these settings
                        persist across suite restarts, but can be set again on
                        the &quot;cylc restart&quot; command line if they need to be
                        overridden.
  --set-file=FILE       Set the value of Jinja2 template variables in the
                        suite definition from a file containing NAME=VALUE
                        pairs (one per line). NOTE: these settings persist
                        across suite restarts, but can be set again on the
                        &quot;cylc restart&quot; command line if they need to be
                        overridden.
</pre></div>
</div>
</div>
<div class="section" id="hold">
<span id="command-hold"></span><h5>15.6.3.32. hold<a class="headerlink" href="#hold" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [control] hold [OPTIONS] REG [TASK_GLOB ...]

Hold a suite or tasks:
  cylc hold REG - hold a suite
  cylc hold REG TASK_GLOB ... - hold one or more tasks in a suite

Held tasks do not submit their jobs even if ready to run.

See also &#39;cylc [control] release&#39;.

Multiple TASK_GLOBs can be given. They each match task proxy instances in the
current task pool by task or family name pattern, cycle point pattern, and task
state. They do NOT match any task at any point in the abstract suite graph; if
target task instances do not exist in the current pool you must insert them
first with the &quot;cylc insert&quot; command.
* [CYCLE-POINT-GLOB/]TASK-NAME-GLOB[:TASK-STATE]
* [CYCLE-POINT-GLOB/]FAMILY-NAME-GLOB[:TASK-STATE]
* TASK-NAME-GLOB[.CYCLE-POINT-GLOB][:TASK-STATE]
* FAMILY-NAME-GLOB[.CYCLE-POINT-GLOB][:TASK-STATE]

For example, to match:
* all tasks in a cycle: &#39;20200202T0000Z/*&#39; or &#39;*.20200202T0000Z&#39;
* all tasks in the submitted status: &#39;:submitted&#39;
* retrying &#39;foo*&#39; tasks in 0000Z cycles: &#39;foo*.*0000Z:retrying&#39; or
  &#39;*0000Z/foo*:retrying&#39;
* retrying tasks in &#39;BAR&#39; family: &#39;*/BAR:retrying&#39; or &#39;BAR.*:retrying&#39;
* retrying tasks in &#39;BAR&#39; or &#39;BAZ&#39; families: &#39;*/BA[RZ]:retrying&#39; or
  &#39;BA[RZ].*:retrying&#39;

The old &#39;MATCH POINT&#39; syntax will be automatically detected and supported. To
avoid this, use the &#39;--no-multitask-compat&#39; option, or use the new syntax
(with a &#39;/&#39; or a &#39;.&#39;) when specifying 2 TASK_GLOB arguments.

Arguments:
   REG                           Suite name
   [TASK_GLOB ...]               Task match pattern(s)

Options:
  -h, --help            show this help message and exit
  --after=CYCLE_POINT   Hold whole suite AFTER this cycle point.
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --comms-timeout=SEC, --pyro-timeout=SEC
                        Set a timeout for network connections to the running
                        suite. The default is no timeout. For task messaging
                        connections see site/user config file documentation.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
  -f, --force           Do not ask for confirmation before acting. Note that
                        it is not necessary to use this option if interactive
                        command prompts have been disabled in the site/user
                        config files.
  -m, --family          (Obsolete) This option is now ignored and is retained
                        for backward compatibility only. TASK_GLOB in the
                        argument list can be used to match task and family
                        names regardless of this option.
  --no-multitask-compat
                        Disallow backward compatible multitask interface.
</pre></div>
</div>
</div>
<div class="section" id="import-examples">
<span id="command-import-examples"></span><h5>15.6.3.33. import-examples<a class="headerlink" href="#import-examples" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc import-examples DIR

Copy the cylc example suites to DIR and register them for use under the GROUP
suite name group.

Arguments:
   DIR    destination directory
</pre></div>
</div>
</div>
<div class="section" id="insert">
<span id="command-insert"></span><h5>15.6.3.34. insert<a class="headerlink" href="#insert" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [control] insert [OPTIONS] TASK_GLOB [...]

Insert new task proxies into the task pool of a running suite, e.g. to allow
re-triggering of an earlier task that has already been removed from the pool.

NOTE: inserted cycling tasks cycle on as normal, even if another instance of
the same task exists at a later cycle (instances of the same task at different
cycles can coexist, but a newly spawned task will not be added to the pool if
it catches up to another task with the same ID).

See also &#39;cylc submit&#39;, for running tasks independently of the scheduler.

TASK_GLOB matches task or family names, to insert task instances into the pool
at a specific given cycle point. (NOTE this differs from other commands which
match name and cycle point patterns against instances already in the pool).
* CYCLE-POINT/TASK-NAME-GLOB
* CYCLE-POINT/FAMILY-NAME-GLOB
* TASK-NAME-GLOB.CYCLE-POINT
* FAMILY-NAME-GLOB.CYCLE-POINT

For example, to match, within the given cycle point (e.g. &#39;20200202T0000Z&#39;):
* all tasks: &#39;20200202T0000Z/*&#39; or &#39;*.20200202T0000Z&#39;
* all tasks named model_N for some character N: &#39;20200202T0000Z/model_?&#39; or
  &#39;model_?.20200202T0000Z&#39;
* all tasks in &#39;BAR&#39; family: &#39;20200202T0000Z/BAR&#39; or &#39;BAR.20200202T0000Z&#39;
* all tasks in &#39;BAR&#39; or &#39;BAZ&#39; families: &#39;20200202T0000Z/BA[RZ]&#39; or
  &#39;BA[RZ].20200202T0000Z&#39;

The old &#39;MATCH POINT&#39; syntax will be automatically detected and supported. To
avoid this, use the &#39;--no-multitask-compat&#39; option, or use the new syntax
(with a &#39;/&#39; or a &#39;.&#39;) when specifying 2 TASK_GLOB arguments.

Arguments:
   REG                           Suite name
   TASK_GLOB [...]               Task match pattern(s)

Options:
  -h, --help            show this help message and exit
  --stop-point=CYCLE_POINT, --remove-point=CYCLE_POINT
                        Optional hold/stop cycle point for inserted task.
  --no-check            Add task even if the provided cycle point is not valid
                        for the given task.
  --no-multitask-compat
                        Disallow backward compatible multitask interface.
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --comms-timeout=SEC, --pyro-timeout=SEC
                        Set a timeout for network connections to the running
                        suite. The default is no timeout. For task messaging
                        connections see site/user config file documentation.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
  -f, --force           Do not ask for confirmation before acting. Note that
                        it is not necessary to use this option if interactive
                        command prompts have been disabled in the site/user
                        config files.
</pre></div>
</div>
</div>
<div class="section" id="jobs-kill">
<span id="command-jobs-kill"></span><h5>15.6.3.35. jobs-kill<a class="headerlink" href="#jobs-kill" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [control] jobs-kill JOB-LOG-ROOT [JOB-LOG-DIR ...]

(This command is for internal use. Users should use &quot;cylc kill&quot;.) Read job
status files to obtain the names of the batch systems and the job IDs in the
systems. Invoke the relevant batch system commands to ask the batch systems to
terminate the jobs.



Arguments:
   JOB-LOG-ROOT                    The log/job sub-directory for the suite
   [JOB-LOG-DIR ...]               A point/name/submit_num sub-directory

Options:
  -h, --help     show this help message and exit
  --user=USER    Other user account name. This results in command reinvocation
                 on the remote account.
  --host=HOST    Other host name. This results in command reinvocation on the
                 remote account.
  -v, --verbose  Verbose output mode.
  --debug        Output developer information and show exception tracebacks.
</pre></div>
</div>
</div>
<div class="section" id="jobs-poll">
<span id="command-jobs-poll"></span><h5>15.6.3.36. jobs-poll<a class="headerlink" href="#jobs-poll" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [control] jobs-poll JOB-LOG-ROOT [JOB-LOG-DIR ...]

(This command is for internal use. Users should use &quot;cylc poll&quot;.) Read job
status files to obtain the statuses of the jobs. If necessary, Invoke the
relevant batch system commands to ask the batch systems for more statuses.



Arguments:
   JOB-LOG-ROOT                    The log/job sub-directory for the suite
   [JOB-LOG-DIR ...]               A point/name/submit_num sub-directory

Options:
  -h, --help     show this help message and exit
  --user=USER    Other user account name. This results in command reinvocation
                 on the remote account.
  --host=HOST    Other host name. This results in command reinvocation on the
                 remote account.
  -v, --verbose  Verbose output mode.
  --debug        Output developer information and show exception tracebacks.
</pre></div>
</div>
</div>
<div class="section" id="jobs-submit">
<span id="command-jobs-submit"></span><h5>15.6.3.37. jobs-submit<a class="headerlink" href="#jobs-submit" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [control] jobs-submit JOB-LOG-ROOT [JOB-LOG-DIR ...]

(This command is for internal use. Users should use &quot;cylc submit&quot;.) Submit task
jobs to relevant batch systems. On a remote job host, this command reads the
job files from STDIN.



Arguments:
   JOB-LOG-ROOT                    The log/job sub-directory for the suite
   [JOB-LOG-DIR ...]               A point/name/submit_num sub-directory

Options:
  -h, --help     show this help message and exit
  --remote-mode  Is this being run on a remote job host?
  --utc-mode     (for remote mode) is the suite running in UTC mode?
  --user=USER    Other user account name. This results in command reinvocation
                 on the remote account.
  --host=HOST    Other host name. This results in command reinvocation on the
                 remote account.
  -v, --verbose  Verbose output mode.
  --debug        Output developer information and show exception tracebacks.
</pre></div>
</div>
</div>
<div class="section" id="jobscript">
<span id="command-jobscript"></span><h5>15.6.3.38. jobscript<a class="headerlink" href="#jobscript" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [prep] jobscript [OPTIONS] REG TASK

Generate a task job script and print it to stdout.

Here&#39;s how to capture the script in the vim editor:
  % cylc jobscript REG TASK | vim -
Emacs unfortunately cannot read from stdin:
  % cylc jobscript REG TASK &gt; tmp.sh; emacs tmp.sh

This command wraps &#39;cylc [control] submit --dry-run&#39;.
Other options (e.g. for suite host and owner) are passed
through to the submit command.

Options:
  -h, --help   Print this usage message.
  -e --edit    Open the jobscript in a CLI text editor.
  -g --gedit   Open the jobscript in a GUI text editor.
  --plain      Don&#39;t print the &quot;Task Job Script Generated message.&quot;
 (see also &#39;cylc submit --help&#39;)

Arguments:
  REG          Registered suite name.
  TASK         Task ID (NAME.CYCLE_POINT)
</pre></div>
</div>
</div>
<div class="section" id="kill">
<span id="command-kill"></span><h5>15.6.3.39. kill<a class="headerlink" href="#kill" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [control] kill [OPTIONS] REG [TASK_GLOB ...]

Kill jobs of active tasks and update their statuses accordingly.
 cylc kill REG TASK_GLOB ... - kill one or more active tasks
 cylc kill REG - kill all active tasks in the suite

Multiple TASK_GLOBs can be given. They each match task proxy instances in the
current task pool by task or family name pattern, cycle point pattern, and task
state. They do NOT match any task at any point in the abstract suite graph; if
target task instances do not exist in the current pool you must insert them
first with the &quot;cylc insert&quot; command.
* [CYCLE-POINT-GLOB/]TASK-NAME-GLOB[:TASK-STATE]
* [CYCLE-POINT-GLOB/]FAMILY-NAME-GLOB[:TASK-STATE]
* TASK-NAME-GLOB[.CYCLE-POINT-GLOB][:TASK-STATE]
* FAMILY-NAME-GLOB[.CYCLE-POINT-GLOB][:TASK-STATE]

For example, to match:
* all tasks in a cycle: &#39;20200202T0000Z/*&#39; or &#39;*.20200202T0000Z&#39;
* all tasks in the submitted status: &#39;:submitted&#39;
* retrying &#39;foo*&#39; tasks in 0000Z cycles: &#39;foo*.*0000Z:retrying&#39; or
  &#39;*0000Z/foo*:retrying&#39;
* retrying tasks in &#39;BAR&#39; family: &#39;*/BAR:retrying&#39; or &#39;BAR.*:retrying&#39;
* retrying tasks in &#39;BAR&#39; or &#39;BAZ&#39; families: &#39;*/BA[RZ]:retrying&#39; or
  &#39;BA[RZ].*:retrying&#39;

The old &#39;MATCH POINT&#39; syntax will be automatically detected and supported. To
avoid this, use the &#39;--no-multitask-compat&#39; option, or use the new syntax
(with a &#39;/&#39; or a &#39;.&#39;) when specifying 2 TASK_GLOB arguments.

Arguments:
   REG                           Suite name
   [TASK_GLOB ...]               Task match pattern(s)

Options:
  -h, --help            show this help message and exit
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --comms-timeout=SEC, --pyro-timeout=SEC
                        Set a timeout for network connections to the running
                        suite. The default is no timeout. For task messaging
                        connections see site/user config file documentation.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
  -f, --force           Do not ask for confirmation before acting. Note that
                        it is not necessary to use this option if interactive
                        command prompts have been disabled in the site/user
                        config files.
  -m, --family          (Obsolete) This option is now ignored and is retained
                        for backward compatibility only. TASK_GLOB in the
                        argument list can be used to match task and family
                        names regardless of this option.
  --no-multitask-compat
                        Disallow backward compatible multitask interface.
</pre></div>
</div>
</div>
<div class="section" id="list">
<span id="command-list"></span><h5>15.6.3.40. list<a class="headerlink" href="#list" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [info|prep] list|ls [OPTIONS] SUITE

Print runtime namespace names (tasks and families), the first-parent
inheritance graph, or actual tasks for a given cycle range.

The first-parent inheritance graph determines the primary task family
groupings that are collapsible in gcylc suite views and the graph
viewer tool. To visualize the full multiple inheritance hierarchy use:
  &#39;cylc graph -n&#39;.

Arguments:
   SUITE               Suite name or path

Options:
  -h, --help            show this help message and exit
  -a, --all-tasks       Print all tasks, not just those used in the graph.
  -n, --all-namespaces  Print all runtime namespaces, not just tasks.
  -m, --mro             Print the linear &quot;method resolution order&quot; for each
                        namespace (the multiple-inheritance precedence order
                        as determined by the C3 linearization algorithm).
  -t, --tree            Print the first-parent inheritance hierarchy in tree
                        form.
  -b, --box             With -t/--tree, using unicode box characters. Your
                        terminal must be able to display unicode characters.
  -w, --with-titles     Print namespaces titles too.
  -p START[,STOP], --points=START[,STOP]
                        Print actual task IDs from the START [through STOP]
                        cycle points.
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --suite-owner=OWNER   Specify suite owner
  -s NAME=VALUE, --set=NAME=VALUE
                        Set the value of a Jinja2 template variable in the
                        suite definition. This option can be used multiple
                        times on the command line. NOTE: these settings
                        persist across suite restarts, but can be set again on
                        the &quot;cylc restart&quot; command line if they need to be
                        overridden.
  --set-file=FILE       Set the value of Jinja2 template variables in the
                        suite definition from a file containing NAME=VALUE
                        pairs (one per line). NOTE: these settings persist
                        across suite restarts, but can be set again on the
                        &quot;cylc restart&quot; command line if they need to be
                        overridden.
  --initial-cycle-point=CYCLE_POINT, --initial-point=CYCLE_POINT, --icp=CYCLE_POINT, --ict=CYCLE_POINT
                        Set the initial cycle point. Required if not defined
                        in suite.rc.
</pre></div>
</div>
</div>
<div class="section" id="ls-checkpoints">
<span id="command-ls-checkpoints"></span><h5>15.6.3.41. ls-checkpoints<a class="headerlink" href="#ls-checkpoints" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [info] ls-checkpoints [OPTIONS] REG [ID ...]

In the absence of arguments and the --all option, list checkpoint IDs, their
time and events. Otherwise, display the latest and/or the checkpoints of suite
parameters, task pool and broadcast states in the suite runtime database.


Arguments:
   REG                    Suite name
   [ID ...]               Checkpoint ID (default=latest)

Options:
  -h, --help     show this help message and exit
  -a, --all      Display data of all available checkpoints.
  --user=USER    Other user account name. This results in command reinvocation
                 on the remote account.
  --host=HOST    Other host name. This results in command reinvocation on the
                 remote account.
  -v, --verbose  Verbose output mode.
  --debug        Output developer information and show exception tracebacks.
</pre></div>
</div>
</div>
<div class="section" id="message">
<span id="command-message"></span><h5>15.6.3.42. message<a class="headerlink" href="#message" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [task] message [OPTIONS] -- [REG] [TASK-JOB] [[SEVERITY:]MESSAGE ...]

Record task job messages.

Send task job messages to:
- The job stdout/stderr.
- The job status file, if there is one.
- The suite server program, if communication is possible.

Task jobs use this command to record and report status such as success and
failure. Applications run by task jobs can use this command to report messages
and to report registered task outputs.

Messages can be specified as arguments. A &#39;-&#39; indicates that the command should
read messages from STDIN. When reading from STDIN, multiple messages are
separated by empty lines. Examples:

Single message as an argument:
 % cylc message -- &quot;${CYLC_SUITE_NAME}&quot; &quot;${CYLC_TASK_JOB}&quot; &#39;Hello world!&#39;

Multiple messages as arguments:
 % cylc message -- &quot;${CYLC_SUITE_NAME}&quot; &quot;${CYLC_TASK_JOB}&quot; \
        &#39;Hello world!&#39; &#39;Hi&#39; &#39;WARNING:Hey!&#39;

Multiple messages on STDIN:
 % cylc message -- &quot;${CYLC_SUITE_NAME}&quot; &quot;${CYLC_TASK_JOB}&quot; - &lt;&lt;&#39;__STDIN__&#39;
 % Hello
 % world!
 %
 % Hi
 %
 % WARNING:Hey!
 %__STDIN__

Note &quot;${CYLC_SUITE_NAME}&quot; and &quot;${CYLC_TASK_JOB}&quot; are made available in task job
environments - you do not need to write their actual values in task scripting.

Each message can be prefixed with a severity level using the syntax &#39;SEVERITY:
MESSAGE&#39;.

The default message severity is INFO. The --severity=SEVERITY option can be
used to set the default severity level for all unprefixed messages.

Note: to abort a job script with a custom error message, use cylc__job_abort:
  cylc__job_abort &#39;message...&#39;
(For technical reasons this is a shell function, not a cylc sub-command.)

For backward compatibility, if number of arguments is less than or equal to 2,
the command assumes the classic interface, where all arguments are messages.
Otherwise, the first 2 arguments are assumed to be the suite name and the task
job identifier.


Arguments:
   [REG]                                  Suite name
   [TASK-JOB]                             Task job identifier CYCLE/TASK_NAME/SUBMIT_NUM
   [[SEVERITY:]MESSAGE ...]               Messages

Options:
  -h, --help            show this help message and exit
  -s SEVERITY, -p SEVERITY, --severity=SEVERITY, --priority=SEVERITY
                        Set severity levels for messages that do not have one
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --comms-timeout=SEC, --pyro-timeout=SEC
                        Set a timeout for network connections to the running
                        suite. The default is no timeout. For task messaging
                        connections see site/user config file documentation.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
  -f, --force           Do not ask for confirmation before acting. Note that
                        it is not necessary to use this option if interactive
                        command prompts have been disabled in the site/user
                        config files.
</pre></div>
</div>
</div>
<div class="section" id="monitor">
<span id="command-monitor"></span><h5>15.6.3.43. monitor<a class="headerlink" href="#monitor" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [info] monitor [OPTIONS] REG [USER_AT_HOST]

A terminal-based live suite monitor.  Exit with &#39;Ctrl-C&#39;.

The USER_AT_HOST argument allows suite selection by &#39;cylc scan&#39; output:
  cylc monitor $(cylc scan | grep &lt;suite_name&gt;)


Arguments:
   REG                          Suite name
   [USER_AT_HOST]               user@host:port, shorthand for --user, --host &amp; --port.

Options:
  -h, --help            show this help message and exit
  -a, --align           Align task names. Only useful for small suites.
  -r, --restricted      Restrict display to active task states. This may be
                        useful for monitoring very large suites. The state
                        summary line still reflects all task proxies.
  -s ORDER, --sort=ORDER
                        Task sort order: &quot;definition&quot; or &quot;alphanumeric&quot;.The
                        default is definition order, as determined by global
                        config. (Definition order is the order that tasks
                        appear under [runtime] in the suite definition).
  -o, --once            Show a single view then exit.
  -u, --runahead        Display task proxies in the runahead pool (off by
                        default).
  -i SECONDS, --interval=SECONDS
                        Interval between suite state retrievals, in seconds
                        (default 1).
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --comms-timeout=SEC, --pyro-timeout=SEC
                        Set a timeout for network connections to the running
                        suite. The default is no timeout. For task messaging
                        connections see site/user config file documentation.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
</pre></div>
</div>
</div>
<div class="section" id="nudge">
<span id="command-nudge"></span><h5>15.6.3.44. nudge<a class="headerlink" href="#nudge" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [control] nudge [OPTIONS] REG

Cause the cylc task processing loop to be invoked in a running suite.

This happens automatically when the state of any task changes such that
task processing (dependency negotation etc.) is required, or if a
clock-trigger task is ready to run.

The main reason to use this command is to update the &quot;estimated time till
completion&quot; intervals shown in the tree-view suite control GUI, during
periods when nothing else is happening.


Arguments:
   REG               Suite name

Options:
  -h, --help            show this help message and exit
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --comms-timeout=SEC, --pyro-timeout=SEC
                        Set a timeout for network connections to the running
                        suite. The default is no timeout. For task messaging
                        connections see site/user config file documentation.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
  -f, --force           Do not ask for confirmation before acting. Note that
                        it is not necessary to use this option if interactive
                        command prompts have been disabled in the site/user
                        config files.
</pre></div>
</div>
</div>
<div class="section" id="ping">
<span id="command-ping"></span><h5>15.6.3.45. ping<a class="headerlink" href="#ping" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [discovery] ping [OPTIONS] REG [TASK]

If suite REG is running or TASK in suite REG is currently running,
exit with success status, else exit with error status.

Arguments:
   REG                  Suite name
   [TASK]               Task NAME.CYCLE_POINT

Options:
  -h, --help            show this help message and exit
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --comms-timeout=SEC, --pyro-timeout=SEC
                        Set a timeout for network connections to the running
                        suite. The default is no timeout. For task messaging
                        connections see site/user config file documentation.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
  -f, --force           Do not ask for confirmation before acting. Note that
                        it is not necessary to use this option if interactive
                        command prompts have been disabled in the site/user
                        config files.
</pre></div>
</div>
</div>
<div class="section" id="poll">
<span id="command-poll"></span><h5>15.6.3.46. poll<a class="headerlink" href="#poll" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [control] poll [OPTIONS] REG [TASK_GLOB ...]

Poll (query) task jobs to verify and update their statuses.
  cylc poll REG - poll all active tasks
  cylc poll REG TASK_GLOB ... - poll multiple active tasks or families

Multiple TASK_GLOBs can be given. They each match task proxy instances in the
current task pool by task or family name pattern, cycle point pattern, and task
state. They do NOT match any task at any point in the abstract suite graph; if
target task instances do not exist in the current pool you must insert them
first with the &quot;cylc insert&quot; command.
* [CYCLE-POINT-GLOB/]TASK-NAME-GLOB[:TASK-STATE]
* [CYCLE-POINT-GLOB/]FAMILY-NAME-GLOB[:TASK-STATE]
* TASK-NAME-GLOB[.CYCLE-POINT-GLOB][:TASK-STATE]
* FAMILY-NAME-GLOB[.CYCLE-POINT-GLOB][:TASK-STATE]

For example, to match:
* all tasks in a cycle: &#39;20200202T0000Z/*&#39; or &#39;*.20200202T0000Z&#39;
* all tasks in the submitted status: &#39;:submitted&#39;
* retrying &#39;foo*&#39; tasks in 0000Z cycles: &#39;foo*.*0000Z:retrying&#39; or
  &#39;*0000Z/foo*:retrying&#39;
* retrying tasks in &#39;BAR&#39; family: &#39;*/BAR:retrying&#39; or &#39;BAR.*:retrying&#39;
* retrying tasks in &#39;BAR&#39; or &#39;BAZ&#39; families: &#39;*/BA[RZ]:retrying&#39; or
  &#39;BA[RZ].*:retrying&#39;

The old &#39;MATCH POINT&#39; syntax will be automatically detected and supported. To
avoid this, use the &#39;--no-multitask-compat&#39; option, or use the new syntax
(with a &#39;/&#39; or a &#39;.&#39;) when specifying 2 TASK_GLOB arguments.

Arguments:
   REG                           Suite name
   [TASK_GLOB ...]               Task match pattern(s)

Options:
  -h, --help            show this help message and exit
  -s, --succeeded       Allow polling of succeeded tasks.
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --comms-timeout=SEC, --pyro-timeout=SEC
                        Set a timeout for network connections to the running
                        suite. The default is no timeout. For task messaging
                        connections see site/user config file documentation.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
  -f, --force           Do not ask for confirmation before acting. Note that
                        it is not necessary to use this option if interactive
                        command prompts have been disabled in the site/user
                        config files.
  -m, --family          (Obsolete) This option is now ignored and is retained
                        for backward compatibility only. TASK_GLOB in the
                        argument list can be used to match task and family
                        names regardless of this option.
  --no-multitask-compat
                        Disallow backward compatible multitask interface.
</pre></div>
</div>
</div>
<div class="section" id="print">
<span id="command-print"></span><h5>15.6.3.47. print<a class="headerlink" href="#print" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [prep] print [OPTIONS] [REGEX]

Print registered (installed) suites.

Note on result filtering:
  (a) The filter patterns are Regular Expressions, not shell globs, so
the general wildcard is &#39;.*&#39; (match zero or more of anything), NOT &#39;*&#39;.
  (b) For printing purposes there is an implicit wildcard at the end of
each pattern (&#39;foo&#39; is the same as &#39;foo/*&#39;); use the string end marker
to prevent this (&#39;foo$&#39; matches only literal &#39;foo&#39;).

Arguments:
   [REGEX]               Suite name regular expression pattern

Options:
  -h, --help     show this help message and exit
  -t, --tree     Print suites in nested tree form.
  -b, --box      Use unicode box drawing characters in tree views.
  -a, --align    Align columns.
  -x             don&#39;t print suite definition directory paths.
  -y             Don&#39;t print suite titles.
  --fail         Fail (exit 1) if no matching suites are found.
  --user=USER    Other user account name. This results in command reinvocation
                 on the remote account.
  --host=HOST    Other host name. This results in command reinvocation on the
                 remote account.
  -v, --verbose  Verbose output mode.
  --debug        Output developer information and show exception tracebacks.
</pre></div>
</div>
</div>
<div class="section" id="profile-battery">
<span id="command-profile-battery"></span><h5>15.6.3.48. profile-battery<a class="headerlink" href="#profile-battery" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc profile-battery [-e [EXPERIMENT ...]] [-v [VERSION ...]]

Run profiling experiments against different versions of cylc. A list of
experiments can be specified after the -e flag, if not provided the experiment
&quot;complex&quot; will be chosen. A list of versions to profile against can be
specified after the -v flag, if not provided the current version will be used.

Experiments are stored in etc/profile-experiments, user experiments can be
stored in .profiling/experiments. Experiments are specified without the file
extension, experiments in .profiling/ will be chosen before those in etc/.

IMPORTANT: See etc/profile-experiments/example for an experiment template with
further details.

Versions are any valid git identifiers i.e. tags, branches, commits. To compare
results to different cylc versions either:
    * Supply cylc profile-battery with a complete list of the versions you wish
      to profile, it will then provide the option to checkout the required
      versions automatically.
    * Checkout each version manually running cylc profile-battery against only
      one version at a time. Once all results have been gathered you can then
      run cylc profile-battery with a complete list of versions.

Profiling will save results to .profiling/results.json where they can be used
for future comparisons. To list profiling results run:
    * cylc profile-battery --ls  # list all results
    * cylc profile-battery --ls -e experiment  # list all results for
                                               # experiment &quot;experiment&quot;.
    * cylc profile-battery --ls --delete -v  6.1.2  # Delete all results for
                                                    # version 6.1.2 (prompted).

If matplotlib and numpy are installed profiling generates plots which are
saved to .profiling/plots or presented in an interactive window using the -i
flag.

Results are stored along with a checksum for the experiment file. When an
experiment file is changed previous results are maintained, future results will
be stored separately. To copy results from an older version of an experiment
into those from the current one run:
    * cylc profile-battery --promote experiment@checksum
NOTE: At present results cannot be analysed without the experiment file so old
results must be &quot;copied&quot; in this way to be re-used.

The results output contain only a small number of metrics, to see a full list
of results use the --full option.


Options:
  -h, --help            show this help message and exit
  -e, --experiments     Specify list of experiments to run.
  -v, --versions        Specify cylc versions to profile. Git tags, branches,
                        commits are all valid.
  -i, --interactive     Open any plots in interactive window rather saving
                        them to files.
  -p, --no-plots        Don&#39;t generate any plots.
  --ls, --list-results  List all stored results. Experiments and versions to
                        list can be specified using --experiments and
                        --versions.
  --delete              Delete stored results (to be used in combination with
                        --list-results).
  -y, --yes             Answer yes to any user input. Will check-out cylc
                        versions as required.
  --full-results, --full
                        Display all gathered metrics.
  --lobf-order=LOBF_ORDER
                        The order (int)of the line of best fit to be drawn. 0
                        for no lobf, 1 for linear, 2 for quadratic ect.
  --promote=PROMOTE     Promote results from an older version of an experiment
                        to the current version. To be used when making non-
                        functional changes to an experiment.
  --test                For development purposes, run experiment without
                        saving results and regardless of any prior runs.
</pre></div>
</div>
</div>
<div class="section" id="ref-graph">
<span id="command-ref-graph"></span><h5>15.6.3.49. ref-graph<a class="headerlink" href="#ref-graph" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: Usage:
    cylc ref-graph SUITE [START] [STOP]

Implement the old ``cylc graph --reference command`` for producing a
text-format representation of a suite graph.

The `--reference` flag is optional here.

THIS IS A BACK-PORT OF the Python 3 bin/cylc-graph FOR CYLC 8, TO GENERATE
TEXT-FORMAT &quot;REFERENCE GRAPHS&quot; WITHOUT THE NEED FOR PYGTK TO BE INSTALLED.

Arguments:
   [SUITE]               Suite name or path
   [START]               Initial cycle point (default: suite initial point)
   [STOP]                Final cycle point (default: initial + 3 points)

Options:
  -h, --help            show this help message and exit
  -u, --ungrouped       Start with task families ungrouped (the default is
                        grouped).
  -n, --namespaces      Plot the suite namespace inheritance hierarchy (task
                        run time properties).
  -r, --reference       Output in a sorted plain text format for comparison
                        purposes.
  --show-suicide        Show suicide triggers.  They are not shown by default,
                        unless toggled on with the tool bar button.
  --icp=CYCLE_POINT     Set initial cycle point. Required if not defined in
                        suite.rc.
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --suite-owner=OWNER   Specify suite owner
  -s NAME=VALUE, --set=NAME=VALUE
                        Set the value of a Jinja2 template variable in the
                        suite definition. This option can be used multiple
                        times on the command line. NOTE: these settings
                        persist across suite restarts, but can be set again on
                        the &quot;cylc restart&quot; command line if they need to be
                        overridden.
  --set-file=FILE       Set the value of Jinja2 template variables in the
                        suite definition from a file containing NAME=VALUE
                        pairs (one per line). NOTE: these settings persist
                        across suite restarts, but can be set again on the
                        &quot;cylc restart&quot; command line if they need to be
                        overridden.
</pre></div>
</div>
</div>
<div class="section" id="register">
<span id="command-register"></span><h5>15.6.3.50. register<a class="headerlink" href="#register" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [prep] register [OPTIONS] [REG] [PATH]

Register the name REG for the suite definition in PATH. The suite server
program can then be started, stopped, and targeted by name REG. (Note that
&quot;cylc run&quot; can also register suites on the fly).

Registration creates a suite run directory &quot;~/cylc-run/REG/&quot; containing a
&quot;.service/source&quot; symlink to the suite definition location. The .service
directory is also used for server authentication files at runtime. With the
&quot;--run-dir&quot; option &quot;~/cylc-run/REG&quot; can be symlinked to another location.

Suite names can be hierarchical, corresponding to path under the run directory.

  % cylc register dogs/fido PATH
Register PATH/suite.rc as dogs/fido, with run directory ~/cylc-run/dogs/fido.

  % cylc register dogs/fido
Register $PWD/suite.rc as dogs/fido.

  % cylc register
Register $PWD/suite.rc as the parent directory name: $(basename $PWD).

The same suite can be registered with multiple names; this results in multiple
suite run directories that link to the same suite definition.

To &quot;unregister&quot; a suite, delete or rename its run directory (renaming it under
~/cylc-run effectively re-registers the original suite with the new name).

Use of &quot;--redirect&quot; is required to allow an existing name (and run directory)
to be associated with a different suite definition. This is potentially
dangerous because the new suite will overwrite files in the existing run
directory. You should consider deleting or renaming an existing run directory
rather than just re-use it with another suite.

Arguments:
   [REG]                Suite name
   [PATH]               Suite definition directory (defaults to $PWD)

Options:
  -h, --help        show this help message and exit
  --redirect        Allow an existing suite name and run directory to be used
                    with another suite.
  --run-dir=RUNDIR  Symlink $HOME/cylc-run/REG to RUNDIR/REG.
  --user=USER       Other user account name. This results in command
                    reinvocation on the remote account.
  --host=HOST       Other host name. This results in command reinvocation on
                    the remote account.
  -v, --verbose     Verbose output mode.
  --debug           Output developer information and show exception
                    tracebacks.
</pre></div>
</div>
</div>
<div class="section" id="release">
<span id="command-release"></span><h5>15.6.3.51. release<a class="headerlink" href="#release" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [control] release|unhold [OPTIONS] REG [TASK_GLOB ...]

Release a held suite or tasks.
  cylc release REG - release the suite
  cylc release REG TASK_GLOB ... - release one or more tasks

Held tasks do not submit their jobs even if ready to run.

See also &#39;cylc [control] hold&#39;.

Multiple TASK_GLOBs can be given. They each match task proxy instances in the
current task pool by task or family name pattern, cycle point pattern, and task
state. They do NOT match any task at any point in the abstract suite graph; if
target task instances do not exist in the current pool you must insert them
first with the &quot;cylc insert&quot; command.
* [CYCLE-POINT-GLOB/]TASK-NAME-GLOB[:TASK-STATE]
* [CYCLE-POINT-GLOB/]FAMILY-NAME-GLOB[:TASK-STATE]
* TASK-NAME-GLOB[.CYCLE-POINT-GLOB][:TASK-STATE]
* FAMILY-NAME-GLOB[.CYCLE-POINT-GLOB][:TASK-STATE]

For example, to match:
* all tasks in a cycle: &#39;20200202T0000Z/*&#39; or &#39;*.20200202T0000Z&#39;
* all tasks in the submitted status: &#39;:submitted&#39;
* retrying &#39;foo*&#39; tasks in 0000Z cycles: &#39;foo*.*0000Z:retrying&#39; or
  &#39;*0000Z/foo*:retrying&#39;
* retrying tasks in &#39;BAR&#39; family: &#39;*/BAR:retrying&#39; or &#39;BAR.*:retrying&#39;
* retrying tasks in &#39;BAR&#39; or &#39;BAZ&#39; families: &#39;*/BA[RZ]:retrying&#39; or
  &#39;BA[RZ].*:retrying&#39;

The old &#39;MATCH POINT&#39; syntax will be automatically detected and supported. To
avoid this, use the &#39;--no-multitask-compat&#39; option, or use the new syntax
(with a &#39;/&#39; or a &#39;.&#39;) when specifying 2 TASK_GLOB arguments.

Arguments:
   REG                           Suite name
   [TASK_GLOB ...]               Task match pattern(s)

Options:
  -h, --help            show this help message and exit
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --comms-timeout=SEC, --pyro-timeout=SEC
                        Set a timeout for network connections to the running
                        suite. The default is no timeout. For task messaging
                        connections see site/user config file documentation.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
  -f, --force           Do not ask for confirmation before acting. Note that
                        it is not necessary to use this option if interactive
                        command prompts have been disabled in the site/user
                        config files.
  -m, --family          (Obsolete) This option is now ignored and is retained
                        for backward compatibility only. TASK_GLOB in the
                        argument list can be used to match task and family
                        names regardless of this option.
  --no-multitask-compat
                        Disallow backward compatible multitask interface.
</pre></div>
</div>
</div>
<div class="section" id="reload">
<span id="command-reload"></span><h5>15.6.3.52. reload<a class="headerlink" href="#reload" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [control] reload [OPTIONS] REG

Tell a suite to reload its definition at run time. All settings
including task definitions, with the exception of suite log
configuration, can be changed on reload. Note that defined tasks can be
be added to or removed from a running suite with the &#39;cylc insert&#39; and
&#39;cylc remove&#39; commands, without reloading. This command also allows
addition and removal of actual task definitions, and therefore insertion
of tasks that were not defined at all when the suite started (you will
still need to manually insert a particular instance of a newly defined
task). Live task proxies that are orphaned by a reload (i.e. their task
definitions have been removed) will be removed from the task pool if
they have not started running yet. Changes to task definitions take
effect immediately, unless a task is already running at reload time.

If the suite was started with Jinja2 template variables set on the
command line (cylc run --set FOO=bar REG) the same template settings
apply to the reload (only changes to the suite.rc file itself are
reloaded).

If the modified suite definition does not parse, failure to reload will
be reported but no harm will be done to the running suite.

Arguments:
   REG               Suite name

Options:
  -h, --help            show this help message and exit
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --comms-timeout=SEC, --pyro-timeout=SEC
                        Set a timeout for network connections to the running
                        suite. The default is no timeout. For task messaging
                        connections see site/user config file documentation.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
  -f, --force           Do not ask for confirmation before acting. Note that
                        it is not necessary to use this option if interactive
                        command prompts have been disabled in the site/user
                        config files.
</pre></div>
</div>
</div>
<div class="section" id="remote-init">
<span id="command-remote-init"></span><h5>15.6.3.53. remote-init<a class="headerlink" href="#remote-init" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [task] remote-init [--indirect-comm=ssh] UUID RUND

(This command is for internal use.)
Install suite service files on a task remote (i.e. a [owner@]host):
    .service/contact: All task -&gt; suite communication methods.
    .service/passphrase: Direct task -&gt; suite HTTP(S) communication only.
    .service/ssl.cert: Direct task -&gt; suite HTTPS communication only.

Content of items to install from a tar file read from STDIN.

Return:
    0:
        On success or if initialisation not required:
        - Print SuiteSrvFilesManager.REMOTE_INIT_NOT_REQUIRED if initialisation
          not required (e.g. remote has shared file system with suite host).
        - Print SuiteSrvFilesManager.REMOTE_INIT_DONE on success.
    1:
        On failure.



Arguments:
   UUID               UUID of current suite server process
   RUND               The run directory of the suite

Options:
  -h, --help            show this help message and exit
  --indirect-comm=METHOD
                        specify use of indirect communication via e.g. ssh
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
</pre></div>
</div>
</div>
<div class="section" id="remote-tidy">
<span id="command-remote-tidy"></span><h5>15.6.3.54. remote-tidy<a class="headerlink" href="#remote-tidy" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [task] remote-tidy RUND

(This command is for internal use.)
Remove &quot;.service/contact&quot; from a task remote (i.e. a [owner@]host).
Remove &quot;.service&quot; directory on the remote if emptied.



Arguments:
   RUND               The run directory of the suite

Options:
  -h, --help     show this help message and exit
  --user=USER    Other user account name. This results in command reinvocation
                 on the remote account.
  --host=HOST    Other host name. This results in command reinvocation on the
                 remote account.
  -v, --verbose  Verbose output mode.
  --debug        Output developer information and show exception tracebacks.
</pre></div>
</div>
</div>
<div class="section" id="remove">
<span id="command-remove"></span><h5>15.6.3.55. remove<a class="headerlink" href="#remove" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [control] remove [OPTIONS] REG TASK_GLOB [...]

Remove one or more task instances from a running suite.

Tasks will be forced to spawn successors before removal if they have not done
so already, unless you use &#39;--no-spawn&#39;.

Multiple TASK_GLOBs can be given. They each match task proxy instances in the
current task pool by task or family name pattern, cycle point pattern, and task
state. They do NOT match any task at any point in the abstract suite graph; if
target task instances do not exist in the current pool you must insert them
first with the &quot;cylc insert&quot; command.
* [CYCLE-POINT-GLOB/]TASK-NAME-GLOB[:TASK-STATE]
* [CYCLE-POINT-GLOB/]FAMILY-NAME-GLOB[:TASK-STATE]
* TASK-NAME-GLOB[.CYCLE-POINT-GLOB][:TASK-STATE]
* FAMILY-NAME-GLOB[.CYCLE-POINT-GLOB][:TASK-STATE]

For example, to match:
* all tasks in a cycle: &#39;20200202T0000Z/*&#39; or &#39;*.20200202T0000Z&#39;
* all tasks in the submitted status: &#39;:submitted&#39;
* retrying &#39;foo*&#39; tasks in 0000Z cycles: &#39;foo*.*0000Z:retrying&#39; or
  &#39;*0000Z/foo*:retrying&#39;
* retrying tasks in &#39;BAR&#39; family: &#39;*/BAR:retrying&#39; or &#39;BAR.*:retrying&#39;
* retrying tasks in &#39;BAR&#39; or &#39;BAZ&#39; families: &#39;*/BA[RZ]:retrying&#39; or
  &#39;BA[RZ].*:retrying&#39;

The old &#39;MATCH POINT&#39; syntax will be automatically detected and supported. To
avoid this, use the &#39;--no-multitask-compat&#39; option, or use the new syntax
(with a &#39;/&#39; or a &#39;.&#39;) when specifying 2 TASK_GLOB arguments.

Arguments:
   REG                           Suite name
   TASK_GLOB [...]               Task match pattern(s)

Options:
  -h, --help            show this help message and exit
  --no-spawn            Do not spawn successors before removal.
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --comms-timeout=SEC, --pyro-timeout=SEC
                        Set a timeout for network connections to the running
                        suite. The default is no timeout. For task messaging
                        connections see site/user config file documentation.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
  -f, --force           Do not ask for confirmation before acting. Note that
                        it is not necessary to use this option if interactive
                        command prompts have been disabled in the site/user
                        config files.
  -m, --family          (Obsolete) This option is now ignored and is retained
                        for backward compatibility only. TASK_GLOB in the
                        argument list can be used to match task and family
                        names regardless of this option.
  --no-multitask-compat
                        Disallow backward compatible multitask interface.
</pre></div>
</div>
</div>
<div class="section" id="report-timings">
<span id="command-report-timings"></span><h5>15.6.3.56. report-timings<a class="headerlink" href="#report-timings" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [util] report-timings [OPTIONS] REG

Retrieve suite timing information for wait and run time performance analysis.
Raw output and summary output (in text or HTML format) are available.  Output
is sent to standard output, unless an output filename is supplied.

Summary Output (the default):
Data stratified by host and batch system that provides a statistical
summary of
    1. Queue wait time (duration between task submission and start times)
    2. Task run time (duration between start and succeed times)
    3. Total run time (duration between task submission and succeed times)
Summary tables can be output in plain text format, or HTML with embedded SVG
boxplots.  Both summary options require the Pandas library, and the HTML
summary option requires the Matplotlib library.

Raw Output:
A flat list of tabular data that provides (for each task and cycle) the
    1. Time of successful submission
    2. Time of task start
    3. Time of task successful completion
as well as information about the batch system and remote host to permit
stratification/grouping if desired by downstream processors.

Timings are shown only for succeeded tasks.

For long-running and/or large suites (i.e. for suites with many task events),
the database query to obtain the timing information may take some time.



Arguments:
   REG               Suite name

Options:
  -h, --help            show this help message and exit
  -r, --raw             Show raw timing output suitable for custom
                        diagnostics.
  -s, --summary         Show textual summary timing output for tasks.
  -w, --web-summary     Show HTML summary timing output for tasks.
  -O OUTPUT_FILENAME, --output-file=OUTPUT_FILENAME
                        Output to a specific file
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
</pre></div>
</div>
</div>
<div class="section" id="reset">
<span id="command-reset"></span><h5>15.6.3.57. reset<a class="headerlink" href="#reset" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [control] reset [OPTIONS] REG [TASK_GLOB ...]

Force task instances to a specified state.
  cylc reset --state=xxx REG - reset all tasks to state xxx
  cylc reset --state=xxx REG TASK_GLOB ... - reset one or more tasks to xxx

Outputs are automatically updated to reflect the new task state, except for
custom message outputs which can be manipulated directly with &quot;--output&quot;.

Prerequisites reflect the state of other tasks; they are not changed except
to unset them on resetting state to &#39;waiting&#39; or earlier.

To hold and release tasks use &quot;cylc hold&quot; and &quot;cylc release&quot;, not this command.

Multiple TASK_GLOBs can be given. They each match task proxy instances in the
current task pool by task or family name pattern, cycle point pattern, and task
state. They do NOT match any task at any point in the abstract suite graph; if
target task instances do not exist in the current pool you must insert them
first with the &quot;cylc insert&quot; command.
* [CYCLE-POINT-GLOB/]TASK-NAME-GLOB[:TASK-STATE]
* [CYCLE-POINT-GLOB/]FAMILY-NAME-GLOB[:TASK-STATE]
* TASK-NAME-GLOB[.CYCLE-POINT-GLOB][:TASK-STATE]
* FAMILY-NAME-GLOB[.CYCLE-POINT-GLOB][:TASK-STATE]

For example, to match:
* all tasks in a cycle: &#39;20200202T0000Z/*&#39; or &#39;*.20200202T0000Z&#39;
* all tasks in the submitted status: &#39;:submitted&#39;
* retrying &#39;foo*&#39; tasks in 0000Z cycles: &#39;foo*.*0000Z:retrying&#39; or
  &#39;*0000Z/foo*:retrying&#39;
* retrying tasks in &#39;BAR&#39; family: &#39;*/BAR:retrying&#39; or &#39;BAR.*:retrying&#39;
* retrying tasks in &#39;BAR&#39; or &#39;BAZ&#39; families: &#39;*/BA[RZ]:retrying&#39; or
  &#39;BA[RZ].*:retrying&#39;

The old &#39;MATCH POINT&#39; syntax will be automatically detected and supported. To
avoid this, use the &#39;--no-multitask-compat&#39; option, or use the new syntax
(with a &#39;/&#39; or a &#39;.&#39;) when specifying 2 TASK_GLOB arguments.

Arguments:
   REG                           Suite name
   [TASK_GLOB ...]               Task match pattern(s)

Options:
  -h, --help            show this help message and exit
  -s STATE, --state=STATE
                        Reset task state to STATE, can be succeeded, waiting,
                        submitted, failed, running, submit-failed, expired
  -O OUTPUT, --output=OUTPUT
                        Find task output by message string or trigger string,
                        set complete or incomplete with !OUTPUT, &#39;*&#39; to set
                        all complete, &#39;!*&#39; to set all incomplete. Can be used
                        more than once to reset multiple task outputs.
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --comms-timeout=SEC, --pyro-timeout=SEC
                        Set a timeout for network connections to the running
                        suite. The default is no timeout. For task messaging
                        connections see site/user config file documentation.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
  -f, --force           Do not ask for confirmation before acting. Note that
                        it is not necessary to use this option if interactive
                        command prompts have been disabled in the site/user
                        config files.
  -m, --family          (Obsolete) This option is now ignored and is retained
                        for backward compatibility only. TASK_GLOB in the
                        argument list can be used to match task and family
                        names regardless of this option.
  --no-multitask-compat
                        Disallow backward compatible multitask interface.
</pre></div>
</div>
</div>
<div class="section" id="restart">
<span id="command-restart"></span><h5>15.6.3.58. restart<a class="headerlink" href="#restart" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [control] restart [OPTIONS] [REG]

Start a suite run from the previous state. To start from scratch (cold or warm
start) see the &#39;cylc run&#39; command.

The scheduler runs as a daemon unless you specify --no-detach.

Tasks recorded as submitted or running are polled at start-up to determine what
happened to them while the suite was down.

Arguments:
   [REG]               Suite name

Options:
  -h, --help            show this help message and exit
  -n, --no-detach, --non-daemon
                        Do not daemonize the suite
  -a, --no-auto-shutdown
                        Do not shut down the suite automatically when all
                        tasks have finished. This flag overrides the
                        corresponding suite config item.
  --auto-shutdown       Shut down the suite automatically when all tasks have
                        finished. This flag overrides the corresponding suite
                        config item.
  --profile             Output profiling (performance) information
  --checkpoint=CHECKPOINT-ID
                        Specify the ID of a checkpoint to restart from
  --ignore-initial-cycle-point
                        Ignore the initial cycle point in the suite run
                        database. If one is specified in the suite definition
                        it will be used, however.
  --ignore-final-cycle-point
                        Ignore the final cycle point in the suite run
                        database. If one is specified in the suite definition
                        it will be used, however.
  --ignore-start-cycle-point
                        Ignore the start cycle point in the suite run
                        database.
  --ignore-stop-cycle-point
                        Ignore the stop cycle point in the suite run database.
  --final-cycle-point=CYCLE_POINT, --final-point=CYCLE_POINT, --until=CYCLE_POINT, --fcp=CYCLE_POINT
                        Set the final cycle point.
  --stop-cycle-point=CYCLE_POINT, --stop-point=CYCLE_POINT
                        Set stop point. Shut down after all tasks have PASSED
                        this cycle point. (Not to be confused with the final
                        cycle point.)
  --hold                Hold suite immediately on starting.
  --hold-point=CYCLE_POINT, --hold-after=CYCLE_POINT
                        Set hold cycle point. Hold suite AFTER all tasks have
                        PASSED this cycle point.
  -m STRING, --mode=STRING
                        Run mode: live, dummy, dummy-local, simulation
                        (default live).
  --reference-log       Generate a reference log for use in reference tests.
  --reference-test      Do a test run against a previously generated reference
                        log.
  --host=HOST           Specify the host on which to start-up the suite. If
                        not specified, a host will be selected using the
                        &#39;suite servers&#39; global config.
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  -s NAME=VALUE, --set=NAME=VALUE
                        Set the value of a Jinja2 template variable in the
                        suite definition. This option can be used multiple
                        times on the command line. NOTE: these settings
                        persist across suite restarts, but can be set again on
                        the &quot;cylc restart&quot; command line if they need to be
                        overridden.
  --set-file=FILE       Set the value of Jinja2 template variables in the
                        suite definition from a file containing NAME=VALUE
                        pairs (one per line). NOTE: these settings persist
                        across suite restarts, but can be set again on the
                        &quot;cylc restart&quot; command line if they need to be
                        overridden.
</pre></div>
</div>
</div>
<div class="section" id="review">
<span id="command-review"></span><h5>15.6.3.59. review<a class="headerlink" href="#review" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [info] review [OPTIONS] [start [PORT]] [stop]

Start/stop ad-hoc Cylc Review web service server for browsing users&#39; suite
logs via an HTTP interface.

With no arguments, the status of the ad-hoc web service server is printed.

For &#39;cylc review start&#39;, if &#39;PORT&#39; is not specified, port 8080 is used.

Arguments:
   [start [PORT]]               Start ad-hoc web service server.
   [stop]                       Stop ad-hoc web service server.

Options:
  -h, --help            show this help message and exit
  -y, --non-interactive, --yes
                        Switch off interactive prompting i.e. answer yes to
                        everything (for stop only).
  -R, --service-root    Include web service name under root of URL (for start
                        only).
</pre></div>
</div>
</div>
<div class="section" id="run">
<span id="command-run"></span><h5>15.6.3.60. run<a class="headerlink" href="#run" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [control] run|start [OPTIONS] [[REG] [START_POINT] ]

Start a suite run from scratch, ignoring dependence prior to the start point.

WARNING: this will wipe out previous suite state. To restart from a previous
state, see &#39;cylc restart --help&#39;.

The scheduler will run as a daemon unless you specify --no-detach.

If the suite is not already registered (by &quot;cylc register&quot; or a previous run)
it will be registered on the fly before start up.

% cylc run REG
  Run the suite registered with name REG.

% cylc run
  Register $PWD/suite.rc as $(basename $PWD) and run it.
 (Note REG must be given explicitly if START_POINT is on the command line.)

A &quot;cold start&quot; (the default) starts from the suite initial cycle point
(specified in the suite.rc or on the command line). Any dependence on tasks
prior to the suite initial cycle point is ignored.

A &quot;warm start&quot; (-w/--warm) starts from a given cycle point later than the suite
initial cycle point (specified in the suite.rc). Any dependence on tasks prior
to the given warm start cycle point is ignored. The suite initial cycle point
is preserved.

Arguments:
   [REG]                       Suite name
   [START_POINT]               Initial cycle point or &#39;now&#39;;
                               overrides the suite definition.

Options:
  -h, --help            show this help message and exit
  -n, --no-detach, --non-daemon
                        Do not daemonize the suite
  -a, --no-auto-shutdown
                        Do not shut down the suite automatically when all
                        tasks have finished. This flag overrides the
                        corresponding suite config item.
  --auto-shutdown       Shut down the suite automatically when all tasks have
                        finished. This flag overrides the corresponding suite
                        config item.
  --profile             Output profiling (performance) information
  -w, --warm            Warm start the suite. The default is to cold start.
  --start-cycle-point=CYCLE_POINT, --start-point=CYCLE_POINT
                        Set the start cycle point. Implies --warm.(Not to be
                        confused with the initial cycle point.)
  --final-cycle-point=CYCLE_POINT, --final-point=CYCLE_POINT, --until=CYCLE_POINT, --fcp=CYCLE_POINT
                        Set the final cycle point.
  --stop-cycle-point=CYCLE_POINT, --stop-point=CYCLE_POINT
                        Set stop point. Shut down after all tasks have PASSED
                        this cycle point. (Not to be confused with the final
                        cycle point.)
  --hold                Hold suite immediately on starting.
  --hold-point=CYCLE_POINT, --hold-after=CYCLE_POINT
                        Set hold cycle point. Hold suite AFTER all tasks have
                        PASSED this cycle point.
  -m STRING, --mode=STRING
                        Run mode: live, dummy, dummy-local, simulation
                        (default live).
  --reference-log       Generate a reference log for use in reference tests.
  --reference-test      Do a test run against a previously generated reference
                        log.
  --host=HOST           Specify the host on which to start-up the suite. If
                        not specified, a host will be selected using the
                        &#39;suite servers&#39; global config.
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  -s NAME=VALUE, --set=NAME=VALUE
                        Set the value of a Jinja2 template variable in the
                        suite definition. This option can be used multiple
                        times on the command line. NOTE: these settings
                        persist across suite restarts, but can be set again on
                        the &quot;cylc restart&quot; command line if they need to be
                        overridden.
  --set-file=FILE       Set the value of Jinja2 template variables in the
                        suite definition from a file containing NAME=VALUE
                        pairs (one per line). NOTE: these settings persist
                        across suite restarts, but can be set again on the
                        &quot;cylc restart&quot; command line if they need to be
                        overridden.
  --initial-cycle-point=CYCLE_POINT, --initial-point=CYCLE_POINT, --icp=CYCLE_POINT, --ict=CYCLE_POINT
                        Set the initial cycle point. Required if not defined
                        in suite.rc.
</pre></div>
</div>
</div>
<div class="section" id="scan">
<span id="command-scan"></span><h5>15.6.3.61. scan<a class="headerlink" href="#scan" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [discovery] scan [OPTIONS] [HOSTS ...]

Print information about running suites.

By default, it will obtain a listing of running suites for the current user
from the file system, before connecting to the suites to obtain information.
Use the -o/--suite-owner option to get information of running suites for other
users.

If a list of HOSTS is specified, it will obtain a listing of running suites by
scanning all ports in the relevant range for running suites on the specified
hosts. If the -a/--all option is specified, it will use the global
configuration &quot;[suite servers]scan hosts&quot; setting to determine a list of hosts
to scan.

Suite passphrases are not needed to get identity information (name and owner).
Titles, descriptions, state totals, and cycle point state totals may also be
revealed publicly, depending on global and suite authentication settings. Suite
passphrases still grant full access regardless of what is revealed publicly.

WARNING: a suite suspended with Ctrl-Z will cause port scans to hang until the
connection times out (see --comms-timeout).

Arguments:
   [HOSTS ...]               Hosts to scan instead of the configured hosts.

Options:
  -h, --help            show this help message and exit
  -a, --all             Scan all port ranges in known hosts.
  -n PATTERN, --name=PATTERN
                        List suites with name matching PATTERN (regular
                        expression). Defaults to any name. Can be used
                        multiple times.
  -o PATTERN, --suite-owner=PATTERN
                        List suites with owner matching PATTERN (regular
                        expression). Defaults to current user. Use &#39;.*&#39; to
                        match all known users. Can be used multiple times.
  -d, --describe        Print suite metadata if available.
  -s, --state-totals    Print number of tasks in each state if available
                        (total, and by cycle point).
  -f, --full            Print all available information about each suite.
  -c, --color, --colour
                        Print task state summaries using terminal color
                        control codes.
  -b, --no-bold         Don&#39;t use any bold text in the command output.
  --print-ports         Print the port range from the global config file.
  --comms-timeout=SEC   Set a timeout for network connections to each running
                        suite. The default is 5 seconds.
  --old, --old-format   Legacy output format (&quot;suite owner host port&quot;).
  -r, --raw, --raw-format
                        Parsable format (&quot;suite|owner|host|property|value&quot;).
  -j, --json, --json-format
                        JSON format.
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
</pre></div>
</div>
</div>
<div class="section" id="scp-transfer">
<span id="command-scp-transfer"></span><h5>15.6.3.62. scp-transfer<a class="headerlink" href="#scp-transfer" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [util] scp-transfer [OPTIONS]

An scp wrapper for transferring a list of files and/or directories
at once. The source and target scp URLs can be local or remote (scp
can transfer files between two remote hosts). Passwordless ssh must
be configured appropriately.

ENVIRONMENT VARIABLE INPUTS:
$SRCE  - list of sources (files or directories) as scp URLs.
$DEST  - parallel list of targets as scp URLs.
The source and destination lists should be space-separated.

We let scp determine the validity of source and target URLs.
Target directories are created pre-copy if they don&#39;t exist.

Options:
 -v     - verbose: print scp stdout.
 --help - print this usage message.
</pre></div>
</div>
</div>
<div class="section" id="search">
<span id="command-search"></span><h5>15.6.3.63. search<a class="headerlink" href="#search" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [prep] search|grep [OPTIONS] SUITE PATTERN [PATTERN2...]

Search for pattern matches in suite definitions and any files in the
suite bin directory. Matches are reported by line number and suite
section. An unquoted list of PATTERNs will be converted to an OR&#39;d
pattern. Note that the order of command line arguments conforms to
normal cylc command usage (suite name first) not that of the grep
command.

Note that this command performs a text search on the suite definition,
it does not search the data structure that results from parsing the
suite definition - so it will not report implicit default settings.

For case insenstive matching use &#39;(?i)PATTERN&#39;.

Arguments:
   SUITE                       Suite name or path
   PATTERN                     Python-style regular expression
   [PATTERN2...]               Additional search patterns

Options:
  -h, --help           show this help message and exit
  -x                   Do not search in the suite bin directory
  --user=USER          Other user account name. This results in command
                       reinvocation on the remote account.
  --host=HOST          Other host name. This results in command reinvocation
                       on the remote account.
  -v, --verbose        Verbose output mode.
  --debug              Output developer information and show exception
                       tracebacks.
  --suite-owner=OWNER  Specify suite owner
</pre></div>
</div>
</div>
<div class="section" id="set-verbosity">
<span id="command-set-verbosity"></span><h5>15.6.3.64. set-verbosity<a class="headerlink" href="#set-verbosity" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [control] set-verbosity [OPTIONS] REG LEVEL

Change the logging severity level of a running suite.  Only messages at
or above the chosen severity level will be logged; for example, if you
choose WARNING, only warnings and critical messages will be logged.

Arguments:
   REG                 Suite name
   LEVEL               INFO, WARNING, NORMAL, CRITICAL, ERROR, DEBUG

Options:
  -h, --help            show this help message and exit
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --comms-timeout=SEC, --pyro-timeout=SEC
                        Set a timeout for network connections to the running
                        suite. The default is no timeout. For task messaging
                        connections see site/user config file documentation.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
  -f, --force           Do not ask for confirmation before acting. Note that
                        it is not necessary to use this option if interactive
                        command prompts have been disabled in the site/user
                        config files.
</pre></div>
</div>
</div>
<div class="section" id="show">
<span id="command-show"></span><h5>15.6.3.65. show<a class="headerlink" href="#show" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [info] show [OPTIONS] REG [TASK_NAME or TASK_GLOB ...]

Query a running suite for:
  cylc show REG - suite metadata
  cylc show REG TASK_NAME - task metadata
  cylc show REG TASK_GLOB - prerequisites and outputs of matched task instances

Multiple TASK_GLOBs can be given. They each match task proxy instances in the
current task pool by task or family name pattern, cycle point pattern, and task
state. They do NOT match any task at any point in the abstract suite graph; if
target task instances do not exist in the current pool you must insert them
first with the &quot;cylc insert&quot; command.
* [CYCLE-POINT-GLOB/]TASK-NAME-GLOB[:TASK-STATE]
* [CYCLE-POINT-GLOB/]FAMILY-NAME-GLOB[:TASK-STATE]
* TASK-NAME-GLOB[.CYCLE-POINT-GLOB][:TASK-STATE]
* FAMILY-NAME-GLOB[.CYCLE-POINT-GLOB][:TASK-STATE]

For example, to match:
* all tasks in a cycle: &#39;20200202T0000Z/*&#39; or &#39;*.20200202T0000Z&#39;
* all tasks in the submitted status: &#39;:submitted&#39;
* retrying &#39;foo*&#39; tasks in 0000Z cycles: &#39;foo*.*0000Z:retrying&#39; or
  &#39;*0000Z/foo*:retrying&#39;
* retrying tasks in &#39;BAR&#39; family: &#39;*/BAR:retrying&#39; or &#39;BAR.*:retrying&#39;
* retrying tasks in &#39;BAR&#39; or &#39;BAZ&#39; families: &#39;*/BA[RZ]:retrying&#39; or
  &#39;BA[RZ].*:retrying&#39;

The old &#39;MATCH POINT&#39; syntax will be automatically detected and supported. To
avoid this, use the &#39;--no-multitask-compat&#39; option, or use the new syntax
(with a &#39;/&#39; or a &#39;.&#39;) when specifying 2 TASK_GLOB arguments.

Arguments:
   REG                                        Suite name
   [TASK_NAME or TASK_GLOB ...]               Task names or match patterns

Options:
  -h, --help            show this help message and exit
  --list-prereqs        Print a task&#39;s pre-requisites as a list.
  --json                Print output in JSON format.
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --comms-timeout=SEC, --pyro-timeout=SEC
                        Set a timeout for network connections to the running
                        suite. The default is no timeout. For task messaging
                        connections see site/user config file documentation.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
  -m, --family          (Obsolete) This option is now ignored and is retained
                        for backward compatibility only. TASK_GLOB in the
                        argument list can be used to match task and family
                        names regardless of this option.
  --no-multitask-compat
                        Disallow backward compatible multitask interface.
</pre></div>
</div>
</div>
<div class="section" id="spawn">
<span id="command-spawn"></span><h5>15.6.3.66. spawn<a class="headerlink" href="#spawn" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [control] spawn [OPTIONS] REG [TASK_GLOB ...]

Force task proxies to spawn successors at their own next cycle point.
  cylc spawn REG - force spawn all tasks in a suite
  cylc spawn REG TASK_GLOB ... - force spawn one or more tasks in a suite

Tasks normally spawn on reaching the &quot;submitted&quot; status. Spawning them early
allows running successive instances of the same task out of order. See also
the &quot;spawn to max active cycle points&quot; suite configuration.

Multiple TASK_GLOBs can be given. They each match task proxy instances in the
current task pool by task or family name pattern, cycle point pattern, and task
state. They do NOT match any task at any point in the abstract suite graph; if
target task instances do not exist in the current pool you must insert them
first with the &quot;cylc insert&quot; command.
* [CYCLE-POINT-GLOB/]TASK-NAME-GLOB[:TASK-STATE]
* [CYCLE-POINT-GLOB/]FAMILY-NAME-GLOB[:TASK-STATE]
* TASK-NAME-GLOB[.CYCLE-POINT-GLOB][:TASK-STATE]
* FAMILY-NAME-GLOB[.CYCLE-POINT-GLOB][:TASK-STATE]

For example, to match:
* all tasks in a cycle: &#39;20200202T0000Z/*&#39; or &#39;*.20200202T0000Z&#39;
* all tasks in the submitted status: &#39;:submitted&#39;
* retrying &#39;foo*&#39; tasks in 0000Z cycles: &#39;foo*.*0000Z:retrying&#39; or
  &#39;*0000Z/foo*:retrying&#39;
* retrying tasks in &#39;BAR&#39; family: &#39;*/BAR:retrying&#39; or &#39;BAR.*:retrying&#39;
* retrying tasks in &#39;BAR&#39; or &#39;BAZ&#39; families: &#39;*/BA[RZ]:retrying&#39; or
  &#39;BA[RZ].*:retrying&#39;

The old &#39;MATCH POINT&#39; syntax will be automatically detected and supported. To
avoid this, use the &#39;--no-multitask-compat&#39; option, or use the new syntax
(with a &#39;/&#39; or a &#39;.&#39;) when specifying 2 TASK_GLOB arguments.

Arguments:
   REG                           Suite name
   [TASK_GLOB ...]               Task match pattern(s)

Options:
  -h, --help            show this help message and exit
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --comms-timeout=SEC, --pyro-timeout=SEC
                        Set a timeout for network connections to the running
                        suite. The default is no timeout. For task messaging
                        connections see site/user config file documentation.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
  -f, --force           Do not ask for confirmation before acting. Note that
                        it is not necessary to use this option if interactive
                        command prompts have been disabled in the site/user
                        config files.
  -m, --family          (Obsolete) This option is now ignored and is retained
                        for backward compatibility only. TASK_GLOB in the
                        argument list can be used to match task and family
                        names regardless of this option.
  --no-multitask-compat
                        Disallow backward compatible multitask interface.
</pre></div>
</div>
</div>
<div class="section" id="stop">
<span id="command-stop"></span><h5>15.6.3.67. stop<a class="headerlink" href="#stop" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [control] stop|shutdown [OPTIONS] REG [STOP]

Tell a suite server program to shut down. In order to prevent failures going
unnoticed, suites only shut down automatically at a final cycle point if no
failed tasks are present. There are several shutdown methods:

  1. (default) stop after current active tasks finish
  2. (--now) stop immediately, orphaning current active tasks
  3. (--kill) stop after killing current active tasks
  4. (with STOP as a cycle point) stop after cycle point STOP
  5. (with STOP as a task ID) stop after task ID STOP has succeeded
  6. (--wall-clock=T) stop after time T (an ISO 8601 date-time format e.g.
     CCYYMMDDThh:mm, CCYY-MM-DDThh, etc).

Tasks that become ready after the shutdown is ordered will be submitted
immediately if the suite is restarted.  Remaining task event handlers and job
poll and kill commands, however, will be executed prior to shutdown, unless
--now is used.

This command exits immediately unless --max-polls is greater than zero, in
which case it polls to wait for suite shutdown.

Arguments:
   REG                  Suite name
   [STOP]               a/ task POINT (cycle point), or
                            b/ ISO 8601 date-time (clock time), or
                            c/ TASK (task ID).

Options:
  -h, --help            show this help message and exit
  -k, --kill            Shut down after killing currently active tasks.
  -n, --now             Shut down without waiting for active tasks to
                        complete. If this option is specified once, wait for
                        task event handler, job poll/kill to complete. If this
                        option is specified more than once, tell the suite to
                        terminate immediately.
  -w STOP, --wall-clock=STOP
                        Shut down after time STOP (ISO 8601 formatted)
  --max-polls=INT       Maximum number of polls (default 0).
  --interval=SECS       Polling interval in seconds (default 60).
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --comms-timeout=SEC, --pyro-timeout=SEC
                        Set a timeout for network connections to the running
                        suite. The default is no timeout. For task messaging
                        connections see site/user config file documentation.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
  -f, --force           Do not ask for confirmation before acting. Note that
                        it is not necessary to use this option if interactive
                        command prompts have been disabled in the site/user
                        config files.
</pre></div>
</div>
</div>
<div class="section" id="submit">
<span id="command-submit"></span><h5>15.6.3.68. submit<a class="headerlink" href="#submit" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [task] submit|single [OPTIONS] REG TASK [...]

Submit a single task to run just as it would be submitted by its suite.  Task
messaging commands will print to stdout but will not attempt to communicate
with the suite (which does not need to be running).

For tasks present in the suite graph the given cycle point is adjusted up to
the next valid cycle point for the task. For tasks defined under runtime but
not present in the graph, the given cycle point is assumed to be valid.

WARNING: do not &#39;cylc submit&#39; a task that is running in its suite at the
same time - both instances will attempt to write to the same job logs.

Arguments:
   REG                      Suite name
   TASK [...]               Family or task ID (NAME.CYCLE_POINT)

Options:
  -h, --help            show this help message and exit
  -d, --dry-run         Generate the job script for the task, but don&#39;t submit
                        it.
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  -s NAME=VALUE, --set=NAME=VALUE
                        Set the value of a Jinja2 template variable in the
                        suite definition. This option can be used multiple
                        times on the command line. NOTE: these settings
                        persist across suite restarts, but can be set again on
                        the &quot;cylc restart&quot; command line if they need to be
                        overridden.
  --set-file=FILE       Set the value of Jinja2 template variables in the
                        suite definition from a file containing NAME=VALUE
                        pairs (one per line). NOTE: these settings persist
                        across suite restarts, but can be set again on the
                        &quot;cylc restart&quot; command line if they need to be
                        overridden.
  --initial-cycle-point=CYCLE_POINT, --initial-point=CYCLE_POINT, --icp=CYCLE_POINT, --ict=CYCLE_POINT
                        Set the initial cycle point. Required if not defined
                        in suite.rc.
</pre></div>
</div>
</div>
<div class="section" id="suite-state">
<span id="command-suite-state"></span><h5>15.6.3.69. suite-state<a class="headerlink" href="#suite-state" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc suite-state REG [OPTIONS]

Print task states retrieved from a suite database; or (with --task,
--point, and --status) poll until a given task reaches a given state; or (with
--task, --point, and --message) poll until a task receives a given message.
Polling is configurable with --interval and --max-polls; for a one-off
check use --max-polls=1. The suite database does not need to exist at
the time polling commences but allocated polls are consumed waiting for
it (consider max-polls*interval as an overall timeout).

Note for non-cycling tasks --point=1 must be provided.

For your own suites the database location is determined by your
site/user config. For other suites, e.g. those owned by others, or
mirrored suite databases, use --run-dir=DIR to specify the location.

Example usages:
  cylc suite-state REG --task=TASK --point=POINT --status=STATUS
returns 0 if TASK.POINT reaches STATUS before the maximum number of
polls, otherwise returns 1.

  cylc suite-state REG --task=TASK --point=POINT --status=STATUS --offset=PT6H
adds 6 hours to the value of CYCLE for carrying out the polling operation.

  cylc suite-state REG --task=TASK --status=STATUS --task-point
uses CYLC_TASK_CYCLE_POINT environment variable as the value for the CYCLE
to poll. This is useful when you want to use cylc suite-state in a cylc task.


Arguments:
   REG               Suite name

Options:
  -h, --help            show this help message and exit
  -t TASK, --task=TASK  Specify a task to check the state of.
  -p CYCLE, --point=CYCLE
                        Specify the cycle point to check task states for.
  -T, --task-point      Use the CYLC_TASK_CYCLE_POINT environment variable as
                        the cycle point to check task states for. Shorthand
                        for --point=$CYLC_TASK_CYCLE_POINT
  --template=TEMPLATE   Remote cyclepoint template (IGNORED - this is now
                        determined automatically).
  -d DIR, --run-dir=DIR
                        The top level cylc run directory if non-standard. The
                        database should be DIR/REG/log/db. Use to interrogate
                        suites owned by others, etc.; see note above.
  -s OFFSET, --offset=OFFSET
                        Specify an offset to add to the targeted cycle point
  -S STATUS, --status=STATUS
                        Specify a particular status or triggering condition to
                        check for. Valid triggering conditions to check for
                        include: &#39;fail&#39;, &#39;finish&#39;, &#39;start&#39;, &#39;submit&#39; and
                        &#39;succeed&#39;. Valid states to check for include:
                        &#39;runahead&#39;, &#39;waiting&#39;, &#39;held&#39;, &#39;queued&#39;, &#39;expired&#39;,
                        &#39;ready&#39;, &#39;submit-failed&#39;, &#39;submit-retrying&#39;,
                        &#39;submitted&#39;, &#39;retrying&#39;, &#39;running&#39;, &#39;failed&#39; and
                        &#39;succeeded&#39;.
  -O MSG, -m MSG, --output=MSG, --message=MSG
                        Check custom task output by message string or trigger
                        string.
  --max-polls=INT       Maximum number of polls (default 10).
  --interval=SECS       Polling interval in seconds (default 60).
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
</pre></div>
</div>
</div>
<div class="section" id="test-battery">
<span id="command-test-battery"></span><h5>15.6.3.70. test-battery<a class="headerlink" href="#test-battery" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   cd &quot;/Users/oliver/cylc-flow&quot;
Usage: cylc test-battery [...]

Run automated Cylc and Parsec tests, under (by default):
   /Users/oliver/cylc-flow/tests/.

Options and arguments are appended to &quot;prove -j $NPROC -s -r ${@:-tests}&quot;.
NPROC is the number of concurrent processes to run, which defaults to the
global config &quot;process pool size&quot; setting.

The tests ignore normal site/user global config and instead use the file:
   /Users/oliver/cylc-flow/etc/global-tests.rc
This should specify test job hosts under the [test battery] section, plus any
other critical settings settings, including [hosts] configuration for test job
hosts (and special batchview commands like qcat if available). Additional
global config items can be added on the fly using the create_test_globalrc
shell function defined in the test_header.

Suite run directories are only cleaned up for passing tests on the suite host.

Set &quot;export CYLC_TEST_DEBUG=true&quot; to print failed-test stderr to the terminal.

To change the test file comparision command from &quot;diff -u&quot; do (for example):
   export CYLC_TEST_DIFF_CMD=&#39;xxdiff -D&#39;

Some test suites submit jobs to the &#39;at&#39; so atd must be up on the job hosts.

Commits or Pull Requests to cylc/cylc-flow on GitHub will trigger Travis CI to
run generic (non platform-specific) tests - see /Users/oliver/cylc-flow/.travis.yml.

By default all tests are executed.  To run just a subset of them:
  * list individual tests or test directories to run on the comand line
  * list individual tests or test directories to skip in $CYLC_TEST_SKIP
  * skip all generic tests with CYLC_TEST_RUN_GENERIC=false
  * skip all platform-specific tests with CYLC_TEST_RUN_PLATFORM=false
  List specific tests relative to /Users/oliver/cylc-flow (i.e. starting with &quot;test/&quot;).
Some platform-specific tests are automatically skipped, depending on platform.

Platform-specific tests must set &quot;CYLC_TEST_IS_GENERIC=false&quot; before sourcing
the test_header.

Tests requiring the sqlite3 CLI must be skipped if sqlite3 is not installed (it
is not otherwise a Cylc software prerequisite):
| if ! which sqlite3 &gt; /dev/null; then
|     # Skip the remaining 3 tests.
|     skip 3 &quot;sqlite3 not installed?&quot;
|     purge_suite $SUITE_NAME
|     exit 0
| fi

Options:
  -h, --help       Print this help message and exit.
  --chunk CHUNK    Divide the test battery into chunks and run the specified
                   chunk. CHUNK takes the format &#39;a/b&#39; where &#39;b&#39; is the number
                   of chunks to divide the battery into and &#39;a&#39; is the number
                   of the chunk to run (1 &gt;= a &gt;= b).

Examples:

Run the full test suite with the default options.
  cylc test-battery
Run the full test suite with 12 processes
  cylc test-battery -j 12
Run only tests under &quot;tests/cyclers/&quot;
  cylc test-battery tests/cyclers
Run only &quot;tests/cyclers/16-weekly.t&quot; in verbose mode
  cylc test-battery -v tests/cyclers/16-weekly.t
Run only tests under &quot;tests/cyclers/&quot;, and skip 00-daily.t
  export CYLC_TEST_SKIP=tests/cyclers/00-daily.t
  cylc test-battery tests/cyclers
Run the first quarter of the test battery
  cylc test-battery --chunk &#39;1/4&#39;
Re-run failed tests
  cylc test-battery --state=save
  cylc test-battery --state=failed
</pre></div>
</div>
</div>
<div class="section" id="trigger">
<span id="command-trigger"></span><h5>15.6.3.71. trigger<a class="headerlink" href="#trigger" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [control] trigger [OPTIONS] REG [TASK_GLOB ...]

Manually trigger tasks.
  cylc trigger REG - trigger all tasks in a running suite
  cylc trigger REG TASK_GLOB ... - trigger one or more tasks in a running suite

NOTE waiting tasks that are queue-limited will be queued if triggered, to
submit as normal when released by the queue; queued tasks will submit
immediately if triggered, even if that violates the queue limit (so you may
need to trigger a queue-limited task twice to get it to submit immediately).

For single tasks you can use &quot;--edit&quot; to edit the generated job script before
it submits, to apply one-off changes. A diff between the original and edited
job script will be saved to the task job log directory.

Multiple TASK_GLOBs can be given. They each match task proxy instances in the
current task pool by task or family name pattern, cycle point pattern, and task
state. They do NOT match any task at any point in the abstract suite graph; if
target task instances do not exist in the current pool you must insert them
first with the &quot;cylc insert&quot; command.
* [CYCLE-POINT-GLOB/]TASK-NAME-GLOB[:TASK-STATE]
* [CYCLE-POINT-GLOB/]FAMILY-NAME-GLOB[:TASK-STATE]
* TASK-NAME-GLOB[.CYCLE-POINT-GLOB][:TASK-STATE]
* FAMILY-NAME-GLOB[.CYCLE-POINT-GLOB][:TASK-STATE]

For example, to match:
* all tasks in a cycle: &#39;20200202T0000Z/*&#39; or &#39;*.20200202T0000Z&#39;
* all tasks in the submitted status: &#39;:submitted&#39;
* retrying &#39;foo*&#39; tasks in 0000Z cycles: &#39;foo*.*0000Z:retrying&#39; or
  &#39;*0000Z/foo*:retrying&#39;
* retrying tasks in &#39;BAR&#39; family: &#39;*/BAR:retrying&#39; or &#39;BAR.*:retrying&#39;
* retrying tasks in &#39;BAR&#39; or &#39;BAZ&#39; families: &#39;*/BA[RZ]:retrying&#39; or
  &#39;BA[RZ].*:retrying&#39;

The old &#39;MATCH POINT&#39; syntax will be automatically detected and supported. To
avoid this, use the &#39;--no-multitask-compat&#39; option, or use the new syntax
(with a &#39;/&#39; or a &#39;.&#39;) when specifying 2 TASK_GLOB arguments.

Arguments:
   REG                           Suite name
   [TASK_GLOB ...]               Task match pattern(s)

Options:
  -h, --help            show this help message and exit
  -e, --edit            Manually edit the job script before running it.
  -g, --geditor         (with --edit) force use of the configured GUI editor.
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --port=INT            Suite port number on the suite host. NOTE: this is
                        retrieved automatically if non-interactive ssh is
                        configured to the suite host.
  --use-ssh             Use ssh to re-invoke the command on the suite host.
  --ssh-cylc=SSH_CYLC   Location of cylc executable on remote ssh commands.
  --no-login            Do not use a login shell to run remote ssh commands.
                        The default is to use a login shell.
  --comms-timeout=SEC, --pyro-timeout=SEC
                        Set a timeout for network connections to the running
                        suite. The default is no timeout. For task messaging
                        connections see site/user config file documentation.
  --print-uuid          Print the client UUID to stderr. This can be matched
                        to information logged by the receiving suite server
                        program.
  --set-uuid=UUID       Set the client UUID manually (e.g. from prior use of
                        --print-uuid). This can be used to log multiple
                        commands under the same UUID (but note that only the
                        first [info] command from the same client ID will be
                        logged unless the suite is running in debug mode).
  -f, --force           Do not ask for confirmation before acting. Note that
                        it is not necessary to use this option if interactive
                        command prompts have been disabled in the site/user
                        config files.
  -m, --family          (Obsolete) This option is now ignored and is retained
                        for backward compatibility only. TASK_GLOB in the
                        argument list can be used to match task and family
                        names regardless of this option.
  --no-multitask-compat
                        Disallow backward compatible multitask interface.
</pre></div>
</div>
</div>
<div class="section" id="upgrade-run-dir">
<span id="command-upgrade-run-dir"></span><h5>15.6.3.72. upgrade-run-dir<a class="headerlink" href="#upgrade-run-dir" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [admin] upgrade-run-dir SUITE

For one-off conversion of a suite run directory to cylc-6 format.

Arguments:
     SUITE    suite name or run directory path

Options:
  -h, --help  show this help message and exit
</pre></div>
</div>
</div>
<div class="section" id="validate">
<span id="command-validate"></span><h5>15.6.3.73. validate<a class="headerlink" href="#validate" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [prep] validate [OPTIONS] SUITE

Validate a suite definition.

If the suite definition uses include-files reported line numbers
will correspond to the inlined version seen by the parser; use
&#39;cylc view -i,--inline SUITE&#39; for comparison.

Arguments:
   SUITE               Suite name or path

Options:
  -h, --help            show this help message and exit
  --strict              Fail any use of unsafe or experimental features.
                        Currently this just means naked dummy tasks (tasks
                        with no corresponding runtime section) as these may
                        result from unintentional typographic errors in task
                        names.
  -o FILENAME, --output=FILENAME
                        Specify a file name to dump the processed suite.rc.
  --profile             Output profiling (performance) information
  -u RUN_MODE, --run-mode=RUN_MODE
                        Validate for run mode.
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --suite-owner=OWNER   Specify suite owner
  -s NAME=VALUE, --set=NAME=VALUE
                        Set the value of a Jinja2 template variable in the
                        suite definition. This option can be used multiple
                        times on the command line. NOTE: these settings
                        persist across suite restarts, but can be set again on
                        the &quot;cylc restart&quot; command line if they need to be
                        overridden.
  --set-file=FILE       Set the value of Jinja2 template variables in the
                        suite definition from a file containing NAME=VALUE
                        pairs (one per line). NOTE: these settings persist
                        across suite restarts, but can be set again on the
                        &quot;cylc restart&quot; command line if they need to be
                        overridden.
  --initial-cycle-point=CYCLE_POINT, --initial-point=CYCLE_POINT, --icp=CYCLE_POINT, --ict=CYCLE_POINT
                        Set the initial cycle point. Required if not defined
                        in suite.rc.
</pre></div>
</div>
</div>
<div class="section" id="view">
<span id="command-view"></span><h5>15.6.3.74. view<a class="headerlink" href="#view" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [prep] view [OPTIONS] SUITE

View a read-only temporary copy of suite NAME&#39;s suite.rc file, in your
editor, after optional include-file inlining and Jinja2 preprocessing.

The edit process is spawned in the foreground as follows:
  % &lt;editor&gt; suite.rc
Where &lt;editor&gt; can be set in cylc global config.

For remote host or owner, the suite will be printed to stdout unless
the &#39;-g,--gui&#39; flag is used to spawn a remote GUI edit session.

See also &#39;cylc [prep] edit&#39;.

Arguments:
   SUITE               Suite name or path

Options:
  -h, --help            show this help message and exit
  -i, --inline          Inline include-files.
  -e, --empy            View after EmPy template processing (implies
                        &#39;-i/--inline&#39; as well).
  -j, --jinja2          View after Jinja2 template processing (implies
                        &#39;-i/--inline&#39; as well).
  -p, --process         View after all processing (EmPy, Jinja2, inlining,
                        line-continuation joining).
  -m, --mark            (With &#39;-i&#39;) Mark inclusions in the left margin.
  -l, --label           (With &#39;-i&#39;) Label file inclusions with the file name.
                        Line numbers will not correspond to those reported by
                        the parser.
  --single              (With &#39;-i&#39;) Inline only the first instances of any
                        multiply-included files. Line numbers will not
                        correspond to those reported by the parser.
  -c, --cat             Concatenate continuation lines (line numbers will not
                        correspond to those reported by the parser).
  -g, --gui             Force use of the configured GUI editor.
  --stdout              Print the suite definition to stdout.
  --mark-for-edit       (With &#39;-i&#39;) View file inclusion markers as for &#39;cylc
                        edit --inline&#39;.
  --user=USER           Other user account name. This results in command
                        reinvocation on the remote account.
  --host=HOST           Other host name. This results in command reinvocation
                        on the remote account.
  -v, --verbose         Verbose output mode.
  --debug               Output developer information and show exception
                        tracebacks.
  --suite-owner=OWNER   Specify suite owner
  -s NAME=VALUE, --set=NAME=VALUE
                        Set the value of a Jinja2 template variable in the
                        suite definition. This option can be used multiple
                        times on the command line. NOTE: these settings
                        persist across suite restarts, but can be set again on
                        the &quot;cylc restart&quot; command line if they need to be
                        overridden.
  --set-file=FILE       Set the value of Jinja2 template variables in the
                        suite definition from a file containing NAME=VALUE
                        pairs (one per line). NOTE: these settings persist
                        across suite restarts, but can be set again on the
                        &quot;cylc restart&quot; command line if they need to be
                        overridden.
</pre></div>
</div>
</div>
<div class="section" id="warranty">
<span id="command-warranty"></span><h5>15.6.3.75. warranty<a class="headerlink" href="#warranty" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Usage: cylc [license] warranty [--help]
   Cylc is released under the GNU General Public License v3.0
This command prints the GPL v3.0 disclaimer of warranty.
Options:
  --help   Print this usage message.
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-appendices/gcylc-graph-view"></span><div class="section" id="the-gcylc-graph-view">
<span id="thegraphbasedcontrolgui"></span><h3>15.7. The gcylc Graph View<a class="headerlink" href="#the-gcylc-graph-view" title="Permalink to this headline">¶</a></h3>
<p>The graph view in the gcylc GUI shows the structure of the suite as it
evolves. It can work well even for large suites, but be aware that the
Graphviz layout engine has to do a new global layout every time a task
proxy appears in or disappears from the task pool. The following may help
mitigate any jumping layout problems:</p>
<ul class="simple">
<li>The disconnect button can be used to temporarily prevent the
graph from changing as the suite evolves.</li>
<li>The greyed-out base nodes, which are only present to fill out
the graph structure, can be toggled off (but this will split the
graph into disconnected sub-trees).</li>
<li>Right-click on a task and choose the “Focus” option to restrict
the graph display to that task’s cycle point. Anything interesting
happening in other cycle points will show up as disconnected
rectangular nodes to the right of the graph (and you can click on
those to instantly refocus to their cycle points).</li>
<li>Task filtering is the ultimate quick route to focusing on just
the tasks you’re interested in, but this will destroy the graph
structure.</li>
</ul>
</div>
<span id="document-appendices/readme-file"></span><div class="section" id="cylc-readme-file">
<h3>15.8. Cylc README File<a class="headerlink" href="#cylc-readme-file" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># The Cylc Workflow Engine

[![Build Status](https://travis-ci.org/cylc/cylc.svg?branch=master)](https://travis-ci.org/cylc/cylc)
[![Codacy Badge](https://api.codacy.com/project/badge/Grade/1d6a97bf05114066ae30b63dcb0cdcf9)](https://www.codacy.com/app/Cylc/cylc?utm_source=github.com&amp;amp;utm_medium=referral&amp;amp;utm_content=cylc/cylc&amp;amp;utm_campaign=Badge_Grade)
[![codecov](https://codecov.io/gh/cylc/cylc/branch/master/graph/badge.svg)](https://codecov.io/gh/cylc/cylc)
[![DOI](https://zenodo.org/badge/1836229.svg)](https://zenodo.org/badge/latestdoi/1836229)
[![DOI](http://joss.theoj.org/papers/10.21105/joss.00737/status.svg)](https://doi.org/10.21105/joss.00737)

Cylc (“silk”) orchestrates complex distributed suites of interdependent cycling
(or non-cycling) tasks. It was originally designed to automate environmental
forecasting systems at [NIWA](https://www.niwa.co.nz). Cylc is a general
workflow engine, however; it is not specialized to forecasting in any way.

[Quick Installation](INSTALL.md) |
[Web Site](https://cylc.github.io/) |
[Documentation](https://cylc.github.io/documentation) |
[Contributing](CONTRIBUTING.md)

### Copyright and Terms of Use

Copyright (C) NIWA &amp; British Crown (Met Office) &amp; Contributors.
 
Cylc is free software: you can redistribute it and/or modify it under the terms
of the GNU General Public License as published by the Free Software Foundation,
either version 3 of the License, or (at your option) any later version.
 
Cylc is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE.  See the GNU General Public License for more details.
 
You should have received a copy of the GNU General Public License along with
Cylc.  If not, see [GNU licenses](http://www.gnu.org/licenses/).

## Cylc Documentation
 * See [The Cylc Web Site](https://cylc.github.io/)

## Acknowledgement for non-Cylc Work

See [Acknowledgement for Non-Cylc Work](ACKNOWLEDGEMENT.md).
</pre></div>
</div>
</div>
<span id="document-appendices/install-file"></span><div class="section" id="cylc-install-file">
<h3>15.9. Cylc INSTALL File<a class="headerlink" href="#cylc-install-file" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Cylc: Quick Installation Guide

**See [The Cylc User Guide](https://cylc.github.io/documentation.html) for
more detailed information.**

Cylc must be installed on suite and task job hosts. Third-party dependencies
(below) are not required on job hosts.

### Python 2 or Python 3 ?

Currently in the source code repository:
- **master branch:** Python 3, ZeroMQ network layer, **no GUI** - Cylc-8 Work In Progress
- **7.8.x branch:** Python 2, Cherrypy network layer, PyGTK GUI - Cylc-7 Maintenance

The first official Cylc-8 release (with a new web UI) is not expected until late 2019.
Until then we recommend the latest cylc-7.8 release for production use.

**THIS IS THE 7.8.x (PYTHON 2) INSTALL.md**

### Third-party Software Packages

Install the packages listed in the **Installation** section of the User Guide.
See also *Check Software Installation* below.

### Installing Cylc

Download the latest tarball from [Cylc
Releases](https://github.com/cylc/cylc-flow/releases).

Successive Cylc releases should be installed side-by-side under a location
such as `/opt`:

```bash
cd /opt
tar xzf cylc-7.8.1.tar.gz
# DO NOT CHANGE THE NAME OF THE UNPACKED CYLC SOURCE DIRECTORY.
cd cylc-7.8.1
export PATH=$PWD/bin:$PATH
make
```

Then make (or update) a symlink to the latest installed version:
```bash
ln -s /opt/cylc-7.8.1 /opt/cylc
```

When you type `make`:
  * The Cylc User Guide is generated from source (if you have sphinx-doc installed).

If this is the first installed version of Cylc, copy the wrapper script
`usr/bin/cylc` to a location in the system executable path, such as
`/usr/bin/` or `/usr/local/bin/`, and edit it - as per the in-file
instructions - to point to the Cylc install location:

```bash
cp /opt/cylc-7.8.1/usr/bin/cylc /usr/local/bin/
# (and EDIT /usr/local/bin/cylc as instructed)
```

The wrapper is designed invoke the latest (symlinked) version of Cylc by
default, or else a particular version determined by `$CYLC_VERSION` or
`$CYLC_HOME` in your environment. This is how a long-running suite server
program ensures that the jobs it manages invoke clients at the right cylc
version.

### Check Software Installation

```
$ cylc check-software
Checking your software...
...
</pre></div>
</div>
</div>
<span id="document-appendices/dev-history-major-changes"></span><div class="section" id="cylc-development-history-major-changes">
<h3>15.10. Cylc Development History - Major Changes<a class="headerlink" href="#cylc-development-history-major-changes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>pre-cylc-3</strong><ul>
<li>early versions focused on the new
scheduling algorithm. A suite was a collection of “task definition files”
that encoded the prerequisites and outputs of each task,
exposing cylc’s self-organising nature. Tasks could be transferred
from one suite to another by simply copying their taskdef files over
and checking prerequisite and output consistency. Global suite
structure was not easy to discern until run time (although cylc-2
could generate resolved run time dependency graphs).</li>
</ul>
</li>
<li><strong>cylc-3</strong><ul>
<li>a new suite design interface: dependency graph and task runtime properties
defined in a single structured, validated, configuration file - the
suite.rc file</li>
<li>graphical user interface</li>
<li>suite graphing.</li>
</ul>
</li>
<li><strong>cylc-4</strong><ul>
<li>refined and organized the suite.rc file structure</li>
<li>task runtime properties defined by an efficient inheritance hierarchy</li>
<li>support for the Jinja2 template processor in suite configurations.</li>
</ul>
</li>
<li><strong>cylc-5</strong><ul>
<li>multi-threading for continuous network request handling and job submission</li>
<li>more task states to distinguish job submission from execution</li>
<li>dependence between suites via new suite run databases</li>
<li>polling and killing of real task jobs</li>
<li>polling as task communications option.</li>
</ul>
</li>
<li><strong>cylc-6</strong><ul>
<li>specification of all date-times and cycling workflows via the ISO8601
date-times, durations, and recurrence expressions</li>
<li>integer cycling</li>
<li>a multi-process pool to execute job submissions, event handlers, and poll
and kill commands.</li>
</ul>
</li>
<li><strong>cylc-7</strong><ul>
<li>Replaced the Pyro communications layer with RESTful HTTPS</li>
<li>Removed deprecated pre cylc-6 syntax and features.</li>
</ul>
</li>
</ul>
</div>
<span id="document-appendices/cylc-6-migration-ref"></span><div class="section" id="cylc-6-migration-reference">
<span id="cylc-6-migration"></span><h3>15.11. Cylc 6 Migration Reference<a class="headerlink" href="#cylc-6-migration-reference" title="Permalink to this headline">¶</a></h3>
<p>Cylc 6 introduced new date-time-related syntax for the suite.rc file. In
some places, this is quite radically different from the earlier syntax.</p>
<div class="section" id="timeouts-and-delays">
<span id="cylc-6-migration-timeout-delays"></span><h4>15.11.1. Timeouts and Delays<a class="headerlink" href="#timeouts-and-delays" title="Permalink to this headline">¶</a></h4>
<p>Timeouts and delays such as <code class="docutils literal notranslate"><span class="pre">[cylc][[events]]timeout</span></code> or
<code class="docutils literal notranslate"><span class="pre">[runtime][[my_task]][[[job]]]execution</span> <span class="pre">retry</span> <span class="pre">delays</span></code> were written in
a purely numeric form before cylc 6, in seconds, minutes (most common), or
hours, depending on the setting.</p>
<p>They are now written in an ISO 8601 duration form, which has the benefit
that the units are user-selectable (use 1 day instead of 1440 minutes)
and explicit.</p>
<p>Nearly all timeouts and delays in cylc were in minutes, except for:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[runtime][[my_task]][[[suite state polling]]]interval
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[runtime][[my_task]][[[simulation mode]]]run time range
</pre></div>
</div>
<p>which were in seconds, and</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[scheduling]runahead limit
</pre></div>
</div>
<p>which was in hours (this is a special case discussed below
in <a class="reference internal" href="#cylc-6-migration-runahead-limit"><span class="std std-ref">Runahead Limit</span></a>).</p>
<p>See <a class="reference internal" href="#cylc-6-migration-timeout-delays-table"><span class="std std-ref">Table X</span></a>.</p>
<span id="cylc-6-migration-timeout-delays-table"></span><table border="1" class="docutils" id="id1">
<caption><span class="caption-number">Table 3 </span><span class="caption-text">Timeout/Delay Syntax Change Examples</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="63%" />
<col width="17%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Pre-Cylc-6</th>
<th class="head">Cylc-6+</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">[cylc][[events]]timeout</span></code></td>
<td>180</td>
<td>PT3H</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">[runtime][[my_task]][[[job]]]execution</span> <span class="pre">retry</span> <span class="pre">delays</span></code></td>
<td>2*30, 360, 1440</td>
<td>2*PT30M, PT6H, P1D</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">[runtime][[my_task]][[[suite</span> <span class="pre">state</span> <span class="pre">polling]]]interval</span></code></td>
<td>2</td>
<td>PT2S</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="runahead-limit">
<span id="cylc-6-migration-runahead-limit"></span><h4>15.11.2. Runahead Limit<a class="headerlink" href="#runahead-limit" title="Permalink to this headline">¶</a></h4>
<p>See <a class="reference internal" href="index.html#runahead-limit"><span class="std std-ref">[scheduling] -&gt; runahead limit</span></a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">[scheduling]runahead</span> <span class="pre">limit</span></code> setting was written as a number of
hours in pre-cylc-6 suites. This is now in ISO 8601 format for date-time
cycling suites, so <code class="docutils literal notranslate"><span class="pre">[scheduling]runahead</span> <span class="pre">limit=36</span></code> would be written
<code class="docutils literal notranslate"><span class="pre">[scheduling]runahead</span> <span class="pre">limit=PT36H</span></code>.</p>
<p>There is a new preferred alternative to <code class="docutils literal notranslate"><span class="pre">runahead</span> <span class="pre">limit</span></code>,
<code class="docutils literal notranslate"><span class="pre">[scheduling]max</span> <span class="pre">active</span> <span class="pre">cycle</span> <span class="pre">points</span></code>. This allows the user to
configure how many cycle points can run at once (default <code class="docutils literal notranslate"><span class="pre">3</span></code>). See
<a class="reference internal" href="index.html#max-active-cycle-points"><span class="std std-ref">[scheduling] -&gt; max active cycle points</span></a>.</p>
</div>
<div class="section" id="cycle-time-cycle-point">
<span id="cylc-6-migration-cycle-point"></span><h4>15.11.3. Cycle Time/Cycle Point<a class="headerlink" href="#cycle-time-cycle-point" title="Permalink to this headline">¶</a></h4>
<p>See <a class="reference internal" href="index.html#initial-cycle-point"><span class="std std-ref">[scheduling] -&gt; initial cycle point</span></a>.</p>
<p>The following suite.rc settings have changed name
(<a class="reference internal" href="#cylc-6-migration-cycle-point-time-table"><span class="std std-ref">Table X</span></a>):</p>
<span id="cylc-6-migration-cycle-point-time-table"></span><table border="1" class="docutils" id="id2">
<caption><span class="caption-number">Table 4 </span><span class="caption-text">Cycle Point Renaming</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="51%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Pre-Cylc-6</th>
<th class="head">Cylc-6+</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">[scheduling]initial</span> <span class="pre">cycle</span> <span class="pre">time</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">[scheduling]initial</span> <span class="pre">cycle</span> <span class="pre">point</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">[scheduling]final</span> <span class="pre">cycle</span> <span class="pre">time</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">[scheduling]final</span> <span class="pre">cycle</span> <span class="pre">point</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">[visualization]initial</span> <span class="pre">cycle</span> <span class="pre">time</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">[visualization]initial</span> <span class="pre">cycle</span> <span class="pre">point</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">[visualization]final</span> <span class="pre">cycle</span> <span class="pre">time</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">[visualization]final</span> <span class="pre">cycle</span> <span class="pre">point</span></code></td>
</tr>
</tbody>
</table>
<p>This change is to reflect the fact that cycling in cylc 6+ can now be over
e.g. integers instead of being purely based on date-time.</p>
<p>Date-times written in <code class="docutils literal notranslate"><span class="pre">initial</span> <span class="pre">cycle</span> <span class="pre">time</span></code> and
<code class="docutils literal notranslate"><span class="pre">final</span> <span class="pre">cycle</span> <span class="pre">time</span></code> were in a cylc-specific 10-digit (or less)
<code class="docutils literal notranslate"><span class="pre">CCYYMMDDhh</span></code> format, such as <code class="docutils literal notranslate"><span class="pre">2014021400</span></code> for 00:00 on
the 14th of February 2014.</p>
<p>Date-times are now required to be ISO 8601 compatible. This can be achieved
easily enough by inserting a <code class="docutils literal notranslate"><span class="pre">T</span></code> between the day and the hour digits.</p>
<span id="cylc-6-migration-cycle-point-syntax-table"></span><table border="1" class="docutils" id="id3">
<caption><span class="caption-number">Table 5 </span><span class="caption-text">Cycle Point Syntax Example</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="53%" />
<col width="23%" />
<col width="23%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Pre-Cylc-6</th>
<th class="head">Cylc-6+</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">[scheduling]initial</span> <span class="pre">cycle</span> <span class="pre">time</span></code></td>
<td>2014021400</td>
<td>20140214T00</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="cycling">
<span id="cylc-6-migration-cycling"></span><h4>15.11.4. Cycling<a class="headerlink" href="#cycling" title="Permalink to this headline">¶</a></h4>
<p>Special <em>start-up</em> and <em>cold-start</em> tasks have been removed from cylc 6.
Instead, use the initial/run-once notation as detailed
in <a class="reference internal" href="index.html#initial-non-repeating-r1-tasks"><span class="std std-ref">Initial Non-Repeating (R1) Tasks</span></a> and <a class="reference internal" href="index.html#advancedstartingup"><span class="std std-ref">Advanced Starting Up</span></a>.</p>
<p><em>Repeating asynchronous tasks</em> have also been removed because non date-time
workflows can now be handled more easily with integer cycling. See for instance
the satellite data processing example documented in <a class="reference internal" href="index.html#integercycling"><span class="std std-ref">Integer Cycling</span></a>.</p>
<p>For repeating tasks with hour-based cycling the syntax has only minor changes:</p>
<p>Pre-cylc-6:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="c1"># ...</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[0,12]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">foo</span>[<span class="err">T-12</span>] <span class="o">=&gt;</span> <span class="kd">foo</span> <span class="o">&amp;</span> <span class="kd">bar</span> <span class="o">=&gt;</span> <span class="kd">baz</span>
</pre></div>
</div>
<p>Cylc-6+:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="c1"># ...</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[T00,T12]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">foo</span>[<span class="nb">-PT12H</span>] <span class="o">=&gt;</span> <span class="kd">foo</span> <span class="o">&amp;</span> <span class="kd">bar</span> <span class="o">=&gt;</span> <span class="kd">baz</span>
</pre></div>
</div>
<p>Hour-based cycling section names are easy enough to convert, as seen in
<a class="reference internal" href="#cylc-6-migration-cycling-hours-table"><span class="std std-ref">Table X</span></a>.</p>
<span id="cylc-6-migration-cycling-hours-table"></span><table border="1" class="docutils" id="id4">
<caption><span class="caption-number">Table 6 </span><span class="caption-text">Hourly Cycling Sections</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="49%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Pre-Cylc-6</th>
<th class="head">Cylc-6+</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">[scheduling][[dependencies]][[[0]]]</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">[scheduling][[dependencies]][[[T00]]]</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">[scheduling][[dependencies]][[[6]]]</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">[scheduling][[dependencies]][[[T06]]]</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">[scheduling][[dependencies]][[[12]]]</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">[scheduling][[dependencies]][[[T12]]]</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">[scheduling][[dependencies]][[[18]]]</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">[scheduling][[dependencies]][[[T18]]]</span></code></td>
</tr>
</tbody>
</table>
<p>The graph text in hour-based cycling is also easy to convert, as seen in
<a class="reference internal" href="#cylc-6-migration-cycling-hours-offset-table"><span class="std std-ref">Table X</span></a>.</p>
<span id="cylc-6-migration-cycling-hours-offset-table"></span><table border="1" class="docutils" id="id5">
<caption><span class="caption-number">Table 7 </span><span class="caption-text">Hourly Cycling Offsets</span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Pre-Cylc-6</th>
<th class="head">Cylc-6+</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">my_task[T-6]</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">my_task[-PT6H]</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">my_task[T-12]</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">my_task[-PT12H]</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">my_task[T-24]</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">my_task[-PT24H]</span></code> or even <code class="docutils literal notranslate"><span class="pre">my_task[-P1D]</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="no-implicit-creation-of-tasks-by-offset-triggers">
<span id="cylc-6-migration-implicit-cycling"></span><h4>15.11.5. No Implicit Creation of Tasks by Offset Triggers<a class="headerlink" href="#no-implicit-creation-of-tasks-by-offset-triggers" title="Permalink to this headline">¶</a></h4>
<p>Prior to cylc-6 intercycle offset triggers implicitly created task instances at
the offset cycle points. For example, this pre cylc-6 suite automatically
creates instances of task <code class="docutils literal notranslate"><span class="pre">foo</span></code> at the offset hours
<code class="docutils literal notranslate"><span class="pre">3,9,15,21</span></code> each day, for task <code class="docutils literal notranslate"><span class="pre">bar</span></code> to trigger off at <code class="docutils literal notranslate"><span class="pre">0,6,12,18</span></code>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pre cylc-6 implicit cycling.</span>
<span class="nt">[scheduling]</span>
   <span class="nv">initial cycle time </span><span class="o">=</span><span class="s"> 2014080800</span>
   <span class="nt">[[dependencies]]</span>
      <span class="nt">[[[00,06,12,18]]]</span>
         <span class="c1"># This creates foo instances at 03,09,15,21:</span>
         <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">foo</span>[<span class="err">T-3</span>] <span class="o">=&gt;</span> <span class="kd">bar</span>
</pre></div>
</div>
<p>Here’s the direct translation to cylc-6+ format:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># In cylc-6+ this suite will stall.</span>
<span class="nt">[scheduling]</span>
   <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20140808T00</span>
   <span class="nt">[[dependencies]]</span>
      <span class="nt">[[[T00,T06,T12,T18]]]</span>
         <span class="c1"># This does NOT create foo instances at 03,09,15,21:</span>
         <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">foo</span>[<span class="nb">-PT3H</span>] <span class="o">=&gt;</span> <span class="kd">bar</span>
</pre></div>
</div>
<p>This suite fails validation with
<code class="docutils literal notranslate"><span class="pre">ERROR:</span> <span class="pre">No</span> <span class="pre">cycling</span> <span class="pre">sequences</span> <span class="pre">defined</span> <span class="pre">for</span> <span class="pre">foo</span></code>,
and at runtime it would stall with <code class="docutils literal notranslate"><span class="pre">bar</span></code> instances waiting on
non-existent offset <code class="docutils literal notranslate"><span class="pre">foo</span></code> instances (note that these
appear as ghost nodes in graph visualisations).</p>
<p>To fix this, explicitly define the cycling of with an offset cycling sequence
<code class="docutils literal notranslate"><span class="pre">foo</span></code>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cylc-6+ requires explicit task instance creation.</span>
<span class="nt">[scheduling]</span>
   <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 20140808T00</span>
   <span class="nt">[[dependencies]]</span>
      <span class="nt">[[[T03,T09,T15,T21]]]</span>
         <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">foo</span>
      <span class="nt">[[[T00,T06,T12,T18]]]</span>
         <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">foo</span>[<span class="nb">-PT3H</span>] <span class="o">=&gt;</span> <span class="kd">bar</span>
</pre></div>
</div>
<p>Implicit task creation by offset triggers is no longer allowed because it is
error prone: a mistaken task cycle point offset should cause a failure
rather than automatically creating task instances on the wrong cycling
sequence.</p>
</div>
</div>
<span id="document-appendices/known-issues"></span><div class="section" id="known-issues">
<span id="knownissues"></span><h3>15.12. Known Issues<a class="headerlink" href="#known-issues" title="Permalink to this headline">¶</a></h3>
<div class="section" id="current-known-issues">
<span id="currentknownissues"></span><h4>15.12.1. Current Known Issues<a class="headerlink" href="#current-known-issues" title="Permalink to this headline">¶</a></h4>
<p>The best place to find current known issues is on
<a class="reference external" href="https://github.com/cylc/cylc-flow/issues">GitHub</a>.</p>
</div>
<div class="section" id="notable-known-issues">
<span id="notableknownissues"></span><h4>15.12.2. Notable Known Issues<a class="headerlink" href="#notable-known-issues" title="Permalink to this headline">¶</a></h4>
<div class="section" id="use-of-pipes-in-job-scripts">
<span id="pipeinjobscripts"></span><h5>15.12.2.1. Use of pipes in job scripts<a class="headerlink" href="#use-of-pipes-in-job-scripts" title="Permalink to this headline">¶</a></h5>
<p>In bash, the return status of a pipeline is normally the exit status of the
last command. This is unsafe, because if any command in the pipeline fails, the
script will continue nevertheless.</p>
<p>For safety, a cylc task job script running in bash will have the
<code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">-o</span> <span class="pre">pipefail</span></code> option turned on automatically. If a pipeline
exists in a task’s <code class="docutils literal notranslate"><span class="pre">script</span></code>, etc section, the failure of any part of
a pipeline will cause the command to return a non-zero code at the end, which
will be reported as a task job failure. Due to the unique nature of a pipeline,
the job file will trap the failure of the individual commands, as well as the
whole pipeline, and will attempt to report a failure back to the suite twice.
The second message is ignored by the suite, and so the behaviour can be safely
ignored. (You should probably still investigate the failure, however!)</p>
</div>
</div>
</div>
<span id="document-appendices/licensing"></span><div class="section" id="gnu-general-public-license-v3-0">
<h3>15.13. GNU GENERAL PUBLIC LICENSE v3.0<a class="headerlink" href="#gnu-general-public-license-v3-0" title="Permalink to this headline">¶</a></h3>
<p>See the <a class="reference external" href="https://www.gnu.org/licenses/gpl-3.0.en.html">GNU GENERAL PUBLIC LICENSE v3.0</a>.</p>
</div>
</div>
</div>
<span id="document-suite-design-guide/suite-design-guide-master"></span><div class="section" id="suite-design-guide">
<h2>16. Suite Design Guide<a class="headerlink" href="#suite-design-guide" title="Permalink to this headline">¶</a></h2>
<p><strong>Cylc Rose Suite Design Best Practice Guide</strong></p>
<p>Version 1.0 - 23 March 2017</p>
<p><em>Last updated for: Cylc-7.2.0 and Rose-2017.02.0</em></p>
<p><em>Hilary Oliver, Dave Matthews, Andy Clark, and Contributors</em></p>
<hr class="docutils" />
<div class="toctree-wrapper compound">
<span id="document-suite-design-guide/sdg-introduction"></span><div class="section" id="introduction">
<span id="introduction-label"></span><h3>16.1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h3>
<p>This document provides guidance on making complex Cylc + Rose workflows that
are clear, maintainable, and portable. Note that best practice advice may
evolve over time with the capabilities of Rose and Cylc.</p>
<p>Content is drawn from the Rose and Cylc user guides, earlier Met Office suite
design and operational suite review documents, experience with real suites
across the Unified Model Consortium, and discussion among members of the UM
TISD (Technical Infrastructure Suite Design) working group.</p>
<p>We start with the most general topics (coding style, general principles),
move on to more advanced topics (efficiency and maintainability, portable
suites), and end with some pointers to future developments.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>A good working knowledge of Cylc and Rose is assumed. For further details,
please consult the:</p>
<ul class="last simple">
<li><a class="reference external" href="http://cylc.github.io/documentation.html">Cylc documentation</a></li>
<li><a class="reference external" href="http://metomi.github.io/rose">Rose documentation</a></li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For non-Rose users: this document comes out of the Unified Model
Consortium wherein Cylc is used within the Rose <em>suite management
framework</em>. However, the bulk of the information in this guide is about
Cylc suite design; which parts are Rose-specific should be clear from
context.</p>
</div>
</div>
<span id="document-suite-design-guide/style-guide"></span><div class="section" id="style-guidelines">
<h3>16.2. Style Guidelines<a class="headerlink" href="#style-guidelines" title="Permalink to this headline">¶</a></h3>
<p>Coding style is largely subjective, but for collaborative development of
complex systems it is important to settle on a clear and consistent style to
avoid getting into a mess. The following style rules are recommended.</p>
<div class="section" id="tab-characters">
<h4>16.2.1. Tab Characters<a class="headerlink" href="#tab-characters" title="Permalink to this headline">¶</a></h4>
<p>Do not use tab characters. Tab width depends on editor settings, so a mixture
of tabs and spaces in the same file can render to a mess.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">grep</span> <span class="pre">-InPr</span> <span class="pre">&quot;\t&quot;</span> <span class="pre">*</span></code> to find tabs recursively in files in
a directory.</p>
<p>In <em>vim</em> use <code class="docutils literal notranslate"><span class="pre">%retab</span></code> to convert existing tabs to spaces,
and set <code class="docutils literal notranslate"><span class="pre">expandtab</span></code> to automatically convert new tabs.</p>
<p>In <em>emacs</em> use <em>whitespace-cleanup</em>.</p>
<p>In <em>gedit</em>, use the <em>Draw Spaces</em> plugin to display tabs and spaces.</p>
</div>
<div class="section" id="trailing-whitespace">
<h4>16.2.2. Trailing Whitespace<a class="headerlink" href="#trailing-whitespace" title="Permalink to this headline">¶</a></h4>
<p>Trailing whitespace is untidy, it makes quick reformatting of paragraphs
difficult, and it can result in hard-to-find bugs (space after intended
line continuation markers).</p>
<p>To remove existing trailing whitespace in a file use a <code class="docutils literal notranslate"><span class="pre">sed</span></code> or
<code class="docutils literal notranslate"><span class="pre">perl</span></code> one-liner:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ perl -pi -e <span class="s2">&quot;s/ +</span>$<span class="s2">//g&quot;</span> /path/to/file
<span class="c1"># or:</span>
$ sed --in-place <span class="s1">&#39;s/[[:space:]]\+$//&#39;</span> path/to/file
</pre></div>
</div>
<p>Or do a similar search-and-replace operation in your editor. Editors like
<em>vim</em> and <em>emacs</em> can also be configured to highlight or automatically
remove trailing whitespace on the fly.</p>
</div>
<div class="section" id="indentation">
<h4>16.2.3. Indentation<a class="headerlink" href="#indentation" title="Permalink to this headline">¶</a></h4>
<p>Consistent indentation makes a suite definition more readable, it shows section
nesting clearly, and it makes block re-indentation operations easier in text
editors. Indent suite.rc syntax four spaces per nesting level:</p>
<div class="section" id="config-items">
<h5>16.2.3.1. Config Items<a class="headerlink" href="#config-items" title="Permalink to this headline">¶</a></h5>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[SECTION]</span>
    <span class="c1"># A comment.</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> the quick brown fox</span>
    <span class="nt">[[SUBSECTION]]</span>
        <span class="c1"># Another comment.</span>
        <span class="nv">a short item </span><span class="o">=</span><span class="s"> value1</span>
        <span class="nv">a very very long item </span><span class="o">=</span><span class="s"> value2</span>
</pre></div>
</div>
<p>Don’t align <code class="docutils literal notranslate"><span class="pre">item</span> <span class="pre">=</span> <span class="pre">value</span></code> pairs on the <code class="docutils literal notranslate"><span class="pre">=</span></code> character
like this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[SECTION]</span>  <span class="c1"># Avoid this.</span>
             <span class="nv">a short item </span><span class="o">=</span><span class="s"> value1</span>
    <span class="nv">a very very long item </span><span class="o">=</span><span class="s"> value2</span>
</pre></div>
</div>
<p>or like this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[SECTION]</span>  <span class="c1"># Avoid this.</span>
    <span class="nv">a short item          </span><span class="o">=</span><span class="s"> value1</span>
    <span class="nv">a very very long item </span><span class="o">=</span><span class="s"> value2</span>
</pre></div>
</div>
<p>because the whole block may need re-indenting after a single change, which will
pollute your revision history with spurious changes.</p>
<p>Comments should be indented to the same level as the section or item they refer
to, and trailing comments should be preceded by two spaces, as shown above.</p>
</div>
<div class="section" id="script-string-lines">
<h5>16.2.3.2. Script String Lines<a class="headerlink" href="#script-string-lines" title="Permalink to this headline">¶</a></h5>
<p>Script strings are written verbatim to task job scripts so they should really
be indented from the left margin:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="c1"># Recommended.</span>
        <span class="nv">post-script </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">if [[ $RESULT == &quot;bad&quot; ]]; then</span>
<span class="s2">    echo Goodbye World!</span>
<span class="s2">    exit 1</span>
<span class="s2">fi&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Indentation is <em>mostly</em> ignored by the bash interpreter, but is useful for
readability. It is <em>mostly</em> harmless to indent internal script lines as if
part of the Cylc syntax, or even out to the triple quotes:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="c1"># OK, but...</span>
        <span class="nv">post-script </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            if [[ $RESULT == &quot;bad&quot; ]]; then</span>
<span class="s2">                echo Goodbye World!</span>
<span class="s2">                exit 1</span>
<span class="s2">            fi&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>On parsing the triple quoted value, Cylc will remove any common leading
whitespace from each line using the logic of
<a class="reference external" href="https://docs.python.org/2/library/textwrap.html#textwrap.dedent">Python’s textwrap.dedent</a>
so the script block would end up being the same as the previous example.
However, you should watch your line length (see <a class="reference internal" href="#line-length"><span class="std std-ref">Line Length And Continuation</span></a>) when you
have many levels of indentations.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Take care when indenting here documents:</p>
<div class="last highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
     <span class="nv">script </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">     cat &gt;&gt; log.txt &lt;&lt;_EOF_</span>
<span class="s2">         The quick brown fox jumped</span>
<span class="s2">         over the lazy dog.</span>
<span class="s2">     _EOF_</span>
<span class="s2">              &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<p>In the above, each line in <code class="docutils literal notranslate"><span class="pre">log.txt</span></code> would end up with 4 leading
white spaces. The following will give you lines with no white spaces.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nv">script </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        cat &gt;&gt; log.txt &lt;&lt;_EOF_</span>
<span class="s2">        The quick brown fox jumped</span>
<span class="s2">        over the lazy dog.</span>
<span class="s2">        _EOF_</span>
<span class="s2">                 &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="graph-string-lines">
<h5>16.2.3.3. Graph String Lines<a class="headerlink" href="#graph-string-lines" title="Permalink to this headline">¶</a></h5>
<p>Multiline <code class="docutils literal notranslate"><span class="pre">graph</span></code> strings can be entirely free-form:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
    <span class="c1"># Main workflow:</span>
  <span class="kd">FAMILY</span><span class="c">:</span><span class="kd">succeed</span><span class="c">-</span><span class="kd">all</span> <span class="o">=&gt;</span> <span class="kd">bar</span> <span class="o">&amp;</span> <span class="kd">baz</span> <span class="o">=&gt;</span> <span class="kd">qux</span>

    <span class="c1"># Housekeeping:</span>
  <span class="kd">qux</span> <span class="o">=&gt;</span> <span class="kd">rose_arch</span> <span class="o">=&gt;</span> <span class="kd">rose_prune</span><span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Whitespace is ignored in graph string parsing, however, so internal graph lines
can be indented as if part of the suite.rc syntax, or even out to the triple
quotes, if you feel it aids readability (but watch line length with large
indents; see <a class="reference internal" href="#line-length"><span class="std std-ref">Line Length And Continuation</span></a>):</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
            <span class="c1"># Main workflow:</span>
            <span class="kd">FAMILY</span><span class="c">:</span><span class="kd">succeed</span><span class="c">-</span><span class="kd">all</span> <span class="o">=&gt;</span> <span class="kd">bar</span> <span class="o">&amp;</span> <span class="kd">baz</span> <span class="o">=&gt;</span> <span class="kd">qux</span>

            <span class="c1"># Housekeeping:</span>
            <span class="kd">qux</span> <span class="o">=&gt;</span> <span class="kd">rose_arch</span> <span class="o">=&gt;</span> <span class="kd">rose_prune</span><span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Both styles are acceptable; choose one and use it consistently.</p>
</div>
<div class="section" id="jinja2-code">
<h5>16.2.3.4. Jinja2 Code<a class="headerlink" href="#jinja2-code" title="Permalink to this headline">¶</a></h5>
<p>A suite.rc file with embedded Jinja2 code is essentially a Jinja2 program to
generate a Cylc suite definition. It is not possible to consistently indent the
Jinja2 as if it were part of the suite.rc syntax (which to the Jinja2 processor
is just arbitrary text), so it should be indented from the left margin on
its own terms:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[OPS]]</span>
<span class="cp">{% for T in OPS_TASKS %}</span>
    <span class="cp">{% for M in range(M_MAX) %}</span>
    <span class="nt">[[ops_</span><span class="cp">{{T}}</span><span class="nt">_</span><span class="cp">{{M}}</span><span class="nt">]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> OPS</span>
    <span class="cp">{% endfor %}</span>
<span class="cp">{% endfor %}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="comments">
<h4>16.2.4. Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h4>
<p>Comments should be minimal, but not too minimal. If context and clear
task and variable names will do, leave it at that. Extremely verbose comments
tend to get out of sync with the code they describe, which can be worse
than having no comments.</p>
<p>Avoid long lists of numbered comments - future changes may require mass
renumbering.</p>
<p>Avoid page-width “section divider” comments, especially if they are not
strictly limited to the standard line length (see <a class="reference internal" href="#line-length"><span class="std std-ref">Line Length And Continuation</span></a>).</p>
<p>Indent comments to the same level as the config items they describe.</p>
</div>
<div class="section" id="titles-descriptions-and-urls">
<h4>16.2.5. Titles, Descriptions, And URLs<a class="headerlink" href="#titles-descriptions-and-urls" title="Permalink to this headline">¶</a></h4>
<p>Document the suite and its tasks with <code class="docutils literal notranslate"><span class="pre">title</span></code>,
<code class="docutils literal notranslate"><span class="pre">description</span></code>, and <code class="docutils literal notranslate"><span class="pre">url</span></code> items instead of comments. These
can be displayed, or linked to, by the GUI at runtime.</p>
</div>
<div class="section" id="line-length-and-continuation">
<span id="line-length"></span><h4>16.2.6. Line Length And Continuation<a class="headerlink" href="#line-length-and-continuation" title="Permalink to this headline">¶</a></h4>
<p>Keep to the standard maximum line length of 79 characters where possible. Very
long lines affect readability and make side-by-side diffs hard to view.</p>
<p>Backslash line continuation markers can be used anywhere in the suite.rc file
but should be avoided if possible because they are easily broken by invisible
trailing whitespace.</p>
<p>Continuation markers are not needed in graph strings where trailing
trigger arrows imply line continuation:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="c1"># No line continuation marker is needed here.</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">prep</span> <span class="o">=&gt;</span> <span class="kd">one</span> <span class="o">=&gt;</span> <span class="kd">two</span> <span class="o">=&gt;</span> <span class="kd">three</span> <span class="o">=&gt;</span>
                <span class="kd">four</span> <span class="o">=&gt;</span> <span class="kd">five</span> <span class="kd">six</span> <span class="o">=&gt;</span> <span class="kd">seven</span> <span class="o">=&gt;</span> <span class="kd">eight</span><span class="s2">&quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[MY_TASKS]]</span>
    <span class="c1"># A line continuation marker *is* needed here:</span>
    <span class="nt">[[one, two, three, four, five, six, seven, eight, nine, ten, \</span>
<span class="nt">      eleven, twelve, thirteen ]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> MY_TASKS</span>
</pre></div>
</div>
</div>
<div class="section" id="task-naming-conventions">
<h4>16.2.7. Task Naming Conventions<a class="headerlink" href="#task-naming-conventions" title="Permalink to this headline">¶</a></h4>
<p>Use <code class="docutils literal notranslate"><span class="pre">UPPERCASE</span></code> for family names and <code class="docutils literal notranslate"><span class="pre">lowercase</span></code>
for tasks, so you can distinguish them at a glance.</p>
<p>Choose a convention for multi-component names and use it consistently. Put the
most general name components first for natural grouping in the GUI, e.g.
<code class="docutils literal notranslate"><span class="pre">obs_sonde</span></code>, <code class="docutils literal notranslate"><span class="pre">obs_radar</span></code> (not <code class="docutils literal notranslate"><span class="pre">sonde_obs</span></code> etc.)</p>
<p>Within your convention keep names as short as possible.</p>
<div class="section" id="um-system-task-names">
<h5>16.2.7.1. UM System Task Names<a class="headerlink" href="#um-system-task-names" title="Permalink to this headline">¶</a></h5>
<p>For UM System suites we recommend the following full task naming convention:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>model_system_function[_member]
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">glu_ops_process_scatwind</span></code> where <code class="docutils literal notranslate"><span class="pre">glu</span></code> refers
to the global (deterministic model) update run, <code class="docutils literal notranslate"><span class="pre">ops</span></code> is the system
that owns the task, and <code class="docutils literal notranslate"><span class="pre">process_scatwind</span></code> is the function it
performs. The optional <code class="docutils literal notranslate"><span class="pre">member</span></code> suffix is intended for use with
ensembles as needed.</p>
<p>Within this convention keep names as short as possible, e.g. use
<code class="docutils literal notranslate"><span class="pre">fcst</span></code> instead of <code class="docutils literal notranslate"><span class="pre">forecast</span></code>.</p>
<p>UM forecast apps should be given names that reflect their general science
configuration rather than geographic domain, to allow use on other model
domains without causing confusion.</p>
</div>
</div>
<div class="section" id="rose-config-files">
<h4>16.2.8. Rose Config Files<a class="headerlink" href="#rose-config-files" title="Permalink to this headline">¶</a></h4>
<p>Use <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">config-dump</span></code> to load and re-save new Rose .conf files. This
puts the files in a standard format (ordering of lines etc.) to ensure that
spurious changes aren’t generated when you next use <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">edit</span></code>.</p>
<p>See also <a class="reference internal" href="index.html#optional-app-config-files"><span class="std std-ref">Optional App Config Files</span></a> on optional app config files.</p>
</div>
</div>
<span id="document-suite-design-guide/general-principles"></span><div class="section" id="basic-principles">
<span id="id1"></span><h3>16.3. Basic Principles<a class="headerlink" href="#basic-principles" title="Permalink to this headline">¶</a></h3>
<p>This section covers general principles that should be kept in mind when
writing any suite. More advanced topics are covered later:
<a class="reference internal" href="index.html#efficiency-and-maintainability"><span class="std std-ref">Efficiency And Maintainability</span></a> and <a class="reference internal" href="index.html#portable-suites-label"><span class="std std-ref">Portable Suites</span></a>.</p>
<div class="section" id="utc-mode">
<h4>16.3.1. UTC Mode<a class="headerlink" href="#utc-mode" title="Permalink to this headline">¶</a></h4>
<p>Cylc has full timezone support if needed, but real time NWP suites should use
UTC mode to avoid problems at the transition between local standard time and
daylight saving time, and to enable the same suite to run the same way in
different timezones.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nv">UTC mode </span><span class="o">=</span><span class="s"> True</span>
</pre></div>
</div>
</div>
<div class="section" id="fine-or-coarse-grained-suites">
<h4>16.3.2. Fine Or Coarse-Grained Suites<a class="headerlink" href="#fine-or-coarse-grained-suites" title="Permalink to this headline">¶</a></h4>
<p>Suites can have many small simple tasks, fewer large complex tasks, or anything
in between. A task that runs many distinct processes can be split into many
distinct tasks. The fine-grained approach is more transparent and it allows
more task level concurrency and quicker failure recovery - you can rerun just
what failed without repeating anything unnecessarily.</p>
<div class="section" id="rose-bunch">
<h5>16.3.2.1. rose bunch<a class="headerlink" href="#rose-bunch" title="Permalink to this headline">¶</a></h5>
<p>One caveat to our fine-graining advice is that submitting a large number of
small tasks at once may be a problem on some platforms. If you have many
similar concurrent jobs you can use <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">bunch</span></code> to pack them into a
single task with incremental rerun capability: retriggering the task will rerun
just the component jobs that did not successfully complete earlier.</p>
</div>
</div>
<div class="section" id="monolithic-or-interdependent-suites">
<span id="id2"></span><h4>16.3.3. Monolithic Or Interdependent Suites<a class="headerlink" href="#monolithic-or-interdependent-suites" title="Permalink to this headline">¶</a></h4>
<p>When writing suites from scratch you may need to decide between putting
multiple loosely connected sub-workflows into a single large suite, or
constructing a more modular system of smaller suites that depend on each other
through inter-suite triggering. Each approach has its pros and cons, depending
on your requirements and preferences with respect to the complexity and
manageability of the resulting system.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">gscan</span></code> GUI lets you monitor multiple suites at a time, and
you can define virtual groups of suites that collapse into a single state
summary.</p>
<div class="section" id="inter-suite-triggering">
<h5>16.3.3.1. Inter-Suite Triggering<a class="headerlink" href="#inter-suite-triggering" title="Permalink to this headline">¶</a></h5>
<p>A task in one suite can explicitly trigger off of a task in another suite. The
full range of possible triggering conditions is supported, including custom
message triggers. Remote triggering involves repeatedly querying (“polling”)
the remote suite run database, not the suite server program, so it works even
if the other suite is down at the time.</p>
<p>There is special graph syntax to support triggering off of a task in another
suite, or you can call the underlying <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">suite-state</span></code> command
directly in task scripting.</p>
<p>In real time suites you may want to use clock-triggers to delay the onset of
inter-suite polling until roughly the expected completion time of the remote
task.</p>
</div>
</div>
<div class="section" id="self-contained-suites">
<span id="id3"></span><h4>16.3.4. Self-Contained Suites<a class="headerlink" href="#self-contained-suites" title="Permalink to this headline">¶</a></h4>
<p>All files generated by Cylc during a suite run are confined to the <em>suite
run directory</em> <code class="docutils literal notranslate"><span class="pre">$HOME/cylc-run/&lt;SUITE&gt;</span></code>. However, Cylc has no control
over the locations of the programs, scripts, and files, that are executed,
read, or generated by your tasks at runtime. It is up to you to ensure that
all of this is confined to the suite run directory too, as far as possible.</p>
<p>Self-contained suites are more robust, easier to work with, and more portable.
Multiple instances of the same suite (with different suite names) should be
able to run concurrently under the same user account without mutual
interference.</p>
<div class="section" id="avoiding-external-files">
<h5>16.3.4.1. Avoiding External Files<a class="headerlink" href="#avoiding-external-files" title="Permalink to this headline">¶</a></h5>
<p>Suites that use external scripts, executables, and files beyond the essential
system libraries and utilities are vulnerable to external changes: someone
else might interfere with these files without telling you.</p>
<p>In some case you may need to symlink to large external files anyway, if space
or copy speed is a problem, but otherwise suites with private copies of all the
files they need are more robust.</p>
</div>
<div class="section" id="installing-files-at-start-up">
<h5>16.3.4.2. Installing Files At Start-up<a class="headerlink" href="#installing-files-at-start-up" title="Permalink to this headline">¶</a></h5>
<p>Use <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">suite-run</span></code> <em>file creation mode</em> or <code class="docutils literal notranslate"><span class="pre">R1</span></code>
install tasks to copy files to the self-contained suite run directory at
start-up.  Install tasks are preferred for time-consuming installations because
they don’t slow the suite start-up process, they can be monitored in the GUI,
they can run directly on target platforms, and you can rerun them later without
restarting the suite. If you are using symbolic links to install files under
your suite directory it is recommended that the linking should be set up to
fail if the source is missing e.g. by using <em>mode=symlink+</em> for file
installation in a rose app.</p>
</div>
<div class="section" id="confining-ouput-to-the-run-directory">
<h5>16.3.4.3. Confining Ouput To The Run Directory<a class="headerlink" href="#confining-ouput-to-the-run-directory" title="Permalink to this headline">¶</a></h5>
<p>Output files should be confined to the suite run directory tree. Then all
output is easy to find, multiple instances of the same suite can run
concurrently without interference, and other users should be able to copy and
run your suite with few modifications. Cylc provides a <code class="docutils literal notranslate"><span class="pre">share</span></code>
directory for generated files that are used by several tasks in a suite
(see <a class="reference internal" href="#shared-task-io-paths"><span class="std std-ref">Shared Task IO Paths</span></a>). Archiving tasks can use <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">arch</span></code>
to copy or move selected files to external locations as needed (see
<a class="reference internal" href="#suite-housekeeping"><span class="std std-ref">Suite Housekeeping</span></a>).</p>
</div>
</div>
<div class="section" id="task-host-selection">
<h4>16.3.5. Task Host Selection<a class="headerlink" href="#task-host-selection" title="Permalink to this headline">¶</a></h4>
<p>At sites with multiple task hosts to choose from, use
<code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">host-select</span></code> to dynamically select appropriate task hosts
rather than hard coding particular hostnames. This enables your suite to
adapt to particular machines being down or heavily overloaded by selecting
from a group of hosts based on a series of criteria.
<code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">host-select</span></code> will only return hosts that can be contacted by
non-interactive SSH.</p>
</div>
<div class="section" id="task-scripting">
<h4>16.3.6. Task Scripting<a class="headerlink" href="#task-scripting" title="Permalink to this headline">¶</a></h4>
<p>Non-trivial task scripting should be held in external files rather than
inlined in the suite.rc. This keeps the suite definition tidy, and it
allows proper shell-mode text editing and independent testing of task scripts.</p>
<p>For automatic access by task jobs, task-specific scripts should be kept in
Rose app bin directories, and shared scripts kept in (or installed to) the
suite bin directory.</p>
<div class="section" id="coding-standards">
<h5>16.3.6.1. Coding Standards<a class="headerlink" href="#coding-standards" title="Permalink to this headline">¶</a></h5>
<p>When writing your own task scripts make consistent use of appropriate coding
standards such as:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.python.org/dev/peps/pep-0008/">PEP8 for Python</a></li>
<li><a class="reference external" href="https://google.github.io/styleguide/shell.xml">Google Shell Style Guide for
Bash</a></li>
</ul>
</div>
<div class="section" id="basic-functionality">
<h5>16.3.6.2. Basic Functionality<a class="headerlink" href="#basic-functionality" title="Permalink to this headline">¶</a></h5>
<p>In consideration of future users who may not be expert on the internals of your
suite and its tasks, all task scripts should:</p>
<ul class="simple">
<li>Print clear usage information if invoked incorrectly (and via the
standard options <code class="docutils literal notranslate"><span class="pre">-h,</span> <span class="pre">--help</span></code>).</li>
<li>Print useful diagnostic messages in case of error. For example, if a
file was not found, the error message should contain the full path to the
expected location.</li>
<li>Always return correct shell exit status - zero for success, non-zero
for failure. This is used by Cylc job wrapper code to detect success and
failure and report it back to the suite server program.</li>
<li>In shell scripts use <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">-u</span></code> to abort on any reference to
an undefined variable. If you really need an undefined variable to evaluate
to an empty string, make it explicit: <code class="docutils literal notranslate"><span class="pre">FOO=${FOO:-}</span></code>.</li>
<li>In shell scripts use <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">-e</span></code> to abort on any error without
having to failure-check each command explicitly.</li>
<li>In shell scripts use <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">-o</span> <span class="pre">pipefail</span></code> to abort on any error
within a pipe line. Note that all commands in the pipe line will still
run, it will just exit with the right most non-zero exit status.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Examples and more details <a class="reference external" href="https://vaneyckt.io/posts/safer_bash_scripts_with_set_euxo_pipefail/">are available</a>
for the above three <code class="docutils literal notranslate"><span class="pre">set</span></code> commands.</p>
</div>
</div>
</div>
<div class="section" id="rose-apps">
<h4>16.3.7. Rose Apps<a class="headerlink" href="#rose-apps" title="Permalink to this headline">¶</a></h4>
<p>Rose apps allow all non-shared task configuration - which is not relevant to
workflow automation - to be moved from the suite definition into app config
files. This makes suites tidier and easier to understand, and it allows
<code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">edit</span></code> to provide a unified metadata-enhanced view of the suite
and its apps (see <a class="reference internal" href="#rose-metadata-compliance"><span class="std std-ref">Rose Metadata Compliance</span></a>).</p>
<p>Rose apps are a clear winner for tasks with complex configuration requirements.
It matters less for those with little configuration, but for consistency and to
take full advantage of <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">edit</span></code> it makes sense to use Rose apps
for most tasks.</p>
<p>When most tasks are Rose apps, set the app-run command as a root-level default,
and override it for the occasional non Rose app task:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> rose task-run -v</span>
    <span class="nt">[[rose-app1]]</span>
        <span class="c1">#...</span>
    <span class="nt">[[rose-app2]]</span>
        <span class="c1">#...</span>
    <span class="nt">[[hello-world]]</span>  <span class="c1"># Not a Rose app.</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> echo &quot;Hello World&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="rose-metadata-compliance">
<span id="id4"></span><h4>16.3.8. Rose Metadata Compliance<a class="headerlink" href="#rose-metadata-compliance" title="Permalink to this headline">¶</a></h4>
<p>Rose metadata drives page layout and sort order in <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">edit</span></code>, plus
help information, input validity checking, macros for advanced checking and app
version upgrades, and more.</p>
<p>To ensure the suite and its constituent applications are being run as intended
it should be valid against any provided metadata: launch the
<code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">edit</span></code> GUI or run <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">macro</span> <span class="pre">--validate</span></code> on the
command line to highlight any errors, and correct them prior to use. If errors
are flagged incorrectly you should endeavour to fix the metadata.</p>
<p>When writing a new suite or application, consider creating metadata to
facilitate ease of use by others.</p>
</div>
<div class="section" id="task-independence">
<h4>16.3.9. Task Independence<a class="headerlink" href="#task-independence" title="Permalink to this headline">¶</a></h4>
<p>Essential dependencies must be encoded in the suite graph, but
tasks should not rely unnecessarily on the action of other tasks.
For example, tasks should create their own output directories if they don’t
already exist, even if they would normally be created by an earlier task
in the workflow. This makes it is easier to run tasks alone during
development and testing.</p>
</div>
<div class="section" id="clock-triggered-tasks">
<span id="id5"></span><h4>16.3.10. Clock-Triggered Tasks<a class="headerlink" href="#clock-triggered-tasks" title="Permalink to this headline">¶</a></h4>
<p>Tasks that wait on real time data should use clock-triggers to delay job
submission until the expected data arrival time:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> now</span>
    <span class="nt">[[special tasks]]</span>
        <span class="c1"># Trigger 5 min after wall-clock time is equal to cycle point.</span>
        <span class="nv">clock-trigger </span><span class="o">=</span><span class="s"> get-data(PT5M)</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[T00]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">get</span><span class="c">-</span><span class="kd">data</span> <span class="o">=&gt;</span> <span class="kd">process</span><span class="c">-</span><span class="kd">data</span>
</pre></div>
</div>
<p>Clock-triggered tasks typically have to handle late data arrival. Task
execution <em>retry delays</em> can be used to simply retrigger the task at
intervals until the data is found, but frequently retrying small tasks probably
should not go to a batch scheduler, and multiple task failures will be logged
for what is a essentially a normal condition (at least it is normal until the
data is really late).</p>
<p>Rather than using task execution retry delays to repeatedly trigger a task that
checks for a file, it may be better to have the task itself repeatedly poll for
the data (see <a class="reference internal" href="#rose-app-file-polling"><span class="std std-ref">Rose App File Polling</span></a> for example).</p>
</div>
<div class="section" id="rose-app-file-polling">
<span id="id6"></span><h4>16.3.11. Rose App File Polling<a class="headerlink" href="#rose-app-file-polling" title="Permalink to this headline">¶</a></h4>
<p>Rose apps have built-in polling functionality to check repeatedly for the
existence of files before executing the main app. See the <code class="docutils literal notranslate"><span class="pre">[poll]</span></code>
section in Rose app config documentation. This is a good way to implement
check-and-wait functionality in clock-triggered tasks
(<a class="reference internal" href="#clock-triggered-tasks"><span class="std std-ref">Clock-Triggered Tasks</span></a>), for example.</p>
<p>It is important to note that frequent polling may be bad for some filesystems,
so be sure to configure a reasonable interval between polls.</p>
</div>
<div class="section" id="task-execution-time-limits">
<h4>16.3.12. Task Execution Time Limits<a class="headerlink" href="#task-execution-time-limits" title="Permalink to this headline">¶</a></h4>
<p>Instead of setting job wall clock limits directly in batch scheduler
directives, use the <code class="docutils literal notranslate"><span class="pre">execution</span> <span class="pre">time</span> <span class="pre">limit</span></code> suite config item.
Cylc automatically derives the correct batch scheduler directives from this,
and it is also used to run <code class="docutils literal notranslate"><span class="pre">background</span></code> and <code class="docutils literal notranslate"><span class="pre">at</span></code> jobs via
the <code class="docutils literal notranslate"><span class="pre">timeout</span></code> command, and to poll tasks that haven’t reported in
finished by the configured time limit.</p>
</div>
<div class="section" id="restricting-suite-activity">
<span id="id7"></span><h4>16.3.13. Restricting Suite Activity<a class="headerlink" href="#restricting-suite-activity" title="Permalink to this headline">¶</a></h4>
<p>It may be possible for large suites to overwhelm a job host by submitting too
many jobs at once:</p>
<ul class="simple">
<li>Large suites that are not sufficiently limited by real time clock
triggering or inter-cycle dependence may generate a lot of <em>runahead</em>
(this refers to Cylc’s ability to run multiple cycles at once, restricted
only by the dependencies of individual tasks).</li>
<li>Some suites may have large families of tasks whose members all
become ready at the same time.</li>
</ul>
<p>These problems can be avoided with <em>runahead limiting</em> and <em>internal
queues</em>, respectively.</p>
<div class="section" id="runahead-limiting">
<span id="id8"></span><h5>16.3.13.1. Runahead Limiting<a class="headerlink" href="#runahead-limiting" title="Permalink to this headline">¶</a></h5>
<p>By default Cylc allows a maximum of three cycle points to be active at the same
time, but this value is configurable:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2020-01-01T00</span>
    <span class="c1"># Don&#39;t allow any cycle interleaving:</span>
    <span class="nv">max active cycle points </span><span class="o">=</span><span class="s"> 1</span>
</pre></div>
</div>
</div>
<div class="section" id="internal-queues">
<h5>16.3.13.2. Internal Queues<a class="headerlink" href="#internal-queues" title="Permalink to this headline">¶</a></h5>
<p>Tasks can be assigned to named internal queues that limit the number of members
that can be active (i.e. submitted or running) at the same time:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2020-01-01T00</span>
    <span class="nt">[[queues]]</span>
        <span class="c1"># Allow only 2 members of BIG_JOBS to run at once:</span>
        <span class="nt">[[[big_jobs_queue]]]</span>
            <span class="nv">limit </span><span class="o">=</span><span class="s"> 2</span>
            <span class="nv">members </span><span class="o">=</span><span class="s"> BIG_JOBS</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[T00]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">pre</span> <span class="o">=&gt;</span> <span class="kd">BIG_JOBS</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[BIG_JOBS]]</span>
    <span class="nt">[[foo, bar, baz, ...]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> BIG_JOBS</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="suite-housekeeping">
<span id="id9"></span><h4>16.3.14. Suite Housekeeping<a class="headerlink" href="#suite-housekeeping" title="Permalink to this headline">¶</a></h4>
<p>Ongoing cycling suites can generate an enormous number of output files and logs
so regular housekeeping is very important. Special housekeeping tasks,
typically the last tasks in each cycle, should be included to archive selected
important files and then delete everything at some offset from the current
cycle point.</p>
<p>The Rose built-in apps <code class="docutils literal notranslate"><span class="pre">rose_arch</span></code> and <code class="docutils literal notranslate"><span class="pre">rose_prune</span></code>
provide an easy way to do this. They can be configured easily with
file-matching patterns and cycle point offsets to perform various housekeeping
operations on matched files.</p>
</div>
<div class="section" id="complex-jinja2-code">
<h4>16.3.15. Complex Jinja2 Code<a class="headerlink" href="#complex-jinja2-code" title="Permalink to this headline">¶</a></h4>
<p>The Jinja2 template processor provides general programming constructs,
extensible with custom Python filters, that can be used to <em>generate</em> the
suite definition. This makes it possible to write flexible multi-use
suites with structure and content that varies according to various input
switches. There is a cost to this flexibility however: excessive use of Jinja2
can make a suite hard to understand and maintain. It is difficult to say
exactly where to draw the line, but we recommend erring on the side of
simplicity and clarity: write suites that are easy to understand and therefore
easy to modify for other purposes, rather than extremely complicated suites
that attempt do everything out of the box but are hard to maintain and modify.</p>
<p>Note that use of Jinja2 loops for generating tasks is now deprecated in favour
of built-in parameterized tasks - see <a class="reference internal" href="index.html#parameterized-tasks-label"><span class="std std-ref">Parameterized Tasks</span></a>.</p>
</div>
<div class="section" id="shared-configuration">
<h4>16.3.16. Shared Configuration<a class="headerlink" href="#shared-configuration" title="Permalink to this headline">¶</a></h4>
<p>Configuration that is common to multiple tasks should be defined in one
place and used by all, rather than duplicated in each task. Duplication is
a maintenance risk because changes have to be made consistently in several
places at once.</p>
<div class="section" id="jinja2-variables">
<h5>16.3.16.1. Jinja2 Variables<a class="headerlink" href="#jinja2-variables" title="Permalink to this headline">¶</a></h5>
<p>In simple cases you can share by passing a Jinja2 variable to all the tasks
that need it:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="cp">{% set JOB_VERSION = &#39;A23&#39; %}</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> run-foo --version=</span><span class="cp">{{JOB_VERSION}}</span>
    <span class="nt">[[bar]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> run-bar --version=</span><span class="cp">{{JOB_VERSION}}</span>
</pre></div>
</div>
</div>
<div class="section" id="inheritance">
<h5>16.3.16.2. Inheritance<a class="headerlink" href="#inheritance" title="Permalink to this headline">¶</a></h5>
<p>Sharing by inheritance of task families is recommended when more than a few
configuration items are involved.</p>
<p>The simplest application of inheritance is to set global defaults in the
<code class="docutils literal notranslate"><span class="pre">[[runtime]][root]</span></code> namespace that is inherited by all tasks.
However, this should only be done for settings that really are used
by the vast majority of tasks. Over-sharing of via root, particularly of
environment variables, is a maintenance risk because it can be very
difficult to be sure which tasks are <em>using</em> which global variables.</p>
<p>Any <code class="docutils literal notranslate"><span class="pre">[runtime]</span></code> settings can be shared - scripting, host
and batch scheduler configuration, environment variables, and so on - from
single items up to complete task or app configurations.  At the latter extreme,
it is quite common to have several tasks that inherit the same complete
job configuration followed by minor task-specific additions:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[FILE-CONVERT]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> convert-netcdf</span>
        <span class="c1">#...</span>
    <span class="nt">[[convert-a]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> FILE-CONVERT</span>
        <span class="nt">[[[environment]]]</span>
              <span class="nv">FILE_IN </span><span class="o">=</span><span class="s"> file-a</span>
    <span class="nt">[[convert-b]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> FILE-CONVERT</span>
        <span class="nt">[[[environment]]]</span>
              <span class="nv">FILE_IN </span><span class="o">=</span><span class="s"> file-b</span>
</pre></div>
</div>
<p>Inheritance is covered in more detail from an efficiency perspective in
<a class="reference internal" href="index.html#the-task-family-hierarchy"><span class="std std-ref">The Task Family Hierarchy</span></a>.</p>
</div>
<div class="section" id="shared-task-io-paths">
<span id="id10"></span><h5>16.3.16.3. Shared Task IO Paths<a class="headerlink" href="#shared-task-io-paths" title="Permalink to this headline">¶</a></h5>
<p>If one task uses files generated by another task (and both see the same
filesystem) a common IO path should normally be passed to both tasks via a
shared environment variable. As far as Cylc is concerned this is no different
to other shared configuration items, but there are some additional aspects
of usage worth addressing here.</p>
<p>Primarily, for self-containment (see <a class="reference internal" href="#self-contained-suites"><span class="std std-ref">Self-Contained Suites</span></a>) shared IO
paths should be under the <em>suite share directory</em>, the location of which is
passed to all tasks as <code class="docutils literal notranslate"><span class="pre">$CYLC_SUITE_SHARE_PATH</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">task-env</span></code> utility can provide additional environment
variables that refer to static and cyclepoint-specific locations under the
suite share directory.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[my-task]]</span>
        <span class="nv">env-script </span><span class="o">=</span><span class="s"> $(eval rose task-env -T P1D -T P2D)</span>
</pre></div>
</div>
<p>For a current cycle point of <code class="docutils literal notranslate"><span class="pre">20170105</span></code> this will make the following
variables available to tasks:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">ROSE_DATA</span><span class="o">=</span><span class="nv">$CYLC_SUITE_SHARE_PATH</span>/data
<span class="nv">ROSE_DATAC</span><span class="o">=</span><span class="nv">$CYLC_SUITE_SHARE_PATH</span>/cycle/20170105
<span class="nv">ROSE_DATACP1D</span><span class="o">=</span><span class="nv">$CYLC_SUITE_SHARE_PATH</span>/cycle/20170104
<span class="nv">ROSE_DATACP2D</span><span class="o">=</span><span class="nv">$CYLC_SUITE_SHARE_PATH</span>/cycle/20170103
</pre></div>
</div>
<p>Subdirectories of <code class="docutils literal notranslate"><span class="pre">$ROSE_DATAC</span></code> etc. should be agreed between
different sub-systems of the suite; typically they are named for the
file-generating tasks, and the file-consuming tasks should know to look there.</p>
<p>The share-not-duplicate rule can be relaxed for shared files whose names are
agreed by convention, so long as their locations under the share directory are
proper shared suite variables. For instance the Unified Model uses a large
number of files whose conventional names (<code class="docutils literal notranslate"><span class="pre">glu_snow</span></code>, for example)
can reasonably be expected not to change, so they are typically hardwired into
app configurations (as <code class="docutils literal notranslate"><span class="pre">$ROSE_DATA/glu_snow</span></code>, for example) to avoid
cluttering the suite definition.</p>
<p>Here two tasks share a workspace under the suite share directory
by inheritance:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sharing an I/O location via inheritance.</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">write_data</span> <span class="o">=&gt;</span> <span class="kd">read_data</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nv">env-script </span><span class="o">=</span><span class="s"> $(eval rose task-env)</span>
    <span class="nt">[[WORKSPACE]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">DATA_DIR </span><span class="o">=</span><span class="s"> ${ROSE_DATA}/png</span>
    <span class="nt">[[write_data]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> WORKSPACE</span>
        <span class="nv">script </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">mkdir -p $DATA_DIR</span>
<span class="s2">write-data.exe -o ${DATA_DIR}&quot;&quot;&quot;</span>
    <span class="nt">[[read_data]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> WORKSPACE</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> read-data.exe -i ${DATA_DIR}</span>
</pre></div>
</div>
<p>In simple cases where an appropriate family does not already exist paths can
be shared via Jinja variables:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sharing an I/O location with Jinja2.</span>
<span class="cp">{% set DATA_DIR = &#39;$ROSE_DATA/stuff&#39; %}</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">write_data</span> <span class="o">=&gt;</span> <span class="kd">read_data</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[write_data]]</span>
        <span class="nv">script </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">mkdir -p </span><span class="cp">{{DATA_DIR}}</span><span class="s2"></span>
<span class="s2">write-data.exe -o </span><span class="cp">{{DATA_DIR}}</span><span class="s2">&quot;&quot;&quot;</span>
    <span class="nt">[[read_data]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> read-data.exe -i </span><span class="cp">{{DATA_DIR}}</span>
</pre></div>
</div>
<p>For completeness we note that it is also possible to configure multiple tasks
to use the same work directory so they can all share files in <code class="docutils literal notranslate"><span class="pre">$PWD</span></code>.
(Cylc executes task jobs in special work directories that by default are unique
to each task). This may simplify the suite slightly, and it may be useful if
you are unfortunate enough to have executables that are designed for IO in
<code class="docutils literal notranslate"><span class="pre">$PWD</span></code>, <em>but it is not recommended</em>. There is a higher risk
of interference between tasks; it will break <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">task-run</span></code>
incremental file creation mode; and <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">task-run</span> <span class="pre">--new</span></code> will in
effect delete the work directories of tasks other than its intended target.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># Shared work directory: tasks can read and write in $PWD - use with caution!</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2018</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[P1Y]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">write_data</span> <span class="o">=&gt;</span> <span class="kd">read_data</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[WORKSPACE]]</span>
        <span class="nv">work sub-directory </span><span class="o">=</span><span class="s"> $CYLC_TASK_CYCLE_POINT/datadir</span>
    <span class="nt">[[write_data]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> WORKSPACE</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> write-data.exe</span>
    <span class="nt">[[read_data]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> WORKSPACE</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> read-data.exe</span>
</pre></div>
</div>
</div>
<div class="section" id="varying-behaviour-by-cycle-point">
<h5>16.3.16.4. Varying Behaviour By Cycle Point<a class="headerlink" href="#varying-behaviour-by-cycle-point" title="Permalink to this headline">¶</a></h5>
<p>To make a cycling job behave differently at different cycle points you
<em>could</em> use a single task with scripting that reacts to the cycle point it finds
itself running at, but it is better to use different tasks (in different
cycling sections) that inherit the same base job configuration. This results
in a more transparent suite that can be understood just by inspecting the
graph:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run the same job differently at different cycle points.</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2020-01-01T00</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[T00]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">pre</span> <span class="o">=&gt;</span> <span class="kd">long_fc</span> <span class="o">=&gt;</span> <span class="kd">post</span>
        <span class="nt">[[[T12]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">pre</span> <span class="o">=&gt;</span> <span class="kd">short_fc</span> <span class="o">=&gt;</span> <span class="kd">post</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[MODEL]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> run-model.sh</span>
    <span class="nt">[[long_fc]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> MODEL</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">execution time limit </span><span class="o">=</span><span class="s"> PT30M</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">RUN_LEN </span><span class="o">=</span><span class="s"> PT48H</span>
    <span class="nt">[[short_fc]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> MODEL</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">execution time limit </span><span class="o">=</span><span class="s"> PT10M</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">RUN_LEN </span><span class="o">=</span><span class="s"> PT12H</span>
</pre></div>
</div>
<p>The few differences between <code class="docutils literal notranslate"><span class="pre">short_fc</span></code> and <code class="docutils literal notranslate"><span class="pre">long_fc</span></code>,
including batch scheduler resource requests, can be configured after common
settings are inherited.</p>
</div>
<div class="section" id="at-start-up">
<h5>16.3.16.5. At Start-Up<a class="headerlink" href="#at-start-up" title="Permalink to this headline">¶</a></h5>
<p>Similarly, if a cycling job needs special behaviour at the initial (or any
other) cycle point, just use a different logical task in an <code class="docutils literal notranslate"><span class="pre">R1</span></code> graph and
have it inherit the same job as the general cycling task, not a single task
with scripting that behaves differently if it finds itself running at the
initial cycle point.</p>
</div>
</div>
<div class="section" id="automating-failure-recovery">
<h4>16.3.17. Automating Failure Recovery<a class="headerlink" href="#automating-failure-recovery" title="Permalink to this headline">¶</a></h4>
<div class="section" id="job-submission-retries">
<h5>16.3.17.1. Job Submission Retries<a class="headerlink" href="#job-submission-retries" title="Permalink to this headline">¶</a></h5>
<p>When submitting jobs to a remote host, use job submission retries to
automatically resubmit tasks in the event of network outages. Note this is
distinct from job retries for job execution failure (just below).</p>
<p>Job submission retries should normally be host (or host-group for
<code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">host-select</span></code>) specific, not task-specific, so configure them in
a host (or host-group) specific family. The following suite.rc fragment
configures all HPC jobs to retry on job submission failure up to 10
times at 1 minute intervals, then another 5 times at 1 hour intervals:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[HPC]]</span>  <span class="c1"># Inherited by all jobs submitted to HPC.</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">submission retry delays </span><span class="o">=</span><span class="s"> 10*PT1M, 5*PT1H</span>
</pre></div>
</div>
</div>
<div class="section" id="job-execution-retries">
<h5>16.3.17.2. Job Execution Retries<a class="headerlink" href="#job-execution-retries" title="Permalink to this headline">¶</a></h5>
<p>Automatic retry on job execution failure is useful if you have good reason to
believe that a simple retry will usually succeed. This may be the case if the
job host is known to be flaky, or if the job only ever fails for one known
reason that can be fixed on a retry. For example, if a model fails occasionally
with a numerical instability that can be remedied with a short timestep rerun,
then an automatic retry may be appropriate:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[model]]</span>
        <span class="nv">script </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">if [[ $CYLC_TASK_TRY_NUMBER &gt; 1 ]]; then</span>
<span class="s2">    SHORT_TIMESTEP=true</span>
<span class="s2">else</span>
<span class="s2">    SHORT_TIMESTEP=false</span>
<span class="s2">fi</span>
<span class="s2">model.exe&quot;&quot;&quot;</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">execution retry delays </span><span class="o">=</span><span class="s"> 1*PT0M</span>
</pre></div>
</div>
</div>
<div class="section" id="failure-recovery-workflows">
<h5>16.3.17.3. Failure Recovery Workflows<a class="headerlink" href="#failure-recovery-workflows" title="Permalink to this headline">¶</a></h5>
<p>For recovery from failures that require explicit diagnosis you can configure
alternate routes through the workflow, together with <em>suicide triggers</em>
that remove the unused route. In the following example, if the model fails a
diagnosis task will trigger; if it determines the cause of the failure is a
known numerical instability (e.g. by parsing model job logs) it will succeed,
triggering a short timestep run. Postprocessing can proceed from either the
original or the short-step model run, and suicide triggers remove the unused
path from the workflow:</p>
<div class="twocol docutils container" id="fig-failure-rec">
<div class="image docutils container">
<div class="figure align-center">
<img alt="_images/failure-recovery.png" src="_images/failure-recovery.png" />
</div>
</div>
<div class="caption docutils container">
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
            <span class="kd">model</span> <span class="o">|</span> <span class="kd">model_short</span> <span class="o">=&gt;</span> <span class="kd">postproc</span>
            <span class="kd">model</span><span class="c">:</span><span class="kd">fail</span> <span class="o">=&gt;</span> <span class="kd">diagnose</span> <span class="o">=&gt;</span> <span class="kd">model_short</span>
              <span class="c1"># Clean up with suicide triggers:</span>
            <span class="kd">model</span> <span class="o">=&gt;</span> <span class="c">!</span> <span class="kd">diagnose</span> <span class="o">&amp;</span> <span class="c">!</span> <span class="kd">model_short</span>
            <span class="kd">model_short</span> <span class="o">=&gt;</span> <span class="c">!</span> <span class="kd">model</span><span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="include-files">
<h4>16.3.18. Include Files<a class="headerlink" href="#include-files" title="Permalink to this headline">¶</a></h4>
<p>Include-files should not be overused, but they can sometimes be useful
(e.g. see <a class="reference internal" href="index.html#portable-suites-label"><span class="std std-ref">Portable Suites</span></a>):</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="cp">{% include &#39;inc/foo.rc&#39; %}</span>
</pre></div>
</div>
<p>(Technically this inserts a Jinja2-rendered file template). Cylc also has a
native include mechanism that pre-dates Jinja2 support and literally inlines
the include-file:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="o">%include</span> <span class="s">&#39;inc/foo.rc&#39;</span>
</pre></div>
</div>
<p>The two methods normally produce the same result, but use the Jinja2 version if
you need to construct an include-file name from a variable (because Cylc
include-files get inlined before Jinja2 processing is done):</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="cp">{% include &#39;inc/&#39; ~ SITE ~ &#39;.rc&#39; %}</span>
</pre></div>
</div>
</div>
</div>
<span id="document-suite-design-guide/efficiency"></span><div class="section" id="efficiency-and-maintainability">
<span id="id1"></span><h3>16.4. Efficiency And Maintainability<a class="headerlink" href="#efficiency-and-maintainability" title="Permalink to this headline">¶</a></h3>
<p>Efficiency (in the sense of <em>economy of suite definition</em>) and
maintainability go hand in hand. This section describes techniques for clean
and efficient construction of complex workflows that are easy to understand,
maintain, and modify.</p>
<div class="section" id="the-task-family-hierarchy">
<span id="id2"></span><h4>16.4.1. The Task Family Hierarchy<a class="headerlink" href="#the-task-family-hierarchy" title="Permalink to this headline">¶</a></h4>
<p>A properly designed family hierarchy fulfils three purposes in Cylc:</p>
<ul class="simple">
<li>efficient sharing of all configuration common to groups of related
tasks</li>
<li>efficient bulk triggering, for clear scheduling graphs</li>
<li>clean suite visualization and monitoring, because families are
collapsible in the GUIs</li>
</ul>
<div class="section" id="sharing-by-inheritance">
<span id="id3"></span><h5>16.4.1.1. Sharing By Inheritance<a class="headerlink" href="#sharing-by-inheritance" title="Permalink to this headline">¶</a></h5>
<p>Duplication is a maintenance risk because changes have to be repeated in
multiple places without mistakes. On the other hand, unnecessary sharing of
items via global variables is also bad because it is hard to be sure which
tasks are using which variables. A properly designed runtime inheritance
hierarchy can give every task exactly what it needs, and nothing that it
doesn’t need.</p>
<p>If a group of related tasks has some configuration in common, it can be
factored out into a task family inherited by all.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[OBSPROC]]</span>
        <span class="c1"># Settings common to all obs processing tasks.</span>
    <span class="nt">[[obs1]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> OBSPROC</span>
    <span class="nt">[[obs2]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> OBSPROC</span>
</pre></div>
</div>
<p>If several families have settings in common, they can in turn can inherit
from higher-level families.</p>
<p>Multiple inheritance allows efficient sharing even for overlapping categories
of tasks. For example consider that some obs processing tasks in the following
suite run parallel jobs and some serial:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[SERIAL]]</span>
        <span class="c1"># Serial job settings.</span>
    <span class="nt">[[PARALLEL]]</span>
        <span class="c1"># Parallel job settings.</span>
    <span class="nt">[[OBSPROC]]</span>
        <span class="c1"># Settings for all obs processing tasks.</span>
    <span class="nt">[[obs1, obs2, obs3]]</span>
        <span class="c1"># Serial obs processing tasks.</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> OBSPROC, SERIAL</span>
    <span class="nt">[[obs4, obs5]]</span>
        <span class="c1"># Parallel obs processing tasks.</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> OBSPROC, PARALLEL</span>
</pre></div>
</div>
<p>Note that suite parameters should really be used to define family members
efficiently - see <a class="reference internal" href="#generating-tasks"><span class="std std-ref">Generating Tasks Automatically</span></a>.</p>
<p>Cylc provides tools to help make sense of your inheritance hierarchy:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">graph</span> <span class="pre">-n/--namespaces</span></code> - plot the full multiple
inheritance graph (not the dependency graph)</li>
<li><code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">get-config</span> <span class="pre">SUITE</span></code> - print selected sections or items
after inheritance processing</li>
<li><code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">graph</span> <span class="pre">SUITE</span></code> - plot the dependency graph, with
collapsible first-parent families
(see <a class="reference internal" href="#task-families-and-visualization"><span class="std std-ref">Task Families And Visualization</span></a>)</li>
<li><code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">list</span> <span class="pre">-t/--tree</span> <span class="pre">SUITE</span></code> - print the first-parent
inheritance hierarchy</li>
<li><code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">list</span> <span class="pre">-m/--mro</span> <span class="pre">SUITE</span></code> - print the inheritance
precedence order for each runtime namespace</li>
</ul>
</div>
<div class="section" id="family-triggering">
<h5>16.4.1.2. Family Triggering<a class="headerlink" href="#family-triggering" title="Permalink to this headline">¶</a></h5>
<p>Task families can be used to simplify the scheduling graph wherever many
tasks need to trigger at once:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">pre</span> <span class="o">=&gt;</span> <span class="kd">MODELS</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[MODELS]]</span>
    <span class="nt">[[model1, model2, model3, ...]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> MODELS</span>
</pre></div>
</div>
<p>To trigger <em>off of</em> many tasks at once, family names need to be qualified
by <code class="docutils literal notranslate"><span class="pre">&lt;state&gt;-all</span></code> or <code class="docutils literal notranslate"><span class="pre">&lt;state&gt;-any</span></code> to indicate the desired
member-triggering semantics:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">pre</span> <span class="o">=&gt;</span> <span class="kd">MODELS</span>
                <span class="kd">MODELS</span><span class="c">:</span><span class="kd">succeed</span><span class="c">-</span><span class="kd">all</span> <span class="o">=&gt;</span> <span class="kd">post</span><span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Note that this can be simplified further because Cylc ignores trigger
qualifiers like <code class="docutils literal notranslate"><span class="pre">:succeed-all</span></code> on the right of trigger arrows
to allow chaining of dependencies:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">pre</span> <span class="o">=&gt;</span> <span class="kd">MODELS</span><span class="c">:</span><span class="kd">succeed</span><span class="c">-</span><span class="kd">all</span> <span class="o">=&gt;</span> <span class="kd">post</span>
</pre></div>
</div>
</div>
<div class="section" id="family-to-family-triggering">
<h5>16.4.1.3. Family-to-Family Triggering<a class="headerlink" href="#family-to-family-triggering" title="Permalink to this headline">¶</a></h5>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">BIG_FAM_1</span><span class="c">:</span><span class="kd">succeed</span><span class="c">-</span><span class="kd">all</span> <span class="o">=&gt;</span> <span class="kd">BIG_FAM_2</span>
</pre></div>
</div>
<p>This means every member of <code class="docutils literal notranslate"><span class="pre">BIG_FAM_2</span></code> depends on every member
of <code class="docutils literal notranslate"><span class="pre">BIG_FAM_1</span></code> succeeding. For very large families this can create so
many dependencies that it affects the performance of Cylc at run time, as
well as cluttering graph visualizations with unnecessary edges. Instead,
interpose a dummy task that signifies completion of the first family:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">BIG_FAM_1</span><span class="c">:</span><span class="kd">succeed</span><span class="c">-</span><span class="kd">all</span> <span class="o">=&gt;</span> <span class="kd">big_fam_1_done</span> <span class="o">=&gt;</span> <span class="kd">BIG_FAM_2</span>
</pre></div>
</div>
<p>For families with <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">N</span></code> members respectively, this
reduces the number of dependencies from <code class="docutils literal notranslate"><span class="pre">M*N</span></code> to <code class="docutils literal notranslate"><span class="pre">M+N</span></code>
without affecting the scheduling.</p>
<img alt="_images/fam-to-fam-1.png" src="_images/fam-to-fam-1.png" />
<img alt="_images/fam-to-fam-2.png" src="_images/fam-to-fam-2.png" />
</div>
<div class="section" id="task-families-and-visualization">
<span id="id4"></span><h5>16.4.1.4. Task Families And Visualization<a class="headerlink" href="#task-families-and-visualization" title="Permalink to this headline">¶</a></h5>
<p><em>First parents</em> in the inheritance hierarchy double as collapsible summary
groups for visualization and monitoring. Tasks should generally be grouped into
visualization families that reflect their logical purpose in the suite rather
than technical detail such as inherited job submission or host settings. So in
the example under <a class="reference internal" href="#sharing-by-inheritance"><span class="std std-ref">Sharing By Inheritance</span></a> above all
<code class="docutils literal notranslate"><span class="pre">obs&lt;n&gt;</span></code> tasks collapse into <code class="docutils literal notranslate"><span class="pre">OBSPROC</span></code> but not into
<code class="docutils literal notranslate"><span class="pre">SERIAL</span></code> or <code class="docutils literal notranslate"><span class="pre">PARALLEL</span></code>.</p>
<p>If necessary you can introduce new namespaces just for visualization:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[MODEL]]</span>
        <span class="c1"># (No settings here - just for visualization).</span>
    <span class="nt">[[model1, model2]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> MODEL, HOSTX</span>
    <span class="nt">[[model3, model4]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> MODEL, HOSTY</span>
</pre></div>
</div>
<p>To stop a solo parent being used in visualization, demote it to secondary with
a null parent like this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[SERIAL]]</span>
    <span class="nt">[[foo]]</span>
        <span class="c1"># Inherit settings from SERIAL but don&#39;t use it in visualization.</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> None, SERIAL</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="generating-tasks-automatically">
<span id="generating-tasks"></span><h4>16.4.2. Generating Tasks Automatically<a class="headerlink" href="#generating-tasks-automatically" title="Permalink to this headline">¶</a></h4>
<p>Groups of tasks that are closely related such as an ensemble of model runs or
a family of obs processing tasks, or sections of workflow that are repeated
with minor variations, can be generated automatically by iterating over
some integer range (e.g. <code class="docutils literal notranslate"><span class="pre">model&lt;n&gt;</span></code> for <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">=</span> <span class="pre">1..10</span></code>) or
list of strings (e.g. <code class="docutils literal notranslate"><span class="pre">obs&lt;type&gt;</span></code> for
<code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">=</span> <span class="pre">ship,</span> <span class="pre">buoy,</span> <span class="pre">radiosonde,</span> <span class="pre">...</span></code>).</p>
<div class="section" id="jinja2-loops">
<h5>16.4.2.1. Jinja2 Loops<a class="headerlink" href="#jinja2-loops" title="Permalink to this headline">¶</a></h5>
<p>Task generation was traditionally done in Cylc with explicit Jinja2 loops,
like this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># Task generation the old way: Jinja2 loops (NO LONGER RECOMMENDED!)</span>
<span class="cp">{% set PARAMS = range(1,11) %}</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="cp">{% for P in PARAMS %}</span>
      <span class="kd">pre</span> <span class="o">=&gt;</span> <span class="kd">model_p</span><span class="cp">{{P}}</span> <span class="o">=&gt;</span> <span class="kd">post</span>
      <span class="cp">{% if P == 5 %}</span>
          <span class="kd">model_p</span><span class="cp">{{P}}</span> <span class="o">=&gt;</span> <span class="kd">check</span>
      <span class="cp">{% endif %}</span>
<span class="cp">{% endfor %}</span>    <span class="s2">&quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
<span class="cp">{% for P in PARAMS %}</span>
    <span class="nt">[[model_p</span><span class="cp">{{P}}</span><span class="nt">]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> echo &quot;my parameter value is </span><span class="cp">{{P}}</span><span class="s">&quot;</span>
    <span class="cp">{% if P == 1 %}</span>
        <span class="c1"># special case...</span>
    <span class="cp">{% endif %}</span>
<span class="cp">{% endfor %}</span>
</pre></div>
</div>
<p>Unfortunately this makes a mess of the suite definition, particularly the
scheduling graph, and it gets worse with nested loops over multiple parameters.</p>
<img alt="_images/param-1.png" src="_images/param-1.png" />
</div>
<div class="section" id="parameterized-tasks">
<span id="sdg-parameterized-tasks"></span><h5>16.4.2.2. Parameterized Tasks<a class="headerlink" href="#parameterized-tasks" title="Permalink to this headline">¶</a></h5>
<p>Cylc-6.11 introduced built-in <em>suite parameters</em> for generating tasks
without destroying the clarity of the base suite definition. Here’s the same
example using suite parameters instead of Jinja2 loops:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># Task generation the new way: suite parameters.</span>
<span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">p </span><span class="o">=</span><span class="s"> 1..10</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="kd">pre</span> <span class="o">=&gt;</span> <span class="kd">model</span>&lt;<span class="nb">p</span>&gt; <span class="o">=&gt;</span> <span class="kd">post</span>
                <span class="kd">model</span>&lt;<span class="nb">p=5</span>&gt; <span class="o">=&gt;</span> <span class="kd">check</span><span class="s2">&quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[model</span>&lt;<span class="nb">p</span>&gt;<span class="nt">]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> echo &quot;my parameter value is ${CYLC_TASK_PARAM_p}&quot;</span>
    <span class="nt">[[model</span>&lt;<span class="nb">p=7</span>&gt;<span class="nt">]]</span>
        <span class="c1"># special case ...</span>
</pre></div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">model&lt;p&gt;</span></code> expands to <code class="docutils literal notranslate"><span class="pre">model_p7</span></code> for <code class="docutils literal notranslate"><span class="pre">p=7</span></code>,
and so on, via the default expansion template for integer-valued parameters,
but custom templates can be defined if necessary. Parameters can also be
defined as lists of strings, and you can define dependencies between different
values: <code class="docutils literal notranslate"><span class="pre">chunk&lt;p-1&gt;</span> <span class="pre">=&gt;</span> <span class="pre">chunk&lt;p&gt;</span></code>.  Here’s a multi-parameter example:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">run </span><span class="o">=</span><span class="s"> a, b, c</span>
        <span class="nv">m </span><span class="o">=</span><span class="s"> 1..5</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">pre</span> <span class="o">=&gt;</span> <span class="kd">init</span>&lt;<span class="nb">run</span>&gt; <span class="o">=&gt;</span> <span class="kd">sim</span>&lt;<span class="nb">run,m</span>&gt; <span class="o">=&gt;</span> <span class="kd">close</span>&lt;<span class="nb">run</span>&gt; <span class="o">=&gt;</span> <span class="kd">post</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[sim</span>&lt;<span class="nb">run,m</span>&gt;<span class="nt">]]</span>
</pre></div>
</div>
<img alt="_images/param-2.png" src="_images/param-2.png" />
<p>If family members are defined by suite parameters, then parameterized
trigger expressions are equivalent to family <code class="docutils literal notranslate"><span class="pre">:&lt;state&gt;-all</span></code> triggers.
For example, this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">n </span><span class="o">=</span><span class="s"> 1..5</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">pre</span> <span class="o">=&gt;</span> <span class="kd">model</span>&lt;<span class="nb">n</span>&gt; <span class="o">=&gt;</span> <span class="kd">post</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[MODELS]]</span>
    <span class="nt">[[model</span>&lt;<span class="nb">n</span>&gt;<span class="nt">]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> MODELS</span>
</pre></div>
</div>
<p>is equivalent to this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nt">[[parameters]]</span>
        <span class="nv">n </span><span class="o">=</span><span class="s"> 1..5</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">pre</span> <span class="o">=&gt;</span> <span class="kd">MODELS</span><span class="c">:</span><span class="kd">succeed</span><span class="c">-</span><span class="kd">all</span> <span class="o">=&gt;</span> <span class="kd">post</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[MODELS]]</span>
    <span class="nt">[[model</span>&lt;<span class="nb">n</span>&gt;<span class="nt">]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> MODELS</span>
</pre></div>
</div>
<p>(but future plans for family triggering may make the second case more
efficient for very large families).</p>
<p>For more information on parameterized tasks see the Cylc user guide.</p>
</div>
</div>
<div class="section" id="optional-app-config-files">
<span id="id5"></span><h4>16.4.3. Optional App Config Files<a class="headerlink" href="#optional-app-config-files" title="Permalink to this headline">¶</a></h4>
<p>Closely related tasks with few configuration differences between them - such as
multiple UM forecast and reconfiguration apps in the same suite - should use
the same Rose app configuration with the differences supplied by optional
configs, rather than duplicating the entire app for each task.</p>
<p>Optional app configs should be valid on top of the main app config and not
dependent on the use of other optional app configs. This ensures they will
work correctly with macros and can therefore be upgraded automatically.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Currently optional configs don’t work very well with UM STASH
configuration - see <a class="reference internal" href="index.html#um-stash-in-optional-app-configs"><span class="std std-ref">UM STASH in Optional App Configs</span></a>.</p>
</div>
<p>Optional app configs can be loaded by command line switch:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rose task-run -O key1 -O key2
</pre></div>
</div>
<p>or by environment variable:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">ROSE_APP_OPT_CONF_KEYS</span> <span class="o">=</span> key1 key2
</pre></div>
</div>
<p>The environment variable is generally preferred in suites because you don’t
have to repeat and override the root-level script configuration:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> rose task-run -v</span>
    <span class="nt">[[foo]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">ROSE_APP_OPT_CONF_KEYS </span><span class="o">=</span><span class="s"> key1 key2</span>
</pre></div>
</div>
</div>
</div>
<span id="document-suite-design-guide/portable-suites"></span><div class="section" id="portable-suites">
<span id="portable-suites-label"></span><h3>16.5. Portable Suites<a class="headerlink" href="#portable-suites" title="Permalink to this headline">¶</a></h3>
<p>A <em>portable</em> or <em>interoperable</em> suite can run “out of the box” at
different sites, or in different environments such as research and operations
within a site.  For convenience we just use the term <em>site portability</em>.</p>
<p>Lack of portability is a major barrier to collaborative development when
sites need to run more or less the same workflow, because it is very
difficult to translate changes manually between large, complicated suites.</p>
<p>Most suites are riddled with site-specific details such as local build
configurations, file paths, host names, and batch scheduler directives, etc.;
but it is possible to cleanly factor all this out to make a portable suite.
Significant variations in workflow structure can even be accommodated quite
easily. If the site workflows are <em>too different</em>, however, you may decide
that it is appropriate for each site to maintain separate suites.</p>
<p>The recommended way to do this, which we expand on below, is:</p>
<ul class="simple">
<li>Put all site-specific settings in include-files loaded at the end
of a generic “core” suite definition.</li>
<li>Use “optional” app config files for site-specific variations
in the core suite’s Rose apps.</li>
<li>(Make minimal use of inlined site switches too, if necessary).</li>
<li>When referencing files, reference them within the suite structure and
use an install task to link external files in.</li>
</ul>
<p>The result should actually be tidier than the original in one respect: all
the messy platform-specific resource directives etc., will be hidden away in
the site include-files.</p>
<div class="section" id="the-jinja2-site-variable">
<h4>16.5.1. The Jinja2 SITE Variable<a class="headerlink" href="#the-jinja2-site-variable" title="Permalink to this headline">¶</a></h4>
<p>First a suite Jinja2 variable called <code class="docutils literal notranslate"><span class="pre">SITE</span></code> should be set to the site
name, either in <code class="docutils literal notranslate"><span class="pre">rose-suite.conf</span></code>, or in the suite definition itself
(perhaps automatically, by querying the local environment in some way).</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="ch">#!Jinja2</span>
<span class="cp">{% set SITE = &quot;niwa&quot; %}</span>
<span class="c1">#...</span>
</pre></div>
</div>
<p>This will be used to select site-specific configuration, as described below.</p>
</div>
<div class="section" id="site-include-files">
<h4>16.5.2. Site Include-Files<a class="headerlink" href="#site-include-files" title="Permalink to this headline">¶</a></h4>
<p>If a section heading in a suite.rc file is repeated the items under it simply
add to or override those defined under the same section earlier in the file
(but note <a class="reference internal" href="index.html#list-item-override-in-site-include-files"><span class="std std-ref">List Item Override In Site Include-Files</span></a>).
For example, this task definition:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> run-foo.sh</span>
        <span class="nt">[[[remote]]]</span>
            <span class="nv">host </span><span class="o">=</span><span class="s"> hpc1.niwa.co.nz</span>
</pre></div>
</div>
<p>can equally be written like this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>  <span class="c1"># Part 1 (site-agnostic).</span>
    <span class="nt">[[foo]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> run-foo.sh</span>
<span class="nt">[runtime]</span>  <span class="c1"># Part 2 (site-specific).</span>
    <span class="nt">[[foo]]</span>
        <span class="nt">[[[remote]]]</span>
            <span class="nv">host </span><span class="o">=</span><span class="s"> hpc1.niwa.co.nz</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If Part 2 had also defined <code class="docutils literal notranslate"><span class="pre">script</span></code> the new value would
override the original. It can sometimes be useful to set a widely used
default and override it in a few cases, but be aware that this can
make it more difficult to determine the origin of affected values.</p>
</div>
<p>In this way all site-specific <code class="docutils literal notranslate"><span class="pre">[runtime]</span></code> settings, with their
respective sub-section headings, can be moved to the end of the file, and then
out into an include-file (file inclusion is essentially just literal inlining):</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="cp">{% set SITE = &quot;niwa&quot; %}</span>

<span class="c1"># Core site-agnostic settings:</span>
<span class="c1">#...</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> run-foo.sh</span>
<span class="c1">#...</span>

<span class="c1"># Site-specific settings:</span>
<span class="cp">{% include &#39;site/&#39; ~ SITE ~ &#39;.rc&#39; %}</span>
</pre></div>
</div>
<p>where the site include-file <code class="docutils literal notranslate"><span class="pre">site/niwa.rc</span></code> contains:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># site/niwa.rc</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nt">[[[remote]]]</span>
            <span class="nv">host </span><span class="o">=</span><span class="s"> hpc1.niwa.co.nz</span>
</pre></div>
</div>
</div>
<div class="section" id="site-specific-graphs">
<h4>16.5.3. Site-Specific Graphs<a class="headerlink" href="#site-specific-graphs" title="Permalink to this headline">¶</a></h4>
<p>Repeated <code class="docutils literal notranslate"><span class="pre">graph</span></code> strings under the same graph section headings are
always additive (graph strings are the only exception to the normal repeat item
override semantics). So, for instance, this graph:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2025</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[P1Y]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">pre</span> <span class="o">=&gt;</span> <span class="kd">model</span> <span class="o">=&gt;</span> <span class="kd">post</span> <span class="o">=&gt;</span> <span class="kd">niwa_archive</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>can be written like this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2025</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[P1Y]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">pre</span> <span class="o">=&gt;</span> <span class="kd">model</span> <span class="o">=&gt;</span> <span class="kd">post</span><span class="c">&quot;</span>
        <span class="nt">[[[P1Y]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">post</span> <span class="o">=&gt;</span> <span class="kd">niwa_archive</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>and again, the site-specific part can be taken out to a site include-file:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="cp">{% set SITE = &quot;niwa&quot; %}</span>

<span class="c1"># Core site-agnostic settings.</span>
<span class="c1">#...</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2025</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[P1Y]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">pre</span> <span class="o">=&gt;</span> <span class="kd">model</span> <span class="o">=&gt;</span> <span class="kd">post</span><span class="c">&quot;</span>
<span class="c1">#...</span>
<span class="c1"># Site-specific settings:</span>
<span class="cp">{% include &#39;site/&#39; ~ SITE ~ &#39;.rc&#39; %}</span>
</pre></div>
</div>
<p>where the site include-file <code class="docutils literal notranslate"><span class="pre">site/niwa.rc</span></code> contains:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># site/niwa.rc</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[P1Y]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="c">&quot;</span><span class="kd">post</span> <span class="o">=&gt;</span> <span class="kd">niwa_archive</span><span class="c">&quot;</span>
</pre></div>
</div>
<p>Note that the site-file graph needs to define the dependencies of the
site-specific tasks, and thus their points of connection to the core
suite - which is why the core task <code class="docutils literal notranslate"><span class="pre">post</span></code> appears in the graph here (if
<code class="docutils literal notranslate"><span class="pre">post</span></code> had any site-specific runtime settings, to get it to run at
this site, they would also be in the site-file).</p>
</div>
<div class="section" id="inlined-site-switching">
<span id="id1"></span><h4>16.5.4. Inlined Site-Switching<a class="headerlink" href="#inlined-site-switching" title="Permalink to this headline">¶</a></h4>
<p>It may be tempting to use inlined switch blocks throughout the suite instead of
site include-files, but <em>this is not recommended</em> - it is verbose and
untidy (the greater the number of supported sites, the bigger the
mess) and it exposes all site configuration to all users:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[model]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> run-model.sh</span>
<span class="c c-Multi">{# Site switch blocks not recommended:#}</span>
<span class="cp">{% if SITE == &#39;niwa&#39; %}</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> loadleveler</span>
        <span class="nt">[[[directives]]]</span>
            <span class="c1"># NIWA Loadleveler directives...</span>
<span class="cp">{% elif SITE == &#39;metoffice&#39; %}</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> pbs</span>
        <span class="nt">[[[directives]]]</span>
            <span class="c1"># Met Office PBS directives...</span>
<span class="cp">{% elif SITE == ... %}</span>
            <span class="c1">#...</span>
<span class="cp">{% else %}</span>
    <span class="cp">{{raise(&#39;Unsupported site: &#39; ~ SITE)}}</span>
<span class="cp">{% endif %}</span>
    <span class="c1">#...</span>
</pre></div>
</div>
<p>Inlined switches can be used, however, to configure exceptional behaviour at
one site without requiring the other sites to duplicate the default behaviour.
But be wary of accumulating too many of these switches:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># (core suite.rc file)</span>
<span class="c1">#...</span>
<span class="cp">{% if SITE == &#39;small&#39; %}</span>
   <span class="c c-Multi">{# We can&#39;t run 100 members... #}</span>
   <span class="cp">{% set ENSEMBLE_SIZE = 25 %}</span>
<span class="cp">{% else %}</span>
   <span class="c c-Multi">{# ...but everyone else can! #}</span>
   <span class="cp">{% set ENSEMBLE_SIZE = 100 %}</span>
<span class="cp">{% endif %}</span>
<span class="c1">#...</span>
</pre></div>
</div>
<p>Inlined switches can also be used to temporarily isolate a site-specific
change to a hitherto non site-specific part of the suite, thereby avoiding the
need to update all site include-files before getting agreement from the suite
owner and collaborators.</p>
</div>
<div class="section" id="site-specific-suite-variables">
<h4>16.5.5. Site-Specific Suite Variables<a class="headerlink" href="#site-specific-suite-variables" title="Permalink to this headline">¶</a></h4>
<p>It can sometimes be useful to set site-specific values of suite variables that
aren’t exposed to users via <code class="docutils literal notranslate"><span class="pre">rose-suite.conf</span></code>. For example, consider
a suite that can run a special post-processing workflow of some kind at sites
where IDL is available. The IDL-dependence switch can be set per site like this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="cp">{% from SITE ~ &#39;-vars.rc&#39; import HAVE_IDL, OTHER_VAR %}</span>
<span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
  <span class="kd">pre</span> <span class="o">=&gt;</span> <span class="kd">model</span> <span class="o">=&gt;</span> <span class="kd">post</span>
<span class="cp">{% if HAVE_IDL %}</span>
      <span class="kd">post</span> <span class="o">=&gt;</span> <span class="kd">idl</span><span class="c">-</span><span class="kd">1</span> <span class="o">=&gt;</span> <span class="kd">idl</span><span class="c">-</span><span class="kd">2</span> <span class="o">=&gt;</span> <span class="kd">idl</span><span class="c">-</span><span class="kd">3</span>
<span class="cp">{% endif %}</span>
        <span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>where for <code class="docutils literal notranslate"><span class="pre">SITE</span> <span class="pre">=</span> <span class="pre">niwa</span></code> the file <code class="docutils literal notranslate"><span class="pre">niwa-vars.rc</span></code> contains:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c c-Multi">{# niwa-vars.rc #}</span>
<span class="cp">{% set HAVE_IDL = True %}</span>
<span class="cp">{% set OTHER_VAR = &quot;the quick brown fox&quot; %}</span>
</pre></div>
</div>
<p>Note we are assuming there are significantly fewer options (IDL or not, in this
case) than sites, otherwise the IDL workflow should just go in the site
include-files of the sites that need it.</p>
</div>
<div class="section" id="site-specific-optional-suite-configs">
<h4>16.5.6. Site-Specific Optional Suite Configs<a class="headerlink" href="#site-specific-optional-suite-configs" title="Permalink to this headline">¶</a></h4>
<p>During development and testing of a portable suite you can use an optional Rose
suite config file to automatically set site-specific suite inputs and thereby
avoid the need to make manual changes every time you check out and run a new
version. The site switch itself has to be set of course, but there may be other
settings too such as model parameters for a standard local test domain. Just
put these settings in <code class="docutils literal notranslate"><span class="pre">opt/rose-suite-niwa.conf</span></code> (for site “niwa”)
and run the suite with <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">suite-run</span> <span class="pre">-O</span> <span class="pre">niwa</span></code>.</p>
</div>
<div class="section" id="site-agnostic-file-paths-in-app-configs">
<h4>16.5.7. Site-Agnostic File Paths in App Configs<a class="headerlink" href="#site-agnostic-file-paths-in-app-configs" title="Permalink to this headline">¶</a></h4>
<p>Where possible apps should be configured to reference files within the suite
structure itself rather than outside of it. This makes the apps themselves
portable and it becomes the job of the install task to ensure all required
source files are available within the suite structure e.g. via symlink into
the share directory. Additionally, by moving the responsibility of linking
files into the suite to an install task you gain the added benefit of knowing
if a file is missing at the start of a suite rather than part way into a run.</p>
</div>
<div class="section" id="site-specific-optional-app-configs">
<h4>16.5.8. Site-Specific Optional App Configs<a class="headerlink" href="#site-specific-optional-app-configs" title="Permalink to this headline">¶</a></h4>
<p>Typically a few but not all apps will need some site customization, e.g. for
local archive configuration, local science options, or whatever. To avoid
explicit site-customization of individual task-run command lines use Rose’s
built-in <em>optional app config</em> capability:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> rose task-run -v -O &#39;(</span><span class="cp">{{SITE}}</span><span class="s">)&#39;</span>
</pre></div>
</div>
<p>Normally a missing optional app config is considered to be an error, but the
round parentheses here mean the named optional config is optional - i.e.
use it if it exists, otherwise ignore.</p>
<p>With this setting in place we can simply add a <code class="docutils literal notranslate"><span class="pre">opt/rose-app-niwa.conf</span></code> to
any app that needs customization at <code class="docutils literal notranslate"><span class="pre">SITE</span> <span class="pre">=</span> <span class="pre">niwa</span></code>.</p>
</div>
<div class="section" id="an-example">
<h4>16.5.9. An Example<a class="headerlink" href="#an-example" title="Permalink to this headline">¶</a></h4>
<p>The following small suite is not portable because all of its tasks are
submitted to a NIWA HPC host; two task are entirely NIWA-specific in that they
respectively install files from a local database and upload products to a local
distribution system; and one task runs a somewhat NIWA-specific configuration
of a model. The remaining tasks are site-agnostic apart from local job host
and batch scheduler directives.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nv">UTC mode </span><span class="o">=</span><span class="s"> True</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2017-01-01</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[R1]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">install_niwa</span> <span class="o">=&gt;</span> <span class="kd">preproc</span>
        <span class="nt">[[[P1D]]]</span>
            <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
                <span class="kd">preproc</span> <span class="o">&amp;</span> <span class="kd">model</span>[<span class="nb">-P1D</span>] <span class="o">=&gt;</span> <span class="kd">model</span> <span class="o">=&gt;</span> <span class="kd">postproc</span> <span class="o">=&gt;</span> <span class="kd">upload_niwa</span>
                <span class="kd">postproc</span> <span class="o">=&gt;</span> <span class="kd">idl</span><span class="c">-</span><span class="kd">1</span> <span class="o">=&gt;</span> <span class="kd">idl</span><span class="c">-</span><span class="kd">2</span> <span class="o">=&gt;</span> <span class="kd">idl</span><span class="c">-</span><span class="kd">3</span><span class="s2">&quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> rose task-run -v</span>
    <span class="nt">[[HPC]]</span>  <span class="c1"># NIWA job host and batch scheduler settings.</span>
        <span class="nt">[[[remote]]]</span>
            <span class="nv">host </span><span class="o">=</span><span class="s"> hpc1.niwa.co.nz</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> loadleveler</span>
        <span class="nt">[[[directives]]]</span>
            <span class="nv">account_no </span><span class="o">=</span><span class="s"> NWP1623</span>
            <span class="nv">class </span><span class="o">=</span><span class="s"> General</span>
            <span class="nv">job_type </span><span class="o">=</span><span class="s"> serial</span>  <span class="c1"># (most jobs in this suite are serial)</span>
    <span class="nt">[[install_niwa]]</span>  <span class="c1"># NIWA-specific file installation task.</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> HPC</span>
    <span class="nt">[[preproc]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> HPC</span>
    <span class="nt">[[model]]</span>  <span class="c1"># Run the model on a local test domain.</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> HPC</span>
        <span class="nt">[[[directives]]]</span>  <span class="c1"># Override the serial job_type setting.</span>
            <span class="nv">job_type </span><span class="o">=</span><span class="s"> parallel</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">SPEED </span><span class="o">=</span><span class="s"> fast</span>
    <span class="nt">[[postproc]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> HPC</span>
    <span class="nt">[[upload_niwa]]</span>  <span class="c1"># NIWA-specific product upload.</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> HPC</span>
</pre></div>
</div>
<p>To make this portable, refactor it into a core suite.rc file that contains the
clean site-independent workflow configuration and loads all site-specific
settings from an include-file at the end:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># suite.rc: CORE SITE-INDEPENDENT CONFIGURATION.</span>
<span class="cp">{% set SITE = &#39;niwa&#39; %}</span>
<span class="cp">{% from &#39;site/&#39; ~ SITE ~ &#39;-vars.rc&#39; import HAVE_IDL %}</span>
<span class="nt">[cylc]</span>
    <span class="nv">UTC mode </span><span class="o">=</span><span class="s"> True</span>
<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2017-01-01</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[P1D]]]</span>
            <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="kd">preproc</span> <span class="o">&amp;</span> <span class="kd">model</span>[<span class="nb">-P1D</span>] <span class="o">=&gt;</span> <span class="kd">model</span> <span class="o">=&gt;</span> <span class="kd">postproc</span>
<span class="cp">{% if HAVE_IDL %}</span>
    <span class="kd">postproc</span> <span class="o">=&gt;</span> <span class="kd">idl</span><span class="c">-</span><span class="kd">1</span> <span class="o">=&gt;</span> <span class="kd">idl</span><span class="c">-</span><span class="kd">2</span> <span class="o">=&gt;</span> <span class="kd">idl</span><span class="c">-</span><span class="kd">3</span>
<span class="cp">{% endif %}</span>
                    <span class="s2">&quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> rose task-run -v -O &#39;(</span><span class="cp">{{SITE}}</span><span class="s">)&#39;</span>
    <span class="nt">[[preproc]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> HPC</span>
    <span class="nt">[[preproc]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> HPC</span>
    <span class="nt">[[model]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> HPC</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">SPEED </span><span class="o">=</span><span class="s"> fast</span>
<span class="cp">{% include &#39;site/&#39; ~ SITE ~ &#39;.rc&#39; %}</span>
</pre></div>
</div>
<p>plus site files <code class="docutils literal notranslate"><span class="pre">site/niwa-vars.rc</span></code>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># site/niwa-vars.rc: NIWA SITE SETTINGS FOR THE EXAMPLE SUITE.</span>
<span class="cp">{% set HAVE_IDL = True %}</span>
</pre></div>
</div>
<p>and <code class="docutils literal notranslate"><span class="pre">site/niwa.rc</span></code>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1"># site/niwa.rc: NIWA SITE SETTINGS FOR THE EXAMPLE SUITE.</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[R1]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">install_niwa</span> <span class="o">=&gt;</span> <span class="kd">preproc</span>
        <span class="nt">[[[P1D]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">postproc</span> <span class="o">=&gt;</span> <span class="kd">upload_niwa</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[HPC]]</span>
        <span class="nt">[[[remote]]]</span>
            <span class="nv">host </span><span class="o">=</span><span class="s"> hpc1.niwa.co.nz</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> loadleveler</span>
        <span class="nt">[[[directives]]]</span>
            <span class="nv">account_no </span><span class="o">=</span><span class="s"> NWP1623</span>
            <span class="nv">class </span><span class="o">=</span><span class="s"> General</span>
            <span class="nv">job_type </span><span class="o">=</span><span class="s"> serial</span>  <span class="c1"># (most jobs in this suite are serial)</span>
    <span class="nt">[[install_niwa]]</span>  <span class="c1"># NIWA-specific file installation.</span>
    <span class="nt">[[model]]</span>
        <span class="nt">[[[directives]]]</span>  <span class="c1"># Override the serial job_type setting.</span>
            <span class="nv">job_type </span><span class="o">=</span><span class="s"> parallel</span>
    <span class="nt">[[upload_niwa]]</span>  <span class="c1"># NIWA-specific product upload.</span>
</pre></div>
</div>
<p>and finally, an optional app config file for the local model domain:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>app/model/rose-app.conf  <span class="c1"># Main app config.</span>
app/model/opt/rose-app-niwa.conf  <span class="c1"># NIWA site settings.</span>
</pre></div>
</div>
<p>Some points to note:</p>
<ul class="simple">
<li>It is straightforward to extend support to a new site by copying an
existing site file(s) and adapting it to the new job host and batch
scheduler etc.</li>
<li>Batch system directives should be considered site-specific unless
all supported sites have the same batch system and the same host
architecture (including CPU clock speed and memory size etc.).</li>
<li>We’ve assumed that all tasks run on a single HPC host at both
sites. If that’s not a valid assumption the <code class="docutils literal notranslate"><span class="pre">HPC</span></code> family
inheritance relationships would have to become site-specific.</li>
<li>Core task runtime configuration aren’t needed in site files at all
if their job host and batch system settings can be defined in common
families that are (<code class="docutils literal notranslate"><span class="pre">HPC</span></code> in this case).</li>
</ul>
</div>
<div class="section" id="collaborative-development-model">
<span id="id2"></span><h4>16.5.10. Collaborative Development Model<a class="headerlink" href="#collaborative-development-model" title="Permalink to this headline">¶</a></h4>
<p>Official releases of a portable suite should be made from the suite trunk.</p>
<p>Changes should be developed on feature branches so as not to affect other users
of the suite.</p>
<p>Site-specific changes shouldn’t touch the core suite.rc file, just the relevant
site include-file, and therefore should not need close scrutiny from other
sites.</p>
<p>Changes to the core suite.rc file should be agreed by all stakeholders, and
should be carefully checked for effects on site include-files:</p>
<ul class="simple">
<li>Changing the name of tasks or families in the core suite may break
sites that add configuration to the original runtime namespace.</li>
<li>Adding new tasks or families to the core suite may require
corresponding additions to the site files.</li>
<li>Deleting tasks or families from the core suite may require
corresponding parts of the site files to be removed. And also, check for
site-specific triggering off of deleted tasks or families.</li>
</ul>
<p>However, if the owner site has to get some changes into the trunk before all
collaborating sites have time to test them, version control will of course
protect those lagging behind from any immediate ill effects.</p>
<p>When a new feature is complete and tested at the developer’s site, the suite
owner should check out the branch, review and test it, and if necessary request
that other sites do the same and report back. The owner can then merge the
new feature to the trunk once satisfied.</p>
<p>All planning and discussion associated with the change should be documented on
MOSRS Trac tickets associated with the suite.</p>
</div>
<div class="section" id="research-to-operations-transition">
<h4>16.5.11. Research-To-Operations Transition<a class="headerlink" href="#research-to-operations-transition" title="Permalink to this headline">¶</a></h4>
<p>Under this collaborative development model it is <em>possible</em> to use the
same suite in research and operations, largely eliminating the difficult
translation between the two environments. Where appropriate, this can save
a lot of work.</p>
<p>Operations-specific parts of the suite should be factored out (as for site
portability) into include-files that are only loaded in the operational
environment. Improvements and upgrades can be developed on feature branches in
the research environment. Operations staff can check out completed feature
branches for testing in the operational environment before merging to trunk or
referring back to research if problems are found. After sufficient testing the
new suite version can be deployed into operations.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This obviously glosses over the myriad complexities of the technical
and scientific testing and validation of suite upgrades; it merely describes
what is possible from a suite design and collaborative development
perspective.</p>
</div>
</div>
</div>
<span id="document-suite-design-guide/roadmap"></span><div class="section" id="roadmap">
<h3>16.6. Roadmap<a class="headerlink" href="#roadmap" title="Permalink to this headline">¶</a></h3>
<p>Several planned future developments in Rose and Cylc may have an impact on
suite design.</p>
<div class="section" id="list-item-override-in-site-include-files">
<span id="id1"></span><h4>16.6.1. List Item Override In Site Include-Files<a class="headerlink" href="#list-item-override-in-site-include-files" title="Permalink to this headline">¶</a></h4>
<p>A few Cylc config items hold lists of task (or family) names, e.g.:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[special tasks]]</span>
        <span class="nv">clock-trigger </span><span class="o">=</span><span class="s"> get-data-a, get-data-b</span>
    <span class="c1">#...</span>
<span class="c1">#...</span>
</pre></div>
</div>
<p>Currently a repeated config item completely overrides a previously set value
(apart from graph strings which are always additive). This means a site
include-file (for example) can’t add a new site-specific clock-triggered task
without writing out the complete list of all clock-triggered tasks in the
suite, which breaks the otherwise clean separation into core and site files.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the future we <a class="reference external" href="https://github.com/cylc/cylc-flow/issues/1363">plan to</a>
support add, subtract, unset, and override semantics for all items.</p>
</div>
</div>
<div class="section" id="um-stash-in-optional-app-configs">
<span id="id2"></span><h4>16.6.2. UM STASH in Optional App Configs<a class="headerlink" href="#um-stash-in-optional-app-configs" title="Permalink to this headline">¶</a></h4>
<p>A caveat to the advice on use of option app configs in
<a class="reference internal" href="index.html#optional-app-config-files"><span class="std std-ref">Optional App Config Files</span></a>: in general you might need the ability
to turn off or modify some STASH requests in the main
app, not just add additional site-specific
STASH. But overriding STASH in optional configs is fragile because STASH
namelists names are automatically generated from a <em>hash</em> of the precise
content of the namelist. This makes it possible to uniquely identify the same
STASH requests in different apps, but if any detail of a STASH request changes
in a main app its namelist name will change and any optional configs that refer
to it will become divorced from their intended target.</p>
<p>Until this problem is solved we recommend that:</p>
<ul class="simple">
<li>All STASH in main UM apps should be grouped into sensible
<em>packages</em> that can be turned on and off in optional configs without
referencing the individual STASH request namelists.</li>
<li>Or all STASH should be held in optional site configs and none in the
main app. Note however that STASH is difficult to configure outside of
<code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">edit</span></code>, and the editor <a class="reference external" href="https://github.com/metomi/rose/issues/1685">does not yet allow you to edit optional
configs</a>.</li>
</ul>
</div>
<div class="section" id="modular-suite-design">
<h4>16.6.3. Modular Suite Design<a class="headerlink" href="#modular-suite-design" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference external" href="https://github.com/cylc/cylc/issues/1829">modular suite design concept</a>
is that we should be able to import common workflow segments at install time
rather than duplicating them in each suite. The content of a suite module
will be encapsulated in a protected namespace to avoid clashing with the
importing suite, and selected inputs and outputs exposed via a proper interface.</p>
<p>This should aid portable suite design too by enabling site-specific parts of a
workflow (local product generation for example) to be stored and imported
on-site rather than polluting the source and revision control record of
the core suite that everyone sees.</p>
<p>We note that this can already be done to a limited extent by using
<code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">suite-run</span></code> to install suite.rc fragments from an external
location. However, as a literal inlining mechanism with no encapsulation or
interface, the internals of the “imported” fragments would have to be
compatible with the suite definition in every respect.</p>
<p>See also <a class="reference internal" href="index.html#monolithic-or-interdependent-suites"><span class="std std-ref">Monolithic Or Interdependent Suites</span></a> on modular <em>systems of
suites</em> connected by inter-suite triggering.</p>
</div>
</div>
</div>
<hr class="docutils" />
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html#document-index">
              <img class="logo" src="_static/cylc-logo.png" alt="Logo"/>
            </a></p>
<h3><a href="index.html#document-index">Table of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-introduction">1. Introduction: How Cylc Works</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-screenshots">2. Cylc Screenshots</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-installation">3. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-terminology">4. Cylc Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-workflows">5. Workflows For Cycling Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-global-site-user-conf">6. Global (Site, User) Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-tutorial">7. Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-suite-name-reg">8. Suite Name Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-suite-config">9. Suite Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-task-implementation">10. Task Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-task-job-submission">11. Task Job Submission and Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-external-triggers">12. External Triggers</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-running-suites">13. Running Suites</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-suite-storage-etc">14. Suite Storage, Discovery, Revision Control, and Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-appendices/appendices-master">15. Appendices</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-suite-design-guide/suite-design-guide-master">16. Suite Design Guide</a></li>
</ul>
<!--
  element which gets populated with the list of available versions and
  formats for the documentation by versions.js
-->
<div
  class="rst-versions"
  data-toggle="rst-versions"
  id='versions-and-formats'
></div>



<script type="text/javascript">
    const CUR_FORMAT = "singlehtml";
    const CUR_VERSION = "7.8.8";
    // name of page (in URL), for singlepage builds this will be `index`
    const PAGE_NAME = "index";
    // URL path to the base docs dir i.e. ROOT_DIR/version/format
    const ROOT_DIR = "../..";
</script>

<script
  type="text/javascript"
  src="../../versions.js"
></script>

<!-- Hide the current version (doesn't fit well in this theme) -->
<style
  type="text/css"
>
  #versions-and-formats .rst-current-version {
    display: none;
  }
</style>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="index.html#document-index">The Cylc Suite Engine 7.8.8 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2008-2019 NIWA &amp; British Crown (Met Office) &amp; Contributors.
      Last updated on Mar 26, 2021.
    </div>
  </body>
</html>
