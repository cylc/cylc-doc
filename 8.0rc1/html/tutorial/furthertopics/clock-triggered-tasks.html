<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Clock Triggered Tasks &mdash; Cylc 8.0rc1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/diff_selector.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/grid_table.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/hieroglyph_theme_addons.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/tutorial.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/addons.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/cylc-favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/js/diff_selector.js"></script>
        <script src="../../_static/js/minicylc.js"></script>
        <script src="../../_static/js/spoiler.js"></script>
        <script src="../../_static/js/addons.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Broadcast" href="broadcast.html" />
    <link rel="prev" title="Further Topics" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html">
            <img src="../../_static/cylc-logo-white.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                8.0rc1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../7-to-8/index.html">Cylc 8 Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scheduling/index.html">Scheduling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runtime/index.html">Runtime</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Further Topics</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Clock Triggered Tasks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#clock-triggering">Clock Triggering</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#clock-triggering-tasks">Clock-Triggering Tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-more-clock-triggered-tasks">Adding More Clock-Triggered Tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="broadcast.html">Broadcast</a></li>
<li class="toctree-l3"><a class="reference internal" href="family-triggers.html">Family Triggers</a></li>
<li class="toctree-l3"><a class="reference internal" href="inheritance.html">Inheritance</a></li>
<li class="toctree-l3"><a class="reference internal" href="queues.html">Queues</a></li>
<li class="toctree-l3"><a class="reference internal" href="retries.html">Retries</a></li>
<li class="toctree-l3"><a class="reference internal" href="message-triggers.html">Message Triggers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/index.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../workflow-design-guide/index.html">Workflow Design Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Cylc</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Tutorial</a> &raquo;</li>
          <li><a href="index.html">Further Topics</a> &raquo;</li>
      <li>Clock Triggered Tasks</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/tutorial/furthertopics/clock-triggered-tasks.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="clock-triggered-tasks">
<span id="tutorial-cylc-clock-trigger"></span><h1>Clock Triggered Tasks<a class="headerlink" href="#clock-triggered-tasks" title="Permalink to this headline"></a></h1>
<p>In a <a class="reference internal" href="../../glossary.html#term-datetime-cycling"><span class="xref std std-term">datetime cycling</span></a> workflow the time represented by the
<a class="reference internal" href="../../glossary.html#term-cycle-point"><span class="xref std std-term">cycle points</span></a> bear no relation to the real-world time.
Using clock-triggers we can make tasks wait until their cycle point time before
running.</p>
<p>Clock-triggering effectively enables us to tether the “cycle time” to the
“real world time” which we refer to as the <a class="reference internal" href="../../glossary.html#term-wallclock-time"><span class="xref std std-term">wallclock time</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Clock triggers are <a class="reference internal" href="../../user-guide/writing-workflows/external-triggers.html#section-external-triggers"><span class="std std-ref">External Triggers</span></a>. They differ from
custom external triggers only in that they are provided with Cylc.</p>
</div>
<section id="clock-triggering">
<h2>Clock Triggering<a class="headerlink" href="#clock-triggering" title="Permalink to this headline"></a></h2>
<p>When clock-triggering tasks we can use different
<a class="reference internal" href="../scheduling/datetime-cycling.html#tutorial-iso8601-durations"><span class="std std-ref">offsets</span></a> to the cycle time as follows:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">my_clock_trigger </span><span class="o">=</span><span class="s"> wall_clock(offset=&lt;iso8601 duration&gt;)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Regardless of the offset used, the task still belongs to the cycle from
which the offset has been applied.</p>
</div>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline"></a></h2>
<p>Our example workflow will simulate a clock chiming on the hour.</p>
<p>Within your <code class="docutils literal notranslate"><span class="pre">~/cylc-src</span></code> directory create a new directory called
<code class="docutils literal notranslate"><span class="pre">clock-trigger</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">~/</span><span class="n">cylc</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">clock</span><span class="o">-</span><span class="n">trigger</span>
<span class="n">cd</span> <span class="o">~/</span><span class="n">cylc</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">clock</span><span class="o">-</span><span class="n">trigger</span>
</pre></div>
</div>
<p>Paste the following code into a <code class="docutils literal notranslate"><span class="pre">flow.cylc</span></code> file:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduler]</span>
    <span class="nv">UTC mode </span><span class="o">=</span><span class="s"> True</span> <span class="c1"># Ignore DST</span>

<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> TODO</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> +P1D</span> <span class="c1"># Run for one day</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">PT1H </span><span class="o">=</span><span class="s"> bell</span>

<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nt">[[[events]]]</span>
            <span class="nv">mail events </span><span class="o">=</span><span class="s"> failed</span>
    <span class="nt">[[bell]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> printf &#39;bong%.0s\n&#39; $(seq 1 $(cylc cyclepoint --print-hour))</span>
</pre></div>
</div>
<p>Change the initial cycle point to 00:00 this morning (e.g. if it was
the first of January 2000 we would write <code class="docutils literal notranslate"><span class="pre">2000-01-01T00Z</span></code>).</p>
<p>We now have a simple workflow with a single task that prints “bong” a number
of times equal to the (cycle point) hour.</p>
<p>Run your workflow using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cylc</span> <span class="n">validate</span> <span class="o">.</span>
<span class="n">cylc</span> <span class="n">install</span>
<span class="n">cylc</span> <span class="n">play</span> <span class="n">clock</span><span class="o">-</span><span class="n">trigger</span>
</pre></div>
</div>
<p>Stop the workflow after a few cycles using <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">stop</span> <span class="pre">--now</span> <span class="pre">--now</span> <span class="pre">clock-trigger</span></code>.
Notice how the tasks run as soon as possible rather than
waiting for the actual time to be equal to the cycle point.</p>
</section>
<section id="clock-triggering-tasks">
<h2>Clock-Triggering Tasks<a class="headerlink" href="#clock-triggering-tasks" title="Permalink to this headline"></a></h2>
<p>We want our clock to only ring in real-time rather than the simulated
cycle time.</p>
<p>To do this, modify the <code class="docutils literal notranslate"><span class="pre">[scheduling][graph]</span></code> section of
your <code class="docutils literal notranslate"><span class="pre">flow.cylc</span></code>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">PT1H </span><span class="o">=</span><span class="s"> </span><span class="cp">@wall_clock</span><span class="s">  =&gt; bell</span>
</pre></div>
</div>
<p>This tells the workflow to clock trigger the <code class="docutils literal notranslate"><span class="pre">bell</span></code> task with a cycle
offset of <code class="docutils literal notranslate"><span class="pre">0</span></code> hours.</p>
<p>Save your changes, install and run your workflow.</p>
<p>Your workflow should now be running the <code class="docutils literal notranslate"><span class="pre">bell</span></code> task in real-time. Any cycle times
that have already passed (such as the one defined by <code class="docutils literal notranslate"><span class="pre">initial</span> <span class="pre">cycle</span> <span class="pre">time</span></code>)
will be run as soon as possible, while those in the future will wait for that
time to pass.</p>
<p>At this point you may want to leave your workflow running until the next hour
has passed in order to confirm the clock triggering is working correctly.
Once you are satisfied, stop your workflow.</p>
<p>By making the <code class="docutils literal notranslate"><span class="pre">bell</span></code> task a clock triggered task we have made it run in
real-time. Thus, when the wallclock time caught up with the cycle time, the
<code class="docutils literal notranslate"><span class="pre">bell</span></code> task triggered.</p>
</section>
<section id="adding-more-clock-triggered-tasks">
<h2>Adding More Clock-Triggered Tasks<a class="headerlink" href="#adding-more-clock-triggered-tasks" title="Permalink to this headline"></a></h2>
<p>Running clock triggered tests at the cycle time is a special case:
We will now modify our workflow to run tasks at quarter-past, half-past and
quarter-to the hour.</p>
<p>Open your <code class="docutils literal notranslate"><span class="pre">flow.cylc</span></code> and modify the <code class="docutils literal notranslate"><span class="pre">[runtime]</span></code> section by adding the
following:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[[quarter_past, half_past, quarter_to]]</span>
    <span class="nv">script </span><span class="o">=</span><span class="s"> echo &#39;chimes&#39;</span>
</pre></div>
</div>
<p>Edit the <code class="docutils literal notranslate"><span class="pre">[[scheduling]]</span></code> section to read:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> now</span>
<span class="nv">final cycle point </span><span class="o">=</span><span class="s"> +P1D</span> <span class="c1"># Run for one day</span>
<span class="nt">[[xtriggers]]</span>
    <span class="nv">quarter_past_trigger </span><span class="o">=</span><span class="s"> wall_clock(offset=PT15M):PT30S</span>
    <span class="nv">half_past_trigger </span><span class="o">=</span><span class="s"> wall_clock(offset=PT30M):PT30S</span>
    <span class="nv">quarter_to_trigger </span><span class="o">=</span><span class="s"> wall_clock(offset=PT45M):PT30S</span>
<span class="nt">[[graph]]</span>
    <span class="nv">PT1H </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="cp">@wall_clock</span><span class="s2"> =&gt; bell</span>
<span class="s2">        </span><span class="cp">@quarter_past_trigger</span><span class="s2"> =&gt; quarter_past</span>
<span class="s2">        </span><span class="cp">@half_past_trigger</span><span class="s2"> =&gt; half_past</span>
<span class="s2">        </span><span class="cp">@quarter_to_trigger</span><span class="s2"> =&gt; quarter_to</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Note the different values used for the cycle offsets of the clock-trigger tasks.</p>
<p>Save your changes, install and run your workflow using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cylc</span> <span class="n">validate</span> <span class="o">.</span>
<span class="n">cylc</span> <span class="n">install</span>
<span class="n">cylc</span> <span class="n">play</span> <span class="n">clock</span><span class="o">-</span><span class="n">trigger</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Setting <code class="docutils literal notranslate"><span class="pre">initial</span> <span class="pre">cycle</span> <span class="pre">point</span> <span class="pre">=</span> <span class="pre">now</span></code> will run your workflow using the
current time at startup as the initial cycle point.</p>
</div>
<p>Again, notice how the tasks trigger until the current time is reached.</p>
<p>Leave your workflow running for a while to confirm it is working as expected
before stopping it.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You may have noticed the <code class="docutils literal notranslate"><span class="pre">:PT30S</span></code> at the end of each clock trigger
definition. This how often the <a class="reference internal" href="../../user-guide/writing-workflows/external-triggers.html#section-external-triggers"><span class="std std-ref">External Triggers</span></a> is checked.
By default external triggers are checked every 10 seconds, but if there
are a lot of external triggers this can be hard work for the computer
running the workflow and it may not be necessary to check this often.</p>
</div>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Clock triggers are a type of <a class="reference internal" href="../../glossary.html#term-dependency"><span class="xref std std-term">dependency</span></a> which cause
<a class="reference internal" href="../../glossary.html#term-task"><span class="xref std std-term">tasks</span></a> to wait for the <a class="reference internal" href="../../glossary.html#term-wallclock-time"><span class="xref std std-term">wallclock time</span></a> to reach the
<a class="reference internal" href="../../glossary.html#term-cycle-point"><span class="xref std std-term">cycle point</span></a> time.</p></li>
<li><p>Clock triggers are a built in example of <a class="reference internal" href="../../user-guide/writing-workflows/external-triggers.html#section-external-triggers"><span class="std std-ref">External Triggers</span></a>.</p></li>
<li><p>Clock triggers can only be used in datetime cycling workflows.</p></li>
</ul>
<p>For more information see the <a class="reference external" href="https://cylc.github.io/cylc-doc/latest/html/index.html">Cylc User Guide</a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Further Topics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="broadcast.html" class="btn btn-neutral float-right" title="Broadcast" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2008-2022 NIWA &amp; British Crown (Met Office) &amp; Contributors.
      <span class="lastupdated">Last updated on Feb 21, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <!--
  element which gets populated with the list of available versions and
  formats for the documentation by versions.js
-->
<div
  class="rst-versions"
  data-toggle="rst-versions"
  id='versions-and-formats'
></div>



<script type="text/javascript">
    const CUR_FORMAT = "html";
    const CUR_VERSION = "8.0rc1";
    // name of page (in URL), for singlepage builds this will be `index`
    const PAGE_NAME = "tutorial/furthertopics/clock-triggered-tasks";
    // URL path to the base docs dir i.e. ROOT_DIR/version/format
    const ROOT_DIR = "../../../..";
</script>

<script
  type="text/javascript"
  src="../../../../versions.js"
></script><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>