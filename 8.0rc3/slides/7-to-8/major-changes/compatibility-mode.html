<!DOCTYPE html>


<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Cylc 7 Compatibility Mode &mdash; Cylc 8.0rc3 documentation</title>
    
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/styles.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/single.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <link rel="stylesheet" href="../../_static/css/slides-custom.css" type="text/css" />
    
    
    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/single.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/diff_selector.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/grid_table.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/hieroglyph_theme_addons.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/tutorial.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/addons.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '8.0rc3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/js/diff_selector.js"></script>
    <script type="text/javascript" src="../../_static/js/minicylc.js"></script>
    <script type="text/javascript" src="../../_static/js/spoiler.js"></script>
    <script type="text/javascript" src="../../_static/js/addons.js"></script>
    <script type="text/javascript" src="../../_static/common.js"></script>
    
    <script type="text/javascript" src="../../_static/slides.js"></script>
    <script type="text/javascript" src="../../_static/sync.js"></script>
    <script type="text/javascript" src="../../_static/controller.js"></script>
    <script type="text/javascript" src="../../_static/init.js"></script>
    
    
    <link rel="shortcut icon" href="../../_static/cylc-favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="top" title="Cylc 8.0rc3 documentation" href="../../index.html" />
    <link rel="up" title="Detailed Description of Major Changes" href="index.html" />
    <link rel="next" title="Configuration Changes at Cylc 8" href="config-changes.html" />
    <link rel="prev" title="Command Line Interface" href="cli.html" /> 
  </head>
  <body>

<section
   id="slide_container"
   class='slides layout-regular'>


  
<article class="slide level-1" id="cylc-7-compatibility-mode">

<h1>Cylc 7 Compatibility Mode<a class="headerlink" href="../../../html/7-to-8/major-changes/compatibility-mode.html#cylc-7-compatibility-mode" title="View HTML">§</a></h1>

<div class="tip admonition">
<p class="first admonition-title">Does This Change Affect Me?</p>
<p class="last">This will affect you if you want to run run Cylc 7 workflows (using the
<code class="docutils literal notranslate"><span class="pre">suite.rc</span></code> filename) using Cylc 8.0</p>
</div>




</article>
<article class="slide level-2" id="overview">

<h2>Overview<a class="headerlink" href="../../../html/7-to-8/major-changes/compatibility-mode.html#overview" title="View HTML">§</a></h2>

<p>The old <code class="docutils literal notranslate"><span class="pre">suite.rc</span></code> filename triggers a backward compatibility mode in which:</p>
<ul class="simple">
<li><a class="reference internal" href="../../glossary.html#term-implicit-task"><span class="xref std std-term">implicit tasks</span></a> are allowed by default<ul>
<li>(unless a <code class="docutils literal notranslate"><span class="pre">rose-suite.conf</span></code> file is found in the <a class="reference internal" href="../../glossary.html#term-run-directory"><span class="xref std std-term">run directory</span></a>
for consistency with <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">suite-run</span></code> behaviour)</li>
<li>(Cylc 8 does not allow implicit tasks by default)</li>
</ul>
</li>
<li><a class="reference internal" href="../../glossary.html#term-cycle-point-time-zone"><span class="xref std std-term">cycle point time zone</span></a> defaults to the local time zone<ul>
<li>(Cylc 8 defaults to UTC)</li>
</ul>
</li>
<li>waiting tasks are pre-spawned to mimic the Cylc 7 scheduling algorithm and
stall behaviour, and these require
<a class="reference internal" href="../../glossary.html#term-suicide-trigger"><span class="xref std std-term">suicide triggers</span></a>
for alternate <a class="reference internal" href="../../glossary.html#term-graph-branching"><span class="xref std std-term">graph branching</span></a><ul>
<li>(Cylc 8 spawns tasks on demand, and suicide triggers are not needed for
branching)</li>
</ul>
</li>
<li>only <code class="docutils literal notranslate"><span class="pre">succeeded</span></code> task outputs are <a class="reference internal" href="../../user-guide/writing-workflows/scheduling.html#user-guide-expected-outputs"><span class="std std-ref">*expected*</span></a>,
meaning the scheduler will retain tasks that do not succeed as incomplete<ul>
<li>(in Cylc 8, <strong>all</strong> outputs are <em>expected</em> unless marked as
<a class="reference internal" href="../../user-guide/writing-workflows/scheduling.html#user-guide-optional-outputs"><span class="std std-ref">*optional*</span></a> by the new <code class="docutils literal notranslate"><span class="pre">?</span></code> syntax)</li>
</ul>
</li>
</ul>




</article>
<article class="slide level-2" id="required-changes">

<h2>Required Changes<a class="headerlink" href="../../../html/7-to-8/major-changes/compatibility-mode.html#required-changes" title="View HTML">§</a></h2>

<p>Providing your Cylc 7 workflow does not use syntax that was deprecated at Cylc 7,
you may be able to run it with Cylc 8 without any modifications to begin with.</p>
<p>To see if your workflow is compatible with Cylc 8, run <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">validate</span></code>
<strong>using Cylc 7</strong>.</p>
<p>If tasks in your workflow call Cylc commands directly it might be necessary to
modify them to be compatible with command line interface changes
(unfortunately, this is not possible to detect at validation).</p>




</article>
<article class="slide level-2" id="example">

<h2>Example<a class="headerlink" href="../../../html/7-to-8/major-changes/compatibility-mode.html#example" title="View HTML">§</a></h2>

<p>Consider this configuration:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">suite.rc</span></code></span></div>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 11000101T00</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[R1]]]</span>
            <span class="nv">graph </span><span class="o">=</span><span class="s"> task</span>

<span class="nt">[runtime]</span>
    <span class="nt">[[task]]</span>
        <span class="nv">pre-command scripting </span><span class="o">=</span><span class="s"> echo &quot;Hello World&quot;</span>
</pre></div>
</div>
</div>
<p>Running <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">validate</span></code> on this configuration at <strong>Cylc 7</strong> we see that the
workflow is valid, but we are warned that <code class="docutils literal notranslate"><span class="pre">pre-command</span> <span class="pre">scripting</span></code>
was replaced by <code class="docutils literal notranslate"><span class="pre">pre-script</span></code> at 6.4.0:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Cylc 7 validation</span></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cylc validate .
<span class="go">WARNING - deprecated items were automatically upgraded in &#39;suite definition&#39;:</span>
<span class="go">WARNING -  * (6.4.0) [runtime][task][pre-command scripting] -&gt; [runtime][task][pre-script] - value unchanged</span>
<span class="go">Valid for cylc-7.8.7</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Cylc 7</strong> has handled this deprecation for us, but at <strong>Cylc 8</strong> this
workflow will fail validation.</p>
<div class="literal-block-wrapper last docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Cylc 8 validation</span></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cylc validate .
<span class="go">IllegalItemError: [runtime][task]pre-command scripting</span>
</pre></div>
</div>
</div>
</div>




</article>
<article class="slide level-3" id="fixing-the-validation-failure">

<h3>Fixing the validation failure<a class="headerlink" href="../../../html/7-to-8/major-changes/compatibility-mode.html#fixing-the-validation-failure" title="View HTML">§</a></h3>

<p>You must change the configuration yourself. In this case:</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="gd">-     pre-command scripting = echo &quot;Hello World&quot;</span><span class="w"></span>
<span class="gi">+     pre-script = echo &quot;Hello World&quot;</span><span class="w"></span>
</pre></div>
</div>
<p>Validation will now succeed.</p>
<p>The workflow is now ready for renaming <code class="docutils literal notranslate"><span class="pre">suite.rc</span></code> to <code class="docutils literal notranslate"><span class="pre">flow.cylc</span></code></p>




</article>
<article class="slide level-3" id="fixing-deprecation-warnings-after-renaming-suite-rc-to-flow-cylc">

<h3>Fixing deprecation warnings after renaming <code class="docutils literal notranslate"><span class="pre">suite.rc</span></code> to <code class="docutils literal notranslate"><span class="pre">flow.cylc</span></code><a class="headerlink" href="../../../html/7-to-8/major-changes/compatibility-mode.html#fixing-deprecation-warnings-after-renaming-suite-rc-to-flow-cylc" title="View HTML">§</a></h3>

<p>After renaming <code class="docutils literal notranslate"><span class="pre">suite.rc</span></code> to <code class="docutils literal notranslate"><span class="pre">flow.cylc</span></code>, backwards compatibility mode will
be turned off and validation in Cylc 8 will show warnings (and may fail if
<a class="reference internal" href="../../user-guide/writing-workflows/scheduling.html#user-guide-optional-outputs"><span class="std std-ref">Optional Outputs</span></a> and <a class="reference internal" href="../../user-guide/writing-workflows/scheduling.html#user-guide-expected-outputs"><span class="std std-ref">Expected Outputs</span></a>
conflict).</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Cylc 8 validation</span></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cylc validate .
<span class="go">WARNING - deprecated graph items were automatically upgraded in &quot;workflow definition&quot;:</span>
<span class="go"> * (8.0.0) [scheduling][dependencies][X]graph -&gt; [scheduling][graph]X - for X in:</span>
<span class="go">       R1</span>
<span class="go">Valid for cylc-8.0.0</span>
</pre></div>
</div>
</div>
<p>For the example given, Cylc 8 will validate without warning after making the
following changes. See <a class="reference internal" href="config-changes.html#to-8-graph-syntax"><span class="std std-ref">changes to the graph section.</span></a>.</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="w"> </span>[scheduling]<span class="w"></span>
<span class="w"> </span>    initial cycle point = 11000101T00<span class="w"></span>
<span class="gd">-    [[dependencies]]</span><span class="w"></span>
<span class="gd">-        [[[R1]]]</span><span class="w"></span>
<span class="gd">-            graph = task</span><span class="w"></span>
<span class="gi">+    [[graph]]</span><span class="w"></span>
<span class="gi">+        R1 = task</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Cylc 9 will not be able to upgrade obsolete Cylc 7
configurations. It’s a good idea to try and remove the configuration items
causing to these warnings as part of routine workflow review and
maintenance to avoid problems when a major Cylc version is released.</p>
</div>




</article>
<article class="slide level-2" id="host-to-platform-upgrade-logic">

<h2>Host to platform upgrade logic<a class="headerlink" href="../../../html/7-to-8/major-changes/compatibility-mode.html#host-to-platform-upgrade-logic" title="View HTML">§</a></h2>

<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="platforms.html#majorchangesplatforms"><span class="std std-ref">Details of how platforms work.</span></a></p>
</div>
<p>If you have a Cylc 7 workflow where tasks submit jobs to remote hosts
Cylc 8 will attempt to find a platform which matches the task specification.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Cylc 8 needs platforms matching the Cylc 7 job configuration to be
available in <a class="reference internal" href="../../reference/config/global.html#global.cylc[platforms]" title="global.cylc[platforms]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">global.cylc[platforms]</span></code></a>.</p>
</div>




</article>
<article class="slide level-3" id="id1">

<h3>Example<a class="headerlink" href="../../../html/7-to-8/major-changes/compatibility-mode.html#id1" title="View HTML">§</a></h3>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the following example <code class="docutils literal notranslate"><span class="pre">job</span> <span class="pre">runner</span></code> in <strong>Cylc 8</strong> configurations
and <code class="docutils literal notranslate"><span class="pre">batch</span> <span class="pre">system</span></code> in <strong>Cylc 7</strong> configurations refer to the same item.</p>
</div>
<p>If, for example you had a <strong>Cylc 8</strong> <code class="docutils literal notranslate"><span class="pre">global.cylc</span></code> with the following
platforms section:</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">Part of a Cylc global configuration</span></div>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[platforms]</span>
    <span class="nt">[[supercomputer_A]]</span>
        <span class="nv">hosts </span><span class="o">=</span><span class="s"> localhost</span>
        <span class="nv">job runner </span><span class="o">=</span><span class="s"> slurm</span>
    <span class="nt">[[supercomputer_B]]</span>
        <span class="nv">hosts </span><span class="o">=</span><span class="s"> tigger, wol, eeyore</span>
        <span class="nv">batch system </span><span class="o">=</span><span class="s"> pbs</span>
</pre></div>
</div>
</div>
<p>And you have a <strong>cylc 7</strong> workflow runtime configuration:</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">Part of <code class="docutils literal notranslate"><span class="pre">suite.rc</span></code></span></div>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[task1]]</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> slurm</span>
    <span class="nt">[[task2]]</span>
        <span class="nt">[[[remote]]]</span>
            <span class="nv">hosts </span><span class="o">=</span><span class="s"> eeyore</span>
        <span class="nt">[[[job]]]</span>
            <span class="nv">batch system </span><span class="o">=</span><span class="s"> pbs</span>
</pre></div>
</div>
</div>
<p>Then, <code class="docutils literal notranslate"><span class="pre">task1</span></code> will be assigned platform
<code class="docutils literal notranslate"><span class="pre">supercomputer_A</span></code> because the specified host (implicitly <code class="docutils literal notranslate"><span class="pre">localhost</span></code>)
is in the list of hosts for <code class="docutils literal notranslate"><span class="pre">supercomputer_A</span></code> <strong>and</strong> the batch system is the same.
Likewise, <code class="docutils literal notranslate"><span class="pre">task2</span></code> will run on <code class="docutils literal notranslate"><span class="pre">supercomputer_B</span></code>.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">For simplicity, and because the <code class="docutils literal notranslate"><span class="pre">host</span></code> key is a special case (it can
match and host in <code class="docutils literal notranslate"><span class="pre">[platform]hosts</span></code>) we only show these two config keys
here. In reality, <strong>Cylc 8 compares the whole of</strong>
<code class="docutils literal notranslate"><span class="pre">[&lt;task&gt;][job]</span></code> <strong>and</strong> <code class="docutils literal notranslate"><span class="pre">[&lt;task&gt;][remote]</span></code>
<strong>sections and all items must match to select a platform.</strong></p>
</div>




</article>
<article class="slide level-2" id="caveats">

<h2>Caveats<a class="headerlink" href="../../../html/7-to-8/major-changes/compatibility-mode.html#caveats" title="View HTML">§</a></h2>

<p>The following are some caveats to be aware of when using Cylc 8
Compatibility Mode.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Cylc 6 syntax deprecated by Cylc 7 is now obsolete. Run <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">validate</span></code>
<em>with Cylc 7</em> on your <code class="docutils literal notranslate"><span class="pre">suite.rc</span></code> to check for deprecation warnings and fix
those before validating with Cylc 8.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Check for any use of Cylc commands in task scripting. Some Cylc 7 commands
have been removed and some others now behave differently.
See <a class="reference internal" href="cli.html#majorchangescli"><span class="std std-ref">command line interface changes</span></a>.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Cylc 8 does not support
<a class="reference internal" href="excluding-tasks.html#majorchangesexcludingtasksatstartup"><span class="std std-ref">excluding tasks at start-up</span></a>.
If your workflow used this old functionality, it may have been used in
combination with the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">insert</span></code> command (which has been removed from
Cylc 8) and <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">remove</span></code> (which still exists but is much less needed).</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Cylc 8 cannot <em>restart</em> a Cylc 7 workflow mid-run. Instead, <a class="reference internal" href="../../user-guide/installing-workflows.html#installing-workflows"><span class="std std-ref">install</span></a> the workflow to a new run directory and start it
from scratch at the right cycle point or task(s):</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">play</span> <span class="pre">--start-cycle-point=&lt;cycle&gt;</span></code> (c.f. Cylc 7 <em>warm start</em>), or</li>
<li><code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">play</span> <span class="pre">--start-task=&lt;cycle/task&gt;</span></code>   (Cylc 8 can start anywhere in the graph)</li>
</ul>
<p class="last">Any previous-cycle workflow data needed by the new run will need to be
manually copied over from the original run directory.</p>
</div>




</article>

</section>

<section id="slide_notes">

</section>

  </body>
</html>