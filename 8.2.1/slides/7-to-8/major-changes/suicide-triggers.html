<!DOCTYPE html>


<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Graph branching, optional outputs and suicide triggers &mdash; Cylc 8.2.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/styles.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/single.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <link rel="stylesheet" href="../../_static/css/slides-custom.css" type="text/css" />
    
    
    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/single.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/diff_selector.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/grid_table.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/hieroglyph_theme_addons.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/tutorial.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/addons.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '8.2.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sphinx_highlight.js"></script>
    <script type="text/javascript" src="../../_static/js/diff_selector.js"></script>
    <script type="text/javascript" src="../../_static/js/minicylc.js"></script>
    <script type="text/javascript" src="../../_static/js/spoiler.js"></script>
    <script type="text/javascript" src="../../_static/js/addons.js"></script>
    <script type="text/javascript" src="../../_static/common.js"></script>
    
    <script type="text/javascript" src="../../_static/slides.js"></script>
    <script type="text/javascript" src="../../_static/sync.js"></script>
    <script type="text/javascript" src="../../_static/controller.js"></script>
    <script type="text/javascript" src="../../_static/init.js"></script>
    
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="top" title="Cylc 8.2.1 documentation" href="../../index.html" />
    <link rel="up" title="Detailed Description of Major Changes" href="index.html" />
    <link rel="next" title="Task/Job States" href="task-job-states.html" />
    <link rel="prev" title="Scheduling Algorithm" href="scheduling.html" /> 
  </head>
  <body>

<section
   id="slide_container"
   class='slides layout-regular'>


  
<article class="slide level-1" id="graph-branching-optional-outputs-and-suicide-triggers">

<h1>Graph branching, optional outputs and suicide triggers<a class="headerlink" href="../../../html/7-to-8/major-changes/suicide-triggers.html#graph-branching-optional-outputs-and-suicide-triggers" title="View HTML">§</a></h1>

<p>Cylc 8 has a <a class="reference internal" href="scheduling.html#scheduling-algorithm"><span class="std std-ref">new scheduling algorithm</span></a> and
a new syntax for dealing with tasks that may not necessarily complete.
It handles <a class="reference internal" href="../../glossary.html#term-graph"><span class="xref std std-term">graphs</span></a> in an event-driven manner which means
that a workflow can follow different paths in different eventualities (without
the need for suicide triggers). This is called <a class="reference internal" href="../../glossary.html#term-graph-branching"><span class="xref std std-term">graph branching</span></a>.</p>
<div class="tip admonition">
<p class="first admonition-title">Does This Change Affect Me?</p>
<p>This change affects you if you are upgrading a Cylc 7 workflow that
contains graph branches that are not necessarily expected to complete
at runtime. You might get a <code class="docutils literal notranslate"><span class="pre">GraphParseError</span></code> during validation with
Cylc 8.</p>
<p>Typically this will be the case if you are using
<a class="reference internal" href="../../glossary.html#term-suicide-trigger"><span class="xref std std-term">suicide triggers</span></a> (marked by <code class="docutils literal notranslate"><span class="pre">!</span></code> before the
task name in the graph, e.g. <code class="docutils literal notranslate"><span class="pre">foo:fail</span> <span class="pre">=&gt;</span> <span class="pre">!foo</span></code>).</p>
<p class="last">You should <em>not</em> perform this upgrade if still in <a class="reference internal" href="compatibility-mode.html#cylc-7-compat-mode"><span class="std std-ref">Cylc 7 Compatibility Mode</span></a>
(<code class="docutils literal notranslate"><span class="pre">suite.rc</span></code> filename).</p>
</div>




</article>
<article class="slide level-2" id="required-changes">

<h2>Required Changes<a class="headerlink" href="../../../html/7-to-8/major-changes/suicide-triggers.html#required-changes" title="View HTML">§</a></h2>

<p>Any <a class="reference internal" href="../../glossary.html#term-task-output"><span class="xref std std-term">task outputs</span></a> that are not necessarily expected to
complete must be marked as <a class="reference internal" href="../../glossary.html#term-optional-output"><span class="xref std std-term">optional</span></a> using <code class="docutils literal notranslate"><span class="pre">?</span></code>.
Suicide triggers can then be removed.</p>




</article>
<article class="slide level-2" id="example">

<h2>Example<a class="headerlink" href="../../../html/7-to-8/major-changes/suicide-triggers.html#example" title="View HTML">§</a></h2>

<p>Here is an example Cylc 7 <a class="reference internal" href="../../glossary.html#term-graph"><span class="xref std std-term">graph</span></a>:</p>
<div class="highlight-cylc-graph notranslate"><div class="highlight"><pre><span></span><span class="kd">foo</span><span class="c">:</span><span class="kd">fail</span> <span class="o">=&gt;</span> <span class="kd">recover</span>

<span class="kd">foo</span> <span class="o">|</span> <span class="kd">recover</span> <span class="o">=&gt;</span> <span class="kd">bar</span>

<span class="c1"># Remove the &quot;recover&quot; task in the success case.</span>
<span class="kd">foo</span> <span class="o">=&gt;</span> <span class="c">!</span> <span class="kd">recover</span>
<span class="c1"># Remove the &quot;foo&quot; task in the fail case.</span>
<span class="kd">recover</span> <span class="o">=&gt;</span> <span class="c">!</span> <span class="kd">foo</span>
</pre></div>
</div>
<div align="center" class="align-center"><div class="graphviz"><object data="../../_images/graphviz-2177d3d933cdc16287d883a6c7ec5a4c5e8ed10b.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph Example {
subgraph cluster_1 {
   label = &quot;:fail&quot;
   color = &quot;red&quot;
   fontcolor = &quot;red&quot;
   style = &quot;dashed&quot;
   recover
}

foo -&gt; recover
recover -&gt; bar [arrowhead=&quot;onormal&quot;]
foo -&gt; bar [arrowhead=&quot;onormal&quot; weight=2]
}</p></object></div>
</div>
<p>Validating this with Cylc 8 will give an error:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cylc<span class="w"> </span>validate<span class="w"> </span>.
<span class="go">GraphParseError: Opposite outputs foo:succeeded and foo:failed must both be optional if both are used</span>
</pre></div>
</div>
<p>In Cylc 8, all task outputs are <a class="reference internal" href="../../glossary.html#term-required-output"><span class="xref std std-term">required</span></a> to complete
unless otherwise indicated. However, it is impossible for both <code class="docutils literal notranslate"><span class="pre">:succeed</span></code>
and <code class="docutils literal notranslate"><span class="pre">:fail</span></code> to occur when a task runs.</p>
<p>The solution is to mark the outputs which are <a class="reference internal" href="../../glossary.html#term-optional-output"><span class="xref std std-term">optional</span></a>
(in this case <code class="docutils literal notranslate"><span class="pre">foo:succeed</span></code> and <code class="docutils literal notranslate"><span class="pre">foo:fail</span></code>) with a <code class="docutils literal notranslate"><span class="pre">?</span></code> in the graph.
Also, the suicide triggers can be removed.</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="gd">- foo:fail =&gt; recover</span>
<span class="gi">+ foo:fail? =&gt; recover</span>

<span class="gd">- foo | recover =&gt; bar</span>
<span class="gi">+ foo? | recover =&gt; bar</span>

<span class="gd">- # Remove the &quot;recover&quot; task in the success case.</span>
<span class="gd">- foo =&gt; ! recover</span>
<span class="gd">- # Remove the &quot;foo&quot; task in the fail case.</span>
<span class="gd">- recover =&gt; ! foo</span>
</pre></div>
</div>
<p>In Cylc 7, suicide triggers were used to remove tasks that did not complete
during runtime. Cylc 8’s event-driven graph handling allows such graph
branching using optional output syntax, without the need for suicide triggers.
(Suicide triggers are still supported in Cylc 8; however, they are most
likely unnecessary.)</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Remember: <code class="docutils literal notranslate"><span class="pre">foo?</span></code> is short for <code class="docutils literal notranslate"><span class="pre">foo:succeed?</span></code>. It is the <em>output</em>
that is optional, not the task itself.</p>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference internal" href="../../user-guide/writing-workflows/scheduling.html#user-guide-required-outputs"><span class="std std-ref">Required</span></a> and
<a class="reference internal" href="../../user-guide/writing-workflows/scheduling.html#user-guide-optional-outputs"><span class="std std-ref">optional</span></a> outputs in the User Guide.</li>
<li><a class="reference internal" href="../../user-guide/writing-workflows/scheduling.html#graph-branching"><span class="std std-ref">Graph Branching</span></a> in the user guide.</li>
</ul>
</div>




</article>

</section>

<section id="slide_notes">

</section>

  </body>
</html>