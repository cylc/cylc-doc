

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Suicide Triggers &mdash; Cylc nightly.2021-03-24 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/diff_selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/grid_table.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/hieroglyph_theme_addons.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/tutorial.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/addons.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/cylc-favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/js/diff_selector.js"></script>
        <script src="../../_static/js/minicylc.js"></script>
        <script src="../../_static/js/spoiler.js"></script>
        <script src="../../_static/js/addons.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Message Triggers" href="message-triggers.html" />
    <link rel="prev" title="Retries" href="retries.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/cylc-logo-white.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                nightly.2021-03-24
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scheduling/index.html">Scheduling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runtime/index.html">Runtime</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Further Topics</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="clock-triggered-tasks.html">Clock Triggered Tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="broadcast.html">Broadcast</a></li>
<li class="toctree-l3"><a class="reference internal" href="family-triggers.html">Family Triggers</a></li>
<li class="toctree-l3"><a class="reference internal" href="inheritance.html">Inheritance</a></li>
<li class="toctree-l3"><a class="reference internal" href="queues.html">Queues</a></li>
<li class="toctree-l3"><a class="reference internal" href="retries.html">Retries</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Suicide Triggers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#stalled-suites">Stalled Suites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#handling-failures">Handling Failures</a></li>
<li class="toctree-l4"><a class="reference internal" href="#why-do-we-need-to-remove-tasks-from-the-graph">Why Do We Need To Remove Tasks From The Graph?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#removing-tasks-from-the-graph">Removing Tasks From The Graph</a></li>
<li class="toctree-l4"><a class="reference internal" href="#downstream-dependencies">Downstream Dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#comparing-regular-and-suicide-triggers">Comparing “Regular” and “Suicide” Triggers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#variations">Variations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="message-triggers.html">Message Triggers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/index.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../suite-design-guide/index.html">Suite Design Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Cylc</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Tutorial</a> &raquo;</li>
        
          <li><a href="index.html">Further Topics</a> &raquo;</li>
        
      <li>Suicide Triggers</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/tutorial/furthertopics/suicide-triggers.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="suicide-triggers">
<span id="tut-cylc-suicide-triggers"></span><h1>Suicide Triggers<a class="headerlink" href="#suicide-triggers" title="Permalink to this headline">¶</a></h1>
<p>Suicide triggers allow us to remove a task from the suite’s graph whilst the
suite is running.</p>
<p>The main use of suicide triggers is for handling failures in the workflow.</p>
<div class="section" id="stalled-suites">
<h2>Stalled Suites<a class="headerlink" href="#stalled-suites" title="Permalink to this headline">¶</a></h2>
<p>Imagine a bakery which has a workflow that involves making cake.</p>
<div class="highlight-cylc-graph notranslate"><div class="highlight"><pre><span></span><span class="kd">make_cake_mixture</span> <span class="o">=&gt;</span> <span class="kd">bake_cake</span> <span class="o">=&gt;</span> <span class="kd">sell_cake</span>
</pre></div>
</div>
<div class="minicylc" style="text-align: center;" data-dependencies="make_cake_mixture => bake_cake => sell_cake" data-theme="none" ><div class="graphviz"><object data="../../_images/graphviz-66ee4c9079d9e4035860fbbeb5e4c6939b6596d9.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph Mini_Cylc {
make_cake_mixture -&gt; bake_cake
sell_cake
bake_cake -&gt; sell_cake
}</p></object></div>
</div><p>There is a 50% chance that the cake will turn out fine, and a 50% chance that
it will get burnt. In the case that we burn the cake the workflow gets stuck.</p>
<div align="center" class="align-center"><div class="graphviz"><object data="../../_images/graphviz-57e1d6d1cd0ed93aba95bda76c484e58da734a67.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph Example {
make_cake_mixture [style=&quot;filled&quot; color=&quot;#ada5a5&quot;]
bake_cake [style=&quot;filled&quot; color=&quot;#ff0000&quot; fontcolor=&quot;white&quot;]
sell_cake [color=&quot;#88c6ff&quot;]

make_cake_mixture -&gt; bake_cake -&gt; sell_cake
}</p></object></div>
</div>
<p>In this event the <code class="docutils literal notranslate"><span class="pre">sell_cake</span></code> task will be unable to run as it depends on
<code class="docutils literal notranslate"><span class="pre">bake_cake</span></code>. We would say that this suite has <a class="reference internal" href="../../glossary.html#term-stalled-suite"><span class="xref std std-term">stalled</span></a>.
When Cylc detects that a suite has stalled it sends you an email to let you
know that the suite has got stuck and requires human intervention to proceed.</p>
</div>
<div class="section" id="handling-failures">
<h2>Handling Failures<a class="headerlink" href="#handling-failures" title="Permalink to this headline">¶</a></h2>
<p>In order to prevent the suite from entering a stalled state we need to handle
the failure of the <code class="docutils literal notranslate"><span class="pre">bake_cake</span></code> task.</p>
<p>At the bakery if they burn a cake they eat it and make another.</p>
<p>The following diagram outlines this workflow with its two possible pathways,
<code class="docutils literal notranslate"><span class="pre">:succeed</span></code> in the event that <code class="docutils literal notranslate"><span class="pre">bake_cake</span></code> is successful and <code class="docutils literal notranslate"><span class="pre">:fail</span></code>
otherwise.</p>
<div align="center" class="align-center"><div class="graphviz"><object data="../../_images/graphviz-ccab3583ebca7e046234fa8b4fb2ce30a37cb8c6.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph Example {
make_cake_mixture
bake_cake

subgraph cluster_1 {
   label = &quot;:succeed&quot;
   labelloc = &quot;b&quot;
   color = &quot;green&quot;
   fontcolor = &quot;green&quot;
   style = &quot;dashed&quot;
   sell_cake
}

subgraph cluster_2 {
   label = &quot;:fail&quot;
   labelloc = &quot;b&quot;
   color = &quot;red&quot;
   fontcolor = &quot;red&quot;
   style = &quot;dashed&quot;
   eat_cake
}

make_cake_mixture -&gt; bake_cake
bake_cake -&gt; sell_cake
bake_cake -&gt; eat_cake
}</p></object></div>
</div>
<p>We can add this logic to our workflow using the <code class="docutils literal notranslate"><span class="pre">fail</span></code> <a class="reference internal" href="../../glossary.html#term-qualifier"><span class="xref std std-term">qualifier</span></a>.</p>
<div class="highlight-cylc-graph notranslate"><div class="highlight"><pre><span></span><span class="kd">bake_cake</span> <span class="o">=&gt;</span> <span class="kd">sell_cake</span>
<span class="kd">bake_cake</span><span class="c">:</span><span class="kd">fail</span> <span class="o">=&gt;</span> <span class="kd">eat_cake</span>
</pre></div>
</div>
<div class="hint admonition">
<p class="admonition-title">Reminder</p>
<p>If you don’t specify a qualifier Cylc assumes you mean <code class="docutils literal notranslate"><span class="pre">:succeed</span></code> so the
following two lines are equivalent:</p>
<div class="highlight-cylc-graph notranslate"><div class="highlight"><pre><span></span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">bar</span>
<span class="kd">foo</span><span class="c">:</span><span class="kd">succeed</span> <span class="o">=&gt;</span> <span class="kd">bar</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="why-do-we-need-to-remove-tasks-from-the-graph">
<h2>Why Do We Need To Remove Tasks From The Graph?<a class="headerlink" href="#why-do-we-need-to-remove-tasks-from-the-graph" title="Permalink to this headline">¶</a></h2>
<p>Create a new suite called <code class="docutils literal notranslate"><span class="pre">suicide-triggers</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">~/</span><span class="n">cylc</span><span class="o">-</span><span class="n">run</span><span class="o">/</span><span class="n">suicide</span><span class="o">-</span><span class="n">triggers</span>
<span class="n">cd</span> <span class="o">~/</span><span class="n">cylc</span><span class="o">-</span><span class="n">run</span><span class="o">/</span><span class="n">suicide</span><span class="o">-</span><span class="n">triggers</span>
</pre></div>
</div>
<p>Paste the following code into the <a class="reference internal" href="../../reference/config/suite.html#flow.cylc" title="flow.cylc"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">flow.cylc</span></code></a> file:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduler]</span>
    <span class="nv">allow implicit tasks </span><span class="o">=</span><span class="s"> True</span>
<span class="nt">[scheduling]</span>
    <span class="nv">cycling mode </span><span class="o">=</span><span class="s"> integer</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 1</span>
    <span class="nv">runahead limit </span><span class="o">=</span><span class="s"> P3</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">P1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            make_cake_mixture =&gt; bake_cake =&gt; sell_cake</span>
<span class="s2">            bake_cake:fail =&gt; eat_cake</span>
<span class="s2">        &quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> sleep 2</span>
    <span class="nt">[[bake_cake]]</span>
        <span class="c1"># Random outcome 50% chance of success 50% chance of failure.</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> sleep 2; if (( $RANDOM % 2 )); then true; else false; fi</span>
</pre></div>
</div>
<p>Open the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">gui</span></code> and run the suite:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cylc</span> <span class="n">gui</span> <span class="n">suicide</span><span class="o">-</span><span class="n">triggers</span> <span class="o">&amp;</span>
<span class="n">cylc</span> <span class="n">run</span> <span class="n">suicide</span><span class="o">-</span><span class="n">triggers</span>
</pre></div>
</div>
<p>The suite will run for three cycles then get stuck (because of the
<a class="reference internal" href="../../reference/config/suite.html#flow.cylc[scheduling]runahead limit" title="flow.cylc[scheduling]runahead limit"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[scheduling]runahead</span> <span class="pre">limit</span></code></a>).
You should see something similar to the diagram below. As the <code class="docutils literal notranslate"><span class="pre">bake_cake</span></code>
task fails randomly what you see might differ slightly. You may receive a
“suite stalled” email.</p>
<div align="center" class="align-center"><div class="graphviz"><object data="../../_images/graphviz-c32d5b1c98c1bac2fd26196d75df7c27d04c49f5.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph Example {
size = &quot;7,5&quot;

subgraph cluster_1 {
   label = &quot;1&quot;
   style = &quot;dashed&quot;
   &quot;make_cake_mixture.1&quot; [
      label=&quot;make_cake_mixture\n1&quot;,
      style=&quot;filled&quot;,
      color=&quot;#ada5a5&quot;]
   &quot;bake_cake.1&quot; [
      label=&quot;bake_cake\n1&quot;,
      style=&quot;filled&quot;,
      color=&quot;#ada5a5&quot;]
   &quot;sell_cake.1&quot; [
      label=&quot;sell_cake\n1&quot;,
      style=&quot;filled&quot;,
      color=&quot;#ada5a5&quot;]
   &quot;eat_cake.1&quot; [
      label=&quot;eat_cake\1&quot;,
      color=&quot;#88c6ff&quot;]
}

subgraph cluster_2 {
   label = &quot;2&quot;
   style = &quot;dashed&quot;
   &quot;make_cake_mixture.2&quot; [
      label=&quot;make_cake_mixture\n2&quot;,
      style=&quot;filled&quot;,
      color=&quot;#ada5a5&quot;]
   &quot;bake_cake.2&quot; [
      label=&quot;bake_cake\n2&quot;,
      style=&quot;filled&quot;,
      color=&quot;#ff0000&quot;,
      fontcolor=&quot;white&quot;]
   &quot;sell_cake.2&quot; [
      label=&quot;sell_cake\2&quot;,
      color=&quot;#88c6ff&quot;]
   &quot;eat_cake.2&quot; [
      label=&quot;eat_cake\n2&quot;,
      color=&quot;#888888&quot;,
      fontcolor=&quot;#888888&quot;]
}

subgraph cluster_3 {
   label = &quot;3&quot;
   style = &quot;dashed&quot;
   &quot;make_cake_mixture.3&quot; [
      label=&quot;make_cake_mixture\n3&quot;,
      style=&quot;filled&quot;,
      color=&quot;#ada5a5&quot;]
   &quot;bake_cake.3&quot; [
      label=&quot;bake_cake\n3&quot;,
      style=&quot;filled&quot;,
      color=&quot;#ff0000&quot;,
      fontcolor=&quot;white&quot;]
   &quot;sell_cake.3&quot; [
      label=&quot;sell_cake\n3&quot;,
      color=&quot;#888888&quot;,
      fontcolor=&quot;#888888&quot;]
   &quot;eat_cake.3&quot; [
      label=&quot;eat_cake\3&quot;,
      color=&quot;#888888&quot;,
      fontcolor=&quot;#888888&quot;]
}

&quot;make_cake_mixture.1&quot; -&gt; &quot;bake_cake.1&quot; -&gt; &quot;sell_cake.1&quot;
&quot;bake_cake.1&quot; -&gt; &quot;eat_cake.1&quot;

&quot;make_cake_mixture.2&quot; -&gt; &quot;bake_cake.2&quot; -&gt; &quot;sell_cake.2&quot;
&quot;bake_cake.2&quot; -&gt; &quot;eat_cake.2&quot;

&quot;make_cake_mixture.3&quot; -&gt; &quot;bake_cake.3&quot; -&gt; &quot;sell_cake.3&quot;
&quot;bake_cake.3&quot; -&gt; &quot;eat_cake.3&quot;
}</p></object></div>
</div>
<p>The reason the suite stalls is that, by default, Cylc will run a maximum of
five cycles concurrently. As each cycle has at least one task which hasn’t
either succeeded or failed Cylc cannot move onto the next cycle.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>For more information see the <a class="reference internal" href="../../reference/config/suite.html#flow.cylc[scheduling]runahead limit" title="flow.cylc[scheduling]runahead limit"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[scheduling]runahead</span> <span class="pre">limit</span></code></a>.</p>
</div>
<p>You will also notice that some of the tasks (e.g. <code class="docutils literal notranslate"><span class="pre">eat_cake</span></code> in cycle <code class="docutils literal notranslate"><span class="pre">2</span></code>
in the above example) are drawn in a faded gray. This is because these tasks
have not yet been run in earlier cycles and as such cannot run.</p>
</div>
<div class="section" id="removing-tasks-from-the-graph">
<h2>Removing Tasks From The Graph<a class="headerlink" href="#removing-tasks-from-the-graph" title="Permalink to this headline">¶</a></h2>
<p>In order to get around these problems and prevent the suite from stalling we
must remove the tasks that are no longer needed. We do this using suicide
triggers.</p>
<p>A suicide trigger is written like a normal dependency but with an exclamation
mark in-front of the task on the right-hand-side of the dependency meaning
<em>“remove the following task from the graph at the current cycle point.”</em></p>
<p>For example the following <a class="reference internal" href="../../glossary.html#term-graph-string"><span class="xref std std-term">graph string</span></a> would remove the task <code class="docutils literal notranslate"><span class="pre">bar</span></code>
from the graph if the task <code class="docutils literal notranslate"><span class="pre">foo</span></code> were to succeed.</p>
<div class="highlight-cylc-graph notranslate"><div class="highlight"><pre><span></span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="c">!</span> <span class="kd">bar</span>
</pre></div>
</div>
<p>There are three cases where we would need to remove a task in the cake-making
example:</p>
<ol class="arabic">
<li><p>If the <code class="docutils literal notranslate"><span class="pre">bake_cake</span></code> task succeeds we don’t need the <code class="docutils literal notranslate"><span class="pre">eat_cake</span></code> task so
should remove it.</p>
<div class="highlight-cylc-graph notranslate"><div class="highlight"><pre><span></span><span class="kd">bake_cake</span> <span class="o">=&gt;</span> <span class="c">!</span> <span class="kd">eat_cake</span>
</pre></div>
</div>
</li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">bake_cake</span></code> task fails we don’t need the <code class="docutils literal notranslate"><span class="pre">sell_cake</span></code> task so
should remove it.</p>
<div class="highlight-cylc-graph notranslate"><div class="highlight"><pre><span></span><span class="kd">bake_cake</span><span class="c">:</span><span class="kd">fail</span> <span class="o">=&gt;</span> <span class="c">!</span> <span class="kd">sell_cake</span>
</pre></div>
</div>
</li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">bake_cake</span></code> task fails then we will need to remove it else the
suite will stall. We can do this after the <code class="docutils literal notranslate"><span class="pre">eat_cake</span></code> task has succeeded.</p>
<div class="highlight-cylc-graph notranslate"><div class="highlight"><pre><span></span><span class="kd">eat_cake</span> <span class="o">=&gt;</span> <span class="c">!</span> <span class="kd">bake_cake</span>
</pre></div>
</div>
</li>
</ol>
<p>Add the following three lines to the suite’s graph:</p>
<div class="highlight-cylc-graph notranslate"><div class="highlight"><pre><span></span><span class="kd">bake_cake</span> <span class="o">=&gt;</span> <span class="c">!</span> <span class="kd">eat_cake</span>
<span class="kd">bake_cake</span><span class="c">:</span><span class="kd">fail</span> <span class="o">=&gt;</span> <span class="c">!</span> <span class="kd">sell_cake</span>
<span class="kd">eat_cake</span> <span class="o">=&gt;</span> <span class="c">!</span> <span class="kd">bake_cake</span>
</pre></div>
</div>
<p>We can view suicide triggers in <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">graph</span></code> by un-selecting the
<span class="guilabel">Ignore Suicide Triggers</span> button in the toolbar. Suicide triggers
will then appear as dashed lines with circular endings. You should see
something like this:</p>
<div align="center" class="align-center"><div class="graphviz"><object data="../../_images/graphviz-d151f03d6fbbafc3fdb195803bdcda0e13445ecb.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph Example {
make_cake_mixture -&gt; bake_cake
bake_cake -&gt; sell_cake [style=&quot;dashed&quot; arrowhead=&quot;dot&quot;]
bake_cake -&gt; eat_cake [style=&quot;dashed&quot; arrowhead=&quot;dot&quot;]
eat_cake -&gt; bake_cake [style=&quot;dashed&quot; arrowhead=&quot;dot&quot;]
}</p></object></div>
</div>
</div>
<div class="section" id="downstream-dependencies">
<h2>Downstream Dependencies<a class="headerlink" href="#downstream-dependencies" title="Permalink to this headline">¶</a></h2>
<p>If we wanted to make the cycles run in order we might write an
<a class="reference internal" href="../../glossary.html#term-inter-cycle-dependency"><span class="xref std std-term">inter-cycle dependency</span></a> like this:</p>
<div class="highlight-cylc-graph notranslate"><div class="highlight"><pre><span></span><span class="kd">sell_cake</span>[<span class="nb">-P1</span>] <span class="o">=&gt;</span> <span class="kd">make_cake_mixture</span>
</pre></div>
</div>
<p>In order to handle the event that the <code class="docutils literal notranslate"><span class="pre">sell_cake</span></code> task has been removed from
the graph by a suicide trigger we can write our dependency with an or
symbol <code class="docutils literal notranslate"><span class="pre">|</span></code> like so:</p>
<div class="highlight-cylc-graph notranslate"><div class="highlight"><pre><span></span><span class="kd">eat_cake</span>[<span class="nb">-P1</span>] <span class="o">|</span> <span class="kd">sell_cake</span>[<span class="nb">-P1</span>] <span class="o">=&gt;</span> <span class="kd">make_cake_mixture</span>
</pre></div>
</div>
<p>Now the <code class="docutils literal notranslate"><span class="pre">make_cake_mixture</span></code> task from the next cycle will run after whichever
of the <code class="docutils literal notranslate"><span class="pre">sell_cake</span></code> or <code class="docutils literal notranslate"><span class="pre">eat_cake</span></code> tasks is run.</p>
<div align="center" class="align-center"><div class="graphviz"><object data="../../_images/graphviz-13669ad1aa9cd6dc226fefad60f2188f5d55e26d.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph Example {
subgraph cluster_1 {
   style=&quot;dashed&quot;
   label=&quot;1&quot;
   &quot;make_cake_mixture.1&quot; [label=&quot;make_cake_mixture\n1&quot;]
   &quot;bake_cake.1&quot; [label=&quot;bake_cake\n1&quot;]
   &quot;make_cake_mixture.1&quot; -&gt; &quot;bake_cake.1&quot;
   &quot;bake_cake.1&quot; -&gt; &quot;sell_cake.1&quot; [style=&quot;dashed&quot; arrowhead=&quot;dot&quot;]
   &quot;bake_cake.1&quot; -&gt; &quot;eat_cake.1&quot; [style=&quot;dashed&quot; arrowhead=&quot;dot&quot;]
   &quot;eat_cake.1&quot; -&gt; &quot;bake_cake.1&quot; [style=&quot;dashed&quot; arrowhead=&quot;dot&quot;]
   subgraph cluster_a {
      label = &quot;:fail&quot;
      fontcolor = &quot;red&quot;
      color = &quot;red&quot;
      style = &quot;dashed&quot;
      &quot;eat_cake.1&quot; [label=&quot;eat_cake\n1&quot; color=&quot;red&quot; fontcolor=&quot;red&quot;]
   }
   subgraph cluster_b {
      label = &quot;:success&quot;
      fontcolor = &quot;green&quot;
      color = &quot;green&quot;
      style = &quot;dashed&quot;
      &quot;sell_cake.1&quot; [label=&quot;sell_cake\n1&quot; color=&quot;green&quot; fontcolor=&quot;green&quot;]
   }
}

subgraph cluster_2 {
   style=&quot;dashed&quot;
   label=&quot;2&quot;
   &quot;make_cake_mixture.2&quot; [label=&quot;make_cake_mixture\n2&quot;]
   &quot;bake_cake.2&quot; [label=&quot;bake_cake\n2&quot;]
   &quot;make_cake_mixture.2&quot; -&gt; &quot;bake_cake.2&quot;
   &quot;bake_cake.2&quot; -&gt; &quot;sell_cake.2&quot; [style=&quot;dashed&quot; arrowhead=&quot;dot&quot;]
   &quot;bake_cake.2&quot; -&gt; &quot;eat_cake.2&quot; [style=&quot;dashed&quot; arrowhead=&quot;dot&quot;]
   &quot;eat_cake.2&quot; -&gt; &quot;bake_cake.2&quot; [style=&quot;dashed&quot; arrowhead=&quot;dot&quot;]
   subgraph cluster_c {
      label = &quot;:fail&quot;
      fontcolor = &quot;red&quot;
      color = &quot;red&quot;
      style = &quot;dashed&quot;
      &quot;eat_cake.2&quot; [label=&quot;eat_cake\n2&quot; color=&quot;red&quot; fontcolor=&quot;red&quot;]
   }
   subgraph cluster_d {
      label = &quot;:success&quot;
      fontcolor = &quot;green&quot;
      color = &quot;green&quot;
      style = &quot;dashed&quot;
      &quot;sell_cake.2&quot; [label=&quot;sell_cake\n2&quot; color=&quot;green&quot; fontcolor=&quot;green&quot;]
   }
}

&quot;eat_cake.1&quot; -&gt; &quot;make_cake_mixture.2&quot; [arrowhead=&quot;onormal&quot;]
&quot;sell_cake.1&quot; -&gt; &quot;make_cake_mixture.2&quot; [arrowhead=&quot;onormal&quot;]
}</p></object></div>
</div>
<p>Add the following <a class="reference internal" href="../../glossary.html#term-graph-string"><span class="xref std std-term">graph string</span></a> to your suite.</p>
<div class="highlight-cylc-graph notranslate"><div class="highlight"><pre><span></span><span class="kd">eat_cake</span>[<span class="nb">-P1</span>] <span class="o">|</span> <span class="kd">sell_cake</span>[<span class="nb">-P1</span>] <span class="o">=&gt;</span> <span class="kd">make_cake_mixture</span>
</pre></div>
</div>
<p>Open the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">gui</span></code> and run the suite. You should see that if the
<code class="docutils literal notranslate"><span class="pre">bake_cake</span></code> task fails both it and the <code class="docutils literal notranslate"><span class="pre">sell_cake</span></code> task disappear and
are replaced by the <code class="docutils literal notranslate"><span class="pre">eat_cake</span></code> task.</p>
</div>
<div class="section" id="comparing-regular-and-suicide-triggers">
<h2>Comparing “Regular” and “Suicide” Triggers<a class="headerlink" href="#comparing-regular-and-suicide-triggers" title="Permalink to this headline">¶</a></h2>
<p>In Cylc “regular” and “suicide” triggers both work in the same way. For example
the following graph lines implicitly combine using an <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> operator:</p>
<table class="grid-table docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-cylc-graph notranslate"><div class="highlight"><pre><span></span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="kd">pub</span>
<span class="kd">bar</span> <span class="o">=&gt;</span> <span class="kd">pub</span>
</pre></div>
</div>
</td>
<td><div class="highlight-cylc-graph notranslate"><div class="highlight"><pre><span></span><span class="kd">foo</span> <span class="o">&amp;</span> <span class="kd">bar</span> <span class="o">=&gt;</span> <span class="kd">pub</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Suicide triggers combine in the same way:</p>
<table class="grid-table docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-cylc-graph notranslate"><div class="highlight"><pre><span></span><span class="kd">foo</span> <span class="o">=&gt;</span> <span class="x">!pub</span>
<span class="kd">bar</span> <span class="o">=&gt;</span> <span class="x">!pub</span>
</pre></div>
</div>
</td>
<td><div class="highlight-cylc-graph notranslate"><div class="highlight"><pre><span></span><span class="kd">foo</span> <span class="o">&amp;</span> <span class="kd">bar</span> <span class="o">=&gt;</span> <span class="x">!pub</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>This means that suicide triggers are treated as “invisible tasks” rather than
as “events”. Suicide triggers can have pre-requisites just like a normal task.</p>
</div>
<div class="section" id="variations">
<h2>Variations<a class="headerlink" href="#variations" title="Permalink to this headline">¶</a></h2>
<p>The following sections outline examples of how to use suicide triggers.</p>
<div class="section" id="recovery-task">
<h3>Recovery Task<a class="headerlink" href="#recovery-task" title="Permalink to this headline">¶</a></h3>
<p>A common use case where a <code class="docutils literal notranslate"><span class="pre">recover</span></code> task is used to handle a task failure.</p>
<div align="center" class="align-center"><div class="graphviz"><object data="../../_images/graphviz-4d1904d0b909c71b80068f213f38e864a09a3015.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph Example {
subgraph cluster_1 {
   label = &quot;:fail&quot;
   color = &quot;red&quot;
   fontcolor = &quot;red&quot;
   style = &quot;dashed&quot;
   recover
}

foo -&gt; bar
bar -&gt; recover
recover -&gt; baz [arrowhead=&quot;onormal&quot;]
bar -&gt; baz [arrowhead=&quot;onormal&quot;]
}</p></object></div>
</div>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
            <span class="c1"># Regular graph.</span><span class="s2"></span>
<span class="s2">            foo =&gt; bar</span>

            <span class="c1"># The fail case.</span><span class="s2"></span>
<span class="s2">            bar:fail =&gt; recover</span>

            <span class="c1"># Remove the &quot;recover&quot; task in the success case.</span><span class="s2"></span>
<span class="s2">            bar =&gt; ! recover</span>

            <span class="c1"># Remove the &quot;bar&quot; task in the fail case.</span><span class="s2"></span>
<span class="s2">            recover =&gt; ! bar</span>

            <span class="c1"># Downstream dependencies.</span><span class="s2"></span>
<span class="s2">            bar | recover =&gt; baz</span>
<span class="s2">        &quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> sleep 1</span>
    <span class="nt">[[bar]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> false</span>
</pre></div>
</div>
</div>
<div class="section" id="branched-workflow">
<h3>Branched Workflow<a class="headerlink" href="#branched-workflow" title="Permalink to this headline">¶</a></h3>
<p>A workflow where sub-graphs of tasks are to be run in the success and or fail
cases.</p>
<div align="center" class="align-center"><div class="graphviz"><object data="../../_images/graphviz-5adbcf618333229b1471fc6f22f3ea5ab7f8131a.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph Example {
foo -&gt; bar
bar -&gt; tar -&gt; par
bar -&gt; jar -&gt; par
bar -&gt; baz -&gt; jaz

subgraph cluster_1 {
   label = &quot;:success&quot;
   fontcolor = &quot;green&quot;
   color = &quot;green&quot;
   style = &quot;dashed&quot;
   tar
   jar
   par
}

subgraph cluster_2 {
   label = &quot;:fail&quot;
   fontcolor = &quot;red&quot;
   color = &quot;red&quot;
   style = &quot;dashed&quot;
   baz
   jaz
}

tar -&gt; pub [arrowhead=&quot;onormal&quot;]
jaz -&gt; pub [arrowhead=&quot;onormal&quot;]
}</p></object></div>
</div>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
            <span class="c1"># Regular graph.</span><span class="s2"></span>
<span class="s2">            foo =&gt; bar</span>

            <span class="c1"># Success case.</span><span class="s2"></span>
<span class="s2">            bar =&gt; tar &amp; jar</span>

            <span class="c1"># Fail case.</span><span class="s2"></span>
<span class="s2">            bar:fail =&gt; baz =&gt; jaz</span>

            <span class="c1"># Remove tasks from the fail branch in the success case.</span><span class="s2"></span>
<span class="s2">            bar =&gt; ! baz &amp; ! jaz</span>

            <span class="c1"># Remove tasks from the success branch in the fail case.</span><span class="s2"></span>
<span class="s2">            bar:fail =&gt; ! tar &amp; ! jar &amp; ! par</span>

            <span class="c1"># Remove the bar task in the fail case.</span><span class="s2"></span>
<span class="s2">            baz =&gt; ! bar</span>

            <span class="c1"># Downstream dependencies.</span><span class="s2"></span>
<span class="s2">            tar | jaz =&gt; pub</span>
<span class="s2">        &quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> sleep 1</span>
    <span class="nt">[[bar]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> true</span>
</pre></div>
</div>
</div>
<div class="section" id="triggering-based-on-other-states">
<h3>Triggering Based On Other States<a class="headerlink" href="#triggering-based-on-other-states" title="Permalink to this headline">¶</a></h3>
<p>In these examples we have been using suicide triggers to handle task failure.
The suicide trigger mechanism works with other qualifiers as well for example:</p>
<div class="highlight-cylc-graph notranslate"><div class="highlight"><pre><span></span><span class="kd">foo</span><span class="c">:</span><span class="kd">start</span> <span class="o">=&gt;</span> <span class="c">!</span> <span class="kd">bar</span>
</pre></div>
</div>
<p>Suicide triggers can also be used with custom outputs. In the following example
the task <code class="docutils literal notranslate"><span class="pre">showdown</span></code> produces one of three possible custom outputs, <code class="docutils literal notranslate"><span class="pre">good</span></code>,
<code class="docutils literal notranslate"><span class="pre">bad</span></code> or <code class="docutils literal notranslate"><span class="pre">ugly</span></code>.</p>
<div align="center" class="align-center"><div class="graphviz"><object data="../../_images/graphviz-fd5136a2c71a347093fb4b511352df52030fad32.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph Example {
subgraph cluster_1 {
   label = &quot;:good&quot;
   color = &quot;green&quot;
   fontcolor = &quot;green&quot;
   style = &quot;dashed&quot;
   good
}
subgraph cluster_2 {
   label = &quot;:bad&quot;
   color = &quot;red&quot;
   fontcolor = &quot;red&quot;
   style = &quot;dashed&quot;
   bad
}
subgraph cluster_3 {
   label = &quot;:ugly&quot;
   color = &quot;purple&quot;
   fontcolor = &quot;purple&quot;
   style = &quot;dashed&quot;
   ugly
}
showdown -&gt; good
showdown -&gt; bad
showdown -&gt; ugly
good -&gt; fin [arrowhead=&quot;onormal&quot;]
bad -&gt; fin [arrowhead=&quot;onormal&quot;]
ugly -&gt; fin [arrowhead=&quot;onormal&quot;]
}</p></object></div>
</div>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
         <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
             <span class="c1"># The &quot;regular&quot; dependencies</span><span class="s2"></span>
<span class="s2">             showdown:good =&gt; good</span>
<span class="s2">             showdown:bad =&gt; bad</span>
<span class="s2">             showdown:ugly =&gt; ugly</span>
<span class="s2">             good | bad | ugly =&gt; fin</span>

             <span class="c1"># The &quot;suicide&quot; dependencies for each case</span><span class="s2"></span>
<span class="s2">             showdown:good | showdown:bad =&gt; ! ugly</span>
<span class="s2">             showdown:bad | showdown:ugly =&gt; ! good</span>
<span class="s2">             showdown:ugly | showdown:good =&gt; ! bad</span>
<span class="s2">         &quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> sleep 1</span>
    <span class="nt">[[showdown]]</span>
        <span class="c1"># Randomly return one of the three custom outputs.</span>
        <span class="nv">script </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            SEED=$RANDOM</span>
<span class="s2">            if ! (( $SEED % 3 )); then</span>
<span class="s2">                cylc message &#39;The-Good&#39;</span>
<span class="s2">            elif ! (( ( $SEED + 1 ) % 3 )); then</span>
<span class="s2">                cylc message &#39;The-Bad&#39;</span>
<span class="s2">            else</span>
<span class="s2">                cylc message &#39;The-Ugly&#39;</span>
<span class="s2">            fi</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="nt">[[[outputs]]]</span>
            <span class="c1"># Register the three custom outputs with cylc.</span>
            <span class="nv">good </span><span class="o">=</span><span class="s"> &#39;The-Good&#39;</span>
            <span class="nv">bad </span><span class="o">=</span><span class="s"> &#39;The-Bad&#39;</span>
            <span class="nv">ugly </span><span class="o">=</span><span class="s"> &#39;The-Ugly&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="self-suiciding-task">
<h3>Self-Suiciding Task<a class="headerlink" href="#self-suiciding-task" title="Permalink to this headline">¶</a></h3>
<p>An example of a workflow where there are no tasks which are dependent on the
task to suicide trigger.</p>
<div align="center" class="align-center"><div class="graphviz"><object data="../../_images/graphviz-4f6a326b2c385d41529e16127ba073c8c1f426fa.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph Example {
subgraph cluster_1 {
   label = &quot;Faulty\nTask&quot;
   color = &quot;orange&quot;
   fontcolor = &quot;orange&quot;
   style = &quot;dashed&quot;
   labelloc = &quot;b&quot;
   pub
}

foo -&gt; bar -&gt; baz
bar -&gt; pub
}</p></object></div>
</div>
<p>It is possible for a task to suicide trigger itself e.g:</p>
<div class="highlight-cylc-graph notranslate"><div class="highlight"><pre><span></span><span class="kd">foo</span><span class="c">:</span><span class="kd">fail</span> <span class="o">=&gt;</span> <span class="c">!</span> <span class="kd">foo</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is usually not recommended but in the case where there are no tasks
dependent on the one to remove it is an acceptable approach.</p>
</div>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            foo =&gt; bar =&gt; baz</span>
<span class="s2">            bar =&gt; pub</span>

            <span class="c1"># Remove the &quot;pub&quot; task in the event of failure.</span><span class="s2"></span>
<span class="s2">            pub:fail =&gt; ! pub</span>
<span class="s2">        &quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> sleep 1</span>
    <span class="nt">[[pub]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> false</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="message-triggers.html" class="btn btn-neutral float-right" title="Message Triggers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="retries.html" class="btn btn-neutral float-left" title="Retries" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2008-2021 NIWA &amp; British Crown (Met Office) &amp; Contributors.
      <span class="lastupdated">
        Last updated on Mar 24, 2021.
      </span>

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  <!--
  element which gets populated with the list of available versions and
  formats for the documentation by versions.js
-->
<div
  class="rst-versions"
  data-toggle="rst-versions"
  id='versions-and-formats'
></div>



<script type="text/javascript">
    const CUR_FORMAT = "html";
    const CUR_VERSION = "nightly.2021-03-24";
    // name of page (in URL), for singlepage builds this will be `index`
    const PAGE_NAME = "tutorial/furthertopics/suicide-triggers";
    // URL path to the base docs dir i.e. ROOT_DIR/version/format
    const ROOT_DIR = "../../../..";
</script>

<script
  type="text/javascript"
  src="../../../../versions.js"
></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>