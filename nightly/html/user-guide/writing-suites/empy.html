

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>EmPy &mdash; Cylc nightly.2021-03-24 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/diff_selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/grid_table.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/hieroglyph_theme_addons.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/tutorial.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/addons.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/cylc-favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/js/diff_selector.js"></script>
        <script src="../../_static/js/minicylc.js"></script>
        <script src="../../_static/js/spoiler.js"></script>
        <script src="../../_static/js/addons.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="External Triggers" href="external-triggers.html" />
    <link rel="prev" title="Jinja2" href="jinja2.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/cylc-logo-white.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                nightly.2021-03-24
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../workflows.html">Workflows For Cycling Systems</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Writing Suites</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="configuration.html">Workflow Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="scheduling.html">Scheduling - Dependency Graphs</a></li>
<li class="toctree-l3"><a class="reference internal" href="runtime.html">Runtime - Task Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="parameterized-tasks.html">Parameterized Tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="jinja2.html">Jinja2</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">EmPy</a></li>
<li class="toctree-l3"><a class="reference internal" href="external-triggers.html">External Triggers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../installing-workflows.html">Installing Workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../running-suites.html">Running Suites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../suite-storage-etc.html">Suite Storage, Discovery, Revision Control, and Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../task-implementation/index.html">Task Implementation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/index.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../suite-design-guide/index.html">Suite Design Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Cylc</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">User Guide</a> &raquo;</li>
        
          <li><a href="index.html">Writing Suites</a> &raquo;</li>
        
      <li>EmPy</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/user-guide/writing-suites/empy.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="empy">
<span id="user-guide-empy"></span><h1>EmPy<a class="headerlink" href="#empy" title="Permalink to this headline">Â¶</a></h1>
<p>In addition to Jinja2, Cylc supports EmPy template processor in suite
configurations. Similarly to Jinja2, EmPy provides variables, mathematical
expressions, loop control structures, conditional logic, etc., that are
expanded to generate the final suite configuration seen by Cylc. See the
<a class="reference external" href="http://www.alcyone.com/software/empy">EmPy documentation</a> for more
details on its templating features and how to use them.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>EmPy is not included in the standard Cylc installation, if installing
with <code class="docutils literal notranslate"><span class="pre">pip</span></code> run <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">cylc-flow[empy]</span></code> to install this
dependency.</p>
</div>
<p>To enable EmPy place an <code class="docutils literal notranslate"><span class="pre">empy</span></code> hash-bang comment on the first line of
the flow.cylc file:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="ch">#!empy</span>
<span class="c1"># ...</span>
</pre></div>
</div>
<p>An example suite <code class="docutils literal notranslate"><span class="pre">empy.cities</span></code> demonstrating its use is shown below.
It is a translation of <code class="docutils literal notranslate"><span class="pre">jinja2.cities</span></code> example from
<a class="reference internal" href="jinja2.html#user-guide-jinja2"><span class="std std-ref">Jinja2</span></a> and can be directly compared against it.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="c1">#!EmPy</span>
<span class="nt">[meta]</span>
    <span class="nv">title </span><span class="o">=</span><span class="s"> &quot;EmPy city suite example.&quot;</span>
    <span class="nv">description </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Illustrates use of variables and math expressions, and programmatic</span>
<span class="s2">        generation of groups of related dependencies and runtime properties.</span>
<span class="s2">    &quot;&quot;&quot;</span>

<span class="nt">[scheduler]</span>
    <span class="nv">allow implicit tasks </span><span class="o">=</span><span class="s"> True</span>

<span class="cp">@{</span>
<span class="cp">HOST = &quot;SuperComputer&quot;</span>
<span class="cp">CITIES = &#39;NewYork&#39;, &#39;Philadelphia&#39;, &#39;Newark&#39;, &#39;Houston&#39;, &#39;SantaFe&#39;, &#39;Chicago&#39;</span>
<span class="cp">CITYJOBS = &#39;one&#39;, &#39;two&#39;, &#39;three&#39;, &#39;four&#39;</span>
<span class="cp">LIMIT_MINS = 20</span>
<span class="cp">CLEANUP = True</span>
<span class="cp">}</span>

<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> 2011-08-08T12</span>
    <span class="nt">[[graph]]</span>
<span class="cp">@[ if CLEANUP ]</span>
        <span class="nv">T23 </span><span class="o">=</span><span class="s"> clean</span>
<span class="cp">@[ end if ]</span>
        <span class="nv">T00,T12 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            setup =&gt; get_lbc &amp; get_ic</span> <span class="c1"># foo</span><span class="s2"></span>
<span class="cp">@[ for CITY in CITIES ]</span><span class="c c-Multi">@# comment</span><span class="s2"></span>
<span class="s2">            get_lbc =&gt; </span><span class="cp">@(CITY)</span><span class="s2">_one</span>
<span class="s2">            get_ic =&gt; </span><span class="cp">@(CITY)</span><span class="s2">_two</span>
<span class="s2">            </span><span class="cp">@(CITY)</span><span class="s2">_one &amp; </span><span class="cp">@(CITY)</span><span class="s2">_two =&gt; </span><span class="cp">@(CITY)</span><span class="s2">_three &amp; </span><span class="cp">@(CITY)</span><span class="s2">_four</span>
<span class="s2">    </span><span class="cp">@[ if CLEANUP ]</span><span class="s2"></span>
<span class="s2">            </span><span class="cp">@(CITY)</span><span class="s2">_three &amp; </span><span class="cp">@(CITY)</span><span class="s2">_four =&gt; cleanup</span>
<span class="s2">    </span><span class="cp">@[ end if ]</span><span class="s2"></span>
<span class="cp">@[ end for ]</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[on_</span><span class="cp">@HOST</span><span class="nt"> ]]</span>
        <span class="nt">[[[remote]]]</span>
            <span class="nv">host </span><span class="o">=</span><span class="s"> </span><span class="cp">@HOST</span>
            <span class="c1"># (remote cylc directory is set in site/user config for this host)</span>
        <span class="nt">[[[directives]]]</span>
            <span class="nv">wall_clock_limit </span><span class="o">=</span><span class="s"> &quot;00:</span><span class="cp">@(LIMIT_MINS + 2)</span><span class="s">:00,00:</span><span class="cp">@(LIMIT_MINS)</span><span class="s">:00&quot;</span>

<span class="cp">@[ for CITY in CITIES ]</span>
    <span class="nt">[[ </span><span class="cp">@(CITY)</span><span class="nt"> ]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> on_</span><span class="cp">@(HOST)</span>
    <span class="cp">@[ for JOB in CITYJOBS ]</span>
    <span class="nt">[[ </span><span class="cp">@(CITY)</span><span class="nt">_</span><span class="cp">@(JOB)</span><span class="nt"> ]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> </span><span class="cp">@CITY</span>
    <span class="cp">@[ end for ]</span>
<span class="cp">@[ end for ]</span>

<span class="cp">@empy.include(&quot;./suite-visualization.cylc&quot;)</span>
</pre></div>
</div>
<p>For basic usage the difference between Jinja2 and EmPy amounts to a different
markup syntax with little else to distinguish them. EmPy might be preferable,
however, in cases where more complicated processing logic have to be
implemented.</p>
<p>EmPy is a system for embedding Python expressions and statements in template
text. It makes the full power of Python language and its ecosystem easily
accessible from within the template. This might be desirable for several
reasons:</p>
<ul class="simple">
<li><p>No need to learn different language and its idiosyncrasies just for
writing template logic.</p></li>
<li><p>Availability of lambda functions, list and dictionary comprehensions
can make template code smaller and more readable compared to Jinja2.</p></li>
<li><p>Natural and straightforward integration with Python package ecosystem.</p></li>
<li><p>No two-language barrier between writing template logic and processing
extensions makes it easier to refactor and maintain the template code
as its complexity grows - inline pieces of Python code can be
gathered into subroutines and eventually into separate modules and
packages in a seamless manner.</p></li>
</ul>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="external-triggers.html" class="btn btn-neutral float-right" title="External Triggers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="jinja2.html" class="btn btn-neutral float-left" title="Jinja2" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2008-2021 NIWA &amp; British Crown (Met Office) &amp; Contributors.
      <span class="lastupdated">
        Last updated on Mar 24, 2021.
      </span>

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  <!--
  element which gets populated with the list of available versions and
  formats for the documentation by versions.js
-->
<div
  class="rst-versions"
  data-toggle="rst-versions"
  id='versions-and-formats'
></div>



<script type="text/javascript">
    const CUR_FORMAT = "html";
    const CUR_VERSION = "nightly.2021-03-24";
    // name of page (in URL), for singlepage builds this will be `index`
    const PAGE_NAME = "user-guide/writing-suites/empy";
    // URL path to the base docs dir i.e. ROOT_DIR/version/format
    const ROOT_DIR = "../../../..";
</script>

<script
  type="text/javascript"
  src="../../../../versions.js"
></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>