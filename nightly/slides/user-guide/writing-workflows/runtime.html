<!DOCTYPE html>


<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Task Configuration &mdash; Cylc 8.1.0.dev documentation</title>
    
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/styles.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/single.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <link rel="stylesheet" href="../../_static/css/slides-custom.css" type="text/css" />
    
    
    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/single.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/diff_selector.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/grid_table.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/hieroglyph_theme_addons.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/tutorial.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/addons.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '8.1.0.dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/js/diff_selector.js"></script>
    <script type="text/javascript" src="../../_static/js/minicylc.js"></script>
    <script type="text/javascript" src="../../_static/js/spoiler.js"></script>
    <script type="text/javascript" src="../../_static/js/addons.js"></script>
    <script type="text/javascript" src="../../_static/common.js"></script>
    
    <script type="text/javascript" src="../../_static/slides.js"></script>
    <script type="text/javascript" src="../../_static/sync.js"></script>
    <script type="text/javascript" src="../../_static/controller.js"></script>
    <script type="text/javascript" src="../../_static/init.js"></script>
    
    
    <link rel="shortcut icon" href="../../_static/cylc-favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="top" title="Cylc 8.1.0.dev documentation" href="../../index.html" />
    <link rel="up" title="Writing Workflows" href="index.html" />
    <link rel="next" title="Task Parameters" href="parameterized-tasks.html" />
    <link rel="prev" title="Scheduling Configuration" href="scheduling.html" /> 
  </head>
  <body>

<section
   id="slide_container"
   class='slides layout-regular'>


  
<article class="slide level-1" id="task-configuration">

<h1>Task Configuration<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#task-configuration" title="View HTML">§</a></h1>

<div class="tip tutorial-ref admonition">
<p class="first admonition-title">Related Tutorial</p>
<p class="last"><a class="reference internal" href="../../tutorial/runtime/index.html#tutorial-runtime"><span class="std std-ref">Runtime Tutorial</span></a></p>
</div>
<p>The <a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime]" title="flow.cylc[runtime]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[runtime]</span></code></a> section of the <a class="reference internal" href="../../reference/config/workflow.html#flow.cylc" title="flow.cylc"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">flow.cylc</span></code></a> file
defines what job each <a class="reference internal" href="../../glossary.html#term-task"><span class="xref std std-term">task</span></a> should run, and where and how to
submit each one to run.</p>
<p>It is an inheritance hierarchy that allows common settings to be factored
out and defined once in task <a class="reference internal" href="../../glossary.html#term-family"><span class="xref std std-term">families</span></a> (duplication
of configuration is a maintenance risk in a complex workflow).</p>




</article>
<article class="slide level-2" id="task-and-family-names">

<h2>Task and Family Names<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#task-and-family-names" title="View HTML">§</a></h2>

<p>Task and family names must match in the graph and runtime sections of the
workflow config file. They do not need to match the names of the external
applications wrapped by the tasks.</p>
<dl class="py class">
<dt class="sig sig-object py" id="cylc.flow.unicode_rules.TaskNameValidator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><code class="sig-prename descclassname"><span class="pre">cylc.flow.unicode_rules.</span></code><code class="sig-name descname"><span class="pre">TaskNameValidator</span></code></dt>
<dd><p>The rules for valid task and family names:</p>
<ul class="simple">
<li>must start with: alphanumeric</li>
<li>can only contain: alphanumeric, <code class="docutils literal notranslate"><span class="pre">-</span></code>, <code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">%</span></code>, <code class="docutils literal notranslate"><span class="pre">&#64;</span></code></li>
<li>cannot start with: <code class="docutils literal notranslate"><span class="pre">_cylc</span></code></li>
<li>cannot be: <code class="docutils literal notranslate"><span class="pre">root</span></code></li>
</ul>
</dd></dl>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">At runtime, task jobs can access their own workflow task name as
<code class="docutils literal notranslate"><span class="pre">$CYLC_TASK_NAME</span></code> in the job environment <a class="reference internal" href="#taskexecutionenvironment"><span class="std std-ref">job environment</span></a> if needed.</p>
</div>
<p>The following runtime configuration defines one family called <code class="docutils literal notranslate"><span class="pre">FAM</span></code> and two
member tasks <code class="docutils literal notranslate"><span class="pre">fm1</span></code> and <code class="docutils literal notranslate"><span class="pre">fm2</span></code> that inherit settings from it. Members can
also override inherited settings and define their own private settings.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[FAM]]</span>  <span class="c1"># &lt;-- a family</span>
        <span class="c1">#...  settings for all FAM members</span>

    <span class="nt">[[fm1]]</span>  <span class="c1"># &lt;-- task</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> FAM</span>
        <span class="c1">#...  fm1-specific settings</span>

    <span class="nt">[[fm2]]</span>  <span class="c1"># &lt;-- a task</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> FAM</span>
        <span class="c1">#...  fm2-specific settings</span>
</pre></div>
</div>
<p>Note that families are not nested in terms of the file sub-heading structure. A
runtime subsection defines a family if others inherit from it, otherwise
it defines a task.</p>




</article>
<article class="slide level-2" id="the-root-family">

<h2>The Root Family<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#the-root-family" title="View HTML">§</a></h2>

<p>All tasks inherit implicitly from a family called <code class="docutils literal notranslate"><span class="pre">root</span></code> that can provide
default settings for all tasks in the workflow (non-root families require an
explicit <code class="docutils literal notranslate"><span class="pre">inherit</span></code> statement).</p>
<p>For example, if all task jobs are to run on the same job platform, that could
can be specified once for all tasks under <code class="docutils literal notranslate"><span class="pre">root</span></code>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="c1"># all tasks run on hpc1 (unless they override this setting)</span>
        <span class="nv">platform </span><span class="o">=</span><span class="s"> hpc1</span>
</pre></div>
</div>




</article>
<article class="slide level-2" id="defining-multiple-tasks-or-families-at-once">

<h2>Defining Multiple Tasks or Families at Once<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#defining-multiple-tasks-or-families-at-once" title="View HTML">§</a></h2>

<p>Runtime sub-section headings can be a comma-separated list of task or family
names, in which case the settings below it apply to each list member.</p>
<p>Here a group of three related tasks all run the same script on the same
<a class="reference internal" href="../../glossary.html#term-platform"><span class="xref std std-term">platform</span></a>, but pass their own names to it on the command line:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[ENSEMBLE]]</span>
        <span class="nv">platform </span><span class="o">=</span><span class="s"> hpc1</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;run-model.sh $CYLC_TASK_NAME&quot;</span>

    <span class="nt">[[m1, m2, m3]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> ENSEMBLE</span>

    <span class="nt">[[m1]]</span>
        <span class="c1">#...  m1-specific settings</span>
</pre></div>
</div>
<p>Particular tasks (such as <code class="docutils literal notranslate"><span class="pre">m1</span></code> above) can still be singled out to add
task-specific settings.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference internal" href="parameterized-tasks.html#user-guide-param"><span class="std std-ref">Task parameters</span></a> or template processing (see
<a class="reference internal" href="jinja2.html#user-guide-jinja2"><span class="std std-ref">Jinja2</span></a> and <a class="reference internal" href="empy.html#user-guide-empy"><span class="std std-ref">EmPy</span></a>) can be used to
programmatically generate family members and associated dependencies.</p>
</div>




</article>
<article class="slide level-2" id="families-of-families">

<h2>Families of Families<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#families-of-families" title="View HTML">§</a></h2>

<p>Families can inherit from other families, to any depth.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[HPC1]]</span>
        <span class="nv">platform </span><span class="o">=</span><span class="s"> hpc1</span>

    <span class="nt">[[BIG-HPC1]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> HPC1</span>
        <span class="c1">#...  add in high memory batch system directives</span>

    <span class="nt">[[model]]</span>  <span class="c1"># a big task that runs on hpc1</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> BIG-HPC1</span>
</pre></div>
</div>
<p>If the same item is defined (and redefined) at several levels in the family
tree, the highest level (closest to the task) takes precedence.</p>




</article>
<article class="slide level-2" id="inheriting-from-multiple-parents">

<h2>Inheriting from Multiple Parents<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#inheriting-from-multiple-parents" title="View HTML">§</a></h2>

<p>Sometimes a multi-level single-parent tree is not sufficient to avoid all
duplication of settings. Fortunately tasks can inherit from multiple parents at
once <a class="footnote-reference" href="#id5" id="id1">[1]</a>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[HPC1]]</span>
        <span class="nv">platform </span><span class="o">=</span><span class="s"> hpc1</span>

    <span class="nt">[[BIG]]</span>  <span class="c1"># high memory batch system directives</span>
        <span class="c1">#...</span>

    <span class="nt">[[model]]</span>  <span class="c1"># a big task that runs on hpc1</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> BIG, HPC1</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">config</span></code> to check exactly what settings a task or family ends up
with after inheritance processing:</p>
<div class="last highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cylc config --item <span class="s2">&quot;[runtime][model]environment&quot;</span> &lt;workflow-id&gt;
</pre></div>
</div>
</div>




</article>
<article class="slide level-3" id="first-parent-family-hierarchy-for-visualization">

<h3>First-parent Family Hierarchy for Visualization<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#first-parent-family-hierarchy-for-visualization" title="View HTML">§</a></h3>

<p>Tasks can be collapsed into first-parent families in the Cylc GUI, so first
parents should reflect the logical purpose of a task where possible, rather
than (say) shared technical settings:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[HPC]]</span>
        <span class="c1"># technical platform settings</span>

    <span class="nt">[[MODEL]]</span>
        <span class="c1"># atmospheric model tasks</span>

    <span class="nt">[[atmos]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> MODEL, HPC</span>  <span class="c1"># (not HPC, MODEL)</span>
</pre></div>
</div>
<p>If this is not what you want, given that the primary purpose of the family
hierarchy is inheritance of runtime settings, a dummy first parent <code class="docutils literal notranslate"><span class="pre">None</span></code> can
be used to disable the visualization usage without affecting inheritance:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[BAR]]</span>
        <span class="c1">#...</span>
    <span class="nt">[[foo]]</span>
        <span class="c1"># inherit from BAR but stay under root for visualization</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> None, BAR</span>
</pre></div>
</div>




</article>
<article class="slide level-2" id="task-job-environment">

<h2>Task Job Environment<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#task-job-environment" title="View HTML">§</a></h2>

<p>Task job scripts export various environment variables before running <code class="docutils literal notranslate"><span class="pre">script</span></code>
blocks (see <a class="reference internal" href="../task-implementation/job-submission.html#taskjobsubmission"><span class="std std-ref">Task Job Submission and Management</span></a>).</p>
<p>Scheduler-defined variables appear first to identify the workflow, the task,
and log directory locations. These are followed by user-defined variables from
<a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime][&lt;namespace&gt;][environment]" title="flow.cylc[runtime][&lt;namespace&gt;][environment]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[runtime][&lt;namespace&gt;][environment]</span></code></a>. Order of variable definition
is preserved so that new variable assignments can reference previous ones.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Task environment variables are evaluated at runtime, by task jobs, on the
job platform. So <code class="docutils literal notranslate"><span class="pre">$HOME</span></code> in a task environment, for instance, evaluates at
runtime to the home directory on the job platform, not on the scheduler
platform.</p>
</div>
<p>In this example the task <code class="docutils literal notranslate"><span class="pre">foo</span></code> ends up with <code class="docutils literal notranslate"><span class="pre">SHAPE=circle</span></code>, <code class="docutils literal notranslate"><span class="pre">COLOR=blue</span></code>,
and <code class="docutils literal notranslate"><span class="pre">TEXTURE=rough</span></code> in its environment:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">COLOR </span><span class="o">=</span><span class="s"> red</span>
            <span class="nv">SHAPE </span><span class="o">=</span><span class="s"> circle</span>
    <span class="nt">[[foo]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">COLOR </span><span class="o">=</span><span class="s"> blue</span>  <span class="c1"># root override</span>
            <span class="nv">TEXTURE </span><span class="o">=</span><span class="s"> rough</span> <span class="c1"># new variable</span>
</pre></div>
</div>
<p>Task job access to Cylc itself is configured first so that variable
assignment expressions (as well as scripting) can use Cylc commands:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">REFERENCE_TIME </span><span class="o">=</span><span class="s"> $(cylc cyclepoint --offset-hours=6)</span>
</pre></div>
</div>




</article>
<article class="slide level-3" id="overriding-inherited-environment-variables">

<h3>Overriding Inherited Environment Variables<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#overriding-inherited-environment-variables" title="View HTML">§</a></h3>

<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If you override an inherited task environment variable the parent config
item gets <em>replaced</em> before it is ever used to define the shell variable in
the task job script. Consequently the job cannot see the parent value as well
as the task value:</p>
</div>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[FOO]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">COLOR </span><span class="o">=</span><span class="s"> red</span>
    <span class="nt">[[bar]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> FOO</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">tmp </span><span class="o">=</span><span class="s"> $COLOR</span>  <span class="c1"># !! ERROR: $COLOR is undefined here</span>
            <span class="nv">COLOR </span><span class="o">=</span><span class="s"> dark-$tmp</span>  <span class="c1"># !! as this overrides COLOR in FOO.</span>
</pre></div>
</div>
<p>The compressed variant of this, <code class="docutils literal notranslate"><span class="pre">COLOR</span> <span class="pre">=</span> <span class="pre">dark-$COLOR</span></code>, is also an error for
the same reason. To achieve the desired result, use a different name for the
parent variable:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[FOO]]</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">FOO_COLOR </span><span class="o">=</span><span class="s"> red</span>
    <span class="nt">[[bar]]</span>
        <span class="nv">inherit </span><span class="o">=</span><span class="s"> FOO</span>
        <span class="nt">[[[environment]]]</span>
            <span class="nv">COLOR </span><span class="o">=</span><span class="s"> dark-$FOO_COLOR</span>  <span class="c1"># OK</span>
</pre></div>
</div>




</article>
<article class="slide level-3" id="task-job-script-variables">

<h3>Task Job Script Variables<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#task-job-script-variables" title="View HTML">§</a></h3>

<p>These variables provided by the <a class="reference internal" href="../../glossary.html#term-scheduler"><span class="xref std std-term">scheduler</span></a> are available to task job scripts:</p>
<div class="highlight-sub notranslate"><div class="highlight"><pre><span></span>CYLC_VERSION                       <span class="c"># Version of cylc installation used</span>
CYLC_VERBOSE                       <span class="c"># Verbose mode, true or false</span>
CYLC_DEBUG                         <span class="c"># Debug mode (even more verbose), true or false</span>

CYLC_CYCLING_MODE                  <span class="c"># Cycling mode, e.g. gregorian</span>
ISODATETIMECALENDAR                <span class="c"># Calendar mode for the `isodatetime` command,</span>
                                   <span class="c">#   defined with the value of CYLC_CYCLING_MODE</span>
                                   <span class="c">#   when in any datetime cycling mode</span>

CYLC_WORKFLOW_FINAL_CYCLE_POINT    <span class="c"># Final cycle point</span>
CYLC_WORKFLOW_INITIAL_CYCLE_POINT  <span class="c"># Initial cycle point</span>
CYLC_WORKFLOW_ID                   <span class="c"># Workflow ID</span>
                                   <span class="c"># e.g. &quot;a/b/c/run1&quot;</span>
CYLC_WORKFLOW_NAME                 <span class="c"># Workflow ID with the run name removed</span>
                                   <span class="c"># (use CYLC_WORKFLOW_ID for most purposes)</span>
                                   <span class="c"># e.g. &quot;a/b/c&quot;</span>
CYLC_WORKFLOW_NAME_BASE            <span class="c"># The basename of the workflow name</span>
                                   <span class="c"># (use CYLC_WORKFLOW_ID for most purposes)</span>
                                   <span class="c"># e.g. &quot;c&quot;</span>
CYLC_UTC                           <span class="c"># UTC mode, True or False</span>
TZ                                 <span class="c"># Set to &quot;UTC&quot; in UTC mode or not defined</span>

CYLC_WORKFLOW_RUN_DIR              <span class="c"># Location of the run directory in</span>
                                   <span class="c"># job host, e.g. ~/cylc-run/foo</span>
CYLC_WORKFLOW_HOST                 <span class="c"># Host running the workflow process</span>
CYLC_WORKFLOW_OWNER                <span class="c"># User ID running the workflow process</span>

CYLC_WORKFLOW_SHARE_DIR            <span class="c"># Workflow (or task!) shared directory (see below)</span>
CYLC_WORKFLOW_UUID                 <span class="c"># Workflow UUID string</span>
CYLC_WORKFLOW_WORK_DIR             <span class="c"># Workflow work directory (see below)</span>

CYLC_TASK_JOB                      <span class="c"># Task job identifier expressed as</span>
                                   <span class="c"># CYCLE-POINT/TASK-NAME/SUBMIT-NUMBER</span>
                                   <span class="c">#   e.g. 20110511T1800Z/t1/01</span>

CYLC_TASK_CYCLE_POINT              <span class="c"># Cycle point, e.g. 20110511T1800Z</span>
ISODATETIMEREF                     <span class="c"># Reference time for the `isodatetime` command,</span>
                                   <span class="c">#   defined with the value of CYLC_TASK_CYCLE_POINT</span>
                                   <span class="c">#   when in any datetime cycling mode</span>

CYLC_TASK_NAME                     <span class="c"># Job&#39;s task name, e.g. t1</span>
CYLC_TASK_ID                       <span class="c"># Task instance identifier CYCLE-POINT/TASK-NAME</span>
                                   <span class="c">#   e.g. 20110511T1800Z/t1</span>

CYLC_TASK_SUBMIT_NUMBER            <span class="c"># Job&#39;s submit number, e.g. 1,</span>
                                   <span class="c">#   increments with every submit</span>
CYLC_TASK_TRY_NUMBER               <span class="c"># Number of execution tries, e.g. 1</span>
                                   <span class="c">#   increments with automatic execution retry delays.</span>
CYLC_TASK_FLOW_NUMBERS             <span class="c"># Flows this task belongs to, e.g. 1,2</span>

CYLC_TASK_LOG_DIR                  <span class="c"># Location of the job log directory</span>
                                   <span class="c">#   e.g. ~/cylc-run/foo/log/job/20110511T1800Z/t1/01/</span>
CYLC_TASK_LOG_ROOT                 <span class="c"># The task job file path</span>
                                   <span class="c">#   e.g. ~/cylc-run/foo/log/job/20110511T1800Z/t1/01/job</span>
CYLC_TASK_WORK_DIR                 <span class="c"># Location of task work directory (see below)</span>
                                   <span class="c">#   e.g. ~/cylc-run/foo/work/20110511T1800Z/t1</span>

CYLC_TASK_NAMESPACE_HIERARCHY      <span class="c"># Linearised family namespace of the task,</span>
                                   <span class="c">#   e.g. root postproc t1</span>
CYLC_TASK_DEPENDENCIES             <span class="c"># List of met dependencies that triggered the task</span>
                                   <span class="c">#   e.g. 1/foo 1/bar</span>

CYLC_TASK_COMMS_METHOD             <span class="c"># Set to &quot;ssh&quot; if communication method is &quot;ssh&quot;</span>
CYLC_TASK_SSH_LOGIN_SHELL          <span class="c"># With &quot;ssh&quot; communication, if set to &quot;True&quot;,</span>
                                   <span class="c">#   use login shell on workflow host</span>
</pre></div>
</div>
<p>Some global shell variables are also defined in the task job script, but not
exported to subshells:</p>
<div class="highlight-sub notranslate"><div class="highlight"><pre><span></span>CYLC_FAIL_SIGNALS               <span class="c"># List of signals trapped by the error trap</span>
CYLC_VACATION_SIGNALS           <span class="c"># List of signals trapped by the vacation trap</span>
CYLC_TASK_MESSAGE_STARTED_PID   <span class="c"># PID of &quot;cylc message&quot; job started&quot; command</span>
CYLC_TASK_WORK_DIR_BASE         <span class="c"># Alternate task work directory,</span>
                                <span class="c">#   relative to the workflow work directory</span>
</pre></div>
</div>




</article>
<article class="slide level-3" id="workflow-share-directories">

<h3>Workflow Share Directories<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#workflow-share-directories" title="View HTML">§</a></h3>

<p>The workflow <a class="reference internal" href="../../glossary.html#term-share-directory"><span class="xref std std-term">share directory</span></a> is created automatically under the
workflow run directory as a convenient shared space for tasks. The location is
available to tasks as <code class="docutils literal notranslate"><span class="pre">$CYLC_WORKFLOW_SHARE_DIR</span></code>. In a cycling workflow,
output files are typically held in cycle point sub-directories of this.</p>
<p>The top level share directory location can be changed, e.g. to a large data
area, by global config settings under <a class="reference internal" href="../../reference/config/global.html#global.cylc[install][symlink dirs]" title="global.cylc[install][symlink dirs]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">global.cylc[install][symlink</span> <span class="pre">dirs]</span></code></a>.</p>




</article>
<article class="slide level-3" id="task-work-directories">

<h3>Task Work Directories<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#task-work-directories" title="View HTML">§</a></h3>

<p>Task job scripts are executed from within <a class="reference internal" href="../../glossary.html#term-work-directory"><span class="xref std std-term">work directories</span></a> created automatically under the workflow run directory. A task can
access its own work directory via <code class="docutils literal notranslate"><span class="pre">$CYLC_TASK_WORK_DIR</span></code> (or simply <code class="docutils literal notranslate"><span class="pre">$PWD</span></code>
if it does not change to another location at runtime). By default the location
contains task name and cycle point, to provide a unique workspace for every
instance of every task.</p>
<p>The top level work directory location can be changed, e.g. to a large data
area, by global config settings under <a class="reference internal" href="../../reference/config/global.html#global.cylc[install][symlink dirs]" title="global.cylc[install][symlink dirs]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">global.cylc[install][symlink</span> <span class="pre">dirs]</span></code></a>.</p>




</article>
<article class="slide level-2" id="remote-task-hosting">

<h2>Remote Task Hosting<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#remote-task-hosting" title="View HTML">§</a></h2>

<p>Job <a class="reference internal" href="../../glossary.html#term-platform"><span class="xref std std-term">platforms</span></a> are defined in <code class="docutils literal notranslate"><span class="pre">global.cylc[platforms]</span></code>.</p>
<p>If a task declares a different platform to that where the scheduler is running,
Cylc uses non-interactive SSH to submit the job to the platform <a class="reference internal" href="../../glossary.html#term-job-runner"><span class="xref std std-term">job
runner</span></a> on one of the platform hosts. Workflow source files will be installed
on the platform, via the associated <code class="docutils literal notranslate"><span class="pre">global.cylc[install</span> <span class="pre">targets]</span></code>, just
before the first job is submitted to run there.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
   <span class="nt">[[foo]]</span>
       <span class="nv">platform </span><span class="o">=</span><span class="s"> orca</span>
</pre></div>
</div>
<p>For this to work:</p>
<ul class="simple">
<li>Non-interactive SSH is required from the <a class="reference internal" href="../../glossary.html#term-scheduler"><span class="xref std std-term">scheduler</span></a> host
to the platform hosts</li>
<li>Cylc must be installed on the hosts of the destination platform<ul>
<li>If polling task communication is used, there is no other requirement</li>
<li>If SSH task communication is configured, non-interactive SSH is required
from the job platform to the scheduler platform</li>
<li>If TCP (default) task communication is configured, the task platform
should have access to the Cylc ports on the scheduler host</li>
</ul>
</li>
</ul>
<p>Platforms, like other runtime settings, can be declared globally in the root
family, or in other families, or for individual tasks.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The platform known as <code class="docutils literal notranslate"><span class="pre">localhost</span></code> is the platform where the scheduler
is running, in many cases a dedicated server and <em>not</em> your desktop.</p>
</div>




</article>
<article class="slide level-3" id="internal-platform-and-host-selection">

<h3>Internal Platform and Host Selection<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#internal-platform-and-host-selection" title="View HTML">§</a></h3>

<p>The <a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime][&lt;namespace&gt;]platform" title="flow.cylc[runtime][&lt;namespace&gt;]platform"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[runtime][&lt;namespace&gt;]platform</span></code></a> item points to either a
<a class="reference internal" href="../../reference/config/global.html#global.cylc[platforms][&lt;platform name&gt;]" title="global.cylc[platforms][&lt;platform name&gt;]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">platform</span></code></a> or a
<a class="reference internal" href="../../reference/config/global.html#global.cylc[platform groups][&lt;group&gt;]" title="global.cylc[platform groups][&lt;group&gt;]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">platform</span> <span class="pre">group</span></code></a>.</p>
<p><a class="reference internal" href="../../glossary.html#term-platform"><span class="xref std std-term">Cylc platforms</span></a> allow you to configure compute platforms
you wish Cylc to run jobs on.</p>
<p><a class="reference internal" href="../../glossary.html#term-platform-group"><span class="xref std std-term">Platform groups</span></a> allow you to group together platforms
any of which would be suitable for a given job.
Platform groups can improve robustness by allowing jobs to be submitted on
any platform in the group, as well as providing an interface for
<a class="reference internal" href="../../reference/config/global.html#global.cylc[platform groups][&lt;group&gt;][selection]method" title="global.cylc[platform groups][&lt;group&gt;][selection]method"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">basic</span> <span class="pre">load</span> <span class="pre">balancing</span></code></a>.</p>
<p><a class="reference internal" href="../../glossary.html#term-platform"><span class="xref std std-term">Platforms</span></a> are selected from a <a class="reference internal" href="../../glossary.html#term-platform-group"><span class="xref std std-term">platform group</span></a> once,
when a job is submitted.</p>
<p>Hosts within a <a class="reference internal" href="../../glossary.html#term-platform"><span class="xref std std-term">platform</span></a> are re-selected each time the scheduler
needs to communicate with a job.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../../reference/config/writing-platform-configs.html#adminguide-platformconfigs"><span class="std std-ref">Platform Configuration</span></a>: For details of how Platforms and
Platform Groups are set up and in-depth examples.</p>
</div>




</article>
<article class="slide level-3" id="external-platform-selection-scripts">

<h3>External Platform Selection Scripts<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#external-platform-selection-scripts" title="View HTML">§</a></h3>

<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 8.0.0: </span>Cylc 8 can select hosts from a group of suitable hosts listed in the
platform config, so in many cases this logic should no longer be necessary.</p>
</div>
<p>Instead of hardwiring platform names into the workflow configuration you can
give a command that prints a platform name, or an environment variable, as the
value of <a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime][&lt;namespace&gt;]platform" title="flow.cylc[runtime][&lt;namespace&gt;]platform"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[runtime][&lt;namespace&gt;]platform</span></code></a>.</p>
<p>For example:</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">flow.cylc</span></div>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[mytask]]</span>
        <span class="nv">platform </span><span class="o">=</span><span class="s"> $(script-which-returns-a-platform-name)</span>
</pre></div>
</div>
</div>
<p>Job hosts are always selected dynamically, for the chosen platform or
platform group.</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">If <code class="docutils literal notranslate"><span class="pre">$(script-which-returns-a-platform-name)</span></code> returns a non-zero exit
code then the scheduler will assign the
<a class="reference internal" href="../running-workflows/task-job-states.html#task-job-states"><span class="std std-ref">submit-failed</span></a> state to this <a class="reference internal" href="../../glossary.html#term-job"><span class="xref std std-term">job</span></a>.
If you have submit retries set up for the job, the scheduler will retry
running your platform selection script in the same was is it would for
any other submission failure.</p>
</div>




</article>
<article class="slide level-3" id="remote-task-job-log-directories">

<h3>Remote Task Job Log Directories<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#remote-task-job-log-directories" title="View HTML">§</a></h3>

<p>Task job stdout and stderr streams are written to <a class="reference internal" href="../../glossary.html#term-job-log"><span class="xref std std-term">log files</span></a>
under the workflow <a class="reference internal" href="../../glossary.html#term-run-directory"><span class="xref std std-term">run directory</span></a> (see <a class="reference internal" href="../task-implementation/job-submission.html#whitherstdoutandstderr"><span class="std std-ref">Task stdout and stderr Logs</span></a>).
For remote tasks the same directory is used, on the job host.</p>




</article>
<article class="slide level-2" id="implicit-tasks">

<h2>Implicit Tasks<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#implicit-tasks" title="View HTML">§</a></h2>

<p>An implicit task is one that appears in the graph but is not defined under
<a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime]" title="flow.cylc[runtime]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">flow.cylc[runtime]</span></code></a>.</p>
<p>Depending on the value of <a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[scheduler]allow implicit tasks" title="flow.cylc[scheduler]allow implicit tasks"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">flow.cylc[scheduler]allow</span> <span class="pre">implicit</span> <span class="pre">tasks</span></code></a>,
Cylc can automatically create default task definitions for these, to submit
local dummy jobs that just return the standard job status messages.</p>
<p>Implicit tasks can be used to mock up functional workflows very quickly. A
default <code class="docutils literal notranslate"><span class="pre">script</span></code> can be added to the root family, e.g. to slow job execution
down a little. Here is a complete workflow definition using implicit tasks:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduler]</span>
    <span class="nv">allow implicit tasks </span><span class="o">=</span><span class="s"> True</span>
<span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 = &quot;prep =&gt; run-a &amp; run-b </span><span class="o">=</span><span class="c">&gt;</span> <span class="kd">done</span><span class="c">&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;sleep 10&quot;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Implicit tasks are somewhat dangerous because they can easily be created by
mistake: misspelling a task’s name divorces it from its <code class="docutils literal notranslate"><span class="pre">runtime</span></code> definition.</p>
</div>
<p>For this reason implicit tasks are not allowed by default, and if used they
should be turned off once the real task definitions are complete.</p>
<p>You can get the convenience without the danger with a little more effort, by
adding empty runtime placeholders instead of allowing implicit tasks:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 = &quot;prep =&gt; run-a &amp; run-b </span><span class="o">=</span><span class="c">&gt;</span> <span class="kd">done</span><span class="c">&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;sleep 10&quot;</span>
    <span class="nt">[[prep]]</span>
    <span class="nt">[[run-a, run-b]]</span>
    <span class="nt">[[done]]</span>
</pre></div>
</div>




</article>
<article class="slide level-2" id="task-retry-on-failure">

<h2>Task Retry On Failure<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#task-retry-on-failure" title="View HTML">§</a></h2>

<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime][&lt;namespace&gt;]execution retry delays" title="flow.cylc[runtime][&lt;namespace&gt;]execution retry delays"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[runtime][&lt;namespace&gt;]execution</span> <span class="pre">retry</span> <span class="pre">delays</span></code></a>.</p>
</div>
<p>Tasks can have a list of <a class="reference internal" href="../../glossary.html#term-ISO8601-duration"><span class="xref std std-term">ISO8601 durations</span></a> as retry
intervals. If the job fails the task will return to the <code class="docutils literal notranslate"><span class="pre">waiting</span></code> state
with a clock-trigger configured with the next retry delay.</p>
<p>In the following example, tasks <code class="docutils literal notranslate"><span class="pre">bad</span></code> and <code class="docutils literal notranslate"><span class="pre">flaky</span></code> each have 3 retries
configured, with a 10 second delay between. On the final try, <code class="docutils literal notranslate"><span class="pre">bad</span></code> fails
again and goes to the <code class="docutils literal notranslate"><span class="pre">failed</span></code> state, while <code class="docutils literal notranslate"><span class="pre">flaky</span></code> succeeds and triggers
task <code class="docutils literal notranslate"><span class="pre">whizz</span></code> downstream. The scheduler will then stall with
<code class="docutils literal notranslate"><span class="pre">bad</span></code> retained as an incomplete task.</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
            <span class="kd">bad</span> <span class="o">=&gt;</span> <span class="kd">cheese</span>
            <span class="kd">flaky</span> <span class="o">=&gt;</span> <span class="kd">whizz</span>
         <span class="s2">&quot;&quot;&quot;</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[bad]]</span>
        <span class="c1"># retry 3 times then fail</span>
        <span class="nv">script </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            sleep 10</span>
<span class="s2">            false</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="nv">execution retry delays </span><span class="o">=</span><span class="s"> 3*PT10S</span>
    <span class="nt">[[flaky]]</span>
        <span class="c1"># retry 3 times then succeed</span>
        <span class="nv">script </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            sleep 10</span>
<span class="s2">            test $CYLC_TASK_TRY_NUMBER -gt 3</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="nv">execution retry delays </span><span class="o">=</span><span class="s"> 3*PT10S</span>
    <span class="nt">[[cheese, whizz]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> &quot;sleep 10&quot;</span>
</pre></div>
</div>




</article>
<article class="slide level-2" id="event-handling">

<h2>Event Handling<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#event-handling" title="View HTML">§</a></h2>

<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li>Task events <a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime][&lt;namespace&gt;][events]" title="flow.cylc[runtime][&lt;namespace&gt;][events]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[runtime][&lt;namespace&gt;][events]</span></code></a></li>
<li>Workflow events <a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[scheduler][events]" title="flow.cylc[scheduler][events]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[scheduler][events]</span></code></a></li>
</ul>
</div>
<p>Custom <em>event handler</em> scripts can be called when certain workflow and task
events occur. Event handlers can be used to send a message, raise an alarm, or
whatever you like. They can even call <code class="docutils literal notranslate"><span class="pre">cylc</span></code> commands to intervene in the
workflow.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Task event handlers are called by the <a class="reference internal" href="../../glossary.html#term-scheduler"><span class="xref std std-term">scheduler</span></a>, not by the task
jobs that generate the events - so they do not see the task job environment.</p>
</div>
<p>Event handlers can be stored in the workflow <code class="docutils literal notranslate"><span class="pre">bin</span></code> directory, or anywhere in
<code class="docutils literal notranslate"><span class="pre">$PATH</span></code> in the <a class="reference internal" href="../../glossary.html#term-scheduler"><span class="xref std std-term">scheduler</span></a> environment.</p>
<p>They should return quickly to avoid tying up the scheduler process pool -
see <a class="reference internal" href="scheduler.html#managing-external-command-execution"><span class="std std-ref">External Command Execution</span></a>.</p>




</article>
<article class="slide level-3" id="event-specific-handlers">

<h3>Event-Specific Handlers<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#event-specific-handlers" title="View HTML">§</a></h3>

<p>Event-specific handlers are configured by <code class="docutils literal notranslate"><span class="pre">&lt;event&gt;</span> <span class="pre">handlers</span></code>
under <a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime][&lt;namespace&gt;][events]" title="flow.cylc[runtime][&lt;namespace&gt;][events]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[runtime][&lt;namespace&gt;][events]</span></code></a>, where <code class="docutils literal notranslate"><span class="pre">&lt;event&gt;</span></code>
can be:</p>
<table border="1" class="docutils align-default">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Event</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>submitted</td>
<td>job submitted</td>
</tr>
<tr class="row-odd"><td>submission retry</td>
<td>job submission failed but will retry later</td>
</tr>
<tr class="row-even"><td>submission failed</td>
<td>job submission failed</td>
</tr>
<tr class="row-odd"><td>started</td>
<td>job started running</td>
</tr>
<tr class="row-even"><td>retry</td>
<td>job failed but will retry later</td>
</tr>
<tr class="row-odd"><td>failed</td>
<td>job failed</td>
</tr>
<tr class="row-even"><td>succeeded</td>
<td>job succeeded</td>
</tr>
<tr class="row-odd"><td>submission timeout</td>
<td>job timed out in the <code class="docutils literal notranslate"><span class="pre">submitted</span></code> state</td>
</tr>
<tr class="row-even"><td>execution timeout</td>
<td>job timed out in the <code class="docutils literal notranslate"><span class="pre">running</span></code> state</td>
</tr>
<tr class="row-odd"><td>warning</td>
<td>scheduler received a message of severity WARNING from job</td>
</tr>
<tr class="row-even"><td>critical</td>
<td>scheduler received a message of severity CRITICAL from job</td>
</tr>
<tr class="row-odd"><td>custom</td>
<td>scheduler received a message of severity CUSTOM from job <br> (note: literally, the word <code class="docutils literal notranslate"><span class="pre">CUSTOM</span></code>)</td>
</tr>
<tr class="row-even"><td>expired</td>
<td>task expired and will not submit (too far behind)</td>
</tr>
<tr class="row-odd"><td>late</td>
<td>task running later than expected</td>
</tr>
</tbody>
</table>
<p>Values should be a list of commands, command lines, or command line templates
(see below) to call if the specified event is triggered.</p>




</article>
<article class="slide level-3" id="general-event-handlers">

<h3>General Event Handlers<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#general-event-handlers" title="View HTML">§</a></h3>

<p>Alternatively you can configure <code class="docutils literal notranslate"><span class="pre">handler</span> <span class="pre">events</span></code> and <code class="docutils literal notranslate"><span class="pre">handlers</span></code>
under <a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime][&lt;namespace&gt;][events]" title="flow.cylc[runtime][&lt;namespace&gt;][events]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[runtime][&lt;namespace&gt;][events]</span></code></a>, where the former is a list
of events (as above), and the latter a list of commands, command lines, lines
or command line templates (see below) to call if any of the specified events
are triggered.</p>




</article>
<article class="slide level-3" id="task-event-template-variables">

<h3>Task Event Template Variables<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#task-event-template-variables" title="View HTML">§</a></h3>

<dl>
<p>The following variables are available to task event handlers.</p>
<p>They can be templated into event handlers with Python percent style string
formatting e.g:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>%(workflow)s is running on %(host)s
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">%(event)s</span></code> string, for instance, will be replaced by the actual
event name when the handler is invoked.</p>
<p>If no templates or arguments are specified the following default command
line will be used:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;event-handler&gt; %(event)s %(workflow)s %(id)s %(message)s
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Substitution patterns should not be quoted in the template strings.
This is done automatically where required.</p>
</div>
<p>For an explanation of the substitution syntax, see
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#printf-style-string-formatting">String Formatting Operations in the Python documentation</a>.</p>
<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">event</span></code></dt>
<dd><p>Event name.</p>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">workflow</span></code></dt>
<dd><p>Workflow ID.</p>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">suite</span></code></dt>
<dd><p>Workflow ID.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 8.0.0: </span>Use “workflow”.</p>
</div>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">uuid</span></code></dt>
<dd><p>The unique identification string for this workflow run.</p>
<p>This string is preserved for the lifetime of the scheduler and is restored
from the database on restart.</p>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">suite_uuid</span></code></dt>
<dd><p>The unique identification string for this workflow run.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 8.0.0: </span>Use ‘uuid_str’.</p>
</div>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">point</span></code></dt>
<dd><p>The task’s cycle point.</p>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">submit_num</span></code></dt>
<dd><p>The job’s submit number.</p>
<p>This starts at 1 and increments with each additional job submission.</p>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">try_num</span></code></dt>
<dd><p>The job’s try number.</p>
<p>The number of execution attempts.
It starts at 1 and increments with automatic
<a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime][&lt;namespace&gt;]execution retry delays" title="flow.cylc[runtime][&lt;namespace&gt;]execution retry delays"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">flow.cylc[runtime][&lt;namespace&gt;]execution</span> <span class="pre">retry</span> <span class="pre">delays</span></code></a>.</p>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">id</span></code></dt>
<dd><p>The task ID (i.e. <code class="docutils literal notranslate"><span class="pre">%(point)/%(name)</span></code>).</p>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">message</span></code></dt>
<dd><p>Events message, if any.</p>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">job_runner_name</span></code></dt>
<dd><p>The job runner name.</p>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">batch_sys_name</span></code></dt>
<dd><p>The job runner name.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 8.0.0: </span>Use “job_runner_name”.</p>
</div>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">job_id</span></code></dt>
<dd><p>The job ID in the job runner.</p>
<p>I.E. The job submission ID. For background jobs this is the process ID.</p>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">batch_sys_job_id</span></code></dt>
<dd><p>The job ID in the job runner.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 8.0.0: </span>Use “job_id”.</p>
</div>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">submit_time</span></code></dt>
<dd><p>Date-time when the job was submitted, in ISO8601 format.</p>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">start_time</span></code></dt>
<dd><p>Date-time when the job started, in ISO8601 format.</p>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">finish_time</span></code></dt>
<dd><p>Date-time when the job finished, in ISO8601 format.</p>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">platform_name</span></code></dt>
<dd><p>The name of the platform where the job is submitted.</p>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">user&#64;host</span></code></dt>
<dd><p>The name of the platform where the job is submitted.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 8.0.0: </span>Use “platform_name”.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 8.0.0: </span>This now provides the platform name rather than <code class="docutils literal notranslate"><span class="pre">user&#64;host</span></code>.</p>
</div>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">name</span></code></dt>
<dd><p>The name of the task.</p>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">task_url</span></code></dt>
<dd><p>The URL defined in the task’s metadata.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 8.0.0: </span>Use <code class="docutils literal notranslate"><span class="pre">URL</span></code> from <code class="docutils literal notranslate"><span class="pre">&lt;task</span> <span class="pre">metadata&gt;</span></code>.</p>
</div>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">workflow_url</span></code></dt>
<dd><p>The URL defined in the workflow’s metadata.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 8.0.0: </span>Use <code class="docutils literal notranslate"><span class="pre">workflow_URL</span></code> from <code class="docutils literal notranslate"><span class="pre">workflow_&lt;workflow</span> <span class="pre">metadata&gt;</span></code>.</p>
</div>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">&lt;task</span> <span class="pre">metadata&gt;</span></code></dt>
<dd><p>Any task metadata defined in
<a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime][&lt;namespace&gt;][meta]" title="flow.cylc[runtime][&lt;namespace&gt;][meta]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">flow.cylc[runtime][&lt;namespace&gt;][meta]</span></code></a> can be used e.g:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">%(title)s</span></code></dt><dd>Task title</dd>
<dt><code class="docutils literal notranslate"><span class="pre">%(URL)s</span></code></dt><dd>Task URL</dd>
<dt><code class="docutils literal notranslate"><span class="pre">%(importance)s</span></code></dt><dd>Example custom task metadata</dd>
</dl>
</dd></dl>

<dl class="describe">
<dt class="sig sig-object">
<code class="sig-name descname"><span class="pre">workflow_&lt;workflow</span> <span class="pre">metadata&gt;</span></code></dt>
<dd><p>Any workflow metadata defined in
<a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[meta]" title="flow.cylc[meta]"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">flow.cylc[meta]</span></code></a> can be used with the <code class="docutils literal notranslate"><span class="pre">workflow_</span></code>
e.g. prefix:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">%(workflow_title)s</span></code></dt><dd>Workflow title</dd>
<dt><code class="docutils literal notranslate"><span class="pre">%(workflow_URL)s</span></code></dt><dd>Workflow URL.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">%(workflow_rating)s</span></code></dt><dd>Example custom workflow metadata.</dd>
</dl>
</dd></dl>

</dl>





</article>
<article class="slide level-3" id="examples">

<h3>Examples<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#examples" title="View HTML">§</a></h3>

<p>The following <a class="reference internal" href="../../reference/config/workflow.html#flow.cylc" title="flow.cylc"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">flow.cylc</span></code></a> snippets illustrate the two (general and
task-specific) ways to configure event handlers:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> test ${CYLC_TASK_TRY_NUMBER} -eq 2</span>
        <span class="nv">execution retry delays </span><span class="o">=</span><span class="s"> PT0S, PT30S</span>
        <span class="nt">[[[events]]]</span>  <span class="c1"># event-specific handlers:</span>
            <span class="nv">retry handlers </span><span class="o">=</span><span class="s"> notify-retry.py</span>
            <span class="nv">failed handlers </span><span class="o">=</span><span class="s"> notify-failed.py</span>
</pre></div>
</div>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nv">script </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            test ${CYLC_TASK_TRY_NUMBER} -eq 2</span>
<span class="s2">            cylc message -- &quot;${CYLC_WORKFLOW_ID}&quot; &quot;${CYLC_TASK_JOB}&quot; &#39;oopsy daisy&#39;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="nv">execution retry delays </span><span class="o">=</span><span class="s"> PT0S, PT30S</span>
        <span class="nt">[[[events]]]</span>  <span class="c1"># general handlers:</span>
            <span class="nv">handlers </span><span class="o">=</span><span class="s"> notify-events.py</span>
            <span class="c1"># Note: task output name can be used as an event in this method</span>
            <span class="nv">handler events </span><span class="o">=</span><span class="s"> retry, failed, oops</span>
        <span class="nt">[[[outputs]]]</span>
            <span class="nv">oops </span><span class="o">=</span><span class="s"> oopsy daisy</span>
</pre></div>
</div>




</article>
<article class="slide level-3" id="built-in-email-event-handler">

<h3>Built-in Email Event Handler<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#built-in-email-event-handler" title="View HTML">§</a></h3>

<p>To send an email on task events, configure relevant tasks with a list of events
to handle by email. Custom task output names can also be used as event names,
in which case the event triggers when the output message is received.</p>
<p>E.g. to send an email on task failed, retry, and a custom message event:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
    <span class="nt">[[foo]]</span>
        <span class="nv">script </span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            test ${CYLC_TASK_TRY_NUMBER} -eq 3</span>
<span class="s2">            cylc message -- &quot;${CYLC_WORKFLOW_ID}&quot; &quot;${CYLC_TASK_JOB}&quot; &#39;oopsy daisy&#39;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="nv">execution retry delays </span><span class="o">=</span><span class="s"> PT0S, PT30S</span>
        <span class="nt">[[[events]]]</span>
            <span class="nv">mail events </span><span class="o">=</span><span class="s"> failed, retry, oops</span>
        <span class="nt">[[[outputs]]]</span>
            <span class="nv">oops </span><span class="o">=</span><span class="s"> oopsy daisy</span>
</pre></div>
</div>
<p>By default, event emails will be sent to the current user with:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">to:</span></code> set as <code class="docutils literal notranslate"><span class="pre">$USER</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">from:</span></code> set as <code class="docutils literal notranslate"><span class="pre">notifications&#64;$(hostname)</span></code></li>
<li>SMTP server at <code class="docutils literal notranslate"><span class="pre">localhost:25</span></code></li>
</ul>
<p>These can be configured using the settings:</p>
<ul class="simple">
<li><a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime][&lt;namespace&gt;][mail]to" title="flow.cylc[runtime][&lt;namespace&gt;][mail]to"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[mail]to</span></code></a> (list of email addresses)</li>
<li><a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[runtime][&lt;namespace&gt;][mail]from" title="flow.cylc[runtime][&lt;namespace&gt;][mail]from"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[mail]from</span></code></a></li>
</ul>
<p>The scheduler batches events over a 5 minute interval, by default, to avoid
flooding your Inbox if many events occur in a short time. The batching interval
can be configured with <a class="reference internal" href="../../reference/config/workflow.html#flow.cylc[scheduler][mail]task event batch interval" title="flow.cylc[scheduler][mail]task event batch interval"><code class="xref cylc cylc-conf docutils literal notranslate"><span class="pre">[scheduler][mail]task</span> <span class="pre">event</span> <span class="pre">batch</span> <span class="pre">interval</span></code></a>.</p>




</article>
<article class="slide level-3" id="late-events">

<h3>Late Events<a class="headerlink" href="../../../html/user-guide/writing-workflows/runtime.html#late-events" title="View HTML">§</a></h3>

<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The scheduler can only check for lateness once a task has appeared in its
active task window. In Cylc 8 this is usually when the task is actually
ready to run, which severely limits the usefulness of late events as
currently implemented.</p>
</div>
<p>If a real time (clock-triggered) workflow performs fairly consistently from one
cycle to the next, you may want to be notified when certain tasks are running
late with respect the time they normally trigger in each cycle.</p>
<p>Cylc can generate a <em>late</em> event if a task has not triggered by a given offset
from its cycle point in real time. For example, if a task <code class="docutils literal notranslate"><span class="pre">forecast</span></code> normally
triggers at 30 minutes after cycle point, a late event could be configured like this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[runtime]</span>
   <span class="nt">[[forecast]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> run-model.sh</span>
        <span class="nt">[[[events]]]</span>
            <span class="nv">late offset </span><span class="o">=</span><span class="s"> PT40M</span>  <span class="c1"># allow a 10 minute delay</span>
            <span class="nv">late handlers </span><span class="o">=</span><span class="s"> my-handler %(message)s</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Late offset intervals are not computed automatically so be careful to update
them after any workflow change that affects triggering times.</p>
</div>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>The order of precedence for inheritance from multiple parents is
determined by the <a class="reference external" href="https://en.wikipedia.org/wiki/C3_linearization">C3 algorithm</a> used to find
the linear method resolution order for multiple inheritance in Python.</td></tr>
</tbody>
</table>




</article>

</section>

<section id="slide_notes">

</section>

  </body>
</html>